<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personalizada Tu propia Mezcla</title>

    <!-- Google Fonts for elegant style -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Alpine.js CDN -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.0/dist/cdn.min.js"></script>

    <style>
        [x-cloak] {
            display: none !important;
        }

        .font-elegant {
            font-family: 'Playfair Display', serif;
        }

        .font-body {
            font-family: 'Roboto', sans-serif;
        }

        .transition-height {
            transition: max-height 0.5s ease-in-out;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #4A5D23;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        html {
            scroll-behavior: smooth;
        }
        
        body.overflow-hidden {
            overflow: hidden;
        }

        .group:hover .group-hover\:opacity-100,
        .group:focus-within .group-hover\:opacity-100 {
            opacity: 1;
        }
    </style>
</head>

<body class="bg-stone-100 text-slate-800 font-body">

    <div id="payment-banner" class="fixed bottom-0 left-0 w-full bg-slate-800 text-white p-3 z-50 text-center text-sm md:text-base">
        <div class="container mx-auto">
            <p>
                <strong class="font-bold text-orange-300">FORMA DE PAGO:</strong> Se acordará por WhatsApp una vez finalices tu pedido. Aceptamos TRANSFERENCIA, NEQUI, DAVIPLATA, DALE y EFECTIVO.
            </p>
        </div>
    </div>

    <div class="container mx-auto max-w-4xl p-4 sm:p-6 lg:p-8 pb-32 md:pb-24" x-data="mixBuilder()" @keydown.escape.window="handleEscape()" x-cloak>
        <header id="header" class="text-center mb-8">
            <div class="flex justify-center items-center space-x-4">
                <img src="https://i.ibb.co/svMK2wRn/Airbrush-Image-Enhancer-1752901262222.jpg" alt="Logo Izquierda" width="280" height="280">
            </div>
            <p class="mt-4 max-w-3xl mx-auto text-slate-700 leading-relaxed">
                Tú tienes el control. Crea tu mix ideal con nuestra selección premium y disfruta de un bocado saludable, hecho perfectamente para ti.
            </p>
        </header>

        <div id="selection-tabs" class="mb-8">
            <div class="mb-6 flex justify-center">
                <div class="inline-flex border border-slate-300 rounded-lg p-1 bg-slate-200">
                    <button @click="activeTab = 0"
                            :class="{ 'bg-white text-slate-800 shadow-md': activeTab === 0, 'text-slate-600 hover:bg-slate-100': activeTab !== 0 }"
                            class="flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-3 rounded-md font-semibold text-sm sm:text-base transition-colors duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path d="M5 4a1 1 0 00-2 0v7.268a2 2 0 000 3.464V16a1 1 0 102 0v-1.268a2 2 0 000-3.464V4zM11 4a1 1 0 10-2 0v1.268a2 2 0 000 3.464V16a1 1 0 102 0V8.732a2 2 0 000-3.464V4zM16 3a1 1 0 011 1v7.268a2 2 0 010 3.464V16a1 1 0 11-2 0v-1.268a2 2 0 010-3.464V4a1 1 0 011-1z" /></svg>
                        <span class="text-center leading-tight">Crea tu<br class="hidden sm:block"> Mix</span>
                    </button>
                    <button @click="activeTab = 1"
                            :class="{ 'bg-white text-slate-800 shadow-md': activeTab === 1, 'text-slate-600 hover:bg-slate-100': activeTab !== 1 }"
                            class="flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-3 rounded-md font-semibold text-sm sm:text-base transition-colors duration-300">
                       <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
                        </svg>
                        <span class="text-center leading-tight">Productos</span>
                    </button>
                    <button @click="activeTab = 3"
                            :class="{ 'bg-white text-slate-800 shadow-md': activeTab === 3, 'text-slate-600 hover:bg-slate-100': activeTab !== 3 }"
                            class="flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-3 rounded-md font-semibold text-sm sm:text-base transition-colors duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5 5a3 3 0 013-3h4a3 3 0 013 3v1h-2v-1a1 1 0 00-1-1H8a1 1 0 00-1 1v1H5V5zM2 8a2 2 0 012-2h12a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V8zm5 3a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1z" clip-rule="evenodd" />
                        </svg>
                        <span class="text-center leading-tight">Envases &<br class="hidden sm:block"> Empaques</span>
                    </button>
                    <button @click="activeTab = 2"
                            :class="{ 'bg-white text-slate-800 shadow-md': activeTab === 2, 'text-slate-600 hover:bg-slate-100': activeTab !== 2 }"
                            class="flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-3 rounded-md font-semibold text-sm sm:text-base transition-colors duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" /></svg>
                        <span class="text-center leading-tight">Mixes<br>Vitales</span>
                    </button>

                </div>
            </div>

            <hr class="border-t border-slate-200 my-6">

            <div class="pt-4 pb-4">
                <div :class="{ '!block': activeTab === 0 }" x-show.transition.in.opacity.duration.600="activeTab === 0" class="hidden">
                    <div class="mb-6 flex justify-center text-sm">
                        <div class="inline-flex border border-slate-300 rounded-lg p-1 bg-slate-200">
                            <button @click="changeSubTab(0)"
                                    :class="{ 'bg-white text-[#4A5D23] shadow-md': activeSubTab === 0, 'text-slate-600 hover:bg-slate-100': activeSubTab !== 0 }"
                                    class="flex items-center gap-2 px-4 py-2 rounded-md font-semibold transition-colors duration-300">
                                Mix por Cantidad
                            </button>
                            <button @click="changeSubTab(1)"
                                    :class="{ 'bg-white text-[#4A5D23] shadow-md': activeSubTab === 1, 'text-slate-600 hover:bg-slate-100': activeSubTab !== 1 }"
                                    class="flex items-center gap-2 px-4 py-2 rounded-md font-semibold transition-colors duration-300">
                                Mix por Porcentajes
                            </button>
                            <button @click="changeSubTab(2)"
                                    :class="{ 'bg-white text-[#4A5D23] shadow-md': activeSubTab === 2, 'text-slate-600 hover:bg-slate-100': activeSubTab !== 2 }"
                                    class="flex items-center gap-2 px-4 py-2 rounded-md font-semibold transition-colors duration-300">
                                A granel (Individual)
                            </button>
                        </div>
                    </div>
                    
                    <div x-show="activeSubTab === 0" x-transition>
                        <p class="mb-6 text-center font-elegant text-slate-700 text-lg">Indica la cantidad en gramos de cada fruto que deseas combinar</p>
                        <div class="text-center text-sm text-slate-700 mb-6 bg-[#eef3e6] p-3 rounded-md border border-[#dce6cf]">
                            <p class="font-bold text-[#4A5D23]">Aprovecha nuestro descuento por cantidad</p>
                            <p><strong>750 g o más</strong> → <span class="font-semibold">5 % de descuento</span></p>
                        </div>
                        <!-- CÓDIGO MEJORADO CON BOTÓN 'X' -->
<div class="relative">
    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
        <svg class="h-5 w-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
        </svg>
    </div>
    <!-- MODIFICACIÓN: Añadimos 'pr-10' y lo metimos en un div -->
    <input type="text" x-model.debounce.300ms="mixSearchQuery" placeholder="Buscar un fruto para tu mezcla..." class="w-full rounded-lg border-2 border-slate-300 bg-white p-2 pl-10 pr-10 shadow-sm transition focus:border-[#4A5D23] focus:ring-1 focus:ring-[#4A5D23]">
    <!-- NUEVO: El botón 'X' que aparece cuando hay texto -->
    <div x-show="mixSearchQuery.length > 0" x-transition class="absolute inset-y-0 right-0 flex items-center">
        <button @click="mixSearchQuery = ''" type="button" class="p-2 text-slate-500 hover:text-slate-700 focus:outline-none">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
            </svg>
        </button>
    </div>
</div>
                        <div class="grid grid-cols-1 divide-y divide-slate-200">
                            <div class="grid grid-cols-[3fr,2fr] gap-4 font-semibold text-slate-500 pb-2 mb-2 px-2">
				                <span>FRUTO (COSTO X GRAMO)</span>
				                <span class="text-center">CANTIDAD</span>	
       			            </div>
                            <template x-for="nut in filteredNuts" :key="nut.name">
                                <div class="grid grid-cols-[3fr,2fr] gap-4 items-center py-3 group relative">
                                    <div class="flex items-center gap-3">
                                        <div @click="openImageModal(nut.imageUrl)" class="relative w-12 h-12 flex-shrink-0 cursor-pointer group/image">
                                            <img :src="nut.imageUrl" :alt="nut.name" class="w-12 h-12 rounded-md object-cover">
                                            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover/image:bg-opacity-50 flex items-center justify-center transition-all duration-300 rounded-md">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-white opacity-0 group-hover/image:opacity-100 transition-opacity">
                                                    <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Zm5-2.25a.75.75 0 0 1 .75.75v1.5h1.5a.75.75 0 0 1 0 1.5h-1.5v1.5a.75.75 0 0 1-1.5 0v-1.5h-1.5a.75.75 0 0 1 0-1.5h1.5v-1.5a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd" />
                                                </svg>
                                            </div>
                                        </div>
                                        <div>
                                            <span x-text="nut.name" class="font-medium text-slate-700 text-justify"></span>
                                            <p class="text-[#4A5D23] font-semibold" x-text="(formatCurrency(nut.price) + '/gr')"></p>
                                            <p x-show="largeFruits.includes(nut.name)" class="text-xs italic text-indigo-600 mt-1">✨ Opción de corte en trozos disponible</p>
                                        </div>
                                    </div>
                                    <div class="relative">
                                        <span class="absolute -top-7 left-1/2 -translate-x-1/2 text-xs bg-gray-700 text-white px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap"
                                              x-text="'Total gramos Mix: ' + currentMix.totalGrams.toFixed(0) + 'g'">
                                        </span>
                                        <input type="number" min="0" x-model.number.debounce="nut.grams" 
                                               :disabled="nut.name === 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Con cáscara)'"
                                               class="w-full text-center border-2 border-slate-300 rounded-md shadow-sm p-2 focus:border-[#4A5D23] focus:ring-[#4A5D23] pr-8 disabled:bg-slate-200 disabled:cursor-not-allowed">
                                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 select-none">gr</span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <div x-show="activeSubTab === 1" x-transition>
                        <p class="mb-6 text-center font-elegant text-slate-700 text-lg">Define un peso total y luego distribuye el 100% entre tus frutos favoritos</p>
                        <div class="text-center text-sm text-slate-700 mb-6 bg-[#eef3e6] p-3 rounded-md border border-[#dce6cf]">
                            <p class="font-bold text-[#4A5D23]">Aprovecha nuestro descuento por cantidad</p>
                            <p><strong>750 g o más</strong> → <span class="font-semibold">5 % de descuento</span></p>
                        </div>
                        <div class="mb-6">
                            <label for="totalGrams" class="block text-sm font-medium text-slate-700 text-center mb-2">Ingresa la cantidad total de tu Mezcla (Gramos)</label>
                            <div class="relative max-w-xs mx-auto">
                                <input id="totalGrams" type="number" min="0" x-model.number="totalGramsForPercentage" class="w-full text-center border-2 border-slate-300 rounded-md shadow-sm p-2 focus:border-[#4A5D23] focus:ring-[#4A5D23] transition-colors">
                            </div>
                        </div>
                        
                        <div x-show="activeSubTab === 1" x-transition class="sticky top-2 z-30 mb-4">
                            <div class="bg-white p-3 rounded-lg shadow-lg border border-slate-200 flex items-center justify-center gap-4">
                                <div class="relative w-20 h-20">
                                    <svg class="w-full h-full" viewBox="0 0 36 36">
                                        <path class="text-slate-200" stroke="currentColor" stroke-width="3" fill="none"
                                              d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                        <path class="text-[#4A5D23] transition-all duration-500" stroke="currentColor" stroke-width="3" fill="none"
                                              stroke-linecap="round"
                                              :stroke-dasharray="circumference"
                                              :stroke-dashoffset="progressOffset"
                                              d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    </svg>
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <span class="text-lg font-bold text-slate-700" x-text="`${currentMix.totalPercentage}%`"></span>
                                    </div>
                                </div>
                                <div class="text-left">
                                    <p class="font-bold text-slate-800">Progreso de tu Mezcla</p>
                                    <p class="text-sm text-slate-600" x-text="percentageTooltipMessage"></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-6 px-2">
                       <!-- CÓDIGO MEJORADO CON BOTÓN 'X' -->
<div class="relative">
    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
        <svg class="h-5 w-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
        </svg>
    </div>
    <!-- MODIFICACIÓN: Añadimos 'pr-10' y lo metimos en un div -->
    <input type="text" x-model.debounce.300ms="mixSearchQuery" placeholder="Buscar un fruto para tu mezcla..." class="w-full rounded-lg border-2 border-slate-300 bg-white p-2 pl-10 pr-10 shadow-sm transition focus:border-[#4A5D23] focus:ring-1 focus:ring-[#4A5D23]">
    <!-- NUEVO: El botón 'X' que aparece cuando hay texto -->
    <div x-show="mixSearchQuery.length > 0" x-transition class="absolute inset-y-0 right-0 flex items-center">
        <button @click="mixSearchQuery = ''" type="button" class="p-2 text-slate-500 hover:text-slate-700 focus:outline-none">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
            </svg>
        </button>
    </div>
</div>    
                        </div>
                        <div class="relative grid grid-cols-1 divide-y divide-slate-200">
                            <div class="grid grid-cols-[3fr,2fr] gap-4 font-semibold text-slate-500 pb-2 mb-2 px-2"><span>FRUTO (COSTO X GRAMO)</span><span class="text-center">PORCENTAJE</span></div>
                            <template x-for="nut in filteredNuts" :key="nut.name">
                                <div class="relative group grid grid-cols-[3fr,2fr] gap-4 items-center py-3">
                                    <div class="flex items-center gap-3">
                                        <div @click="openImageModal(nut.imageUrl)" class="relative w-12 h-12 flex-shrink-0 cursor-pointer group/image">
                                            <img :src="nut.imageUrl" :alt="nut.name" class="w-12 h-12 rounded-md object-cover">
                                            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover/image:bg-opacity-50 flex items-center justify-center transition-all duration-300 rounded-md">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-white opacity-0 group-hover/image:opacity-100 transition-opacity">
                                                    <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Zm5-2.25a.75.75 0 0 1 .75.75v1.5h1.5a.75.75 0 0 1 0 1.5h-1.5v1.5a.75.75 0 0 1-1.5 0v-1.5h-1.5a.75.75 0 0 1 0-1.5h1.5v-1.5a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd" />
                                                </svg>
                                            </div>
                                        </div>
                                        <div>
                                            <span x-text="nut.name" class="font-medium text-slate-700 text-justify"></span>
                                            <p class="text-[#4A5D23] font-semibold" x-text="(formatCurrency(nut.price) + '/gr')"></p>
                                            <p x-show="largeFruits.includes(nut.name)" class="text-xs italic text-indigo-600 mt-1">✨ Opción de corte en trozos disponible</p>
                                        </div>
                                    </div>
                                    <div class="relative">
                                        <span class="absolute -bottom-8 left-1/2 -translate-x-1/2 text-xs bg-gray-700 text-white px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap"
                                              x-text="percentageTooltipMessage">
                                        </span>
                                        <input type="number" min="0" max="100" x-model.number.debounce="nut.percentage"
                                               :disabled="nut.name === 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Con cáscara)'"
                                               class="w-full text-center border-2 border-slate-300 rounded-md shadow-sm p-2 focus:border-[#4A5D23] focus:ring-[#4A5D23] pr-8 disabled:bg-slate-200 disabled:cursor-not-allowed">
                                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 select-none">%</span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <div x-show="activeSubTab === 2" x-transition>
                        <p class="mb-6 text-center font-elegant text-slate-700 text-lg">Indica la cantidad exacta de tu fruto favorito</p>
                        <div class="text-center text-sm text-slate-700 mb-6 bg-[#eef3e6] p-3 rounded-md border border-[#dce6cf]">
                            <p class="font-bold text-[#4A5D23]">Aprovecha nuestro descuento por cantidad</p>
                            <p><strong>750g o más</strong> → <span class="font-semibold">5 % de descuento</span></p>
                        </div>
                        <div class="grid grid-cols-1 divide-y divide-slate-200">
                            <!-- CÓDIGO MEJORADO CON BOTÓN 'X' -->
<div class="relative">
    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
        <svg class="h-5 w-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
        </svg>
    </div>
    <!-- MODIFICACIÓN: Añadimos 'pr-10' y lo metimos en un div -->
    <input type="text" x-model.debounce.300ms="mixSearchQuery" placeholder="Buscar un fruto para tu mezcla..." class="w-full rounded-lg border-2 border-slate-300 bg-white p-2 pl-10 pr-10 shadow-sm transition focus:border-[#4A5D23] focus:ring-1 focus:ring-[#4A5D23]">
    <!-- NUEVO: El botón 'X' que aparece cuando hay texto -->
    <div x-show="mixSearchQuery.length > 0" x-transition class="absolute inset-y-0 right-0 flex items-center">
        <button @click="mixSearchQuery = ''" type="button" class="p-2 text-slate-500 hover:text-slate-700 focus:outline-none">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
            </svg>
        </button>
    </div>
</div>
                            <div class="grid grid-cols-[3fr,1.5fr,1.5fr] gap-4 font-semibold text-slate-500 pb-2 mb-2 px-2">
                                <span>FRUTO (COSTO X GRAMO)</span>
                                <span class="text-center">CANTIDAD</span>
                                <span></span>
                            </div>
                            <template x-for="nut in filteredNuts" :key="nut.name">
                                <div class="grid grid-cols-[3fr,1.5fr,1.5fr] gap-4 items-center py-3">
                                    <div class="flex items-center gap-3">
                                        <div @click="openImageModal(nut.imageUrl)" class="relative w-12 h-12 flex-shrink-0 cursor-pointer group/image">
                                            <img :src="nut.imageUrl" :alt="nut.name" class="w-12 h-12 rounded-md object-cover">
                                            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover/image:bg-opacity-50 flex items-center justify-center transition-all duration-300 rounded-md">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-white opacity-0 group-hover/image:opacity-100 transition-opacity"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Zm5-2.25a.75.75 0 0 1 .75.75v1.5h1.5a.75.75 0 0 1 0 1.5h-1.5v1.5a.75.75 0 0 1-1.5 0v-1.5h-1.5a.75.75 0 0 1 0-1.5h1.5v-1.5a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd" /></svg>
                                            </div>
                                        </div>
                                        <div>
                                            <span x-text="nut.name" class="font-medium text-slate-700 text-justify"></span>
                                            <p class="text-[#4A5D23] font-semibold" x-text="(formatCurrency(nut.price) + '/gr')"></p>
                                            <p x-show="largeFruits.includes(nut.name)" class="text-xs italic text-indigo-600 mt-1">✨ Opción de corte en trozos disponible</p>
                                        </div>
                                    </div>
                                    <div class="relative">
                                        <input type="number" min="0" x-model.number="nut.grams"
                                               @input="handleIndividualSelection(nut)"
                                               :disabled="selectedIndividualNutName && selectedIndividualNutName !== nut.name"
                                               class="w-full text-center border-2 border-slate-300 rounded-md shadow-sm p-2 focus:border-[#4A5D23] focus:ring-[#4A5D23] pr-8 disabled:bg-slate-200 disabled:cursor-not-allowed">
                                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 select-none">gr</span>
                                    </div>
                                    <div class="text-center">
                                        <button @click="handleIndividualAddToCart(nut)"
                                                class="w-full font-bold py-2 px-4 rounded-lg transition-all text-white"
                                                :class="{
                                                    'bg-[#4A5D23] hover:bg-[#3b4a1c] shadow-md': !nut.justAddedIndividual,
                                                    'bg-green-600': nut.justAddedIndividual
                                                }">
                                            <span x-show="!nut.justAddedIndividual" class="flex items-center justify-center gap-1">
                                                 <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l.892-.892L7.793 8H14a1 1 0 00.994-.883l1.928-6.432A1 1 0 0015.958 0H4.592a1 1 0 00-.986.816L3.43 2H3z" /><path d="M6 16a2 2 0 11-4 0 2 2 0 014 0zM15 16a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                                                Añadir
                                            </span>
                                            <span x-show="nut.justAddedIndividual" class="flex items-center justify-center gap-1">
                                                ¡Añadido!
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                                            </span>
                                        </button>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <div x-show="activeSubTab === 0 || activeSubTab === 1">
                        <div id="add-to-cart-section" class="mt-6">
                            <div class="pt-4 border-t border-slate-200 bg-white p-4 rounded-lg">
                                <h3 class="font-bold text-lg mb-2 text-slate-800">Resumen de Compra Actual</h3>
                                <div class="flex justify-between"><span class="text-slate-600">Total Gramos:</span><span class="font-semibold" x-text="currentMix.totalGrams.toFixed(0) + ' g'"></span></div>
                                <div x-show="activeSubTab === 1" class="flex justify-between items-center">
                                    <span class="text-slate-600">Total Porcentaje:</span>
                                    <span class="font-semibold px-2 py-0.5 rounded" :class="{'text-green-800 bg-green-200': currentMix.totalPercentage === 100, 'text-red-800 bg-red-200': currentMix.totalPercentage !== 100}" x-text="currentMix.totalPercentage + '%'"></span>
                                </div>
                                <p x-show="activeSubTab === 1 && currentMix.totalPercentage !== 100" class="text-red-600 text-sm text-right">El total debe ser 100% para añadir.</p>
                                <div class="flex justify-between"><span class="text-slate-600">Subtotal:</span><span class="font-semibold" x-text="formatCurrency(currentMix.subtotal)"></span></div>
                                <div x-show="currentMix.discount > 0" class="flex justify-between text-[#4A5D23]">
                                    <span class="text-[#4A5D23]" x-text="`Descuento por cantidad (${currentMix.discountPercentage}%):`"></span>
                                    <span class="font-semibold" x-text="'-' + formatCurrency(currentMix.discount)"></span>
                                </div>
                                <div class="flex justify-between text-xl"><span class="font-bold">Costo Mezcla:</span><span class="font-bold text-slate-800" x-text="formatCurrency(currentMix.cost)"></span></div>
                            </div>
                            <div class="mt-6">
                                <button @click="handleAddToCart()" class="w-full font-bold py-3 px-4 rounded-lg transition-all"
                                        :class="{'bg-[#4A5D23] hover:bg-[#3b4a1c] text-white shadow-lg': !justAdded, 'bg-slate-500 text-white': justAdded}">
                                    <span x-show="!justAdded">Añadir Compra</span>
                                    <span x-show="justAdded" class="flex items-center justify-center gap-2">
                                        ¡Añadido!
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                                    </span>
                                </button>
                                <p class="text-center text-sm text-slate-500 mt-2">Puedes añadir las mezclas que desees.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div :class="{ '!block': activeTab === 1 }" x-show.transition.in.opacity.duration.600="activeTab === 1" class="hidden">
                    <div class="mb-6">
                        <h2 class="text-3xl font-elegant font-bold text-slate-900 text-center mb-4">Nuestros Productos</h2>
                        <p class="text-center text-slate-600 mb-8">Explora nuestra selección premium de frutos secos y frutas deshidratadas.</p>
                    </div>
<!-- CÓDIGO MEJORADO CON BOTÓN 'X' -->
<div class="mb-8 px-4 sm:px-0">
    <div class="relative">
        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
            <svg class="h-5 w-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
            </svg>
        </div>
        <!-- MODIFICACIÓN: Añadimos 'pr-10' para dar espacio al botón 'X' -->
        <input type="text" x-model.debounce.300ms="searchQuery" placeholder="Buscar un producto..." class="w-full rounded-lg border-2 border-slate-300 bg-white p-2 pl-10 pr-10 shadow-sm transition focus:border-[#4A5D23] focus:ring-1 focus:ring-[#4A5D23]">
        <!-- NUEVO: El botón 'X' que aparece cuando hay texto -->
        <div x-show="searchQuery.length > 0" x-transition class="absolute inset-y-0 right-0 flex items-center">
            <button @click="searchQuery = ''" type="button" class="p-2 text-slate-500 hover:text-slate-700 focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>
    </div>
</div>
                    <div class="flex justify-center flex-wrap gap-2 mb-8">
                        <button @click="productFilter = 'Todos'; searchQuery = ''" class="px-4 py-2 text-sm font-medium rounded-full transition-colors" :class="{'bg-[#4A5D23] text-white': productFilter === 'Todos', 'bg-slate-200 text-slate-700 hover:bg-slate-300': productFilter !== 'Todos'}">Todos</button>
                        <button @click="productFilter = 'Frutos Secos'; searchQuery = ''" class="px-4 py-2 text-sm font-medium rounded-full transition-colors" :class="{'bg-[#4A5D23] text-white': productFilter === 'Frutos Secos', 'bg-slate-200 text-slate-700 hover:bg-slate-300': productFilter !== 'Frutos Secos'}">Frutos Secos</button>
                        <button @click="productFilter = 'Frutos Deshidratados'; searchQuery = ''" class="px-4 py-2 text-sm font-medium rounded-full transition-colors" :class="{'bg-[#4A5D23] text-white': productFilter === 'Frutos Deshidratados', 'bg-slate-200 text-slate-700 hover:bg-slate-300': productFilter !== 'Frutos Deshidratados'}">Frutos Deshidratados</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <template x-for="nut in nuts.filter(n => (productFilter === 'Todos' || n.category === productFilter) && (normalizeText(n.name).includes(normalizeText(searchQuery))))" :key="nut.name">
                            <div class="bg-white border border-slate-200 rounded-lg overflow-hidden shadow-md hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
                                <img :src="nut.imageUrl" :alt="nut.name" class="w-full h-48 object-cover object-top">
                                <div class="p-4 flex flex-col justify-between min-h-0 md:min-h-[188px]">
                                    <div>
                                        <h3 class="font-bold text-slate-800 mb-2" x-text="nut.name"></h3>
                                        <p class="text-[#4A5D23] font-semibold mb-3" x-text="formatCurrency(nut.price) + '/gr'"></p>
                                    </div>
                                    <button @click="viewProduct(nut)"
                                            class="w-full bg-[#4A5D23] hover:bg-[#3b4a1c] text-white font-bold py-2 px-4 rounded transition-colors">
                                        Ver Detalle
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
                
                <div :class="{ '!block': activeTab === 3 }" x-show.transition.in.opacity.duration.600="activeTab === 3" class="hidden">
                    <div class="mb-6 flex justify-center text-sm">
                        <div class="inline-flex border border-slate-300 rounded-lg p-1 bg-slate-200">
                            <button @click="packagingSubTab = 'glass'"
                                    :class="{ 'bg-white text-[#4A5D23] shadow-md': packagingSubTab === 'glass', 'text-slate-600 hover:bg-slate-100': packagingSubTab !== 'glass' }"
                                    class="flex items-center gap-2 px-4 py-2 rounded-md font-semibold transition-colors duration-300">
                                Envases de Vidrio
                            </button>
                            <button @click="packagingSubTab = 'custom'"
                                    :class="{ 'bg-white text-[#4A5D23] shadow-md': packagingSubTab === 'custom', 'text-slate-600 hover:bg-slate-100': packagingSubTab !== 'custom' }"
                                    class="flex items-center gap-2 px-4 py-2 rounded-md font-semibold transition-colors duration-300">
                                Empaques Personalizados
                            </button>
                        </div>
                    </div>

                    <div x-show="packagingSubTab === 'glass'" x-transition>
                        <div class="mb-6">
                            <h2 class="text-3xl font-elegant font-bold text-slate-900 text-center mb-4">Nuestros Envases de Vidrio</h2>
                            <div class="text-center text-slate-700 max-w-2xl mx-auto mb-8 bg-[#eef3e6] p-4 rounded-lg border border-[#dce6cf]">
                                <p class="font-bold text-[#4A5D23]">¿Cómo añadir envases?</p>
                                <p class="mt-1">Esta es una galería visual. Para seleccionar un envase, primero crea tu mezcla o a granel en las pestañas <strong>"Crea tu Mix"</strong> y/o <strong>"Mixes Vitales"</strong> . Al hacer clic en "Añadir Compra", podrás elegir envase para regalos y seleccionar tus preferidos al igual que personalizar tu etiqueta.</p>
                            </div>
                        </div>
                        
                        <div class="mb-12">
                            <h3 class="text-2xl font-elegant text-slate-800 text-center mb-4">Ideales para Regalo</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    <template x-for="image in giftJarExamples" :key="image.alt">
        <div class="group relative">
            <img :src="image.imageUrl" :alt="image.alt" class="rounded-lg shadow-md aspect-square object-cover">
            
            <!-- Botón de zoom con la misma lógica que las etiquetas -->
            <button @click="openImageModal(image.imageUrl)" type="button" 
                class="absolute top-1.5 right-1.5 bg-slate-800 bg-opacity-60 text-white rounded-full p-1.5 transition-opacity duration-300 hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-white opacity-100 md:opacity-0 md:group-hover:opacity-100">
                <span class="sr-only">Agrandar imagen</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M9.25 13.25a.75.75 0 001.5 0V9.75h3.5a.75.75 0 000-1.5h-3.5V4.75a.75.75 0 00-1.5 0v3.5h-3.5a.75.75 0 000 1.5h3.5v3.5z" />
                  <path fill-rule="evenodd" d="M1.5 10a8.5 8.5 0 1117 0 8.5 8.5 0 01-17 0zM10 2.5a7.5 7.5 0 100 15 7.5 7.5 0 000-15z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>
    </template>
</div>
                        </div>
                        <hr class="border-t-2 border-dashed border-slate-300 my-8">

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            <template x-for="jar in jars" :key="jar.id">
                                <div x-data="{ currentImage: jar.imageUrls[0] }" class="bg-white border border-slate-200 rounded-lg overflow-hidden shadow-md flex flex-col">
                                    <div class="relative bg-slate-50 p-2 group">
    <img :src="currentImage" :alt="jar.name" class="w-full h-56 object-contain">
    
    <!-- Botón de zoom con la misma lógica que las etiquetas -->
    <button @click="openImageModal(currentImage)" type="button" 
        class="absolute top-1.5 right-1.5 bg-slate-800 bg-opacity-60 text-white rounded-full p-1.5 transition-opacity duration-300 hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-white opacity-100 md:opacity-0 md:group-hover:opacity-100">
        <span class="sr-only">Agrandar imagen</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path d="M9.25 13.25a.75.75 0 001.5 0V9.75h3.5a.75.75 0 000-1.5h-3.5V4.75a.75.75 0 00-1.5 0v3.5h-3.5a.75.75 0 000 1.5h3.5v3.5z" />
          <path fill-rule="evenodd" d="M1.5 10a8.5 8.5 0 1117 0 8.5 8.5 0 01-17 0zM10 2.5a7.5 7.5 0 100 15 7.5 7.5 0 000-15z" clip-rule="evenodd" />
        </svg>
    </button>
</div>
                                    <div class="flex justify-center p-2 gap-2 bg-slate-100 border-t">
                                        <template x-for="(url, index) in jar.imageUrls" :key="index">
                                            <img @click="currentImage = url" :src="url" class="w-12 h-12 object-cover rounded-md cursor-pointer border-2 transition" :class="currentImage === url ? 'border-[#4A5D23]' : 'border-transparent hover:border-slate-400'">
                                        </template>
                                    </div>
                                    <div class="p-4 flex flex-col justify-between flex-grow">
                                        <div>
                                            <h3 class="font-bold text-slate-800" x-text="jar.name"></h3>
                                            <p class="text-sm text-slate-500" x-text="`Capacidad : ${jar.capacity}g`"></p>
                                            <p class="text-[#4A5D23] font-semibold text-lg mt-2" x-text="formatCurrency(jar.price)"></p>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <div x-show="packagingSubTab === 'custom'" x-transition>
                        <div class="mb-6">
                            <h2 class="text-3xl font-elegant font-bold text-slate-900 text-center mb-4">Empaques Personalizados</h2>
                            <p class="text-center text-slate-600 max-w-2xl mx-auto mb-8">
                                Ideal para eventos, regalos corporativos o cualquier ocasión especial. Realizamos cada pieza a tu medida y personalizada para que tu regalo sea tan especial por fuera como por dentro <strong>¿Tienes una idea? Contáctanos y juntos la convertiremos en un proyecto increíble.</strong>
                            </p>
                            <div class="space-y-12">
                                <template x-for="set in customPackagingSets" :key="set.title">
                                    <div>
                                        <h3 class="text-2xl font-elegant text-slate-800 mb-4" x-text="set.title"></h3>
                                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                            <template x-for="image in set.images" :key="image.alt">
                                                <div @click="openImageModal(image.imageUrl)" class="cursor-pointer group">
                                                    <div class="relative">
                                                        <img :src="image.imageUrl" :alt="image.alt" class="rounded-lg shadow-md aspect-square object-cover">
                                                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 flex items-center justify-center transition-all duration-300 rounded-lg">
                                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Zm5-2.25a.75.75 0 0 1 .75.75v1.5h1.5a.75.75 0 0 1 0 1.5h-1.5v1.5a.75.75 0 0 1-1.5 0v-1.5h-1.5a.75.75 0 0 1 0-1.5h1.5v-1.5a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd" /></svg>
                                                        </div>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                            <div class="text-center mt-12 pt-8 border-t-2 border-dashed border-slate-300">
                                <a href="https://wa.me/573123526839?text=Hola%2C%20me%20gustar%C3%ADa%20cotizar%20un%20empaque%20personalizado."
                                   target="_blank" rel="noopener noreferrer"
                                   class="inline-flex items-center gap-3 bg-emerald-700 hover:bg-emerald-800 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 448 512" fill="currentColor"><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zM223.9 439.6c-38.2 0-73.7-11.8-103.6-32.5L100 419.5l-2.3-1.4-86.8 22.7L32.6 351.6c-19.8-31.5-31.5-68.4-31.5-107.6 0-110.3 89.7-200 200-200 55.1 0 105.9 21.6 143.4 59.1 37.5 37.5 59.1 88.3 59.1 143.4-.1 110.4-89.8 200-200.1 200zM324.9 288c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z" /></svg>
                                    <span>Contactar por WhatsApp</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div :class="{ '!block': activeTab === 2 }" x-show.transition.in.opacity.duration.600="activeTab === 2" class="hidden">
                    <h2 class="text-3xl font-elegant font-bold text-slate-900 text-center mb-4">
                        Una Guía para tu Bienestar
                    </h2>
                    <p class="max-w-2xl mx-auto text-slate-600 text-center mb-6">
                        Explora nuestras mezclas diseñadas para potenciar tu vitalidad.
                    </p>
     	            <ol class="flex flex-col sm:flex-row justify-center items-center gap-4 sm:gap-8 my-8 text-slate-700">
                        <li class="flex items-center gap-2">
                            <span class="flex items-center justify-center w-8 h-8 bg-[#4A5D23] text-white font-bold rounded-full">1</span>
                            <span class="font-semibold"><strong>Elige</strong> tu mix de bienestar.</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="flex items-center justify-center w-8 h-8 bg-[#4A5D23] text-white font-bold rounded-full">2</span>
                            <span class="font-semibold"><strong>Indica</strong> los gramos que deseas.</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="flex items-center justify-center w-8 h-8 bg-[#4A5D23] text-white font-bold rounded-full">3</span>
                            <span class="font-semibold"><strong>Añádelo</strong> o <strong>Personalízalo</strong> a tu gusto.</span>
                        </li>
                    </ol>
                    <p class="text-xs text-slate-500 max-w-xl text-center mx-auto italic">
                        Nota: Estas sugerencias no reemplazan el consejo de un profesional de la salud.
                    </p><br>
                    <div class="flex justify-center"><img src="https://i.ibb.co/7J4DD40q/IMG1.png" alt="IMG1" class="rounded-lg shadow-md mb-8" width="206" height="143" >
                    </div>
                    <!-- CÓDIGO MEJORADO CON BOTÓN 'X' -->
<div class="mb-8 px-4 sm:px-0">
    <div class="relative">
        <!-- MODIFICACIÓN: Añadimos 'pr-10' para dar espacio al botón 'X' -->
        <input type="text" x-model.debounce.300ms="vitalMixSearchQuery" placeholder="Buscar mix vital por nombre o beneficio..." class="w-full p-3 border-2 border-slate-300 rounded-lg shadow-sm focus:border-[#4A5D23] focus:ring-[#4A5D23] transition pr-10">
        <!-- NUEVO: El botón 'X' que aparece cuando hay texto -->
        <div x-show="vitalMixSearchQuery.length > 0" x-transition class="absolute inset-y-0 right-0 flex items-center pr-3">
            <button @click="vitalMixSearchQuery = ''" type="button" class="p-2 text-slate-500 hover:text-slate-700 focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>
    </div>
</div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <template x-for="(mix, index) in filteredPredefinedMixes" :key="mix.id">
                            <div class="bg-white border border-slate-300 rounded-xl overflow-hidden flex flex-col relative hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
                                <div class="absolute top-2 right-3 font-elegant text-4xl text-slate-800/10 font-bold select-none" x-text="mix.id.toString().padStart(2, '0')"></div>
                                <div class="p-4 flex flex-col flex-grow">
                                    <div class="flex-grow">
                                        <h3 class="text-xl font-bold font-elegant text-emerald-800" x-text="mix.name"></h3>
                                        <p class="text-sm text-slate-500 mb-4" x-text="mix.subtitle"></p>
					                    <p class="text-sm text-slate-800 text-justify mb-4" x-text="mix.description1"></p>   
                                        <button @click="viewMix(mix)" 
                                            class="text-sm font-semibold text-[#4A5D23] text-justify bg-[#eef3e6] hover:bg-[#dce6cf] px-4 py-2 rounded-full transition-colors duration-200">
                                            Ver Detalle
                                        </button>
                                    </div>
                                    <div class="mt-4 pt-4 border-t border-slate-200 text-center">
                                        <div class="relative w-full max-w-xs mx-auto">
                                            <input type="number" step="50" x-model.number="mix.gramsToAdd" placeholder="Gramos (mín. 100)"
                                                class="w-full text-center border-2 border-slate-300 rounded-md shadow-sm p-2 focus:border-[#4A5D23] focus:ring-[#4A5D23] pr-8">
                                            <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 select-none">gr</span>
                                        </div>
                                        
                                        <div class="flex flex-col items-center gap-2 max-w-xs mx-auto mt-2">
                                            <p x-show="!mix.gramsToAdd || mix.gramsToAdd < 100"
                                               class="text-xs text-slate-500 text-center mb-1 italic"
                                               x-transition:enter="transition ease-out duration-200"
                                               x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
                                               x-transition:leave="transition ease-in duration-200"
                                               x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
                                                Ingresa 100g o más para continuar
                                            </p>
                                            <div class="flex gap-2 w-full">
                                                <button @click="handleAddPredefinedMix(mix)"
                                                        class="bg-[#4A5D23] hover:bg-[#3b4a1c] text-white font-bold text-base py-2 px-4 rounded-lg shadow-lg whitespace-nowrap w-full transition-colors duration-300">
                                                    Añadir
                                                </button>
                                                <button @click="handleOpenCustomization(mix)"
                                                        class="bg-[#A98B61] hover:bg-[#8c714e] text-white font-bold text-base py-2 px-4 rounded-lg shadow-lg whitespace-nowrap w-full transition-colors duration-300">
                                                    Personalizar Mix
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <div class="mt-8 flex justify-end">
                        <button @click="scrollToElement('#header')"
                            class="font-bold py-2 px-6 rounded-lg bg-[#4A5D23] hover:bg-[#3b4a1c] text-white shadow-lg transition-transform hover:scale-105 flex items-center gap-2">
                            Menú principal
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                <path fill-rule="evenodd"
                                    d="M10 17a.75.75 0 0 1-.75-.75V5.612L7.03 7.83a.75.75 0 1 1-1.06-1.06l3.25-3.25a.75.75 0 0 1 1.06 0l3.25 3.25a.75.75 0 1 1-1.06 1.06L10.75 5.612V16.25A.75.75 0 0 1 10 17Z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

         <div x-show="mode === 'productDetail' && selectedNut"
              @keydown.escape.window="backToBuilder()"
              x-data="{ detailTab: 'description' }"
              class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4 overflow-hidden">
             <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col">
                 <div class="flex-shrink-0 flex justify-between items-center p-4 border-b border-gray-200">
                     <div class="w-6 h-6"></div>
                     <button @click="backToBuilder()"
                             class="text-gray-400 hover:text-gray-600 transition-colors">
                         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                         </svg>
                     </button>
                 </div>
                 <div class="flex-1 overflow-y-auto p-6 min-h-0">
                     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                         <div>
                             <img :src="selectedNut?.imageUrl" :alt="selectedNut?.name"
                                  class="w-full h-auto rounded-lg shadow-md mb-4">
                         </div>
                         <div>
                             <h3 class="text-3xl font-elegant font-bold text-slate-900 mb-2"
                                 x-text="selectedNut?.name || ''"></h3>
                             <p class="text-2xl font-semibold text-[#4A5D23] mb-4" x-text="formatCurrency(selectedNut?.price || 0) + '/gr'"></p>
                             <div class="text-sm space-y-2">
                                 <p><strong class="font-semibold text-slate-800">ORIGEN:</strong> <span class="text-slate-600" x-text="selectedNut?.origin"></span></p>
                                 <p><strong class="font-semibold text-slate-800">INGREDIENTES:</strong> <span class="text-slate-600" x-text="selectedNut?.ingredients"></span></p>
                             </div>
                         </div>
                     </div>

                     <div class="mt-6 border-t pt-6">
                         <div class="mb-4 flex justify-center">
                             <div class="inline-flex border border-slate-300 rounded-lg p-1 bg-slate-200">
                                 <button @click="detailTab = 'description'" :class="{'bg-white text-[#4A5D23] shadow-md': detailTab === 'description', 'text-slate-600 hover:bg-slate-100': detailTab !== 'description'}"
                                         class="px-4 py-2 rounded-md font-semibold transition-colors duration-300">
                                     Descripción
                                 </button>
                                 <button @click="detailTab = 'benefits'" :class="{'bg-white text-[#4A5D23] shadow-md': detailTab === 'benefits', 'text-slate-600 hover:bg-slate-100': detailTab !== 'benefits'}"
                                         class="px-4 py-2 rounded-md font-semibold transition-colors duration-300">
                                     Beneficios
                                 </button>
                                 <button @click="detailTab = 'nutrition'" :class="{'bg-white text-[#4A5D23] shadow-md': detailTab === 'nutrition', 'text-slate-600 hover:bg-slate-100': detailTab !== 'nutrition'}"
                                         class="px-4 py-2 rounded-md font-semibold transition-colors duration-300">
                                     Info. Nutricional
                                 </button>
                             </div>
                         </div>
                         <div class="mt-4 text-slate-700 leading-relaxed space-y-3 text-justify bg-white p-4 rounded-lg border">
                             <div x-show="detailTab === 'description'" x-html="selectedNut?.description || ''"></div>
                             <div x-show="detailTab === 'benefits'" x-html="selectedNut?.benefits || ''"></div>
                             <div x-show="detailTab === 'nutrition'" class="flex justify-center" x-html="selectedNut?.nutritionInfo || ''"></div>
                         </div>
                     </div>
                 </div>
                 <div class="flex-shrink-0 p-4 border-t border-gray-200 bg-slate-50 flex justify-end">
                     <button @click="backToBuilder()"
                         class="font-bold py-2 px-6 rounded-lg bg-[#4A5D23] hover:bg-[#3b4a1c] text-white shadow-lg transition-colors">
                         Cerrar
                     </button>
                 </div>
             </div>
         </div>
         
         <div x-show="selectedMix"
              class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4 overflow-hidden">
             <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl h-[80vh] flex flex-col">
                 <div class="flex flex-col h-full">
                     <div class="flex-shrink-0 flex justify-between items-center p-4 border-b border-gray-200">
                         <h2 class="text-xl font-bold text-slate-900" x-text="selectedMix?.name || ''"></h2>
                         <button @click="closeMixDetail()"
                                 class="text-gray-400 hover:text-gray-600 transition-colors">
                             <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                             </svg>
                         </button>
                     </div>
                     <div class="flex-1 overflow-y-auto p-6 min-h-0">
                         <h3 class="text-2xl font-elegant font-bold text-emerald-700" x-text="selectedMix?.name || ''"></h3>
                         <p class="text-md text-slate-500 mb-4" x-text="selectedMix?.subtitle || ''"></p>
                         <p class="text-slate-700 leading-relaxed text-justify mb-6" x-text="selectedMix?.description2 || ''"></p>
                         <div>
                             <p class="text-lg font-bold text-green-700">Ingredientes:</p>
                             <ul class="text-slate-700 list-none mt-2 space-y-1">
                                 <template x-for="ingredient in selectedMix?.ingredients" :key="ingredient">
                                     <li class="font-semibold" x-text="ingredient"></li>
                                 </template>
                             </ul>
                         </div>
                     </div>
                     <div class="flex-shrink-0 p-4 border-t border-gray-200 flex justify-center">
                         <button @click="closeMixDetail()"
                             class="font-bold py-2 px-6 rounded-lg bg-[#4A5D23] hover:bg-[#3b4a1c] text-white shadow-lg transition-colors">
                             Entendido
                         </button>
                     </div>
                 </div>
             </div>
         </div>

         <div x-show="showImageModal"
              x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
              x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
              class="fixed inset-0 z-[200] flex items-center justify-center bg-black bg-opacity-75 p-4">
            <div class="relative max-w-lg max-h-full">
                <img :src="modalImageUrl" alt="Vista previa del producto" class="rounded-lg shadow-lg">
                <button @click="closeImageModal()" class="absolute -top-2 -right-2 bg-white rounded-full p-1 text-slate-700 hover:text-red-500 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
         </div>

        <div x-show="showAlert"
             x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform -translate-y-4" x-transition:enter-end="opacity-100 transform translate-y-0"
             x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100 transform translate-y-0" x-transition:leave-end="opacity-0 transform -translate-y-4"
             class="fixed top-5 left-1/2 -translate-x-1/2 z-[100] bg-red-500 text-white font-semibold py-3 px-6 rounded-lg shadow-lg flex items-center gap-4"
             x-cloak>
            <span x-text="alertMessage"></span>
            <button @click="showAlert = false" class="text-xl font-bold">×</button>
        </div>
        
        <div x-show="customization.showModal"
             class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4 overflow-hidden"
             x-cloak>
            <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col">
                
                <div class="flex-shrink-0 flex justify-between items-center p-4 border-b border-gray-200">
                    <h2 class="text-xl font-bold text-slate-900">Personalizando: <span x-text="customization.mix.name"></span></h2>
                    <button @click="closeCustomizationModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <div class="flex-1 bg-stone-100 overflow-y-auto p-6 min-h-0 space-y-6">
                    <div>
                        <label for="customMixGrams" class="block text-sm font-medium text-slate-700 text-center mb-2">1. Ajusta la cantidad total de tu Mezcla (Gramos)</label>
                        <div class="relative max-w-xs mx-auto">
                            <input id="customMixGrams" type="number" min="100" x-model.number="customization.totalGrams" class="w-full text-center border-2 rounded-md shadow-sm p-2 focus:border-[#4A5D23] focus:ring-[#4A5D23] transition-colors"
                                   :class="{'border-red-500 ring-2 ring-red-300': customization.totalPercentage !== 100 && customization.totalGrams > 0, 'border-slate-300': customization.totalPercentage === 100 || customization.totalGrams === 0}">
                        </div>
                    </div>

                    <div class="border-t pt-4">
                        <p class="text-center font-medium text-slate-700 mb-4">2. Añade o elimina ingredientes / Ajusta porcentajes (La suma debe ser 100%).</p>
                        
                        <div class="space-y-3">
                            <template x-for="(ingredient, index) in customization.mix.ingredients" :key="index">
                                <div class="grid grid-cols-[auto,1fr,auto,auto] gap-3 items-center">
                                    <div @click="openImageModal(getNutByName(ingredient.name)?.imageUrl)" class="relative w-10 h-10 flex-shrink-0 cursor-pointer group/image">
                                        <img :src="getNutByName(ingredient.name)?.imageUrl" :alt="ingredient.name" class="w-10 h-10 rounded-md object-cover">
                                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover/image:bg-opacity-50 flex items-center justify-center transition-all duration-300 rounded-md">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-white opacity-0 group-hover/image:opacity-100 transition-opacity">
                                                <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Zm5-2.25a.75.75 0 0 1 .75.75v1.5h1.5a.75.75 0 0 1 0 1.5h-1.5v1.5a.75.75 0 0 1-1.5 0v-1.5h-1.5a.75.75 0 0 1 0-1.5h1.5v-1.5a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="font-medium text-slate-800" x-text="ingredient.name"></div>
                                    <div class="relative">
                                        <input type="number" min="0" max="100" x-model.number="ingredient.percentage" class="w-24 text-center border-2 border-slate-300 rounded-md p-1 pr-6">
                                        <span class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 select-none text-sm">%</span>
                                    </div>
                                    <button @click="removeCustomIngredient(index)" class="text-red-500 hover:text-red-700 p-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>
                                    </button>
                                </div>
                            </template>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-dashed">
                            <div class="grid grid-cols-[1fr,auto] gap-3 items-center">
                                <select x-model="customization.nutToAdd" class="w-full border-slate-300 rounded-md shadow-sm focus:border-[#4A5D23] focus:ring-[#4A5D23]">
                                    <option value="">Añadir otro fruto...</option>
                                    <template x-for="nut in availableNutsForCustomization" :key="nut.name">
                                        <option :value="nut.name" x-text="nut.name"></option>
                                    </template>
                                </select>
                                <button @click="addCustomIngredient()" :disabled="!customization.nutToAdd" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold px-4 py-2 rounded-md transition-colors disabled:bg-slate-100 disabled:text-slate-400 disabled:cursor-not-allowed">Añadir</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex-shrink-0 p-4 border-t border-gray-200 bg-slate-50">
                    <div class="flex justify-between items-center">
                        <div class="text-lg">
                            <span class="font-bold">Total:</span>
                            <span class="font-semibold px-2 py-1 rounded" :class="{'text-green-800 bg-green-200': customization.totalPercentage === 100, 'text-red-800 bg-red-200': customization.totalPercentage !== 100}" x-text="customization.totalPercentage + '%'"></span>
                            <span class="font-bold ml-4" x-text="formatCurrency(customization.cost)"></span>
                        </div>
                        <div class="flex gap-4">
                            <button @click="closeCustomizationModal()" class="font-bold py-2 px-6 rounded-lg bg-slate-200 hover:bg-slate-300 text-slate-700">Cancelar</button>
                            <button @click="handleAddCustomMix()" class="font-bold py-2 px-6 rounded-lg bg-[#4A5D23] hover:bg-[#3b4a1c] text-white shadow-lg">
                                Añadir Mix
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <section id="cart" class="mt-8 bg-white p-6 rounded-xl shadow-lg border border-slate-200"
            x-show="!selectedNut && !selectedMix">
            <h2 class="text-2xl font-bold text-slate-800 mb-4">Revisa tu Carrito</h2>
            <div x-show="cart.length === 0"
                class="text-center text-slate-500 py-8 border-2 border-dashed border-slate-300 rounded-lg">
                <p class="font-medium">Tu carrito está vacío.</p>
                <p class="text-sm">Añade tus mezclas perfectas para verlas aquí.</p>
            </div>
            <div x-show="cart.length > 0" class="space-y-4" x-transition>
                <template x-for="(item, index) in cart" :key="item.id">
                    <div class="bg-stone-100 p-4 rounded-lg border border-slate-200">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex-grow">
                                <p class="font-bold text-slate-800" x-text="item.name"></p>
                                <ul class="text-sm text-slate-600 mt-1 space-y-1">
                                    <template x-for="nut in item.nuts.filter(n => n.grams > 0)" :key="nut.name">
                                        <li class="flex items-center">
                                            <span class="w-2 h-2 bg-slate-400 rounded-full mr-2"></span>
                                            <span x-text="`${nut.name}: ${nut.grams.toFixed(0)}g`"></span>
                                            <span x-show="nut.cutPreference" x-text="`(${nut.cutPreference})`" class="ml-2 text-xs font-semibold text-indigo-600"></span>
                                        </li>
                                    </template>
                                </ul>
                                <div class="mt-2 text-sm">
                                    <div x-show="item.packaging.type === 'glass_jar'" x-transition>
                                        <p class="font-semibold text-teal-700">Envase: <span x-text="getJarById(item.packaging.jarId)?.name + ' (' + getJarById(item.packaging.jarId)?.capacity + 'g) + ' + formatCurrency(getJarById(item.packaging.jarId)?.price)"></span></p>
                                        <p class="font-semibold text-sky-600">Etiqueta: <span class="font-semibold" x-text="item.packaging.labelId === 'custom' ? `Personalizada: '${item.packaging.customMessage}'` : getLabelNameById(item.packaging.labelId)"></span></p>
                                    </div>
                                     <div x-show="item.packaging.type === 'default'" x-transition>
                                        <p class="font-semibold text-teal-700">Empaque: <span class="font-normal">Bolsa Kraft (Incluida)</span></p>
                                    </div>
                                </div>
                                <p x-show="item.discount > 0" class="text-xs text-[#4A5D23] font-bold mt-2"
                                    x-text="`(Incluye ${item.discountPercentage}% de descuento por cantidad)`"></p>
                            </div>
                            <div class="text-right flex-shrink-0 flex flex-col items-end">
                                <p class="font-semibold text-lg" x-text="formatCurrency((item.cost + item.packaging.price) * item.quantity)"></p>
                                <p class="text-sm text-slate-500 mb-2" x-text="`${(item.totalGrams * item.quantity).toFixed(0)} g total`"></p>
                                
                                <div class="flex items-center border border-slate-300 rounded-lg bg-white shadow-sm">
                                    <button @click="decreaseQuantity(index)" :disabled="item.quantity <= 1" 
                                            class="px-3 py-1 text-xl font-semibold text-slate-500 hover:bg-slate-50 rounded-l-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors">-</button>
                                    <span class="px-4 text-center font-bold text-slate-800" x-text="item.quantity"></span>
                                    <button @click="increaseQuantity(index)" 
                                            class="px-3 py-1 text-xl font-semibold text-slate-500 hover:bg-slate-50 rounded-r-lg transition-colors">+</button>
                                </div>

                                <div class="flex gap-2 mt-2">
                                    <a href="#" @click.prevent="openOptionsEditor(index)" class="text-sm text-lime-800 hover:text-lime-900 font-semibold">EDITAR</a>
                                    <span class="text-slate-300">|</span>
                                    <a href="#" @click.prevent="removeFromCart(index)" class="text-sm text-red-800 hover:text-red-900 font-semibold">QUITAR</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
                <div x-show="cart.length > 0" class="flex justify-end items-center gap-4 mt-4">
                    <button @click="scrollToElement('#selection-tabs')" type="button"
                        class="font-bold py-2 px-4 rounded-lg bg-slate-200 hover:bg-slate-300 text-slate-700">Continuar Seleccionando</button>
                    <button @click="scrollToElement('#order-section')" type="button"
                        class="font-bold py-2 px-4 rounded-lg bg-[#4A5D23] hover:bg-[#3b4a1c] text-white shadow-lg">Proceder a la Compra</button>
                </div>
            </div>
        </section>

        <div id="order-section" class="overflow-hidden transition-height"
            :style="cart.length > 0 ? 'max-height: 2000px' : 'max-height: 0'" x-show="!selectedNut && !selectedMix">
            <section class="mt-8 bg-white p-6 rounded-xl shadow-lg border border-slate-200">
                <form id="order-form" @submit.prevent="placeOrder">
                    <h2 class="text-2xl font-bold text-slate-800 mb-4">Completa tu Pedido</h2>
                    
                    <div class="mb-6">
                        <div class="bg-stone-100 p-4 rounded-lg space-y-4 border border-slate-200">
                            <h3 class="text-lg font-semibold text-slate-700">Información de Contacto</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label for="contact-name" class="block font-medium">Nombre de Contacto <span class="text-red-500">*</span></label>
                                    <input id="contact-name" type="text" x-model="contactInfo.name" required class="w-full border-slate-300 rounded-md shadow-sm focus:border-[#4A5D23] focus:ring-[#4A5D23]">
                                </div>
                                <div>
                                    <label for="contact-phone" class="block font-medium">Celular de Contacto <span class="text-red-500">*</span></label>
                                    <input id="contact-phone" type="text" x-model="contactInfo.phone" @input="validatePhone()" maxlength="10" pattern="[0-9]*" inputmode="numeric" required class="w-full border-slate-300 rounded-md shadow-sm focus:border-[#4A5D23] focus:ring-[#4A5D23]">
                                    <p x-show="contactInfo.phoneError" x-text="contactInfo.phoneError" class="text-red-500 text-sm mt-1" x-transition></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-slate-700 mb-3 text-center sm:text-left">Método de Entrega
                            <span class="text-red-500">*</span></h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <button type="button" @click="delivery.mode = 'Envío'"
                                :class="{ 'bg-[#4A5D23] text-white border-[#4A5D23] shadow-lg': delivery.mode === 'Envío', 'bg-white hover:bg-slate-50 text-slate-800 border-slate-300': delivery.mode !== 'Envío' }"
                                class="w-full py-3 rounded-lg font-bold border-2 transition-all">Envío</button>
                            <button type="button" @click="delivery.mode = 'recoger'"
                                :class="{ 'bg-[#4A5D23] text-white border-[#4A5D23] shadow-lg': delivery.mode === 'recoger', 'bg-white hover:bg-slate-50 text-slate-800 border-slate-300': delivery.mode !== 'recoger' }"
                                class="w-full py-3 rounded-lg font-bold border-2 transition-all">Recoger</button>
                        </div>
                    </div>
                    
                    <div x-show="delivery.mode === 'Envío'" class="mb-6" x-transition>
                        <div class="bg-stone-100 p-4 rounded-lg space-y-4 border border-slate-200">
                            <h3 class="text-lg font-semibold text-slate-700">Información de Envío</h3>
                            
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label for="department-input" class="block font-medium">Departamento <span class="text-red-500">*</span></label>
                                    <div class="relative" x-data="{ isDeptOpen: false }" @click.away="isDeptOpen = false">
                                        <button type="button" @click="isDeptOpen = !isDeptOpen" class="relative w-full cursor-default rounded-md bg-white py-2 pl-3 pr-10 text-left border border-slate-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#4A5D23] sm:text-sm">
                                            <span class="block truncate" x-text="delivery.department"></span>
                                            <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
                                                <svg class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.53.22l3.5 3.5a.75.75 0 01-1.06 1.06L10 4.81 7.03 7.78a.75.75 0 01-1.06-1.06l3.5-3.5A.75.75 0 0110 3zm-3.72 9.53a.75.75 0 011.06 0L10 15.19l2.97-2.97a.75.75 0 111.06 1.06l-3.5 3.5a.75.75 0 01-1.06 0l-3.5-3.5a.75.75 0 010-1.06z" clip-rule="evenodd" /></svg>
                                            </span>
                                        </button>
                                        <div x-show="isDeptOpen" x-transition class="absolute z-10 mt-1 max-h-56 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm">
                                            <template x-for="dept in colombiaData" :key="dept.departamento">
                                                <div @click="delivery.department = dept.departamento; updateDeliveryCost(true); isDeptOpen = false"
                                                     class="text-gray-900 relative cursor-default select-none py-2 pl-3 pr-9 hover:bg-slate-100"
                                                     :class="{'bg-slate-200': delivery.department === dept.departamento}">
                                                    <span class="block truncate" x-text="dept.departamento"></span>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block font-medium">
                                        <span x-text="delivery.department === 'Bogotá D.C.' ? 'Localidad' : 'Municipio'"></span>
                                        <span class="text-red-500">*</span>
                                    </label>
                                    <div class="relative" x-data="{ isMuniOpen: false }" @click.away="isMuniOpen = false">
                                        <button type="button" @click="isMuniOpen = !isMuniOpen" class="relative w-full cursor-default rounded-md bg-white py-2 pl-3 pr-10 text-left border border-slate-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#4A5D23] sm:text-sm">
                                            <span class="block truncate" x-text="delivery.department === 'Bogotá D.C.' ? (delivery.locality || 'Selecciona una localidad') : (delivery.municipality || 'Selecciona un municipio')"></span>
                                            <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
                                                <svg class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.53.22l3.5 3.5a.75.75 0 01-1.06 1.06L10 4.81 7.03 7.78a.75.75 0 01-1.06-1.06l3.5-3.5A.75.75 0 0110 3zm-3.72 9.53a.75.75 0 011.06 0L10 15.19l2.97-2.97a.75.75 0 111.06 1.06l-3.5 3.5a.75.75 0 01-1.06 0l-3.5-3.5a.75.75 0 010-1.06z" clip-rule="evenodd" /></svg>
                                            </span>
                                        </button>
                                        <div x-show="isMuniOpen" x-transition class="absolute z-10 mt-1 max-h-56 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm">
                                            <template x-if="delivery.department === 'Bogotá D.C.'">
                                                <template x-for="locality in localities" :key="locality">
                                                    <div @click="delivery.locality = locality; updateDeliveryCost(false); isMuniOpen = false"
                                                        class="text-gray-900 relative cursor-default select-none py-2 pl-3 pr-9 hover:bg-slate-100"
                                                        :class="{'bg-slate-200': delivery.locality === locality}">
                                                        <span class="block truncate" x-text="locality"></span>
                                                    </div>
                                                </template>
                                            </template>
                                            <template x-if="delivery.department !== 'Bogotá D.C.'">
                                                <template x-for="muni in municipalitiesForSelectedDepartment" :key="muni.nombre">
                                                    <div @click="delivery.municipality = muni.nombre; updateDeliveryCost(false); isMuniOpen = false"
                                                        class="text-gray-900 relative cursor-default select-none py-2 pl-3 pr-9 hover:bg-slate-100"
                                                        :class="{'bg-slate-200': delivery.municipality === muni.nombre}">
                                                        <span class="block truncate" x-text="muni.nombre"></span>
                                                    </div>
                                                </template>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </div>
                           
                            <div>
                                <label for="address-part1" class="block font-medium">Dirección <span class="text-red-500">*</span></label>
                                <div class="mt-1 flex items-center gap-2">
                                    <input id="address-part1" type="text" placeholder="Carrera 7" x-model="delivery.addressPart1" @input="updateFullAddress()" class="w-full border-slate-300 rounded-md shadow-sm focus:border-[#4A5D23] focus:ring-[#4A5D23]">
                                    <span class="font-bold text-slate-500">#</span>
                                    <input type="text" placeholder="72" x-model="delivery.addressPart2" @input="updateFullAddress()" class="w-1/4 border-slate-300 rounded-md shadow-sm text-center focus:border-[#4A5D23] focus:ring-[#4A5D23]">
                                    <span class="font-bold text-slate-500">-</span>
                                    <input type="text" placeholder="50" x-model="delivery.addressPart3" @input="updateFullAddress()" class="w-1/4 border-slate-300 rounded-md shadow-sm text-center focus:border-[#4A5D23] focus:ring-[#4A5D23]">
                                </div>
                                <div class="mt-2 grid grid-cols-2 gap-4">
                                    <div>
                                        <label for="address-interior" class="block text-sm font-medium">Interior</label>
                                        <input id="address-interior" type="text" placeholder="Ej: 3" x-model="delivery.interior" @input="updateFullAddress()" class="w-full border-slate-300 rounded-md shadow-sm focus:border-[#4A5D23] focus:ring-[#4A5D23]">
                                    </div>
                                    <div>
                                        <label for="address-apartment" class="block text-sm font-medium">Apartamento / Casa</label>
                                        <input id="address-apartment" type="text" placeholder="Ej: 101" x-model="delivery.apartment" @input="updateFullAddress()" class="w-full border-slate-300 rounded-md shadow-sm focus:border-[#4A5D23] focus:ring-[#4A5D23]">
                                    </div>
                                </div>
                            </div>

                            <div class="mt-4 pt-4 border-t border-slate-200 text-center text-sm text-slate-500 space-y-1">
                                <p>✨ <span class="font-bold">ENVÍO GRATIS LOCALIDAD USAQUÉN, BOGOTÁ</span>.</p>
                                <p>✨ Envío <span class="font-bold">GRATIS</span> por compras superiores a <span class="font-bold">$200.000</span> en Bogotá.</p>
                                <p>✨ <span class="font-bold">50% de descuento</span> en Envío para compras entre <span class="font-bold">$100.000</span> y <span class="font-bold">$199.999</span> en Bogotá.</p>
                            </div>
                        </div>
                    </div>

                    <div x-show="delivery.mode === 'recoger'"
                        class="space-y-4 mb-6 bg-stone-100 p-4 rounded-lg text-center border border-slate-200" x-transition>
                        <h3 class="text-lg font-semibold text-slate-700">Información de Recogida</h3>
                        <p class="text-slate-800">Puedes recoger tu pedido en la siguiente dirección:</p>
                        <p class="font-bold text-[#4A5D23] text-lg">Carrera 19 # 183-30 (Usaquén, Bogotá)</p>
                    </div>

                    <footer class="mt-8 pt-6 border-t">
                        <h3 class="text-xl font-bold text-slate-800 mb-4">Resumen Final</h3>
                        <div class="bg-stone-100 p-4 rounded-lg space-y-2 border border-slate-200">
                            <div class="flex justify-between"><span class="text-slate-600">Subtotal Compra</span><span
                                    class="font-semibold" x-text="formatCurrency(finalSummary.subtotal)"></span></div>
                            <div class="flex justify-between"><span class="text-slate-600">Costo Envío</span><span
                                    class="font-semibold" x-text="formatCurrency(finalSummary.deliveryCostRaw)"></span>
                            </div>
                            <div x-show="finalSummary.discount > 0" class="flex justify-between text-[#4A5D23]"><span
                                    class="text-[#4A5D23]">Descuento Envío</span><span class="font-semibold"
                                    x-text="'- ' + formatCurrency(finalSummary.discount)"></span></div>
                            <hr class="my-1 border-slate-300">
                            <div class="flex justify-between text-xl font-bold"><span class="">Total a Pagar</span><span
                                    x-text="formatCurrency(finalSummary.total)"></span></div>
                        </div>

                       <div x-show="shippingWarningMessage" class="mt-4 text-center text-sm font-semibold text-black bg-red-200 p-3 rounded-lg border border-red-900" x-transition>
                            <p class="font-bold">AVISO IMPORTANTE</p>
                            <p x-text="shippingWarningMessage"></p>
                        </div>

                        <div class="mt-6">
                            <button type="submit"
                                    class="w-full text-white font-bold py-3 px-4 rounded-lg transition-all bg-[#4A5D23] hover:bg-[#3b4a1c] shadow-lg">
                                <span x-text="formStatus"></span>
                            </button>
                        </div>
                    </footer>
                </form>
            </section>
        </div>
        
        <div x-show="showPreConfirmationModal" @keydown.escape.window="showPreConfirmationModal = false"
            class="fixed inset-0 z-[100] flex items-center justify-center bg-black bg-opacity-60 p-4">
            <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md text-center">
                <p class="text-slate-700 mb-6 text-lg">Estás a un paso de finalizar. Una vez confirmado, tu pedido será
                    enviado para ser procesado. ¿Deseas continuar?</p>
                <div class="flex justify-center gap-4">
                    <button @click="showPreConfirmationModal = false" type="button"
                        class="font-bold py-2 px-6 rounded-lg bg-slate-200 hover:bg-slate-300 text-slate-700">Volver y revisar</button>
                    <button @click="executeOrder()" type="button"
                        class="font-bold py-2 px-6 rounded-lg bg-[#4A5D23] hover:bg-[#3b4a1c] text-white shadow-lg">Confirmar Pedido</button>
                </div>
            </div>
        </div>

        <div x-show="showConfirmationModal" @keydown.escape.window="closeConfirmationModal()"
            class="fixed inset-0 z-[100] flex items-center justify-center bg-black bg-opacity-60 p-4">
            <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-2xl max-h-screen overflow-y-auto text-center">
                <h2 class="text-3xl font-elegant font-bold text-[#4A5D23] mb-4" x-text="confirmationDetails.title"></h2>
                <p class="text-slate-700 mb-6" x-html="confirmationDetails.message"></p>
                <div class="bg-stone-100 border border-slate-200 rounded-lg p-4 text-left text-sm whitespace-pre-wrap font-mono"
                    x-text="confirmationDetails.summary"></div>
                <button @click="closeConfirmationModal()"
                    class="mt-8 w-full sm:w-auto px-8 py-2 bg-[#4A5D23] text-white font-bold rounded-lg shadow-md hover:bg-[#3b4a1c]">Hacer otra Compra</button>
            </div>
        </div>

    <!-- === INICIO: MODAL DE OPCIONES FINALES (PARA AÑADIR Y EDITAR) === -->
    <div x-show="showPackagingModal" @keydown.escape.window="closeOptionsEditor()"
        class="fixed inset-0 z-[140] flex items-center justify-center bg-black bg-opacity-60 p-4" x-cloak>
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl flex flex-col max-h-[90vh]">
            
            <div class="relative p-4 border-b">
                <h3 class="text-2xl font-elegant font-bold text-slate-800 text-center" x-text="packagingModalTitle"></h3>
                <p class="text-center text-slate-600" x-show="packagingStep !== 'labels' && editingMode !== 'glass'">Configura las opciones para tu <strong x-text="activeItemForModal?.name"></strong></p>
                <button @click="closeOptionsEditor()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <div class="p-6 overflow-y-auto flex-1">

                <!-- VISTA PARA AÑADIR NUEVO / EDITAR KRAFT -->
                <div x-show="packagingStep === 'selection' && editingMode !== 'glass'" class="space-y-4">
                    <div x-show="activeItemHasCutOptions" class="border-b pb-4 mb-4">
                        <h4 class="font-bold text-slate-800 mb-3 text-center text-lg">1. Opciones de Corte</h4>
                        <div class="space-y-2 max-w-md mx-auto">
                             <template x-for="nut in activeItemForModal?.nuts.filter(n => n.hasOwnProperty('cutPreference'))" :key="nut.name">
                                <div class="flex items-center justify-between p-3 bg-slate-100 rounded-lg">
                                    <span class="font-semibold text-slate-700" x-text="nut.name.split(' (')[0] + ':'"></span>
                                    <div class="inline-flex rounded-md shadow-sm" role="group">
                                        <button type="button" @click="nut.cutPreference = 'Entero'"
                                                :class="{'bg-cyan-800 text-white': nut.cutPreference === 'Entero', 'bg-white text-slate-700 hover:bg-slate-50': nut.cutPreference !== 'Entero'}"
                                                class="px-4 py-1.5 text-sm font-semibold border border-slate-300 rounded-l-lg transition-colors">
                                            Entero
                                        </button>
                                        <button type="button" @click="nut.cutPreference = 'Corte en Trozos'"
                                                :class="{'bg-cyan-800 text-white': nut.cutPreference === 'Corte en Trozos', 'bg-white text-slate-700 hover:bg-slate-50': nut.cutPreference !== 'Corte en Trozos'}"
                                                class="px-4 py-1.5 text-sm font-semibold border-t border-b border-r border-slate-300 rounded-r-lg transition-colors">
                                            En Trozos
                                        </button>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <h4 class="font-bold text-slate-800 text-center text-lg" x-text="activeItemHasCutOptions ? '2. Elige el Envase' : 'Elige el Envase'"></h4>
                    
                    <div x-show="editingMode === null || editingMode === 'kraft'" @click.prevent="if(editingMode === null) handleKraftSelection()" 
                         class="flex items-center gap-4 p-3 rounded-lg border-2 transition-all"
                         :class="{'cursor-pointer hover:border-indigo-600 hover:bg-indigo-50': editingMode === null, 'border-slate-300': editingMode === 'kraft'}">
                        <div class="w-20 h-20 bg-slate-200 rounded-md flex items-center justify-center flex-shrink-0">
                            <img src="https://i.ibb.co/V0QLKkX2/bolsa-KRAFT.png" alt="Bolsa Kraft Personalizada" class="w-full h-auto rounded-md">
                        </div>
                        <div class="flex-grow">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-bold text-slate-800">Bolsa Kraft con cierre hermético</h4>
                                    <p class="text-sm text-slate-600 mb-1">Incluida (Gratis)</p>
                                    <div x-show="editingMode === null">
                                        <p class="text-sm font-semibold text-cyan-800">Contenido: <strong x-text="activeItemForModal?.originalGrams.toFixed(0) + 'g'"></strong></p>
                                    </div>
                                    <div x-show="editingMode === 'kraft'">
                                        <label for="kraft-grams" class="block text-sm font-medium text-cyan-800">Modificar contenido:</label>
                                        <div class="relative mt-1 inline-block">
                                            <input id="kraft-grams" type="number" min="1" step="10" x-model.number="editedKraftGrams" @click.stop
                                                class="w-32 text-center border-2 border-cyan-800 rounded-md shadow-sm p-2 focus:border-indigo-500 focus:ring-indigo-500 pr-8">
                                            <span class="absolute right-3 top-1/2 -translate-y-1/2 text-cyan-800 select-none">g</span>
                                        </div>
                                    </div>
                                </div>
                                <div x-show="editingMode === null" class="ml-4">
                                     <button @click.stop="handleKraftSelection()" class="font-bold py-2 px-6 rounded-lg bg-[#4A5D23] hover:bg-[#3b4a1c] text-white shadow-lg">Añadir</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div x-show="editingMode === null" @click="goToJarSelection()" class="flex items-center gap-4 p-3 rounded-lg border-2 cursor-pointer transition-all border-slate-300 hover:border-teal-600 hover:bg-teal-50">
                        <div class="w-20 h-20 bg-slate-200 rounded-md flex items-center justify-center flex-shrink-0">
                             <img src="https://i.ibb.co/kVsQsKLT/corcho1.png" alt="Envases de vidrio" class="w-full h-auto object-contain">
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-800">Envases para Regalos</h4>
                            <p class="text-sm text-slate-600">Elige tus envases y personaliza las etiquetas. La cantidad total se ajustará a la capacidad de los envases que elijas.</p>
                        </div>
                    </div>
                </div>
                
                <div x-show="editingMode === 'glass'" class="space-y-4">
                     <div x-show="activeItemHasCutOptions" class="border-b pb-4 mb-4">
                        <h4 class="font-bold text-slate-800 mb-3 text-center text-lg">1. Opciones de Corte</h4>
                        <div class="space-y-2 max-w-md mx-auto">
                             <template x-for="nut in activeItemForModal?.nuts.filter(n => n.hasOwnProperty('cutPreference'))" :key="nut.name">
                                <div class="flex items-center justify-between p-3 bg-slate-100 rounded-lg">
                                    <span class="font-semibold text-slate-700" x-text="nut.name.split(' (')[0] + ':'"></span>
                                    <div class="inline-flex rounded-md shadow-sm" role="group">
                                        <button type="button" @click="nut.cutPreference = 'Entero'"
                                                :class="{'bg-cyan-800 text-white': nut.cutPreference === 'Entero', 'bg-white text-slate-700 hover:bg-slate-50': nut.cutPreference !== 'Entero'}"
                                                class="px-4 py-1.5 text-sm font-semibold border border-slate-300 rounded-l-lg transition-colors">
                                            Entero
                                        </button>
                                        <button type="button" @click="nut.cutPreference = 'Corte en Trozos'"
                                                :class="{'bg-cyan-800 text-white': nut.cutPreference === 'Corte en Trozos', 'bg-white text-slate-700 hover:bg-slate-50': nut.cutPreference !== 'Corte en Trozos'}"
                                                class="px-4 py-1.5 text-sm font-semibold border-t border-b border-r border-slate-300 rounded-r-lg transition-colors">
                                            En Trozos
                                        </button>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <h4 class="font-bold text-slate-800 text-center text-lg" x-text="activeItemHasCutOptions ? '2. Elige el Envase' : 'Elige el Envase'"></h4>
                    <div class="space-y-3">
                        <template x-for="jar in jars" :key="jar.id">
                            <div class="flex items-center gap-4 p-2 rounded-lg border">
                                <img @click.prevent="openJarGallery(jar)" :src="jar.imageUrls[0]" :alt="jar.name" class="w-16 h-16 object-contain flex-shrink-0 cursor-pointer hover:scale-105 transition-transform">
                                <div class="flex-grow">
                                    <h4 class="font-semibold text-slate-800" x-text="jar.name"></h4>
                                    <p class="text-sm text-slate-600" x-text="`Capacidad: ${jar.capacity}g (+ ${formatCurrency(jar.price)})`"></p>
                                </div>
                                <div class="flex items-center border border-slate-300 rounded-lg bg-white shadow-sm">
                                    <button @click="decrementJar(jar)" class="px-3 py-1 text-xl font-semibold text-slate-500 hover:bg-slate-50 rounded-l-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors">-</button>
                                    <span class="px-4 text-center font-bold text-slate-800" x-text="getJarQuantity(jar.id)"></span>
                                    <button @click="incrementJar(jar)" class="px-3 py-1 text-xl font-semibold text-slate-500 hover:bg-slate-50 rounded-r-lg transition-colors">+</button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <div x-show="packagingStep === 'jars'" class="space-y-3">
                    <template x-for="jar in jars" :key="jar.id">
                        <div class="flex items-center gap-4 p-2 rounded-lg border">
                            <img @click.prevent="openJarGallery(jar)" :src="jar.imageUrls[0]" :alt="jar.name" class="w-16 h-16 object-contain flex-shrink-0 cursor-pointer hover:scale-105 transition-transform">
                            <div class="flex-grow">
                                <h4 class="font-semibold text-slate-800" x-text="jar.name"></h4>
                                <p class="text-sm text-slate-600" x-text="`Capacidad: ${jar.capacity}g (+ ${formatCurrency(jar.price)})`"></p>
                            </div>
                            <div class="flex items-center border border-slate-300 rounded-lg bg-white shadow-sm">
                                <button @click="decrementJar(jar)" class="px-3 py-1 text-xl font-semibold text-slate-500 hover:bg-slate-50 rounded-l-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors">-</button>
                                <span class="px-4 text-center font-bold text-slate-800" x-text="getJarQuantity(jar.id)"></span>
                                <button @click="incrementJar(jar)" class="px-3 py-1 text-xl font-semibold text-slate-500 hover:bg-slate-50 rounded-r-lg transition-colors">+</button>
                            </div>
                        </div>
                    </template>
                </div>

                <div x-show="packagingStep === 'labels'" class="space-y-4">
                    <div class="space-y-3">
                        <template x-for="(selection, index) in giftJarSelections" :key="index">
                             <div class="p-3 rounded-lg border flex items-center justify-between gap-4">
                                <div class="flex items-center gap-3">
                                    <img :src="getJarById(selection.jarId)?.imageUrls[0]" class="w-12 h-12 object-contain">
                                    <div>
                                        <p class="font-bold" x-text="`${selection.quantity}x ${getJarById(selection.jarId)?.name}`"></p>
                                        <p class="text-sm text-slate-500" x-text="`Capacidad: ${getJarById(selection.jarId)?.capacity}g`"></p>
                                    </div>
                                </div>
                                <div>
                                    <button @click="openLabelEditorForJar(index)" class="font-semibold py-2 px-4 rounded-lg transition-colors"
                                        :class="selection.labelId ? 'bg-indigo-100 text-indigo-800 hover:bg-indigo-200' : 'bg-[#4A5D23] text-white hover:bg-[#3b4a1c]'">
                                        <span x-text="selection.labelId ? `Etiqueta: '${getLabelNameById(selection.labelId)}'` : 'Elegir Etiqueta'"></span>
                                    </button>
                                </div>
                            </div>
                        </template>
                         <div class="text-center mb-4">
                           <button @click="openLabelEditorForAll()" class="bg-[#A98B61] hover:bg-[#8c714e] text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                              Aplicar la misma etiqueta a todos
                           </button>
                         </div>
                    </div>
                </div>

            </div>

            <div class="bg-slate-50 px-6 py-3 flex justify-between items-center border-t">
                
                <div x-show="packagingStep === 'selection' && editingMode === 'kraft'" class="w-full flex justify-end">
                    <button @click="handlePrimaryAction()" 
                            class="font-bold py-2 px-6 rounded-lg shadow-lg bg-slate-600 hover:bg-slate-700 text-white">
                        <span>Guardar Cambios</span>
                    </button>
                </div>
                
                 <div x-show="editingMode === 'glass'" class="w-full flex justify-between items-center">
                    <div class="text-center">
                       <p class="text-sm font-bold">Total del Mix: <span class="text-lg text-[#4A5D23]" x-text="`${giftPackagingTotalGrams}g`"></span></p>
                       <p class="text-sm font-bold">Costo Total: <span class="text-lg text-[#4A5D23]" x-text="formatCurrency(giftPackagingTotalCost)"></span></p>
                    </div>
                    <div>
                        <button @click="openLabelEditorForSelection()" :disabled="giftJarSelections.length === 0"
                                class="font-bold py-2 px-6 rounded-lg bg-[#4A5D23] hover:bg-[#3b4a1c] text-white shadow-lg disabled:bg-slate-400 disabled:cursor-not-allowed">
                             <span>Siguiente: Personalizar Etiquetas</span>
                        </button>
                    </div>
                </div>

                <div x-show="packagingStep === 'jars'" class="w-full flex justify-between items-center">
                    <div>
                        <button @click="backToPackagingSelection()" class="font-semibold text-slate-600 hover:text-slate-800">
                            &larr; Volver
                        </button>
                    </div>
                    <div class="text-center">
                        <p class="text-sm font-bold">Total del Mix: <span class="text-lg text-[#4A5D23]" x-text="`${giftPackagingTotalGrams}g`"></span></p>
                        <p class="text-sm font-bold">Costo Total: <span class="text-lg text-[#4A5D23]" x-text="formatCurrency(giftPackagingTotalCost)"></span></p>
                    </div>
                    <div>
                        <button @click="goToLabelSelection()" :disabled="giftJarSelections.length === 0"
                            class="font-bold py-2 px-6 rounded-lg bg-[#4A5D23] hover:bg-[#3b4a1c] text-white shadow-lg disabled:bg-slate-400 disabled:cursor-not-allowed">
                            Continuar con etiquetas
                        </button>
                    </div>
                </div>

                 <div x-show="packagingStep === 'labels'" class="w-full flex justify-between items-center">
                     <div>
                        <button @click="backToJarSelection()" class="font-semibold text-slate-600 hover:text-slate-800">
                           &larr; Volver
                        </button>
                    </div>
                    <div class="text-center">
                       <p class="text-sm font-bold">Total del Mix: <span class="text-lg text-[#4A5D23]" x-text="`${giftPackagingTotalGrams}g`"></span></p>
                       <p class="text-sm font-bold">Costo Total: <span class="text-lg text-[#4A5D23]" x-text="formatCurrency(giftPackagingTotalCost)"></span></p>
                    </div>
                    <div>
                        <button @click="handleGiftSelection()" :disabled="!allJarsHaveLabels"
                                class="font-bold py-2 px-6 rounded-lg bg-[#4A5D23] hover:bg-[#3b4a1c] text-white shadow-lg disabled:bg-slate-400 disabled:cursor-not-allowed">
                             <span>Confirmar y Añadir</span>
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </div>
    
    <!-- === INICIO: MODAL DE SELECCIÓN DE ETIQUETAS (PARA EDITAR) === -->
    <div x-show="showLabelSelectionModal" @keydown.escape.window="closeLabelEditor()"
         class="fixed inset-0 z-[150] flex items-center justify-center bg-black bg-opacity-70 p-4" x-cloak>
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b">
                <h3 class="text-xl font-bold font-elegant text-slate-800 text-center">PERSONALIZA TUS ETIQUETAS</h3>
            </div>
            <div class="p-6 overflow-y-auto space-y-4">
                <div class="space-y-3">
                    <template x-for="(selection, index) in giftJarSelections" :key="index">
                         <div class="p-3 rounded-lg border flex items-center justify-between gap-4">
                            <div class="flex items-center gap-3">
                                <img :src="getJarById(selection.jarId)?.imageUrls[0]" class="w-12 h-12 object-contain">
                                <div>
                                    <p class="font-bold" x-text="`${selection.quantity}x ${getJarById(selection.jarId)?.name}`"></p>
                                    <p class="text-sm text-slate-500" x-text="`Capacidad: ${getJarById(selection.jarId)?.capacity}g`"></p>
                                </div>
                            </div>
                            <div>
                                <button @click="openLabelEditorForJar(index)" class="font-semibold py-2 px-4 rounded-lg transition-colors"
                                    :class="selection.labelId ? 'bg-indigo-100 text-indigo-800 hover:bg-indigo-200' : 'bg-[#4A5D23] text-white hover:bg-[#3b4a1c]'">
                                    <span x-text="selection.labelId ? `Etiqueta: '${getLabelNameById(selection.labelId)}'` : 'Elegir Etiqueta'"></span>
                                </button>
                            </div>
                        </div>
                    </template>
                     <div class="text-center mb-4">
                       <button @click="openLabelEditorForAll()" class="bg-[#A98B61] hover:bg-[#8c714e] text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                          Aplicar la misma etiqueta a todos
                       </button>
                     </div>
                </div>
            </div>
            <div class="bg-slate-50 px-6 py-4 flex justify-between items-center border-t">
                <button @click="closeLabelEditor()" type="button" class="font-semibold text-slate-600 hover:text-slate-800">&larr; Volver a Envases</button>
                <button @click="confirmAndSaveChanges()" :disabled="!allJarsHaveLabels"
                        class="font-bold py-2 px-6 rounded-lg bg-[#4A5D23] hover:bg-[#3b4a1c] text-white shadow-lg disabled:bg-slate-400 disabled:cursor-not-allowed">
                     <span>Guardar Cambios</span>
                </button>
            </div>
        </div>
    </div>
    <!-- === FIN: MODAL DE SELECCIÓN DE ETIQUETAS === -->

    <div x-show="showJarGalleryModal" @keydown.escape.window="closeJarGallery()"
         class="fixed inset-0 z-[150] flex items-center justify-center bg-black bg-opacity-60 p-4" x-cloak
         x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0" 
         x-transition:leave="ease-in duration-200" x-transition:leave-end="opacity-0">
        
        <div @click.away="closeJarGallery()" class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6 relative"
             x-data="{ currentImage: galleryJar ? galleryJar.imageUrls[0] : '' }"
             x-init="$watch('galleryJar', (jar) => { if(jar) currentImage = jar.imageUrls[0] })">
            
            <button @click="closeJarGallery()" class="absolute -top-3 -right-3 bg-white rounded-full p-1 text-slate-700 hover:text-red-500 transition-colors shadow-lg">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            
            <template x-if="galleryJar">
                <div>
                    <h3 class="text-xl font-bold font-elegant text-slate-800 text-center mb-4" x-text="galleryJar.name"></h3>
                    
                    <div class="mb-4 bg-slate-100 p-2 rounded-lg border">
                        <img :src="currentImage" :alt="galleryJar.name" class="w-full h-64 object-contain">
                    </div>
                    
                    <div class="flex justify-center gap-3">
                        <template x-for="url in galleryJar.imageUrls" :key="url">
                            <button @click="currentImage = url" class="w-16 h-16 rounded-md overflow-hidden border-2 transition"
                                    :class="{'border-green-600 ring-2 ring-green-300': currentImage === url, 'border-slate-300 hover:border-slate-400': currentImage !== url}">
                                <img :src="url" class="w-full h-full object-cover">
                            </button>
                        </template>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <div x-show="labelCustomization.showModal"
         class="fixed inset-0 z-[160] flex items-center justify-center bg-black bg-opacity-70 p-4" x-cloak>
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            
            <div class="p-4 border-b">
                <h3 class="text-xl font-bold font-elegant text-slate-800 text-center">PERSONALIZA TU ETIQUETA</h3>
            </div>

            <div class="p-6 overflow-y-auto space-y-6">
                
                <p class="text-center text-stone-900"><strong>Elige un diseño para tu etiqueta o crea tu etiqueta con un mensaje especial (Clic en Personaliza).</strong></p>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <template x-for="label in labelOptions" :key="label.id">
    <!-- El @click principal sigue aquí. Ahora, al hacer clic en la imagen, este evento se disparará. -->
    <div @click="label.id === 'custom' ? openCustomMessageModal() : (labelCustomization.selectedLabelId = label.id)"
         class="p-3 rounded-lg border-2 text-center cursor-pointer transition-all"
         :class="labelCustomization.selectedLabelId === label.id ? 'border-green-600 bg-green-50 shadow-md' : 'border-slate-200 bg-white hover:border-slate-400'">
        
        <div class="relative w-full h-32 rounded-md mb-2 group">
            <!-- La imagen ya no tiene un overlay que bloquee el clic -->
            <img :src="label.imageUrl" :alt="label.name" class="w-full h-full object-cover rounded-md">
            
            <!-- NUEVO: Este es el botón de zoom, pequeño y en la esquina. -->
            <!-- Solo este botón tiene el @click.stop, que abre el modal de imagen y detiene la selección. -->
            <button @click.stop="openImageModal(label.imageUrl)" type="button" 
        class="absolute top-1.5 right-1.5 bg-slate-800 bg-opacity-60 text-white rounded-full p-1 transition-opacity duration-300 hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-white opacity-100 md:opacity-0 md:group-hover:opacity-100">
                <span class="sr-only">Agrandar imagen</span> <!-- Para accesibilidad -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M9.25 13.25a.75.75 0 001.5 0V9.75h3.5a.75.75 0 000-1.5h-3.5V4.75a.75.75 0 00-1.5 0v3.5h-3.5a.75.75 0 000 1.5h3.5v3.5z" />
                  <path fill-rule="evenodd" d="M1.5 10a8.5 8.5 0 1117 0 8.5 8.5 0 01-17 0zM10 2.5a7.5 7.5 0 100 15 7.5 7.5 0 000-15z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>
        <p class="font-semibold text-slate-700 text-sm" x-text="label.name"></p>
    </div>
</template>
                </div>
            </div>

            <div class="bg-slate-50 px-6 py-4 flex justify-between items-center border-t">
                <button @click="cancelLabelSelection()" type="button" class="font-semibold text-slate-600 hover:text-slate-800">Volver</button>
                <button @click="saveLabelSelection()" type="button" class="font-bold py-2 px-6 rounded-lg bg-[#4A5D23] hover:bg-[#3b4a1c] text-white shadow-lg">
                    Guardar y Continuar
                </button>
            </div>
        </div>
    </div>    

    <div x-show="labelCustomization.showCustomMessageModal"
         class="fixed inset-0 z-[170] flex items-center justify-center bg-black bg-opacity-70 p-4" x-cloak>
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6 space-y-4">
                <h3 class="text-lg font-bold text-slate-800">Escribe tu Mensaje Personalizado</h3>
                <textarea x-model="labelCustomization.customMessage" maxlength="50"
                          class="w-full h-28 border-2 border-slate-300 rounded-md shadow-sm p-2 focus:border-[#4A5D23] focus:ring-[#4A5D23]"
                          placeholder="Ej: ¡Feliz cumpleaños, mamá!"></textarea>
                <p class="text-right text-xs text-slate-500" x-text="`${labelCustomization.customMessage.length} / 50`"></p>
            </div>
            <div class="bg-slate-50 px-6 py-4 flex justify-end gap-4 border-t">
                <button @click="labelCustomization.showCustomMessageModal = false" type="button" class="font-semibold text-slate-600 hover:text-slate-800">Volver</button>
                <button @click="saveCustomMessage()" type="button" class="font-bold py-2 px-6 rounded-lg bg-[#4A5D23] hover:bg-[#3b4a1c] text-white shadow-lg">Guardar Mensaje y Continuar</button>
            </div>
        </div>
    </div>
   
        <script>
        function mixBuilder() {
            return {
                activeTab: 0,
                activeSubTab: 0,
                packagingSubTab: 'glass',
                cartItemIdCounter: 1, 
                selectedIndividualNutName: null,
                totalGramsForPercentage: 0,
                nuts: [],
                largeFruits: [ 
                    'Albaricoque Turco seco (Sin azúcar añadida)',
                    'Higo Turco seco (Sin azúcar añadida)',
                    'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)'
                ],
                productFilter: 'Todos',
                searchQuery: '',
                mixSearchQuery: '',
                vitalMixSearchQuery: '',
                justAdded: false,
                predefinedMixes: [],
                giftJarExamples: [
                    { imageUrl: 'https://i.ibb.co/QF9kSZY5/envase1.jpg', alt: 'Envase de regalo 1' },
                    { imageUrl: 'https://i.ibb.co/Kp41r5BG/envase2.jpg', alt: 'Envase de regalo 2' },
                    { imageUrl: 'https://i.ibb.co/vv16Hh2d/envase3.jpg', alt: 'Envase de regalo 3' },
                    { imageUrl: 'https://i.ibb.co/5w5Xbfp/envase4.jpg', alt: 'Envase de regalo 4' },
                ],
                customPackagingSets: [
                    { 
                        title: 'Regalos',
                        images: [
                            { imageUrl: 'https://i.ibb.co/rGtrs2VM/1.jpg', alt: 'Empaque personalizado 1' },
                            { imageUrl: 'https://i.ibb.co/k2sg3S3y/2.jpg', alt: 'Empaque personalizado 2' },
                            { imageUrl: 'https://i.ibb.co/8ghQSdxm/3.jpg', alt: 'Empaque personalizado 3' },
                            { imageUrl: 'https://i.ibb.co/4RGNTyGd/4.jpg', alt: 'Empaque personalizado 4' },
                        ]
                    },
                    { 
                        title: 'Recordatorios',
                        images: [
                            { imageUrl: 'https://i.ibb.co/mCC5F49y/Whats-App-Image-2025-08-26-at-11-09-31-AM.jpg', alt: 'Empaque corporativo con logo 1' },
                            { imageUrl: 'https://i.ibb.co/bgmFytKr/Whats-App-Image-2025-08-26-at-11-06-50-AM.jpg', alt: 'Empaque corporativo con logo 2' },
                            { imageUrl: 'https://i.ibb.co/hJK6Lsj9/Whats-App-Image-2025-08-26-at-11-08-01-AM.jpg', alt: 'Empaque corporativo con logo 3' },
                            { imageUrl: 'https://i.ibb.co/7t6Tm99z/Whats-App-Image-2025-08-26-at-11-11-41-AM.jpg', alt: 'Empaque corporativo con logo 4' },
                        ]
                    }
                ],
                radius: 15.9155,
                circumference: 2 * Math.PI * 15.9155,
                
                localities: [
                    'Usaquén', 'Chapinero', 'Santa Fe', 'San Cristóbal', 'Usme', 'Tunjuelito', 'Bosa', 'Kennedy',
                    'Fontibón', 'Engativá', 'Suba', 'Barrios Unidos', 'Teusaquillo', 'Los Mártires', 'Antonio Nariño',
                    'Puente Aranda', 'La Candelaria', 'Rafael Uribe Uribe', 'Ciudad Bolívar', 'Sumapaz'
                ],

                jars: [
                    { id: 'jar_100', name: 'Envase vidrio redondo Tapa Corcho', capacity: 100, price: 4300, imageUrls: ['https://i.ibb.co/kVsQsKLT/corcho1.png', 'https://i.ibb.co/DPQBQ2Kg/corcho2.png', 'https://i.ibb.co/93CsMLFD/corcho3.png'] },
                    { id: 'jar_105', name: 'Envase vidrio Hexagonal Tapa Blanca', capacity: 105, price: 3100, imageUrls: ['https://i.ibb.co/LXm9GGPK/hexagonal1.png', 'https://i.ibb.co/8gyBL2zn/hexagonal2.png', 'https://i.ibb.co/Q3YpQNXH/hexagonal3.png'] },
		            { id: 'jar_130', name: 'Envase vidrio cuadrado Tapa Dorada', capacity: 130, price: 3500, imageUrls: ['https://i.ibb.co/9kNvKmMj/cuadrado1.png', 'https://i.ibb.co/B23FgNTd/cuadrado2.png', 'https://i.ibb.co/VW1R6YpT/cuadrado3.png'] },
		            { id: 'jar_140', name: 'Envase vidrio bombillo Tapa Dorada', capacity: 140, price: 3350, imageUrls: ['https://i.ibb.co/FkJCR8h0/bombillo1.png', 'https://i.ibb.co/Hp28YKQt/bombillo2.png', 'https://i.ibb.co/0RYsyDhj/bombillo3.png'] },
		            { id: 'jar_150', name: 'Envase vidrio redondo Tapa Negra', capacity: 150, price: 4960, imageUrls: ['https://i.ibb.co/9kxKnbfS/Tapanegra1.png', 'https://i.ibb.co/7xSpqV4P/Tapanegra2.png', 'https://i.ibb.co/Vc0PXf3n/Tapanegra3.png'] },
		            { id: 'jar_155', name: 'Envase vidrio diamante Tapa Dorada', capacity: 155, price: 3950, imageUrls: ['https://i.ibb.co/W4Rq8JG4/esmeralda1.png', 'https://i.ibb.co/5hzbSkCN/esmeralda2.png', 'https://i.ibb.co/RT8qCCNh/esmeralda3.png'] },
		            { id: 'jar_250', name: 'Envase vidrio redondo Tapa Dorada', capacity: 250, price: 5600, imageUrls: ['https://i.ibb.co/0pr5HmsJ/250g1.png', 'https://i.ibb.co/sX0Mv9J/250g2.png', 'https://i.ibb.co/35ds7BXP/250g3.png'] },
                    { id: 'jar_435', name: 'Envase vidrio Flint redondo Tapa Dorada', capacity: 435, price: 4800, imageUrls: ['https://i.ibb.co/7tBnMjPy/430g1.png', 'https://i.ibb.co/KjWGWm04/430g2.png', 'https://i.ibb.co/BYw5BFT/430g3.png'] }
                ],

                labelOptions: [
                    { id: 'custom', name: 'Personaliza: Crea tu Mensaje', type: 'custom', imageUrl: 'https://i.ibb.co/5grFp6hk/ETIQpersonalizada.png' },
                    { id: 'classic', name: 'Etiqueta 1', imageUrl: 'https://i.ibb.co/2YNZb5BD/ETIQ1.png' },
                    { id: 'minimalist', name: 'Etiqueta 2', imageUrl: 'https://i.ibb.co/V02p9hcd/ETIQ2.png' },
                    { id: 'label_3', name: 'Etiqueta 3', imageUrl: 'https://i.ibb.co/hz6DtcM/ETIQ3.png' },
                    { id: 'label_4', name: 'Etiqueta 4', imageUrl: 'https://i.ibb.co/ZzsGkFnX/ETIQ4.png' },
                    { id: 'label_5', name: 'Etiqueta 5', imageUrl: 'https://i.ibb.co/mZ1dDwC/ETIQ5.png' },
                    { id: 'label_6', name: 'Etiqueta 6', imageUrl: 'https://i.ibb.co/vvzKzZFd/ETIQ6.png' },
                    { id: 'label_7', name: 'Etiqueta 7', imageUrl: 'https://i.ibb.co/Kjbg4skp/ETIQ7.png' },
                    { id: 'label_8', name: 'Etiqueta 8', imageUrl: 'https://i.ibb.co/WvkhQSgV/ETIQ7.png' },
                    { id: 'label_9', name: 'Etiqueta 9', imageUrl: 'https://i.ibb.co/4wXGSSX3/ETIQ9.png' },
                    { id: 'label_10', name: 'Etiqueta 10', imageUrl: 'https://i.ibb.co/Y7VDN9dJ/ETIQ10.png' },
                    { id: 'label_11', name: 'Etiqueta 11', imageUrl: 'https://i.ibb.co/JWHVswfW/ETIQ11.png' }
                ],

                colombiaData: [
                    { "departamento": "Bogotá D.C.", "ciudades": [] },
                    { "departamento": "Amazonas", "ciudades": [{nombre: "El Encanto", costo: 53160},{nombre: "La Chorrera", costo: 53160},{nombre: "La Pedrera", costo: 53160},{nombre: "La Victoria", costo: 53160},{nombre: "Leticia", costo: 53160},{nombre: "Miriti Parana", costo: 53160},{nombre: "Puerto Alegría", costo: 53160},{nombre: "Puerto Arica", costo: 53160},{nombre: "Puerto Nariño", costo: 53160},{nombre: "Puerto Santander", costo: 53160}, {nombre: "Tarapaca", costo: 53160}] },
                    { "departamento": "Antioquia", "ciudades": [{nombre: "Abejorral", costo: 19350},{nombre: "Abriaquí", costo: 25830},{nombre: "Alejandría", costo: 23200},{nombre: "Amagá", costo: 19350},{nombre: "Amalfi", costo: 19350},{nombre: "Andes", costo: 21450},{nombre: "Angelópolis", costo: 25830},{nombre: "Angostura", costo: 23200},{nombre: "Anorí", costo: 23200},{nombre: "Anzá", costo: 19350},{nombre: "Apartadó", costo: 16560},{nombre: "Arboletes", costo: 19350},{nombre: "Argelia", costo: 23200},{nombre: "Armenia", costo: 17400},{nombre: "Barbosa", costo: 16560},{nombre: "Bello", costo: 16560},{nombre: "Belmira", costo: 25830},{nombre: "Betania", costo: 21450},{nombre: "Betulia", costo: 23200},{nombre: "Bolombolo", costo: 25830},{nombre: "Briceño", costo: 25830},{nombre: "Buriticá", costo: 23200},{nombre: "Cáceres", costo: 23200},{nombre: "Caicedo", costo: 25830},{nombre: "Caldas", costo: 16560},{nombre: "Campamento", costo: 23200},{nombre: "Cañagordas", costo: 21450},{nombre: "Caracolí", costo: 21450},{nombre: "Caramanta", costo: 21450},{nombre: "Carepa", costo: 21450},{nombre: "Carolina del Príncipe", costo: 23200},{nombre: "Caucasia", costo: 16560},{nombre: "Chigorodó", costo: 19350},{nombre: "Cisneros", costo: 21450},{nombre: "Ciudad Bolívar", costo: 23200},{nombre: "Cocorná", costo: 21450},{nombre: "Concepción", costo: 23200},{nombre: "Concordia", costo: 23200},{nombre: "Copacabana", costo: 21450},{nombre: "Dabeiba", costo: 21450},{nombre: "Don matías", costo: 21450},{nombre: "Doradal", costo: 21450},{nombre: "Ebéjico", costo: 23200},{nombre: "El Bagre", costo: 23200},{nombre: "El Carmen de Viboral", costo: 17400},{nombre: "El Peñol", costo: 21450},{nombre: "El Santuario", costo: 17400},{nombre: "El Totumo", costo: 25830},{nombre: "Entrerríos", costo: 21450},{nombre: "Envigado", costo: 16560},{nombre: "Fredonia", costo: 19350},{nombre: "Frontino", costo: 23200},{nombre: "Giraldo", costo: 23200},{nombre: "Girardota", costo: 16560},{nombre: "Gómez Plata", costo: 23200},{nombre: "Granada", costo: 21450},{nombre: "Guadalupe", costo: 23200},{nombre: "Guarne", costo: 16560},{nombre: "Guatapé", costo: 19350},{nombre: "Heliconia", costo: 25830},{nombre: "Hispania", costo: 21450},{nombre: "itagüí", costo: 16560},{nombre: "Ituango", costo: 25830},{nombre: "Jardín", costo: 21450},{nombre: "Jericó", costo: 23200},{nombre: "La Ceja", costo: 16560},{nombre: "La Estrella", costo: 16560},{nombre: "La Pintada", costo: 21450},{nombre: "La Unión", costo: 19350},{nombre: "Liborina", costo: 21450},{nombre: "Maceo", costo: 21450},{nombre: "Marinilla", costo: 16560},{nombre: "Medellín", costo: 16200},{nombre: "Montebello", costo: 17780},{nombre: "Murindó", costo: 19970}, {nombre: "Mutatá", costo: 17780}, {nombre: "Nariño", costo: 18660}, {nombre: "Nechí", costo: 18660},{nombre: "Necoclí", costo: 17780},{nombre: "Olaya", costo: 17780},{nombre: "Peque", costo: 19970},{nombre: "Pueblorrico", costo: 18660},{nombre: "Puerto Berrío", costo: 17780},{nombre: "Puerto Nare", costo: 18660},{nombre: "Puerto Triunfo", costo: 17780},{nombre: "Remedios", costo: 17780},{nombre: "Rionegro", costo: 16200},{nombre: "Sabanalarga", costo: 17780},{nombre: "Sabaneta", costo: 16200},{nombre: "Salgar", costo: 18660},{nombre: "San Andrés de Cuerquia", costo: 18660},{nombre: "San Carlos", costo: 19970},{nombre: "San Francisco", costo: 19970},{nombre: "San Jerónimo", costo: 17780},{nombre: "San José de la Montaña", costo: 18660},{nombre: "San Juan de Urabá", costo: 19970},{nombre: "San Rafael", costo: 17780},{nombre: "San Roque", costo: 17780},{nombre: "San Vicente", costo: 17780},{nombre: "Santa Bárbara", costo: 17780},{nombre: "Santafé de Antioquia", costo: 17780},{nombre: "Santa Rosa de Osos", costo: 17780},{nombre: "Santo Domingo", costo: 17780},{nombre: "Segovia", costo: 17780},{nombre: "Sonsón", costo: 17780},{nombre: "Sopetrán", costo: 17780},{nombre: "Támesis", costo: 17780},{nombre: "Tarazá", costo: 17780},{nombre: "Tarso", costo: 18660},{nombre: "Titiribí", costo: 18660},{nombre: "Toledo", costo: 19970},{nombre: "Turbo", costo: 18930},{nombre: "Uramita", costo: 17780},{nombre: "Urrao", costo: 18660},{nombre: "Valdivia", costo: 17780},{nombre: "Valparaíso", costo: 17780},{nombre: "Vegachí", costo: 17780},{nombre: "Venecia", costo: 18660},{nombre: "Vigía del Fuerte", costo: 44410},{nombre: "Yalí", costo: 17780},{nombre: "Yarumal", costo: 17780},{nombre: "Yolombó", costo: 17780},{nombre: "Yondó", costo: 17780}, {nombre: "Zaragoza", costo: 18660}] },
                    { "departamento": "Arauca", "ciudades": [ { "nombre": "Arauca", "costo": 17780 }, { "nombre": "Arauquita", "costo": 17780 }, { "nombre": "Cravo Norte", "costo": 48160 },{ "nombre": "Fortul", "costo": 17780 },{ "nombre": "Puerto Rondón", "costo": 48160 },{ "nombre": "Saravena", "costo": 17780 },{ "nombre": "Tame", "costo": 18340 } ] },
                    { "departamento": "Atlántico", "ciudades": [ { "nombre": "Baranoa", "costo": 16200 },{ "nombre": "Barranquilla", "costo": 14500 },{ "nombre": "Campo de la Cruz", "costo": 19970 },{ "nombre": "Candelaria", "costo": 16200 },{ "nombre": "Galapa", "costo": 20600 },{ "nombre": "Juan de Acosta", "costo": 20600 },{ "nombre": "Luruaco", "costo": 20600 },{ "nombre": "Malambo", "costo": 20600 },{ "nombre": "Manatí", "costo": 21500 },{ "nombre": "Palmar de Varela", "costo": 20600 },{ "nombre": "Piojó", "costo": 20600 },{ "nombre": "Polonuevo", "costo": 20600 },{ "nombre": "Ponedera", "costo": 20600 },{ "nombre": "Puerto Colombia", "costo": 20600 },{ "nombre": "Repelón", "costo": 20600 },{ "nombre": "Sabanagrande", "costo": 20600 },{ "nombre": "Sabanalarga", "costo": 20600 },{ "nombre": "Santa Lucía", "costo": 21500 },{ "nombre": "Santo Tomás", "costo": 20600 },{ "nombre": "Soledad", "costo": 20600 },{ "nombre": "Suán", "costo": 20600 },{ "nombre": "Tubará", "costo": 20600 },{ "nombre": "Usiacurí", "costo": 20600 } ] },
                    { "departamento": "Bolívar", "ciudades": [ { "nombre": "Achí", "costo": 21500 },{ "nombre": "Altos del Rosario", "costo": 49690 },{ "nombre": "Arenal", "costo": 20600 },{ "nombre": "Arjona", "costo": 20600 },{ "nombre": "Arroyohondo", "costo": 21500 },{ "nombre": "Barranco de Loba", "costo": 33730 },{ "nombre": "Calamar", "costo": 20600 },{ "nombre": "Cantagallo", "costo": 19240 },{ "nombre": "Cartagena de Indias", "costo": 16200 },{ "nombre": "Cicuco", "costo": 21500 },{ "nombre": "Clemencia", "costo": 20600 },{ "nombre": "Córdoba", "costo": 21500 },{ "nombre": "El Carmen de Bolívar", "costo": 20600 },{ "nombre": "El Guamo", "costo": 21500 },{ "nombre": "El Peñón", "costo": 21500 },{ "nombre": "Hatillo de Loba", "costo": 33730 },{ "nombre": "Magangué", "costo": 21500 },{ "nombre": "Mahates", "costo": 20600 },{ "nombre": "Margarita", "costo": 49690 },{ "nombre": "María La Baja", "costo": 20600 },{ "nombre": "Mompós", "costo": 21500 },{ "nombre": "Montecristo", "costo": 21500 },{ "nombre": "Morales", "costo": 20600 },{ "nombre": "Norosí", "costo": 20600 },{ "nombre": "Pinillos", "costo": 33730 },{ "nombre": "Regidor", "costo": 20600 },{ "nombre": "Río Viejo", "costo": 20600 },{ "nombre": "San Cristóbal", "costo": 21500 },{ "nombre": "San Estanislao", "costo": 20600 },{ "nombre": "San Fernando", "costo": 49690 },{ "nombre": "San Jacinto", "costo": 20600 },{ "nombre": "San Jacinto del Cauca", "costo": 21500 },{ "nombre": "San Juan Nepomuceno", "costo": 20600 },{ "nombre": "San Martín de Loba", "costo": 33730 },{ "nombre": "San Pablo", "costo": 19240 },{ "nombre": "Santa Catalina", "costo": 20600 },{ "nombre": "Santa Cruz de Mompox", "costo": 33730 },{ "nombre": "Santa Rosa", "costo": 20600 },{ "nombre": "Santa Rosa del Sur", "costo": 19240 },{ "nombre": "Simití", "costo": 19240 },{ "nombre": "Soplaviento", "costo": 21500 },{ "nombre": "Talaigua Nuevo", "costo": 21500 },{ "nombre": "Tiquisio", "costo": 49690 },{ "nombre": "Turbaco", "costo": 20600 },{ "nombre": "Turbaná", "costo": 20600 },{ "nombre": "Villanueva", "costo": 20600 },{ "nombre": "Zambrano", "costo": 21500 } ] },
                    { "departamento": "Boyacá", "ciudades": [ { "nombre": "Almeida", "costo": 19240 },{ "nombre": "Aquitania", "costo": 20600 },{ "nombre": "Arcabuco", "costo": 18340 },{ "nombre": "Belén", "costo": 18340 },{ "nombre": "Berbeo", "costo": 18340 },{ "nombre": "Betéitiva", "costo": 20600 },{ "nombre": "Boavita", "costo": 18340 },{ "nombre": "Boyacá", "costo": 18340 },{ "nombre": "Briceño", "costo": 19240 },{ "nombre": "Buenavista", "costo": 19240 },{ "nombre": "Busbanzá", "costo": 18340 },{ "nombre": "Caldas", "costo": 19240 },{ "nombre": "Campohermoso", "costo": 19240 },{ "nombre": "Cerinza", "costo": 18340 },{ "nombre": "Chinavita", "costo": 18340 },{ "nombre": "Chiquinquirá", "costo": 12200 },{ "nombre": "Chíquiza", "costo": 20600 },{ "nombre": "Chiscas", "costo": 19240 },{ "nombre": "Chita", "costo": 20600 },{ "nombre": "Chitaraque", "costo": 18340 },{ "nombre": "Chivatá", "costo": 20600 },{ "nombre": "Chivor", "costo": 19240 },{ "nombre": "Ciénega", "costo": 18340 },{ "nombre": "Cómbita", "costo": 18340 },{ "nombre": "Coper", "costo": 20600 },{ "nombre": "Corrales", "costo": 18340 },{ "nombre": "Covarachía", "costo": 19240 },{ "nombre": "Cubará", "costo": 49690 },{ "nombre": "Cucaita", "costo": 18340 },{ "nombre": "Cuítiva", "costo": 18340 },{ "nombre": "Duitama", "costo": 12200 },{ "nombre": "El Cocuy", "costo": 18340 },{ "nombre": "El Espino", "costo": 18340 },{ "nombre": "Firavitoba", "costo": 18340 },{ "nombre": "Floresta", "costo": 18340 },{ "nombre": "Gachantivá", "costo": 18340 },{ "nombre": "Gámeza", "costo": 20600 },{ "nombre": "Garagoa", "costo": 18340 },{ "nombre": "Guacamayas", "costo": 18340 },{ "nombre": "Guateque", "costo": 18340 },{ "nombre": "Guayatá", "costo": 19240 },{ "nombre": "Güicán", "costo": 18340 },{ "nombre": "Iza", "costo": 18340 },{ "nombre": "Jenesano", "costo": 18340 },{ "nombre": "Jericó", "costo": 20600 },{ "nombre": "La Capilla", "costo": 18340 },{ "nombre": "La Uvita", "costo": 18340 },{ "nombre": "La Victoria", "costo": 19240 },{ "nombre": "Labranzagrande", "costo": 47950 },{ "nombre": "Leiva", "costo": 19240 },{ "nombre": "Macanal", "costo": 19240 },{ "nombre": "Maripí", "costo": 19240 },{ "nombre": "Miraflores", "costo": 18340 },{ "nombre": "Mongua", "costo": 18340 },{ "nombre": "Monguí", "costo": 18340 },{ "nombre": "Moniquirá", "costo": 18340 },{ "nombre": "Motavita", "costo": 18340 },{ "nombre": "Muzo", "costo": 19240 },{ "nombre": "Nobsa", "costo": 18340 },{ "nombre": "Nuevo Colón", "costo": 20600 },{ "nombre": "Oicatá", "costo": 18340 },{ "nombre": "Otanche", "costo": 19240 },{ "nombre": "Pachavita", "costo": 19240 },{ "nombre": "Páez", "costo": 19240 },{ "nombre": "Paipa", "costo": 12200 },{ "nombre": "Pajarito", "costo": 18340 },{ "nombre": "Panqueba", "costo": 18340 },{ "nombre": "Pauna", "costo": 19240 },{ "nombre": "Paya", "costo": 48430 },{ "nombre": "Paz de Río", "costo": 19240 },{ "nombre": "Pesca", "costo": 20600 },{ "nombre": "Pisba", "costo": 48430 },{ "nombre": "Puerto Boyacá", "costo": 20600 },{ "nombre": "Quípama", "costo": 19240 },{ "nombre": "Ramiriquí", "costo": 18340 },{ "nombre": "Ráquira", "costo": 18340 },{ "nombre": "Rondón", "costo": 19240 },{ "nombre": "Saboyá", "costo": 20600 },{ "nombre": "Sáchica", "costo": 18340 },{ "nombre": "Samacá", "costo": 18340 },{ "nombre": "San Eduardo", "costo": 18340 },{ "nombre": "San José de Pare", "costo": 18340 },{ "nombre": "San Luis de Gaceno", "costo": 19240 },{ "nombre": "San Mateo", "costo": 18340 },{ "nombre": "San Miguel de Sema", "costo": 20600 },{ "nombre": "San Pablo de Borbur", "costo": 19240 },{ "nombre": "Santa María", "costo": 19240 },{ "nombre": "Santa Rosa de Viterbo", "costo": 18340 },{ "nombre": "Santa Sofía", "costo": 18340 },{ "nombre": "Santana", "costo": 18340 },{ "nombre": "Sativanorte", "costo": 19240 },{ "nombre": "Sativasur", "costo": 19240 },{ "nombre": "Siachoque", "costo": 19240 },{ "nombre": "Soatá", "costo": 18340 },{ "nombre": "Socha", "costo": 18660 },{ "nombre": "Socotá", "costo": 19240 },{ "nombre": "Sogamoso", "costo": 12200 },{ "nombre": "Somondoco", "costo": 19240 },{ "nombre": "Sora", "costo": 18340 },{ "nombre": "Soracá", "costo": 18340 },{ "nombre": "Sotaquirá", "costo": 18340 },{ "nombre": "Susacón", "costo": 18340 },{ "nombre": "Sutamarchán", "costo": 18340 },{ "nombre": "Sutatenza", "costo": 18340 },{ "nombre": "Tasco", "costo": 20600 },{ "nombre": "Tenza", "costo": 18340 },{ "nombre": "Tibaná", "costo": 18340 },{ "nombre": "Tibasosa", "costo": 18340 },{ "nombre": "Tinjacá", "costo": 18340 },{ "nombre": "Tipacoque", "costo": 19240 },{ "nombre": "Toca", "costo": 20600 },{ "nombre": "Togüí", "costo": 20600 },{ "nombre": "Tópaga", "costo": 18340 },{ "nombre": "Tota", "costo": 18340 },{ "nombre": "Tunja", "costo": 12200 },{ "nombre": "Tununguá", "costo": 19240 },{ "nombre": "Turmequé", "costo": 20600 },{ "nombre": "Tuta", "costo": 18340 },{ "nombre": "Tutasá", "costo": 20600 },{ "nombre": "Úmbita", "costo": 19240 },{ "nombre": "Ventaquemada", "costo": 20600 },{ "nombre": "Villa de Leyva", "costo": 18349 },{ "nombre": "Viracachá", "costo": 18340 },{ "nombre": "Zetaquira", "costo": 18340 } ] },
                    { "departamento": "Caldas", "ciudades": [ { "nombre": "Aguadas", "costo": 18340 },{ "nombre": "Anserma", "costo": 18340 },{ "nombre": "Aranzazu", "costo": 18340 },{ "nombre": "Belalcázar", "costo": 18340 },{ "nombre": "Chinchiná", "costo": 18340 },{ "nombre": "Filadelfia", "costo": 18340 },{ "nombre": "La Dorada", "costo": 12200 },{ "nombre": "La Merced", "costo": 18340 },{ "nombre": "Manizales", "costo": 18340 },{ "nombre": "Manzanares", "costo": 18340 },{ "nombre": "Marmato", "costo": 18340 },{ "nombre": "Marquetalia", "costo": 19240 },{ "nombre": "Marulanda", "costo": 19240 },{ "nombre": "Neira", "costo": 18340 },{ "nombre": "Norcasia", "costo": 14730 },{ "nombre": "Pácora", "costo": 18340 },{ "nombre": "Palestina", "costo": 18340 },{ "nombre": "Pensilvania", "costo": 18340 },{ "nombre": "Riosucio", "costo": 18340 },{ "nombre": "Risaralda", "costo": 18340 },{ "nombre": "Salamina", "costo": 18340 },{ "nombre": "Samaná", "costo": 19240 },{ "nombre": "San José", "costo": 18340 },{ "nombre": "Supía", "costo": 18340 },{ "nombre": "Victoria", "costo": 18340 },{ "nombre": "Villamaría", "costo": 18340 },{ "nombre": "Viterbo", "costo": 18340 } ] },
                    { "departamento": "Caquetá", "ciudades": [ { "nombre": "Albania", "costo": 18340 },{ "nombre": "Belén de Los Andaquies", "costo": 18340 },{ "nombre": "Cartagena del Chairá", "costo": 18340 },{ "nombre": "Curillo", "costo": 18340 },{ "nombre": "El Doncello", "costo": 18340 },{ "nombre": "El Paujil", "costo": 18340 },{ "nombre": "Florencia", "costo": 18340 },{ "nombre": "La Montañita", "costo": 18340 },{ "nombre": "Milán", "costo": 18340 },{ "nombre": "Morelia", "costo": 18340 },{ "nombre": "Puerto Rico", "costo": 18340 },{ "nombre": "San José del Fragua", "costo": 18340 },{ "nombre": "San Vicente del Caguán", "costo": 18340 },{ "nombre": "Solano", "costo": 18340 },{ "nombre": "Solita", "costo": 18340 },{ "nombre": "Valparaíso", "costo": 18340 } ] },
                    { "departamento": "Casanare", "ciudades": [ { "nombre": "Aguazul", "costo": 12200 },{ "nombre": "Chámeza", "costo": 20600 },{ "nombre": "Hato Corozal", "costo": 18340 },{ "nombre": "La Salina", "costo": 20600 },{ "nombre": "Maní", "costo": 18340 },{ "nombre": "Monterrey", "costo": 18340 },{ "nombre": "Nunchía", "costo": 18340 },{ "nombre": "Orocué", "costo": 18340 },{ "nombre": "Paz de Ariporo", "costo": 18340 },{ "nombre": "Pore", "costo": 18340 },{ "nombre": "Recetor", "costo": 20600 },{ "nombre": "Sabanalarga", "costo": 19240 },{ "nombre": "Sácama", "costo": 20600 },{ "nombre": "San Luis de Palenque", "costo": 18340 },{ "nombre": "Támara", "costo": 18340 },{ "nombre": "Tauramena", "costo": 18340 },{ "nombre": "Trinidad", "costo": 18340 },{ "nombre": "Villanueva", "costo": 18340 },{ "nombre": "Yopal", "costo": 12200 } ] },
                    { "departamento": "Cauca", "ciudades": [ { "nombre": "Almaguer", "costo": 18340 },{ "nombre": "Argelia", "costo": 19240 },{ "nombre": "Balboa", "costo": 19240 },{ "nombre": "Bolívar", "costo": 19240 },{ "nombre": "Buenos Aires", "costo": 19240 },{ "nombre": "Cajibío", "costo": 19240 },{ "nombre": "Caldono", "costo": 20600 },{ "nombre": "Caloto", "costo": 19240 },{ "nombre": "Corinto", "costo": 18340 },{ "nombre": "El Tambo", "costo": 18340 },{ "nombre": "Florencia", "costo": 18340 },{ "nombre": "Guachené", "costo": 19240 },{ "nombre": "Guapí", "costo": 51720 },{ "nombre": "Inzá", "costo": 20600 },{ "nombre": "Jambaló", "costo": 18340 },{ "nombre": "La Sierra", "costo": 18340 },{ "nombre": "La Vega", "costo": 18340 },{ "nombre": "López de Micay", "costo": 49690 },{ "nombre": "Mercaderes", "costo": 19240 },{ "nombre": "Miranda", "costo": 18340 },{ "nombre": "Morales", "costo": 18340 },{ "nombre": "Padilla", "costo": 18340 },{ "nombre": "Páez", "costo": 20600 },{ "nombre": "Patía", "costo": 48430 },{ "nombre": "Piamonte", "costo": 49690 },{ "nombre": "Piendamó", "costo": 18340 },{ "nombre": "Popayán", "costo": 18340 },{ "nombre": "Puerto Tejada", "costo": 18340 },{ "nombre": "Puracé", "costo": 37710 },{ "nombre": "Rosas", "costo": 18340 },{ "nombre": "San Sebastián", "costo": 18340 },{ "nombre": "Santander de Quilichao", "costo": 18340 },{ "nombre": "Santa Rosa", "costo": 20600 },{ "nombre": "Silvia", "costo": 18340 },{ "nombre": "Sotará", "costo": 18340 },{ "nombre": "Suárez", "costo": 19240 },{ "nombre": "Sucre", "costo": 19240 },{ "nombre": "Timbío", "costo": 18340 },{ "nombre": "Timbiquí", "costo": 33730 },{ "nombre": "Toribío", "costo": 19240 },{ "nombre": "Totoró", "costo": 18340 },{ "nombre": "Villa Rica", "costo": 18340 } ] },
                    { "departamento": "Cesar", "ciudades": [ { "nombre": "Aguachica", "costo": 18340 },{ "nombre": "Agustín Codazzi", "costo": 20600 },{ "nombre": "Astrea", "costo": 20600 },{ "nombre": "Becerril", "costo": 20600 },{ "nombre": "Bosconia", "costo": 20600 },{ "nombre": "Chimichagua", "costo": 20600 },{ "nombre": "Chiriguaná", "costo": 20600 },{ "nombre": "Curumaní", "costo": 20600 },{ "nombre": "El Copey", "costo": 20600 },{ "nombre": "El Paso", "costo": 20600 },{ "nombre": "Gamarra", "costo": 20600 },{ "nombre": "González", "costo": 19240 },{ "nombre": "La Gloria", "costo": 20600 },{ "nombre": "La Jagua de Ibirico", "costo": 20600 },{ "nombre": "Manaure Balcón del Cesar", "costo": 21500 },{ "nombre": "Pailitas", "costo": 20600 },{ "nombre": "Pelaya", "costo": 20600 },{ "nombre": "Pueblo Bello", "costo": 20600 },{ "nombre": "Río de Oro", "costo": 18340 },{ "nombre": "La Paz", "costo": 20600 },{ "nombre": "San Alberto", "costo": 18340 },{ "nombre": "San Diego", "costo": 20600 },{ "nombre": "San Martín", "costo": 18340 },{ "nombre": "Tamalameque", "costo": 20600 },{ "nombre": "Valledupar", "costo": 20600 } ] },
                    { "departamento": "Chocó", "ciudades": [ { "nombre": "Acandí", "costo": 45820 },{ "nombre": "Alto Baudó", "costo": 45820 },{ "nombre": "Atrato", "costo": 45820 },{ "nombre": "Bagadó", "costo": 45820 },{ "nombre": "Bahía Solano", "costo": 45820 },{ "nombre": "Bajo Baudó", "costo": 45820 },{ "nombre": "Bojayá", "costo": 45820 },{ "nombre": "Cantón de San Pablo", "costo": 45820 },{ "nombre": "Carmen del Darién", "costo": 45820 },{ "nombre": "Cértegui", "costo": 20600 },{ "nombre": "Condoto", "costo": 20600 },{ "nombre": "El Carmen de Atrato", "costo": 19240 },{ "nombre": "El Litoral del San Juan", "costo": 45820 },{ "nombre": "Istmina", "costo": 20600 },{ "nombre": "Juradó", "costo": 45820 },{ "nombre": "Lloró", "costo": 45820 },{ "nombre": "Medio Atrato", "costo": 45820 },{ "nombre": "Medio Baudó", "costo": 45820 },{ "nombre": "Medio San Juan", "costo": 45820 },{ "nombre": "Nóvita", "costo": 20600 },{ "nombre": "Nuquí", "costo": 45820 },{ "nombre": "Quibdó", "costo": 20600 },{ "nombre": "Río Iró", "costo": 45820 },{ "nombre": "Río Quito", "costo": 45820 },{ "nombre": "Riosucio", "costo": 45820 },{ "nombre": "San José del Palmar", "costo": 19240 },{ "nombre": "Sipí", "costo": 45820 },{ "nombre": "Tadó", "costo": 45820 },{ "nombre": "Unguía", "costo": 45820 },{ "nombre": "Unión Panamericana", "costo": 20600 } ] },
                    { "departamento": "Córdoba", "ciudades": [ { "nombre": "Ayapel", "costo": 21500 },{ "nombre": "Buenavista", "costo": 20600 },{ "nombre": "Canalete", "costo": 19970 },{ "nombre": "Cereté", "costo": 20600 },{ "nombre": "Chimá", "costo": 21500 },{ "nombre": "Chinú", "costo": 20600 },{ "nombre": "Ciénaga de Oro", "costo": 20600 },{ "nombre": "Cotorra", "costo": 20600 },{ "nombre": "La Apartada", "costo": 19970 },{ "nombre": "Lorica", "costo": 20600 },{ "nombre": "Los Córdobas", "costo": 20600 },{ "nombre": "Momil", "costo": 21500 },{ "nombre": "Moñitos", "costo": 20600 },{ "nombre": "Montelíbano", "costo": 20600 },{ "nombre": "Montería", "costo": 20600 },{ "nombre": "Planeta Rica", "costo": 20600 },{ "nombre": "Pueblo Nuevo", "costo": 20840 },{ "nombre": "Puerto Escondido", "costo": 20600 },{ "nombre": "Puerto Libertador", "costo": 20600 },{ "nombre": "Purísima", "costo": 21500 },{ "nombre": "Sahagún", "costo": 20600 },{ "nombre": "San Andrés de Sotavento", "costo": 21500 },{ "nombre": "San Antero", "costo": 20600 },{ "nombre": "San Bernardo del Viento", "costo": 20600 },{ "nombre": "San Carlos", "costo": 20600 },{ "nombre": "San José de Uré", "costo": 21500 },{ "nombre": "San Pelayo", "costo": 20600 },{ "nombre": "Tierralta", "costo": 20600 },{ "nombre": "Tuchín", "costo": 21500 },{ "nombre": "Valencia", "costo": 20600 } ] },
                    { "departamento": "Cundinamarca", "ciudades": [ { "nombre": "Agua de Dios", "costo": 12200 },{ "nombre": "Albán", "costo": 12200 },{ "nombre": "Anapoima", "costo": 12200 },{ "nombre": "Anolaima", "costo": 12200 },{ "nombre": "Apulo", "costo": 12200 },{ "nombre": "Arbeláez", "costo": 13280 },{ "nombre": "Beltrán", "costo": 12200 },{ "nombre": "Bituima", "costo": 12200 },{ "nombre": "Bojacá", "costo": 12200 },{ "nombre": "Briceño", "costo": 9940 },{ "nombre": "Cabrera", "costo": 13280 },{ "nombre": "Cachipay", "costo": 12200 },{ "nombre": "Cajicá", "costo": 9940 },{ "nombre": "Caparrapí", "costo": 12200 },{ "nombre": "Cáqueza", "costo": 12200 },{ "nombre": "Carmen de Carupa", "costo": 12200 },{ "nombre": "Chaguaní", "costo": 12200 },{ "nombre": "Chía", "costo": 9640 },{ "nombre": "Chinauta", "costo": 12200 },{ "nombre": "Chipaque", "costo": 12200 },{ "nombre": "Choachí", "costo": 12200 },{ "nombre": "Chocontá", "costo": 12200 },{ "nombre": "Cogua", "costo": 12200 },{ "nombre": "Cota", "costo": 9940 },{ "nombre": "Cucunubá", "costo": 12200 },{ "nombre": "El Colegio", "costo": 12200 },{ "nombre": "El Peñón", "costo": 13280 },{ "nombre": "El Rosal", "costo": 12200 },{ "nombre": "Facatativá", "costo": 9940 },{ "nombre": "Fómeque", "costo": 12200 },{ "nombre": "Fosca", "costo": 13280 },{ "nombre": "Funza", "costo": 9940 },{ "nombre": "Fúquene", "costo": 12200 },{ "nombre": "Fusagasugá", "costo": 12200 },{ "nombre": "Gachalá", "costo": 12200 },{ "nombre": "Gachancipá", "costo": 12200 },{ "nombre": "Gachetá", "costo": 12200 },{ "nombre": "Gama", "costo": 12200 },{ "nombre": "Girardot", "costo": 12200 },{ "nombre": "Granada", "costo": 12200 },{ "nombre": "Guachetá", "costo": 12200 },{ "nombre": "Guaduas", "costo": 12200 },{ "nombre": "Guasca", "costo": 12200 },{ "nombre": "Guataquí", "costo": 14250 },{ "nombre": "Guatavita", "costo": 12200 },{ "nombre": "Guayabal de Síquima", "costo": 12200 },{ "nombre": "Guayabetal", "costo": 12200 },{ "nombre": "Gutiérrez", "costo": 13280 },{ "nombre": "Jerusalén", "costo": 19240 },{ "nombre": "Junín", "costo": 12200 },{ "nombre": "La Calera", "costo": 9940 },{ "nombre": "La Llanada", "costo": 56220 },{ "nombre": "La Mesa", "costo": 12200 },{ "nombre": "La Palma", "costo": 12200 },{ "nombre": "La Peña", "costo": 12200 },{ "nombre": "La Punta", "costo": 9940 },{ "nombre": "La Vega", "costo": 12200 },{ "nombre": "Lenguazaque", "costo": 12200 },{ "nombre": "Machetá", "costo": 12200 },{ "nombre": "Madrid", "costo": 9940 },{ "nombre": "Manta", "costo": 12200 },{ "nombre": "Medina", "costo": 18340 },{ "nombre": "Mosquera", "costo": 9940 },{ "nombre": "Nariño", "costo": 14250 },{ "nombre": "Nemocón", "costo": 12200 },{ "nombre": "Nilo", "costo": 18340 },{ "nombre": "Nimaima", "costo": 12200 },{ "nombre": "Nocaima", "costo": 12200 },{ "nombre": "Pacho", "costo": 12200 },{ "nombre": "Paime", "costo": 12200 },{ "nombre": "Pandi", "costo": 13280 },{ "nombre": "Paratebueno", "costo": 18340 },{ "nombre": "Pasca", "costo": 13280 },{ "nombre": "Puente de Piedra", "costo": 9940 },{ "nombre": "Puente Quetame", "costo": 14250 },{ "nombre": "Puerto Salgar", "costo": 13280 },{ "nombre": "Pulí", "costo": 12200 },{ "nombre": "Quebradanegra", "costo": 12200 },{ "nombre": "Quetame", "costo": 12200 },{ "nombre": "Quipile", "costo": 12200 },{ "nombre": "Ricaurte", "costo": 12200 },{ "nombre": "San Antonio del Tequendama", "costo": 12200 },{ "nombre": "San Bernardo", "costo": 13280 },{ "nombre": "San Cayetano", "costo": 13280 },{ "nombre": "San Francisco", "costo": 12200 },{ "nombre": "San Juan de Rioseco", "costo": 12200 },{ "nombre": "Sasaima", "costo": 12200 },{ "nombre": "Sesquilé", "costo": 12200 },{ "nombre": "Sibaté", "costo": 12200 },{ "nombre": "Silvania", "costo": 12200 },{ "nombre": "Simijaca", "costo": 12200 },{ "nombre": "Soacha", "costo": 9940 },{ "nombre": "Sopó", "costo": 9940 },{ "nombre": "Subachoque", "costo": 12200 },{ "nombre": "Subia", "costo": 12200 },{ "nombre": "Suesca", "costo": 12200 },{ "nombre": "Supatá", "costo": 12200 },{ "nombre": "Susa", "costo": 12200 },{ "nombre": "Sutatausa", "costo": 12200 },{ "nombre": "Tabio", "costo": 9940 },{ "nombre": "Tausa", "costo": 12200 },{ "nombre": "Tena", "costo": 12200 },{ "nombre": "Tenjo", "costo": 9940 },{ "nombre": "Tibacuy", "costo": 14730 },{ "nombre": "Tibirita", "costo": 12200 },{ "nombre": "Tocaima", "costo": 12200 },{ "nombre": "Tocancipá", "costo": 12200 },{ "nombre": "Topaipí", "costo": 12200 },{ "nombre": "Ubalá", "costo": 12200 },{ "nombre": "Ubaque", "costo": 12200 },{ "nombre": "Une", "costo": 13280 },{ "nombre": "Útica", "costo": 12200 },{ "nombre": "Venecia", "costo": 13280 },{ "nombre": "Vergara", "costo": 12200 },{ "nombre": "Vianí", "costo": 12200 },{ "nombre": "Villagómez", "costo": 12200 },{ "nombre": "Villapinzón", "costo": 12200 },{ "nombre": "Villeta", "costo": 12200 },{ "nombre": "Viotá", "costo": 12200 },{ "nombre": "Yacopí", "costo": 12200 },{ "nombre": "Zipacón", "costo": 12200 },{ "nombre": "Zipaquirá", "costo": 9940 } ] },
                    { "departamento": "Guainía", "ciudades": [ { "nombre": "Inírida", "costo": 54850 },{ "nombre": "Barranco Minas", "costo": 49690},{ "nombre": "Mapiripana", "costo": 71280},{ "nombre": "San Felipe", "costo": 71280},{ "nombre": "Puerto Colombia", "costo": 54850},{ "nombre": "La Guadalupe", "costo": 54850},{ "nombre": "Cacahual", "costo": 54850},{ "nombre": "Pana Pana", "costo": 54850},{ "nombre": "Morichal Nuevo", "costo": 54850} ] },
                    { "departamento": "Guaviare", "ciudades": [ { "nombre": "Calamar", "costo": 19240 },{ "nombre": "El Retorno", "costo": 19240 },{ "nombre": "Miraflores", "costo": 54850 },{ "nombre": "San José del Guaviare", "costo": 18340 } ] },
                    { "departamento": "Huila", "ciudades": [ { "nombre": "Acevedo", "costo": 18340 },{ "nombre": "Agrado", "costo": 19240 },{ "nombre": "Aipe", "costo": 12200 },{ "nombre": "Algeciras", "costo": 18340 },{ "nombre": "Altamira", "costo": 18340 },{ "nombre": "Baraya", "costo": 18340 },{ "nombre": "Bruselas", "costo": 18340 },{ "nombre": "Cagúan", "costo": 12200 },{ "nombre": "Campoalegre", "costo": 12200 },{ "nombre": "Colombia", "costo": 18340 },{ "nombre": "El Juncal", "costo": 18340 },{ "nombre": "Elías", "costo": 19240 },{ "nombre": "Garzón", "costo": 18340 },{ "nombre": "Gigante", "costo": 18340 },{ "nombre": "Guadalupe", "costo": 18340 },{ "nombre": "Hobo", "costo": 18340 },{ "nombre": "Íquira", "costo": 18340 },{ "nombre": "Isnos", "costo": 19240 },{ "nombre": "La Argentina", "costo": 18340 },{ "nombre": "La Plata", "costo": 18340 },{ "nombre": "Nátaga", "costo": 18340 },{ "nombre": "Neiva", "costo": 12200 },{ "nombre": "Oporapa", "costo": 19240 },{ "nombre": "Paicol", "costo": 18340 },{ "nombre": "Palermo", "costo": 18340 },{ "nombre": "Palestina", "costo": 19240 },{ "nombre": "Pital", "costo": 19240 },{ "nombre": "Pitalito", "costo": 18340 },{ "nombre": "Rivera", "costo": 12200 },{ "nombre": "Saladoblanco", "costo": 19240 },{ "nombre": "San Agustín", "costo": 19240 },{ "nombre": "Santa María", "costo": 18340 },{ "nombre": "Suaza", "costo": 18340 },{ "nombre": "Tarqui", "costo": 18340 },{ "nombre": "Tello", "costo": 18340 }, { "nombre": "Teruel", "costo": 18340 },{ "nombre": "Tesalia", "costo": 18340 },{ "nombre": "Timaná", "costo": 18340 },{ "nombre": "Villavieja", "costo": 18340 },{ "nombre": "Yaguará", "costo": 19240 },{ "nombre": "Zuluaga", "costo": 18340 } ] },
                    { "departamento": "La Guajira", "ciudades": [ { "nombre": "Albania", "costo": 20600 },{ "nombre": "Barrancas", "costo": 20600 },{ "nombre": "Buenavista", "costo": 59820 },{ "nombre": "Dibulla", "costo": 20600 },{ "nombre": "Distracción", "costo": 20600 },{ "nombre": "El Molino", "costo": 20600 },{ "nombre": "Fonseca", "costo": 20600 },{ "nombre": "Hatonuevo", "costo": 20600 },{ "nombre": "La Jagua del Pilar", "costo": 20600 },{ "nombre": "Maicao", "costo": 21500 },{ "nombre": "Manaure", "costo": 21500 },{ "nombre": "Palomino", "costo": 45030 },{ "nombre": "Papayal", "costo": 20600 },{ "nombre": "Riohacha", "costo": 20600 },{ "nombre": "San Juan del Cesar", "costo": 20600 },{ "nombre": "Uribia", "costo": 21500 },{ "nombre": "Urumita", "costo": 20600 },{ "nombre": "Villanueva", "costo": 20600 } ] },
                    { "departamento": "Magdalena", "ciudades": [ { "nombre": "Algarrobo", "costo": 20600 },{ "nombre": "Aracataca", "costo": 20600 },{ "nombre": "Ariguaní", "costo": 20600 },{ "nombre": "Cerro de San Antonio", "costo": 21500 },{ "nombre": "Chibolo", "costo": 20600 },{ "nombre": "Ciénaga", "costo": 20600 },{ "nombre": "Concordia", "costo": 71280 },{ "nombre": "El Banco", "costo": 20600 },{ "nombre": "El Piñón", "costo": 20600 },{ "nombre": "El Retén", "costo": 21500 },{ "nombre": "Fundación", "costo": 20600 },{ "nombre": "Gaira", "costo": 14500 },{ "nombre": "Guamal", "costo": 21500 },{ "nombre": "Nueva Granada", "costo": 20600 },{ "nombre": "Pedraza", "costo": 21500 },{ "nombre": "Pijiño del Carmen", "costo": 49690 },{ "nombre": "Pivijay", "costo": 20600 },{ "nombre": "Plato", "costo": 20600 },{ "nombre": "Puebloviejo", "costo": 20600 },{ "nombre": "Remolino", "costo": 20600 },{ "nombre": "Sabanas de San Ángel", "costo": 21500 },{ "nombre": "Salamina", "costo": 20600 },{ "nombre": "San Sebastián de Buenavista", "costo": 21500 },{ "nombre": "San Zenón", "costo": 49690 },{ "nombre": "Santa Ana", "costo": 21500 },{ "nombre": "Santa Bárbara de Pinto", "costo": 18930 },{ "nombre": "Santa Marta", "costo": 20600 },{ "nombre": "Sitionuevo", "costo": 20600 },{ "nombre": "Tenerife", "costo": 20600 },{ "nombre": "Zapayán", "costo": 21500 },{ "nombre": "Zona Bananera", "costo": 21500 } ] },
                    { "departamento": "Meta", "ciudades": [ { "nombre": "Acacías", "costo": 12200 },{ "nombre": "Alto Pompeya", "costo": 12200 },{ "nombre": "Apiay", "costo": 14250 },{ "nombre": "Barranca de Upía", "costo": 18340 },{ "nombre": "Cabuyaro", "costo": 19240 },{ "nombre": "Castilla la Nueva", "costo": 19240 },{ "nombre": "Cubarral", "costo": 19240 },{ "nombre": "Cumaral", "costo": 12200 },{ "nombre": "El Calvario", "costo": 18340 },{ "nombre": "El Castillo", "costo": 19240 },{ "nombre": "El Dorado", "costo": 19240 },{ "nombre": "Fuente de Oro", "costo": 18340 },{ "nombre": "Granada", "costo": 12200 },{ "nombre": "Guamal", "costo": 18340 },{ "nombre": "La Julia", "costo": 19240 },{ "nombre": "La Macarena", "costo": 49690 },{ "nombre": "Lejanías", "costo": 19240 },{ "nombre": "Mapiripán", "costo": 19240 },{ "nombre": "Mesetas", "costo": 19240 },{ "nombre": "Pachaquiaro", "costo": 12200 },{ "nombre": "Puerto Concordia", "costo": 18340 },{ "nombre": "Puerto Gaitán", "costo": 18340 },{ "nombre": "Puerto Lleras", "costo": 18340 },{ "nombre": "Puerto López", "costo": 12200 },{ "nombre": "Puerto Rico", "costo": 18340 },{ "nombre": "Restrepo", "costo": 12200 },{ "nombre": "San Carlos de Guaroa", "costo": 19240 },{ "nombre": "San Juan de Arama", "costo": 19240 },{ "nombre": "San Juanito", "costo": 18340 },{ "nombre": "San Martín", "costo": 12200 },{ "nombre": "Uribe", "costo": 19240 },{ "nombre": "Villavicencio", "costo": 12200 },{ "nombre": "Vista Hermosa", "costo": 19240 } ] },
                    { "departamento": "Nariño", "ciudades": [ { "nombre": "Albán", "costo": 20600 },{ "nombre": "Aldana", "costo": 20600 },{ "nombre": "Ancuyá", "costo": 20600 },{ "nombre": "Arboleda", "costo": 20600 },{ "nombre": "Barbacoas", "costo": 21500 },{ "nombre": "Belén", "costo": 20600 },{ "nombre": "Buesaco", "costo": 20600 },{ "nombre": "Chachagüí", "costo": 20600 },{ "nombre": "Colón", "costo": 20600 },{ "nombre": "Consacá", "costo": 20600 },{ "nombre": "Contadero", "costo": 20600 },{ "nombre": "Córdoba", "costo": 20600 },{ "nombre": "Cuaspud", "costo": 20600 },{ "nombre": "Cumbal", "costo": 20600 },{ "nombre": "Cumbitara", "costo": 49690 },{ "nombre": "El Charco", "costo": 49690 },{ "nombre": "El Peñol", "costo": 20600 },{ "nombre": "El Rosario", "costo": 20600 },{ "nombre": "El Tablón de Gómez", "costo": 20600 },{ "nombre": "El Tambo", "costo": 20600 },{ "nombre": "Francisco Pizarro", "costo": 49690 },{ "nombre": "Funes", "costo": 20600 },{ "nombre": "Guachucal", "costo": 20600 },{ "nombre": "Guaitarilla", "costo": 20600 },{ "nombre": "Gualmatán", "costo": 20600 },{ "nombre": "Iles", "costo": 20600 },{ "nombre": "Imués", "costo": 20600 },{ "nombre": "Ipiales", "costo": 20600 },{ "nombre": "La Cruz", "costo": 20600 },{ "nombre": "La Florida", "costo": 20600 },{ "nombre": "La Llanada", "costo": 20600 },{ "nombre": "La Tola", "costo": 49690 },{ "nombre": "La Unión", "costo": 20600 },{ "nombre": "Leiva", "costo": 21500 },{ "nombre": "Linares", "costo": 20600 },{ "nombre": "Los Andes", "costo": 20600 },{ "nombre": "Magüí Payán", "costo": 54850 },{ "nombre": "Mallama", "costo": 20600 },{ "nombre": "Mosquera", "costo": 49690 },{ "nombre": "Nariño", "costo": 20600 },{ "nombre": "Olaya Herrera", "costo": 50650 },{ "nombre": "Ospina", "costo": 21500 },{ "nombre": "Pasto", "costo": 20600 },{ "nombre": "Policarpa", "costo": 20600 },{ "nombre": "Potosí", "costo": 20600 },{ "nombre": "Providencia", "costo": 21500 },{ "nombre": "Puerres", "costo": 20600 },{ "nombre": "Pupiales", "costo": 20600 },{ "nombre": "Ricaurte", "costo": 20600 },{ "nombre": "Roberto Payán", "costo": 33730 },{ "nombre": "Samaniego", "costo": 21500 },{ "nombre": "San Bernardo", "costo": 20600 },{ "nombre": "San Lorenzo", "costo": 20600 },{ "nombre": "San Pablo", "costo": 20600 },{ "nombre": "San Pedro de Cartago", "costo": 20600 },{ "nombre": "Sandoná", "costo": 20600 },{ "nombre": "Santa Bárbara", "costo": 50650 },{ "nombre": "Santacruz", "costo": 21500 },{ "nombre": "Sapuyes", "costo": 21500 },{ "nombre": "Taminango", "costo": 20600 },{ "nombre": "Tangua", "costo": 20600 },{ "nombre": "Tumaco", "costo": 20600 },{ "nombre": "Túquerres", "costo": 20600 },{ "nombre": "Yacuanquer", "costo": 20600 } ] },
                    { "departamento": "Norte de Santander", "ciudades": [ { "nombre": "Ábrego", "costo": 18340 },{ "nombre": "Arboledas", "costo": 20600 },{ "nombre": "Bochalema", "costo": 21500 },{ "nombre": "Bucarasica", "costo": 20600 },{ "nombre": "Cáchira", "costo": 20600 },{ "nombre": "Cácota", "costo": 20600 },{ "nombre": "Chinácota", "costo": 20600 },{ "nombre": "Chitagá", "costo": 20600 },{ "nombre": "Convención", "costo": 19240 },{ "nombre": "Cúcuta", "costo": 20600 },{ "nombre": "Cucutilla", "costo": 20600 },{ "nombre": "Duranía", "costo": 21500 },{ "nombre": "El Carmen", "costo": 19240 },{ "nombre": "El Tarra", "costo": 21500 },{ "nombre": "El Zulia", "costo": 20600 },{ "nombre": "Gramalote", "costo": 21500 },{ "nombre": "Hacarí", "costo": 19240 },{ "nombre": "Herrán", "costo": 21500 },{ "nombre": "La DonJuana", "costo": 20600 },{ "nombre": "La Esperanza", "costo": 18340 },{ "nombre": "La Playa de Belén", "costo": 19240 },{ "nombre": "Labateca", "costo": 20600 },{ "nombre": "Los Patios", "costo": 20600 },{ "nombre": "Lourdes", "costo": 21500 },{ "nombre": "Mutiscua", "costo": 21500 },{ "nombre": "Ocaña", "costo": 18340 },{ "nombre": "Pamplona", "costo": 20600 },{ "nombre": "Pamplonita", "costo": 20600 },{ "nombre": "Puerto Santander", "costo": 20600 },{ "nombre": "Ragonvalia", "costo": 21500 },{ "nombre": "Salazar de Las Palmas", "costo": 20600 },{ "nombre": "San Calixto", "costo": 19240 },{ "nombre": "San Cayetano", "costo": 20600 },{ "nombre": "Santiago", "costo": 20600 },{ "nombre": "Sardinata", "costo": 20600 },{ "nombre": "Silos", "costo": 21500 },{ "nombre": "Teorama", "costo": 19240 },{ "nombre": "Tibú", "costo": 20600 },{ "nombre": "Toledo", "costo": 20600 },{ "nombre": "Villa Caro", "costo": 21500 },{ "nombre": "Villa del Rosario", "costo": 20600 } ] },
                    { "departamento": "Putumayo", "ciudades": [ { "nombre": "Colón", "costo": 18340 },{ "nombre": "La Hormiga", "costo": 18340 },{ "nombre": "Leguizamo", "costo": 54850 },{ "nombre": "Mocoa", "costo": 18340 },{ "nombre": "Orito", "costo": 18340 },{ "nombre": "Puerto Asís", "costo": 18340 },{ "nombre": "Puerto Caicedo", "costo": 18340 },{ "nombre": "Puerto Guzmán", "costo": 18340 },{ "nombre": "San Francisco", "costo": 18340 },{ "nombre": "San Miguel", "costo": 18340 },{ "nombre": "Santiago", "costo": 18340 },{ "nombre": "Sibundoy", "costo": 18340 },{ "nombre": "Valle del Guamuez", "costo": 18340 },{ "nombre": "Villagarzón", "costo": 18340 } ] },
                    { "departamento": "Quindío", "ciudades": [ { "nombre": "Armenia", "costo": 18340 },{ "nombre": "Barcelona", "costo": 18340 },{ "nombre": "Buenavista", "costo": 18340 },{ "nombre": "Calarcá", "costo": 18340 },{ "nombre": "Circasia", "costo": 18340 },{ "nombre": "Córdoba", "costo": 18340 },{ "nombre": "Filandia", "costo": 18340 },{ "nombre": "Génova", "costo": 19240 },{ "nombre": "La Tebaida", "costo": 18340 },{ "nombre": "Montenegro", "costo": 18340 },{ "nombre": "Pijao", "costo": 18340 },{ "nombre": "Quimbaya", "costo": 18340 },{ "nombre": "Salento", "costo": 18340 } ] },
                    { "departamento": "Risaralda", "ciudades": [ { "nombre": "Apía", "costo": 19240 },{ "nombre": "Balboa", "costo": 19240 },{ "nombre": "Belén de Umbría", "costo": 18340 },{ "nombre": "Dosquebradas", "costo": 18340 },{ "nombre": "Guática", "costo": 18340 },{ "nombre": "La Celia", "costo": 19240 },{ "nombre": "La Virginia", "costo": 18340 },{ "nombre": "Marsella", "costo": 18340 },{ "nombre": "Mistrató", "costo": 18340 },{ "nombre": "Pereira", "costo": 18340 },{ "nombre": "Pueblo Rico", "costo": 19240 },{ "nombre": "Quinchía", "costo": 18340 },{ "nombre": "Santa Rosa de Cabal", "costo": 18340 },{ "nombre": "Santuario", "costo": 19240 } ] },
                    { "departamento": "San Andrés y Providencia", "ciudades": [ { "nombre": "Providencia y Santa Catalina Islas", "costo": 53160 },{ "nombre": "San Andrés", "costo": 45440 } ] },
                    { "departamento": "Santander", "ciudades": [ { "nombre": "Acapulco", "costo": 18340 },{ "nombre": "Aguada", "costo": 20600 },{ "nombre": "Albania", "costo": 19240 },{ "nombre": "Aratoca", "costo": 18340 },{ "nombre": "Barbosa", "costo": 18340 },{ "nombre": "Barichara", "costo": 18340 },{ "nombre": "Barrancabermeja", "costo": 18340 },{ "nombre": "Betulia", "costo": 18340 },{ "nombre": "Bolívar", "costo": 19240 },{ "nombre": "Bucaramanga", "costo": 14500 },{ "nombre": "Cabrera", "costo": 20600 },{ "nombre": "California", "costo": 18340 },{ "nombre": "Capitanejo", "costo": 19240 },{ "nombre": "Carcasí", "costo": 19240 },{ "nombre": "Cepitá", "costo": 20600 },{ "nombre": "Cerrito", "costo": 19240 },{ "nombre": "Charalá", "costo": 18340 },{ "nombre": "Charta", "costo": 18340 },{ "nombre": "Chima", "costo": 18340 },{ "nombre": "Chipatá", "costo": 19240 },{ "nombre": "Cimitarra", "costo": 18340 },{ "nombre": "Concepción", "costo": 19240 },{ "nombre": "Confines", "costo": 20600 },{ "nombre": "Contratación", "costo": 18340 },{ "nombre": "Coromoro", "costo": 18340 },{ "nombre": "Curití", "costo": 18340 },{ "nombre": "El Carmen de Chucurí", "costo": 19240 },{ "nombre": "El Guacamayo", "costo": 18340 },{ "nombre": "El Peñón", "costo": 20600 },{ "nombre": "El Playón", "costo": 18340 },{ "nombre": "Encino", "costo": 20600 },{ "nombre": "Enciso", "costo": 19240 },{ "nombre": "Florián", "costo": 19240 },{ "nombre": "Floridablanca", "costo": 18340 },{ "nombre": "Galán", "costo": 18340 },{ "nombre": "Gámbita", "costo": 19240 },{ "nombre": "Girón", "costo": 18340 },{ "nombre": "Guaca", "costo": 18340 },{ "nombre": "Guadalupe", "costo": 18340 },{ "nombre": "Guapotá", "costo": 20600 },{ "nombre": "Guavatá", "costo": 19240 },{ "nombre": "Güepsa", "costo": 18340 },{ "nombre": "Hato", "costo": 18340 },{ "nombre": "Jesús María", "costo": 19240 },{ "nombre": "Jordán", "costo": 20600 },{ "nombre": "La Belleza", "costo": 19240 },{ "nombre": "La Paz", "costo": 19240 },{ "nombre": "Landázuri", "costo": 18340 },{ "nombre": "Lebrija", "costo": 18340 },{ "nombre": "Los Santos", "costo": 20600 },{ "nombre": "Macaravita", "costo": 19240 },{ "nombre": "Málaga", "costo": 18340 },{ "nombre": "Matanza", "costo": 18340 },{ "nombre": "Mogotes", "costo": 18340 },{ "nombre": "Molagavita", "costo": 18340 },{ "nombre": "Ocamonte", "costo": 18340 },{ "nombre": "Oiba", "costo": 18340 },{ "nombre": "Onzaga", "costo": 18340 },{ "nombre": "Palmar", "costo": 18340 },{ "nombre": "Palmas del Socorro", "costo": 20600 },{ "nombre": "Páramo", "costo": 18340 },{ "nombre": "Piedecuesta", "costo": 18340 },{ "nombre": "Pinchote", "costo": 18340 },{ "nombre": "Puente Nacional", "costo": 19240 },{ "nombre": "Puerto Parra", "costo": 19240 },{ "nombre": "Puerto Wilches", "costo": 19240 },{ "nombre": "Rionegro", "costo": 18340 },{ "nombre": "Sabana de Torres", "costo": 19240 },{ "nombre": "San Andrés", "costo": 18340 },{ "nombre": "San Benito", "costo": 20600 },{ "nombre": "San Gil", "costo": 18340 },{ "nombre": "San Joaquín", "costo": 18340 },{ "nombre": "San José de Miranda", "costo": 19240 },{ "nombre": "San Miguel", "costo": 19240 },{ "nombre": "San Vicente de Chucurí", "costo": 18340 },{ "nombre": "Santa Bárbara", "costo": 18340 },{ "nombre": "Santa Helena del Opón", "costo": 20600 },{ "nombre": "Simacota", "costo": 18340 },{ "nombre": "Socorro", "costo": 18340 },{ "nombre": "Suaita", "costo": 19240 },{ "nombre": "Sucre", "costo": 19240 },{ "nombre": "Suratá", "costo": 18340 },{ "nombre": "Tona", "costo": 20600 },{ "nombre": "Valle de San José", "costo": 18340 },{ "nombre": "Vélez", "costo": 19240 },{ "nombre": "Vetas", "costo": 18340 },{ "nombre": "Villanueva", "costo": 18340 },{ "nombre": "Zapatoca", "costo": 18340 } ] },
                    { "departamento": "Sucre", "ciudades": [ { "nombre": "Buenavista", "costo": 21500 },{ "nombre": "Caimito", "costo": 20600 },{ "nombre": "Chalán", "costo": 21500 },{ "nombre": "Colosó", "costo": 21500 },{ "nombre": "Corozal", "costo": 20600 },{ "nombre": "Coveñas", "costo": 20600 },{ "nombre": "El Roble", "costo": 20600 },{ "nombre": "Galeras", "costo": 20600 },{ "nombre": "Guaranda", "costo": 21500 },{ "nombre": "La Unión", "costo": 20600 },{ "nombre": "Los Palmitos", "costo": 20600 },{ "nombre": "Majagual", "costo": 20600 },{ "nombre": "Morroa", "costo": 20600 },{ "nombre": "Ovejas", "costo": 20600 },{ "nombre": "Palmito", "costo": 20600 },{ "nombre": "Sampués", "costo": 20600 },{ "nombre": "San Benito Abad", "costo": 20600 },{ "nombre": "San Juan de Betulia", "costo": 20600 },{ "nombre": "San Marcos", "costo": 20600 },{ "nombre": "San Onofre", "costo": 20600 },{ "nombre": "San Pedro", "costo": 21500 },{ "nombre": "Santiago de Tolu", "costo": 20600 },{ "nombre": "Sincelejo", "costo": 20600 },{ "nombre": "Sucre", "costo": 48430 },{ "nombre": "Tolú Viejo", "costo": 20600 } ] },
                    { "departamento": "Tolima", "ciudades": [ { "nombre": "Alpujarra", "costo": 19240 },{ "nombre": "Alvarado", "costo": 12200 },{ "nombre": "Ambalema", "costo": 19240 },{ "nombre": "Anzoátegui", "costo": 19240 },{ "nombre": "Armero", "costo": 18340 },{ "nombre": "Ataco", "costo": 18340 },{ "nombre": "Cajamarca", "costo": 18340 },{ "nombre": "Carmen de Apicalá", "costo": 18340 },{ "nombre": "Casabianca", "costo": 19240 },{ "nombre": "Chaparral", "costo": 18340 },{ "nombre": "Coello", "costo": 18340 },{ "nombre": "Coyaima", "costo": 18340 },{ "nombre": "Cunday", "costo": 18340 },{ "nombre": "Dolores", "costo": 18660 },{ "nombre": "Espinal", "costo": 12200 },{ "nombre": "Falan", "costo": 19240 },{ "nombre": "Flandes", "costo": 14500 },{ "nombre": "Fresno", "costo": 18340 },{ "nombre": "Guamo", "costo": 18340 },{ "nombre": "Herveo", "costo": 18340 },{ "nombre": "Honda", "costo": 12200 },{ "nombre": "Ibagué", "costo": 12200 },{ "nombre": "Icononzo", "costo": 19240 },{ "nombre": "Lérida", "costo": 18340 },{ "nombre": "Líbano", "costo": 19240 },{ "nombre": "Mariquita", "costo": 18340 },{ "nombre": "Melgar", "costo": 12200 },{ "nombre": "Murillo", "costo": 19240 },{ "nombre": "Natagaima", "costo": 18340 },{ "nombre": "Ortega", "costo": 18340 },{ "nombre": "Palocabildo", "costo": 19240 },{ "nombre": "Piedras", "costo": 19240 },{ "nombre": "Planadas", "costo": 19240 },{ "nombre": "Prado", "costo": 19240 },{ "nombre": "Purificación", "costo": 19240 },{ "nombre": "Rioblanco", "costo": 19240 },{ "nombre": "Roncesvalles", "costo": 18340 },{ "nombre": "Rovira", "costo": 18340 },{ "nombre": "Saldaña", "costo": 18340 },{ "nombre": "San Antonio", "costo": 18340 },{ "nombre": "San Luis", "costo": 18340 },{ "nombre": "Santa Isabel", "costo": 19240 },{ "nombre": "Suárez", "costo": 18340 },{ "nombre": "Valle de San Juan", "costo": 18340 },{ "nombre": "Venadillo", "costo": 12200 },{ "nombre": "Villahermosa", "costo": 19240 },{ "nombre": "Villarrica", "costo": 18340 } ] },
                    { "departamento": "Valle del Cauca", "ciudades": [ { "nombre": "Alcalá", "costo": 18340 },{ "nombre": "Andalucía", "costo": 18340 },{ "nombre": "Ansermanuevo", "costo": 19240 },{ "nombre": "Argelia", "costo": 19240 },{ "nombre": "Bolívar", "costo": 18340 },{ "nombre": "Buenaventura", "costo": 18340 },{ "nombre": "Buga", "costo": 14500 },{ "nombre": "Bugalagrande", "costo": 18340 },{ "nombre": "Caicedonia", "costo": 18340 },{ "nombre": "Cali", "costo": 14500 },{ "nombre": "Calima", "costo": 18340 },{ "nombre": "Candelaria", "costo": 18340 },{ "nombre": "Cartago", "costo": 14500 },{ "nombre": "Dagua", "costo": 18340 },{ "nombre": "El Águila", "costo": 19240 },{ "nombre": "El Cairo", "costo": 19240 },{ "nombre": "El Cerrito", "costo": 14500 },{ "nombre": "El Dovio", "costo": 18340 },{ "nombre": "Florida", "costo": 14500 },{ "nombre": "Ginebra", "costo": 18340 },{ "nombre": "Guacarí", "costo": 18340 },{ "nombre": "Jamundí", "costo": 18340 },{ "nombre": "La Cumbre", "costo": 18340 },{ "nombre": "La Unión", "costo": 18340 },{ "nombre": "La Victoria", "costo": 18340 },{ "nombre": "Obando", "costo": 19240 },{ "nombre": "Palmira", "costo": 14500 },{ "nombre": "Pradera", "costo": 18340 },{ "nombre": "Restrepo", "costo": 14500 },{ "nombre": "Riofrío", "costo": 18340 },{ "nombre": "Roldanillo", "costo": 18340 },{ "nombre": "San Pedro", "costo": 18340 },{ "nombre": "Sevilla", "costo": 18340 },{ "nombre": "Toro", "costo": 18340 },{ "nombre": "Trujillo", "costo": 18340 },{ "nombre": "Tuluá", "costo": 14500 },{ "nombre": "Ulloa", "costo": 18340 },{ "nombre": "Versalles", "costo": 18340 },{ "nombre": "Vijes", "costo": 18340 },{ "nombre": "Yotoco", "costo": 18340 },{ "nombre": "Yumbo", "costo": 14500 },{ "nombre": "Zarzal", "costo": 18340 } ] },
                    { "departamento": "Vaupés", "ciudades": [ { "nombre": "Carurú", "costo": 54850 },{ "nombre": "Mitú", "costo": 54850 },{ "nombre": "Pacoa", "costo": 54850},{ "nombre": "Papunaua", "costo": 54850 },{ "nombre": "Taraira", "costo": 54850 },{ "nombre": "Yavaraté", "costo": 54850 } ] },
                    { "departamento": "Vichada", "ciudades": [ { "nombre": "Cumaribo", "costo": 54850 },{ "nombre": "La Primavera", "costo": 49690 },{ "nombre": "Puerto Carreño", "costo": 54850 },{ "nombre": "Santa Rosalía", "costo": 49690 } ] }
                ],
                cart: [],
                showOrderSection: false,
                contactInfo: { name: '', phone: '', phoneError: '' },
                
                delivery: { 
                    mode: 'Envío', 
                    address: '',        
                    addressPart1: '',   
                    addressPart2: '',   
                    addressPart3: '',   
                    interior: '',       
                    apartment: '',      
                    department: 'Bogotá D.C.',
                    municipality: '',
                    locality: '',
                    cost: 0, 
                },

                formStatus: 'Confirmar Pedido',
                showConfirmationModal: false,
                showPreConfirmationModal: false,
                selectedNut: null,
                selectedMix: null,
                showImageModal: false,
                modalImageUrl: '',
                showAlert: false,
                alertMessage: '',
                confirmationDetails: { title: '', message: '', summary: '' },
                orderCounter: 1,
                mode: 'builder',
                
                showPackagingModal: false,
                showLabelSelectionModal: false, 
                itemToAdd: null,
                editingCartItemIndex: null,
                editingMode: null, 
                showJarGalleryModal: false,
                galleryJar: null,
                editedKraftGrams: 0,
                packagingStep: 'selection',
                giftJarSelections: [],
                editingLabelFor: { type: null, index: -1 },

                labelCustomization: {
                    showModal: false,
                    showCustomMessageModal: false,
                    selectedLabelId: 'classic',
                    customMessage: '',
                    jar: null,
                    activeImageUrl: '',
                },

                get isAnyModalOpen() {
                    return this.showPackagingModal || this.showLabelSelectionModal || this.showJarGalleryModal || this.labelCustomization.showModal || this.labelCustomization.showCustomMessageModal || this.showImageModal || this.showConfirmationModal || this.showPreConfirmationModal || this.selectedNut || this.selectedMix || this.customization.showModal;
                },

                // <<< NUEVO: AÑADE ESTA FUNCIÓN
                syncStateWithStorage() {
                    // // // console.log('Sincronizando estado con sessionStorage...');
                    this.loadCart();
                    this.orderCounter = parseInt(sessionStorage.getItem('nutMixOrderCounter_v2')) || 1;
                },

                get cartTotalWeight() {
                    return this.cart.reduce((acc, item) => acc + (item.totalGrams * item.quantity), 0);
                },

                get packagingModalTitle() {
                    if (this.editingMode === 'kraft') return 'Editar Bolsa Kraft';
                    if (this.editingMode === 'glass') return 'Editar Envase de Vidrio';
                    
                    switch(this.packagingStep) {
                        case 'selection': return 'FINALIZA LOS DETALLES';
                        case 'jars': return 'ENVASES PARA REGALOS';
                        case 'labels': return 'ELIGE TUS ETIQUETAS';
                        default: return 'FINALIZA LOS DETALLES';
                    }
                },
                get giftPackagingTotalGrams() {
                    if (this.giftJarSelections.length === 0) return 0;
                    return this.giftJarSelections.reduce((acc, selection) => {
                        const jar = this.getJarById(selection.jarId);
                        return acc + (jar.capacity * selection.quantity);
                    }, 0);
                },
                
                get giftPackagingTotalCost() {
                    if (!this.activeItemForModal || this.giftJarSelections.length === 0) return 0;

                    const totalCostOfJars = this.giftJarSelections.reduce((acc, selection) => {
                        const jar = this.getJarById(selection.jarId);
                        return acc + ((jar ? jar.price : 0) * selection.quantity);
                    }, 0);
                    
                    const totalCostOfMix = this.calculateMixCostForWeight(this.giftPackagingTotalGrams);

                    return Math.round(totalCostOfMix + totalCostOfJars);
                },

                get allJarsHaveLabels() {
                    if (this.giftJarSelections.length === 0) return false;
                    return this.giftJarSelections.every(selection => !!selection.labelId);
                },

                get shippingWarningMessage() {
                    if (this.delivery.mode === 'Envío' && this.delivery.department !== 'Bogotá D.C.' && this.cartTotalWeight > 1700) {
                        return 'El precio del envío está calculado para un peso máximo de 1700 gramos. El valor final del envío se ajustará a las nuevas condiciones y será confirmado vía WhatsApp.';
                    }
                    return '';
                },

                get municipalitiesForSelectedDepartment() {
                    if (!this.delivery.department || this.delivery.department === 'Bogotá D.C.') {
                        return [];
                    }
                    const selectedDeptData = this.colombiaData.find(d => d.departamento === this.delivery.department);
                    return selectedDeptData ? selectedDeptData.ciudades.sort((a, b) => a.nombre.localeCompare(b.nombre)) : [];
                },
                
                get activeItemForModal() {
                    return this.itemToAdd;
                },

                get activeItemHasCutOptions() {
                    if (!this.activeItemForModal) return false;
                    return this.activeItemForModal.nuts.some(nut => nut.hasOwnProperty('cutPreference'));
                },
                
                getJarById(jarId) {
                    if (!jarId) return null;
                    return this.jars.find(j => j.id === jarId);
                },
                
                getLabelNameById(labelId) {
                    if (!labelId) return 'Sin etiqueta';
                    if (labelId === 'custom') return 'Personalizada';
                    const label = this.labelOptions.find(l => l.id === labelId);
                    return label ? label.name : 'Clásica';
                },

                openOptionsEditor(index) {
                    this.editingCartItemIndex = index;
                    const originalItem = this.cart[index];
                    this.itemToAdd = JSON.parse(JSON.stringify(originalItem));
                    this.giftJarSelections = []; 
                    
                    if (originalItem.packaging.type === 'default') {
                        this.editingMode = 'kraft';
                        this.packagingStep = 'selection';
                        this.editedKraftGrams = originalItem.totalGrams;
                    } else if (originalItem.packaging.type === 'glass_jar') {
                        this.editingMode = 'glass';
                        this.packagingStep = 'selection'; 
                        this.giftJarSelections.push({
                            jarId: originalItem.packaging.jarId,
                            quantity: originalItem.quantity,
                            labelId: originalItem.packaging.labelId,
                            customMessage: originalItem.packaging.customMessage
                        });
                    }
                    this.showPackagingModal = true;
                },
                
                openJarGallery(jar) {
                    this.galleryJar = jar;
                    this.showJarGalleryModal = true;
                },
                closeJarGallery() {
                    this.showJarGalleryModal = false;
                    setTimeout(() => { this.galleryJar = null; }, 300);
                },

                goToJarSelection() {
                    this.packagingStep = 'jars';
                },

                goToLabelSelection() {
                    if (this.giftJarSelections.length === 0) {
                        this.triggerAlert('Debes seleccionar al menos un envase para continuar.');
                        return;
                    }
                    if (this.editingMode === 'glass') {
                        this.openLabelEditorForSelection();
                    } else {
                        this.packagingStep = 'labels';
                    }
                },
                backToJarSelection() { 
                    if (this.editingMode === 'glass') {
                        this.closeLabelEditor();
                    } else {
                        this.packagingStep = 'jars';
                    }
                },
                backToPackagingSelection() { this.packagingStep = 'selection'; },

                getJarQuantity(jarId) {
                    const selection = this.giftJarSelections.find(s => s.jarId === jarId);
                    return selection ? selection.quantity : 0;
                },
                incrementJar(jar) {
                    let selection = this.giftJarSelections.find(s => s.jarId === jar.id);
                    if (selection) {
                        selection.quantity++;
                    } else {
                        this.giftJarSelections.push({
                            jarId: jar.id,
                            quantity: 1,
                            labelId: null,
                            customMessage: ''
                        });
                    }
                },
                decrementJar(jar) {
                    let selection = this.giftJarSelections.find(s => s.jarId === jar.id);
                    if (selection) {
                        selection.quantity--;
                        if (selection.quantity === 0) {
                            this.giftJarSelections = this.giftJarSelections.filter(s => s.jarId !== jar.id);
                        }
                    }
                },

                openLabelEditorForJar(index) {
                    this.editingLabelFor = { type: 'single', index: index };
                    const jarId = this.giftJarSelections[index].jarId;
                    const jarData = this.getJarById(jarId);
                    this.labelCustomization.jar = jarData;
                    if(jarData) this.labelCustomization.activeImageUrl = jarData.imageUrls[0];
                    this.labelCustomization.selectedLabelId = this.giftJarSelections[index].labelId || 'classic';
                    this.labelCustomization.customMessage = this.giftJarSelections[index].customMessage || '';
                    this.labelCustomization.showModal = true;
                },

                openLabelEditorForAll() {
                    this.editingLabelFor = { type: 'all', index: -1 };
                    this.labelCustomization.jar = null;
                    this.labelCustomization.selectedLabelId = 'classic';
                    this.labelCustomization.customMessage = '';
                    this.labelCustomization.showModal = true;
                },
                
                cancelLabelSelection() {
                    this.labelCustomization.showModal = false;
                },
                
                saveLabelSelection() {
                    const { type, index } = this.editingLabelFor;
                    const labelId = this.labelCustomization.selectedLabelId;

                    if (type === 'single') {
                        this.giftJarSelections[index].labelId = labelId;
                        this.giftJarSelections[index].customMessage = '';
                    } else if (type === 'all') {
                        this.giftJarSelections.forEach(selection => {
                            selection.labelId = labelId;
                            selection.customMessage = '';
                        });
                    }
                    this.labelCustomization.showModal = false;
                },

                openCustomMessageModal() {
                    this.labelCustomization.showCustomMessageModal = true;
                },

                saveCustomMessage() {
                    const { type, index } = this.editingLabelFor;
                    const message = this.labelCustomization.customMessage.trim();
                    if (!message) return;

                    if (type === 'single') {
                        this.giftJarSelections[index].labelId = 'custom';
                        this.giftJarSelections[index].customMessage = message;
                    } else if (type === 'all') {
                         this.giftJarSelections.forEach(selection => {
                            selection.labelId = 'custom';
                            selection.customMessage = message;
                        });
                    }
                    this.labelCustomization.showCustomMessageModal = false;
                    this.labelCustomization.showModal = false;
                },
                
                handlePrimaryAction() {
                    if (this.editingMode === 'kraft') {
                        if (this.editedKraftGrams <= 0) {
                            this.triggerAlert('La cantidad de gramos debe ser mayor a cero.');
                            return;
                        }
                        const originalItem = this.cart[this.editingCartItemIndex];
                        let updatedItem = JSON.parse(JSON.stringify(originalItem));
                        updatedItem.nuts.forEach((nut) => {
                            const editedNut = this.itemToAdd.nuts.find(n => n.name === nut.name);
                            if (editedNut && editedNut.hasOwnProperty('cutPreference')) {
                                nut.cutPreference = editedNut.cutPreference;
                            }
                        });
                        this.applyWeightAdjustment(updatedItem, this.editedKraftGrams);
                        this.cart.splice(this.editingCartItemIndex, 1, updatedItem);
                        this.closeOptionsEditor();
                        this.saveCart(); // <<< NUEVO: Guardar cambios
                    }
                },

                handleKraftSelection() {
    // // // console.log("Paso 2: Se seleccionó 'Bolsa Kraft'.");
    // // // console.log("El item activo para el modal es:", JSON.parse(JSON.stringify(this.activeItemForModal)));
    
    let newItem = this.activeItemForModal;
    newItem.packaging = { type: 'default', jarId: null, price: 0, labelId: null, customMessage: '' };
    newItem.quantity = 1;
    this.applyWeightAdjustment(newItem, newItem.originalGrams);

    // // // console.log("Paso 2.1: El item está listo para ser añadido al carrito:", JSON.parse(JSON.stringify(newItem)));
    
    this.addItemToCart(newItem);
    this.cleanUpAfterAdding();
},

                handleGiftSelection() {
                    if (!this.allJarsHaveLabels) return;
                    
                    this.giftJarSelections.forEach(selection => {
                        const jar = this.getJarById(selection.jarId);
                        let newItem = JSON.parse(JSON.stringify(this.activeItemForModal));
                        newItem.nuts.forEach((nut) => {
                           const editedNut = this.itemToAdd.nuts.find(n => n.name === nut.name);
                           if (editedNut && editedNut.hasOwnProperty('cutPreference')) {
                               nut.cutPreference = editedNut.cutPreference;
                           }
                        });
                        newItem.packaging = {
                            type: 'glass_jar',
                            jarId: selection.jarId,
                            price: jar.price,
                            labelId: selection.labelId,
                            customMessage: selection.customMessage
                        };
                        this.applyWeightAdjustment(newItem, jar.capacity);
                        newItem.quantity = selection.quantity;
                        this.addItemToCart(newItem);
                    });

                    this.cleanUpAfterAdding();
                },
                
                openLabelEditorForSelection() {
                    if (this.giftJarSelections.length === 0) {
                        this.triggerAlert('Debes seleccionar al menos un envase para continuar.');
                        return;
                    }
                    this.showLabelSelectionModal = true;
                },

                closeLabelEditor() {
                    this.showLabelSelectionModal = false;
                },

                confirmAndSaveChanges() {
                    if (!this.allJarsHaveLabels) {
                         this.triggerAlert('Por favor, elige una etiqueta para cada envase seleccionado.');
                        return;
                    }
                    this.cart.splice(this.editingCartItemIndex, 1);
                    
                    this.giftJarSelections.forEach(selection => {
                        if (selection.quantity > 0) {
                            const jar = this.getJarById(selection.jarId);
                            let newItem = JSON.parse(JSON.stringify(this.activeItemForModal));
                            newItem.nuts.forEach((nut) => {
                               const editedNut = this.itemToAdd.nuts.find(n => n.name === nut.name);
                               if (editedNut && editedNut.hasOwnProperty('cutPreference')) {
                                   nut.cutPreference = editedNut.cutPreference;
                               }
                            });
                            newItem.packaging = {
                                type: 'glass_jar',
                                jarId: selection.jarId,
                                price: jar.price,
                                labelId: selection.labelId,
                                customMessage: selection.customMessage
                            };
                            this.applyWeightAdjustment(newItem, jar.capacity);
                            newItem.quantity = selection.quantity;
                            this.addItemToCart(newItem); // addItemToCart ya guarda el carrito
                        }
                    });

                    this.closeLabelEditor();
                    this.cleanUpAfterAdding(); // Esta función llama a addItemToCart que ya guarda
                },

                applyWeightAdjustment(item, newWeight) {
                    if (!item.proportions || item.proportions.length === 0) {
                        const totalOriginalGrams = item.nuts.reduce((acc, nut) => acc + nut.originalGrams, 0);
                        if (totalOriginalGrams > 0) {
                            item.proportions = item.nuts.map(nut => ({
                                name: nut.name,
                                percentage: (nut.originalGrams / totalOriginalGrams) * 100
                            }));
                        } else {
                            return;
                        }
                    }

                    const nutsWithDecimals = item.proportions.map(p => {
                        const idealGrams = newWeight * (p.percentage / 100);
                        return {
                            name: p.name,
                            floorGrams: Math.floor(idealGrams),
                            decimalPart: idealGrams - Math.floor(idealGrams)
                        };
                    });

                    let currentTotalGrams = nutsWithDecimals.reduce((acc, nut) => acc + nut.floorGrams, 0);
                    let remainder = Math.round(newWeight - currentTotalGrams);
                    
                    nutsWithDecimals.sort((a, b) => b.decimalPart - a.decimalPart);

                                        for (let i = 0; i < remainder; i++) {
                        if (nutsWithDecimals[i]) {
                           nutsWithDecimals[i].floorGrams++;
                        }
                    }

                    let newSubtotal = 0;
                    item.nuts.forEach(nut => {
                        const updatedNut = nutsWithDecimals.find(n => n.name === nut.name);
                        if (updatedNut) {
                            nut.grams = updatedNut.floorGrams;
                            const nutData = this.getNutByName(nut.name);
                            if (nutData) newSubtotal += nut.grams * nutData.price;
                        }
                    });

                    item.totalGrams = item.nuts.reduce((acc, nut) => acc + nut.grams, 0);
                    item.originalGrams = newWeight;
                    const discountPercentage = item.totalGrams >= 750 ? 5 : 0;
                    const discountValue = newSubtotal * (discountPercentage / 100);
                    
                    item.discountPercentage = discountPercentage;
                    item.subtotal = Math.round(newSubtotal);
                    item.discount = Math.round(discountValue);
                    item.cost = Math.round(newSubtotal - discountValue);
                },

                cleanUpAfterAdding() {
                    if (this.activeTab === 0) {
                        if(this.activeSubTab < 2) this.changeSubTab(this.activeSubTab);
                    } else if (this.activeTab === 2) {
                        if (this.itemToAdd.originalId) {
                           const mix = this.predefinedMixes.find(m => m.id === this.itemToAdd.originalId);
                           if (mix) mix.gramsToAdd = 0;
                        }
                    }
                    this.closeOptionsEditor();
                    this.$nextTick(() => this.scrollToElement('#cart'));
                },
                
                addItemToCart(newItem) {
 // // // console.log("Paso 3: Ejecutando 'addItemToCart'.");
    // // // console.log("Carrito ANTES de añadir:", JSON.parse(JSON.stringify(this.cart)));
    // // // console.log("Item que se va a añadir:", JSON.parse(JSON.stringify(newItem)));

    // Esta es una copia de la lógica original para encontrar duplicados
    const areNutsIdentical = (nuts1, nuts2) => {
        if (nuts1.length !== nuts2.length) return false;
        const sortedNuts1 = [...nuts1].sort((a, b) => a.name.localeCompare(b.name));
        const sortedNuts2 = [...nuts2].sort((a, b) => a.name.localeCompare(b.name));
        return sortedNuts1.every((nut1, index) => {
            const nut2 = sortedNuts2[index];
            return nut1.name === nut2.name && Math.round(nut1.grams) === Math.round(nut2.grams) && nut1.cutPreference === nut2.cutPreference;
        });
    };

    const existingItemIndex = this.cart.findIndex(cartItem =>
        cartItem.name === newItem.name &&
        cartItem.packaging.type === newItem.packaging.type &&
        cartItem.packaging.jarId === newItem.packaging.jarId &&
        cartItem.packaging.labelId === newItem.packaging.labelId &&
        cartItem.packaging.customMessage === newItem.packaging.customMessage &&
        areNutsIdentical(cartItem.nuts, newItem.nuts)
    );

    if (existingItemIndex > -1) {
        // // // console.log("Se encontró un item idéntico. Aumentando cantidad.");
        this.cart[existingItemIndex].quantity += newItem.quantity;
    } else {
        // // // console.log("No se encontró item idéntico. Añadiendo nuevo item.");
        // --- LA MAGIA ESTÁ AQUÍ ---
        // Generamos un ID único garantizado usando el timestamp + un número aleatorio.
        newItem.id = Date.now() + Math.random(); 
        this.cart.push(newItem);
    }
    
    // // // console.log("Carrito DESPUÉS de añadir:", JSON.parse(JSON.stringify(this.cart)));
    this.saveCart();
},

                closeOptionsEditor() {
                    this.showPackagingModal = false;
                    this.itemToAdd = null;
                    this.editingCartItemIndex = null;
                    this.editingMode = null; 
                    this.packagingStep = 'selection';
                    this.giftJarSelections = [];
                },

                increaseQuantity(index) {
                     this.cart[index].quantity++;
                     this.saveCart(); // <<< NUEVO: Guardar cambios
                },

                decreaseQuantity(index) {
                    if (this.cart[index].quantity > 1) {
                        this.cart[index].quantity--;
                        this.saveCart(); // <<< NUEVO: Guardar cambios
                    }
                },
                
               handleEscape() {
                    if (this.showJarGalleryModal) {
                        this.closeJarGallery();
                    } else if (this.showImageModal) {
                        this.closeImageModal();
                    } else if (this.labelCustomization.showCustomMessageModal) {
                        this.labelCustomization.showCustomMessageModal = false;
                    } else if (this.labelCustomization.showModal) {
                        this.cancelLabelSelection();
                    } else if(this.showPackagingModal) {
                        this.closeOptionsEditor();
                    } else if (this.customization.showModal) {
                        this.closeCustomizationModal();
                    } else if (this.selectedMix) {
                        this.closeMixDetail();
                    } else if (this.selectedNut) {
                        this.backToBuilder();
                    }
                },
                
                customization: {
                    showModal: false,
                    mix: null,
                    totalGrams: 0,
                    nutToAdd: '',
                    get totalPercentage() {
                        if (!this.mix || !this.mix.ingredients) return 0;
                        return this.mix.ingredients.reduce((acc, ing) => acc + (Number(ing.percentage) || 0), 0);
                    },
                    get cost() {
                        if (!this.mix || !this.mix.ingredients || this.totalGrams === 0) return 0;
                        let subtotal = 0;
                        this.mix.ingredients.forEach(ingredient => {
                            const nutData = this.getNutByName(ingredient.name);
                            if(nutData) {
                                const grams = this.totalGrams * ((Number(ingredient.percentage) || 0) / 100);
                                subtotal += grams * nutData.price;
                            }
                        });
                        return Math.round(subtotal);
                    }
                },

                get filteredNuts() {
                    if (!this.mixSearchQuery.trim()) {
                        return this.nuts;
                    }
                    const normalizedQuery = this.normalizeText(this.mixSearchQuery);
                    return this.nuts.filter(nut => 
                        this.normalizeText(nut.name).includes(normalizedQuery)
                    );
                },

                get filteredPredefinedMixes() {
                    if (!this.vitalMixSearchQuery.trim()) {
                        return this.predefinedMixes;
                    }
                    const normalizedQuery = this.normalizeText(this.vitalMixSearchQuery);
                    return this.predefinedMixes.filter(mix => {
                        const inName = this.normalizeText(mix.name).includes(normalizedQuery);
                        const inSubtitle = this.normalizeText(mix.subtitle).includes(normalizedQuery);
                        return inName || inSubtitle;
                    });
                },

                getNutByName(name) {
                    return this.nuts.find(n => n.name === name);
                },

                get availableNutsForCustomization() {
                    if (!this.customization.mix) return this.nuts;
                    const currentIngredients = this.customization.mix.ingredients.map(ing => ing.name);
                    return this.nuts.filter(nut => !currentIngredients.includes(nut.name) && nut.name !== 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Con cáscara)');
                },

                get isCustomizationValid() {
                    return this.customization.totalGrams >= 100 && this.customization.totalPercentage === 100;
                },

                get progressOffset() {
                    const percentage = this.currentMix.totalPercentage;
                    if (percentage > 100) return 0;
                    return this.circumference - (percentage / 100) * this.circumference;
                },

                get percentageTooltipMessage() {
                    const total = this.currentMix.totalPercentage;
                    if (total < 100) {
                        return `Falta un ${100 - total}% para completar`;
                    }
                    if (total > 100) {
                        return `Te has pasado por ${total - 100}%`;
                    }
                    return '¡Mezcla completa! Total es 100%';
                },

                openCustomizationModal(mix) {
                    if (!mix.gramsToAdd || mix.gramsToAdd < 100) return;
                    this.customization.mix = JSON.parse(JSON.stringify({
                        id: mix.id,
                        name: mix.name,
                        ingredients: mix.proportions.map(p => ({name: p.name, percentage: p.percentage}))
                    }));
                    this.customization.totalGrams = mix.gramsToAdd;
                    this.customization.nutToAdd = '';
                    this.customization.showModal = true;
                    this.vitalMixSearchQuery = ''; 
                },

                closeCustomizationModal() {
                    this.customization.showModal = false;
                    this.customization.mix = null;
                },

                addCustomIngredient() {
                    if (this.customization.nutToAdd && !this.customization.mix.ingredients.some(ing => ing.name === this.customization.nutToAdd)) {
                        this.customization.mix.ingredients.push({
                            name: this.customization.nutToAdd,
                            percentage: 0
                        });
                        this.customization.nutToAdd = '';
                    }
                },

                removeCustomIngredient(index) {
                    this.customization.mix.ingredients.splice(index, 1);
                },
                handleAddCustomMix() {
                    if (this.isCustomizationValid) {
                        this.addCustomMixToCart();
                    } else {
                        if (this.customization.totalGrams < 100) {
                            this.triggerAlert('La cantidad total de la mezcla debe ser de al menos 100 gramos.');
                        } else if (this.customization.totalPercentage !== 100) {
                            this.triggerAlert('La suma de los porcentajes de los ingredientes debe ser exactamente 100%.');
                        }
                    }
                },
                addCustomMixToCart() {
                    if (!this.isCustomizationValid) return;
                    
                    const totalGrams = this.customization.totalGrams;
                    let subtotal = 0;
                    const nutsInMix = this.customization.mix.ingredients.map(p => {
                        const nutData = this.nuts.find(n => n.name === p.name);
                        const grams = totalGrams * (p.percentage / 100);
                        subtotal += grams * nutData.price;
                        
                        let nutObject = { name: p.name, grams: grams, originalGrams: grams };
                        if(this.largeFruits.includes(p.name)) {
                            nutObject.cutPreference = 'Entero';
                        }
                        return nutObject;
                    });

                    let discountPercentage = 0;
                    if (totalGrams >= 750) discountPercentage = 5;

                    const discount = subtotal * (discountPercentage / 100);
                    const cost = subtotal - discount;

                    this.itemToAdd = {
                        name: `${this.customization.mix.name} (Personalizado)`,
                        nuts: nutsInMix,
                        totalGrams: totalGrams,
                        originalGrams: totalGrams,
                        cost: Math.round(cost),
                        subtotal: Math.round(subtotal),
                        discount: Math.round(discount),
                        discountPercentage: discountPercentage,
                        quantity: 1,
                        packaging: { type: 'default', jarId: null, price: 0 }
                    };
                    
                    this.editedKraftGrams = this.itemToAdd.totalGrams;

                    const originalMix = this.predefinedMixes.find(pm => pm.id === this.customization.mix.id);
                    if(originalMix) originalMix.gramsToAdd = 0;
                    
                    this.closeCustomizationModal();
                    this.packagingStep = 'selection';
                    this.giftJarSelections = [];
                    this.showPackagingModal = true;
                },

                normalizeText(text) {
                    if (!text) return '';
                    return text
                        .toLowerCase()
                        .normalize('NFD') 
                        .replace(/[\u0300-\u036f]/g, '');
                },
                
                // <<< NUEVO: Funciones para gestionar el carrito en sessionStorage
                saveCart() {
    // // // console.log("Paso 4: Ejecutando 'saveCart'. Guardando en sessionStorage.");
    sessionStorage.setItem('nutMixCart_v2', JSON.stringify(this.cart));
    // // // console.log("----- FIN PROCESO DE AÑADIR -----");
},

                // <<< REEMPLAZA TU loadCart CON ESTA VERSIÓN
loadCart() {
 // // // console.log("Ejecutando 'loadCart' para cargar/refrescar el estado del carrito.");
    const savedCart = sessionStorage.getItem('nutMixCart_v2');
    
    // Vaciamos el array actual sin reemplazarlo para mantener la reactividad
    this.cart.length = 0; 

    if (savedCart) {
        try {
            const parsedCart = JSON.parse(savedCart);
            // // // console.log("Se encontró un carrito guardado en sessionStorage:", parsedCart);

            if (Array.isArray(parsedCart) && parsedCart.length > 0) {
                
                // --- LÓGICA DE AUTOCORRECCIÓN ---
                // Iteramos sobre cada item del carrito guardado.
                parsedCart.forEach(item => {
                    // Si un item no tiene un ID válido (es nulo, undefined, 0, etc.)
                    if (!item.id) {
                        // // // console.warn("Se encontró un item corrupto (sin ID). Asignando uno nuevo.", item);
                        // Le asignamos un ID nuevo, único e infalible.
                        item.id = Date.now() + Math.random();
                    }
                    this.cart.push(item);
                });

                // Después de reparar, guardamos inmediatamente el carrito corregido.
                // Esto asegura que en la próxima carga ya estará limpio.
                this.saveCart(); 
            }
        } catch (e) {
            // // // console.error("Error al parsear el carrito. Se limpiará para evitar problemas.", e);
            // Si el JSON está tan corrupto que ni siquiera se puede leer, lo mejor es empezar de cero.
            sessionStorage.removeItem('nutMixCart_v2');
            this.cart.length = 0;
        }
    } else {
        // // // console.log("No se encontró carrito en sessionStorage. El carrito está vacío.");
    }
},
                clearCart() {
                    this.cart = [];
                    sessionStorage.removeItem('nutMixCart_v2');
                },

                init() {
                    this.resetBuilder();
                    this.orderCounter = parseInt(sessionStorage.getItem('nutMixOrderCounter_v2')) || 1;
                    this.loadCart(); // <<< NUEVO: Cargar carrito al iniciar

                    this.$watch('isAnyModalOpen', (isOpen) => {
                        if (isOpen) {
                            document.body.classList.add('overflow-hidden');
                        } else {
                            document.body.classList.remove('overflow-hidden');
                        }
                    });
  // <<< MODIFICACIÓN: AÑADE ESTOS EVENT LISTENERS
                    // Se ejecuta cuando vuelves a la pestaña
                    window.addEventListener('visibilitychange', () => {
                        if (!document.hidden) {
                            this.syncStateWithStorage();
                        }
                    });

                    // Se ejecuta cuando la ventana del navegador vuelve a tener foco
                    window.addEventListener('focus', () => {
                        this.syncStateWithStorage();
                    });

                    // Importante para el cache de "atrás" y "adelante" del navegador (bfcache)
                    window.addEventListener('pageshow', (event) => {
                        if (event.persisted) {
                            this.syncStateWithStorage();
                        }
                    });
                },
                triggerAlert(message) {
                    this.alertMessage = message;
                    this.showAlert = true;
                    setTimeout(() => {
                        this.showAlert = false;
                    }, 4000);
                },

                openImageModal(imageUrl) {
                    this.modalImageUrl = imageUrl;
                    this.showImageModal = true;
                },
                closeImageModal() {
                    this.showImageModal = false;
                },

                updateFullAddress() {
                    let fullAddress = '';
                    if (this.delivery.addressPart1 && this.delivery.addressPart2 && this.delivery.addressPart3) {
                        fullAddress += `${this.delivery.addressPart1} # ${this.delivery.addressPart2} - ${this.delivery.addressPart3}`;
                    }
                    if (this.delivery.interior) {
                        fullAddress += ` Int. ${this.delivery.interior}`;
                    }
                    if (this.delivery.apartment) {
                        fullAddress += ` Apto. ${this.delivery.apartment}`;
                    }
                    this.delivery.address = fullAddress.trim();
                },
                
                updateDeliveryCost(departmentChanged = false) {
                    if (departmentChanged) {
                        this.delivery.municipality = '';
                        this.delivery.locality = '';
                        this.delivery.cost = 0;
                        return;
                    }

                    if (this.delivery.department === 'Bogotá D.C.') {
                        this.delivery.municipality = '';
                        const locality = this.delivery.locality;
                        if (!locality) {
                            this.delivery.cost = 0;
                            return;
                        }
                        const localityCosts = {
                            'Usaquén': 0, 'Suba': 2500, 'Barrios Unidos': 4000, 
                            'Chapinero': 4000, 'Teusaquillo': 4000
                        };
                        this.delivery.cost = localityCosts[locality] ?? 7000;
                    } else {
                        this.delivery.locality = '';
                        const municipalityName = this.delivery.municipality;
                        if (!municipalityName) {
                            this.delivery.cost = 0;
                            return;
                        }
                        
                        const deptData = this.colombiaData.find(d => d.departamento === this.delivery.department);
                        const cityData = deptData?.ciudades.find(c => c.nombre === municipalityName);
                        
                        this.delivery.cost = cityData ? cityData.costo : 0;
                    }
                },
                
                viewMix(mix) {
                    this.selectedMix = mix;
                    this.vitalMixSearchQuery = ''; 
                },
                closeMixDetail() {
                    this.selectedMix = null;
                },

                validatePhone() {
                    this.contactInfo.phone = this.contactInfo.phone.replace(/[^0-9]/g, '');
                    if (this.contactInfo.phone.length > 0 && this.contactInfo.phone.length !== 10) {
                        this.contactInfo.phoneError = 'El celular debe tener exactamente 10 dígitos.';
                    } else {
                        this.contactInfo.phoneError = '';
                    }
                },

                handleIndividualSelection(changedNut) {
                    if (changedNut.grams > 0) {
                        this.selectedIndividualNutName = changedNut.name;
                    } else {
                        this.selectedIndividualNutName = null;
                    }
                },

                changeSubTab(tabIndex) {
                    this.activeSubTab = tabIndex;
                    this.selectedIndividualNutName = null;
                    this.mixSearchQuery = '';
                    this.nuts.forEach(nut => {
                        nut.grams = 0;
                        nut.percentage = 0;
                    });
                    this.totalGramsForPercentage = 0;
                },
                
                getPriceDisplay(nut) {
                    return `${this.formatCurrency(nut.price)}/gr`;
                },

                get currentMix() {
                    let totalGrams = 0, subtotal = 0, cost = 0, discount = 0, discountPercentage = 0, totalPercentage = 0;
                    let nutsInMix = [];

                    if (this.activeSubTab === 0 || this.activeSubTab === 2) {
                        this.nuts.forEach(nut => {
                            const grams = Number(nut.grams) || 0;
                            if (grams > 0) {
                                totalGrams += grams;
                                subtotal += grams * nut.price;
                                let nutObject = { name: nut.name, grams: grams, originalGrams: grams };
                                if(this.largeFruits.includes(nut.name)) {
                                    nutObject.cutPreference = 'Entero';
                                }
                                nutsInMix.push(nutObject);
                            }
                        });
                    } else {
                        totalGrams = Number(this.totalGramsForPercentage) || 0;
                        totalPercentage = this.nuts.reduce((acc, nut) => acc + (Number(nut.percentage) || 0), 0);
                        this.nuts.forEach(nut => {
                            const grams = totalGrams * ((Number(nut.percentage) || 0) / 100);
                            if (grams > 0) {
                                subtotal += grams * nut.price;
                                let nutObject = { name: nut.name, grams: grams, originalGrams: grams };
                                if(this.largeFruits.includes(nut.name)) {
                                    nutObject.cutPreference = 'Entero';
                                }
                                nutsInMix.push(nutObject);
                            }
                        });
                    }

                    if (totalGrams >= 750) { discountPercentage = 5; discount = subtotal * 0.05; }
                    
                    cost = subtotal - discount;
                    return { totalGrams, originalGrams: totalGrams, subtotal: Math.round(subtotal), discount: Math.round(discount), discountPercentage, cost: Math.round(cost), totalPercentage, nuts: nutsInMix };
                },

                get isActionEnabled() {
                    if (this.activeSubTab === 0) {
                        return this.currentMix.totalGrams > 0;
                    }
                    if (this.activeSubTab === 1) {
                        return this.currentMix.totalPercentage === 100 && this.currentMix.totalGrams > 0;
                    }
                    if (this.activeSubTab === 2) {
                        return this.currentMix.totalGrams > 0 && this.selectedIndividualNutName !== null;
                    }
                    return false;
                },

                scrollToElement(selector) {
                    document.querySelector(selector).scrollIntoView({ behavior: 'smooth' });
                },
                handleAddToCart() {
    // // // console.log("----- INICIO PROCESO DE AÑADIR -----");
    // // // console.log("Paso 1: Click en 'Añadir Compra'.");

    if (this.justAdded) return;
    if (!this.isActionEnabled) {
        // // // console.warn("Acción bloqueada. 'isActionEnabled' es falso.");
        if (this.activeSubTab === 0) {
            this.triggerAlert('Debes añadir gramos a al menos un fruto para crear tu mezcla.');
        } else if (this.activeSubTab === 1) {
            if (this.currentMix.totalGrams <= 0) {
                this.triggerAlert('Debes definir un peso total para tu mezcla antes de añadirla.');
            } else if (this.currentMix.totalPercentage !== 100) {
                this.triggerAlert('La suma de los porcentajes debe ser exactamente 100%.');
            }
        }
        return;
    }
    
    const current = this.currentMix;
    const mixType = this.activeSubTab === 0 ? 'Mezcla por Cantidad' : 'Mezcla por Porcentaje';
    const mixCount = this.cart.filter(item => item.name.startsWith(mixType)).length + 1;

    this.itemToAdd = {
        ...current,
        name: `${mixType} #${mixCount}`,
        quantity: 1,
        packaging: { type: 'default', jarId: null, price: 0 }
    };
    
    // // // console.log("Paso 1.1: Se ha creado el objeto 'itemToAdd'. Abriendo modal de empaque.", this.itemToAdd);
    
    this.editedKraftGrams = this.itemToAdd.totalGrams;
    this.packagingStep = 'selection';
    this.giftJarSelections = [];
    this.showPackagingModal = true;
},

                
                handleIndividualAddToCart(nut) {
                    if (!nut || !nut.grams || nut.grams <= 0) {
                        this.triggerAlert('Debes ingresar una cantidad en gramos para añadir este fruto.');
                        return;
                    }

                    const totalGrams = nut.grams;
                    const subtotal = totalGrams * nut.price;
                    let discountPercentage = totalGrams >= 750 ? 5 : 0;
                    const discount = subtotal * (discountPercentage / 100);
                    const cost = subtotal - discount;
                    const mixType = 'A granel';
                    const mixCount = this.cart.filter(item => item.name.startsWith(mixType)).length + 1;
                    
                    let nutObject = { name: nut.name, grams: totalGrams, originalGrams: totalGrams };

                    if (this.largeFruits.includes(nut.name)) {
                        nutObject.cutPreference = 'Entero';
                    }

                    this.itemToAdd = {
                        name: `${mixType} #${mixCount}`,
                        nuts: [nutObject],
                        totalGrams: totalGrams,
                        originalGrams: totalGrams,
                        cost: Math.round(cost),
                        subtotal: Math.round(subtotal),
                        discount: Math.round(discount),
                        discountPercentage: discountPercentage,
                        quantity: 1,
                        packaging: { type: 'default', jarId: null, price: 0 }
                    };
                    
                    this.editedKraftGrams = this.itemToAdd.totalGrams;
                    nut.grams = 0;
                    this.selectedIndividualNutName = null;
                    this.packagingStep = 'selection';
                    this.giftJarSelections = [];
                    this.showPackagingModal = true;
                },

                handleAddPredefinedMix(mix) {
                    if (!mix.gramsToAdd || mix.gramsToAdd < 100) {
                        this.triggerAlert('Por favor, ingresa una cantidad de al menos 100 gramos para continuar.');
                        return;
                    }
                    
                    const totalGrams = mix.gramsToAdd;
                    let subtotal = 0;
                    const nutsInMix = mix.proportions.map(p => {
                        const nutData = this.nuts.find(n => n.name === p.name);
                        const grams = totalGrams * (p.percentage / 100);
                        subtotal += grams * nutData.price;
                        
                        let nutObject = { name: p.name, grams: grams, originalGrams: grams };
                        if(this.largeFruits.includes(p.name)) {
                            nutObject.cutPreference = 'Entero';
                        }
                        return nutObject;
                    });

                    let discountPercentage = totalGrams >= 750 ? 5 : 0;
                    const discount = subtotal * (discountPercentage / 100);
                    const cost = subtotal - discount;

                    this.itemToAdd = {
                        originalId: mix.id,
                        name: mix.name,
                        nuts: nutsInMix,
                        totalGrams: totalGrams,
                        originalGrams: totalGrams,
                        cost: Math.round(cost),
                        subtotal: Math.round(subtotal),
                        discount: Math.round(discount),
                        discountPercentage: discountPercentage,
                        quantity: 1,
                        packaging: { type: 'default', jarId: null, price: 0 }
                    };

                    this.editedKraftGrams = this.itemToAdd.totalGrams;
                    this.packagingStep = 'selection';
                    this.giftJarSelections = [];
                    this.showPackagingModal = true;
                },
                handleOpenCustomization(mix) {
                    if (!mix.gramsToAdd || mix.gramsToAdd < 100) {
                        this.triggerAlert('Por favor, ingresa una cantidad de al menos 100 gramos para continuar.');
                    } else {
                        this.openCustomizationModal(mix);
                    }
                },
                resetBuilder() {
                    this.nuts = [
                        { name: 'Albaricoque Turco seco (Sin azúcar añadida)', price: 130, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Deshidratados', imageUrl: 'https://i.ibb.co/LD7JnWBT/rev1-albaricoque.jpg', origin: 'Turquía', ingredients: '100% Albaricoque', description: `<strong>• Origen Insuperable:</strong> Proviene de Turquía, el productor número uno y de mayor prestigio del mundo. Este origen es garantía de un albaricoque de calidad superior, carnoso y lleno de sabor.<br><strong>• Dulzura Natural y Toque Ácido:</strong> Famoso por su sabor dulce y meloso, perfectamente equilibrado con un ligero toque ácido que lo hace refrescante y delicioso. Todo su dulzor es 100% natural, sin azúcares añadidos.<br><strong>• Rico en Vitamina A y Hierro:</strong> Es una potencia nutricional, especialmente conocido por su alto contenido de Betacaroteno (que el cuerpo convierte en Vitamina A), esencial para la salud de la piel y la vista, además de ser una buena fuente de hierro.<br><strong>• Textura Tierna y Carnosa:</strong> A diferencia de albaricoques de otros orígenes que pueden ser más secos, el turco se caracteriza por su textura suave, carnosa y muy agradable de morder, ideal como snack o para rehidratar en recetas.`, benefits: `<strong>• Excelente para la Salud Digestiva:</strong> Son muy ricos en fibra, lo que los convierte en un remedio natural y eficaz para aliviar el estreñimiento y promover un tránsito intestinal regular.<br><strong>• Combate la Anemia y da Energía:</strong> Aportan una buena cantidad de hierro y cobre, minerales esenciales para la formación de glóbulos rojos. Además, sus carbohidratos naturales proporcionan una fuente de energía saludable y sostenida.<br><strong>• Protector de la Visión y la Piel:</strong> Son una fuente destacada de Vitamina A (en forma de betacaroteno), un antioxidante clave para mantener una buena salud ocular y proteger la piel del daño celular.<br><strong>• Regulador de la Presión Arterial:</strong> Su alto contenido de potasio ayuda a equilibrar los fluidos en el cuerpo y a relajar los vasos sanguíneos, lo que contribuye a mantener la presión arterial bajo control.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/BHgJdR61/TNUTalbaricoque.jpg" alt="TNUTalbaricoque" border="0" width="295" height="291" /></div></div>` },
			            { name: 'Almendra Americana NPX laminada natural sin cutícula', price: 98, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/LDT0KCNd/rev1-almendra-laminada.jpg', origin: 'Estados Unidos', ingredients: '100% Almendra NPX Laminada sin cutícula', description: `<strong>• Origen Premium:</strong> De los fértiles valles de California, el líder mundial en producción de almendras de alta calidad.<br><strong>• La Mejor Variedad:</strong> Seleccionamos la almendra Nonpareil (NPX), famosa por su sabor dulce superior y textura mantecosa.<br><strong>• Sabor Puro:</strong> Al ser laminada sin piel (cutícula), garantizamos una experiencia de sabor limpia, delicada y sin amargor.<br><strong>• Versatilidad Gourmet:</strong> Su laminado fino es perfecto para repostería, ensaladas o para añadir un toque crujiente y elegante a cualquier creación.`, benefits: `<strong>• Salud Cardiovascular:</strong> Son ricas en grasas monoinsaturadas (grasas "buenas") que ayudan a reducir el colesterol malo (LDL) y a mantener el bueno (HDL). Su contenido de magnesio y vitamina E también favorece la salud del corazón y la presión arterial.<br><strong>• Control del Azúcar en Sangre:</strong> Tienen un bajo índice glucémico y son una excelente fuente de magnesio, un mineral crucial para regular el azúcar en la sangre. Son un snack ideal para personas con diabetes o resistencia a la insulina.<br><strong>• Energía Sostenida y Salud Cerebral:</strong> Aportan proteínas y grasas saludables que proporcionan energía duradera sin causar picos de azúcar. La vitamina E que contienen es un potente antioxidante que protege las células del cerebro del estrés oxidativo.<br><strong>• Fortalecimiento de los Huesos:</strong> Son una buena fuente de calcio, magnesio y fósforo, minerales esenciales para construir y mantener unos huesos fuertes y sanos.<br><strong>• Facilita la Digestión:</strong> Al no tener cutícula (la piel marrón), son más fáciles de digerir para personas con estómagos sensibles, permitiendo absorber sus nutrientes de manera más suave.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><href="https://ibb.co/twKyPZZ8"><img src="https://i.ibb.co/Cp8xsJJh/TNUTalmedralamina.jpg" alt="TNUTalmedralamina" border="0" width="295" height="291"/></div></div>` },
                        { name: 'Almendra Americana NPX natural', price: 87, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/mVj6RVpY/rev1-almendra-natural.jpg', origin: 'Estados Unidos', ingredients: '100% Almendra NPX', description: `<strong>• Origen de Élite:</strong> Cultivada en California, EE. UU., el estándar de oro mundial que garantiza la máxima calidad y consistencia.<br><strong>• La Variedad "Reina":</strong> Seleccionamos la variedad Nonpareil (NPX), famosa por su sabor dulce superior y cero amargor.<br><strong>• Textura Perfecta: </strong> Ofrece una mordida crujiente pero suave, ideal tanto para comer como snack directo como para ingrediente en recetas.<br><strong>• Máximo Nutriente: </strong> Al conservar su piel natural, te beneficias de toda su fibra, antioxidantes y Vitamina E.<br><strong>• Calidad Confiable: </strong> Respaldada por la industria más avanzada del mundo, asegurando un producto seguro y de calibre premium en cada almendra.`, benefits: `<strong>• Potente Protector Cardiovascular: </strong> Ricas en grasas saludables y antioxidantes (concentrados en su piel), que ayudan a reducir el colesterol malo (LDL) y a proteger las arterias.<br><strong>• Salud Digestiva y Efecto Prebiótico: </strong> La piel de la almendra es una excelente fuente de fibra prebiótica, que alimenta a las bacterias buenas del intestino, mejorando la digestión y la salud general del microbioma.<br><strong>• Excelente Regulador del Azúcar: </strong> Su alto contenido de fibra, grasas saludables y magnesio ayuda a ralentizar la absorción de azúcar, evitando picos glucémicos y siendo un snack ideal para el control de peso y la diabetes.<br><strong>• Fortaleza para Huesos y Cerebro: </strong> Son una gran fuente de calcio y magnesio para mantener unos huesos fuertes, y su alta dosis de vitamina E funciona como un potente antioxidante que protege las células cerebrales.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/5WPBZdtf/TNUTalmendranatural.jpg" alt="TNUTalmendranatural" border="0" width="295" height="291"/></div></div>` },
                        { name: 'Arándano deshidratado Americano Ocean Spray (Con azúcar añadida)', price: 59, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Deshidratados', imageUrl: 'https://i.ibb.co/8gqXK5g9/rev1-arandano.jpg', origin: 'Estados Unidos', ingredients: 'Arándano, Azúcar y aceite de girasol', description: `<strong>• Calidad de Marca Líder Mundial:</strong> Respaldado por Ocean Spray, los maestros del arándano. Este nombre es sinónimo de confianza y calidad superior, utilizando los mejores frutos cultivados en Estados Unidos, su tierra natal.<br><strong>• Sabor Icónico y Perfectamente Equilibrado:</strong> El arándano es naturalmente muy ácido; el ligero toque de azúcar añadido es la firma de Ocean Spray para equilibrar esa acidez, creando el delicioso y adictivo sabor agridulce que los ha hecho famosos en todo el mundo.<br><strong>• Concentrado en Bienestar:</strong> A pesar de ser un snack delicioso, sigue siendo una fuente concentrada de proantocianidinas (PACs), los antioxidantes únicos del arándano conocidos por ayudar a mantener la salud del tracto urinario.<br><strong>• Textura Tierna y Color Vibrante:</strong> Posee una textura masticable y jugosa inconfundible y un intenso color rojo que lo convierten en el ingrediente ideal para dar vida, sabor y un toque gourmet a ensaladas, granolas, productos horneados y tus propias mezclas.`, benefits: `<strong>• Salud del Tracto Urinario:</strong> Su beneficio más conocido. Contienen proantocianidinas (PACs), compuestos que ayudan a prevenir que bacterias como la E. coli se adhieran a las paredes del tracto urinario, reduciendo el riesgo de infecciones.<br><strong>• Ricos en Antioxidantes:</strong> Aportan polifenoles y flavonoides que combaten el daño de los radicales libres en el cuerpo, contribuyendo a la salud celular y cardiovascular.<br><strong>• Fuente de Fibra Dietética:</strong> A pesar del proceso, conservan fibra que favorece la digestión y la salud intestinal.<br><strong>• Fuente Rápida de Energía:</strong> El azúcar (tanto natural como añadido) los convierte en una fuente de energía rápida, útil antes de una actividad física, por ejemplo.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/hRLRTwxd/TNUTarandano.jpg" alt="TNUTarandano" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Avellana Turca natural con piel', price: 130, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/Hpd55yQ7/rev1-avellana.jpg', origin: 'Turquía', ingredients: '100% Avellana con piel', description: `<strong>• Origen Insuperable:</strong> Proviene de Turquía, la "Capital Mundial de la Avellana". Este origen  garantiza una calidad y tradición inigualables, ya que son los mayores y más expertos productores del mundo.<br><strong>• Sabor Intenso y Aromático: </strong> Famosa por su perfil de sabor rico, mantecoso y profundo, es la avellana preferida por los chocolateros y pasteleros más prestigiosos de Europa.<br><strong>• Nutrición Completa: </strong> Al conservar su piel natural, obtienes un extra de fibra y antioxidantes, además de un sabor más rústico y completo que el de las avellanas peladas.<br><strong>• El Estándar de Oro: </strong> Mientras otras regiones producen avellanas de gran calidad, la turca es el estándar global por su equilibrio perfecto entre sabor, aceite y textura, convirtiéndola en la más versátil y demanda.`, benefits: `<strong>• Potente Protector del Corazón: </strong> Son muy ricas en grasas monoinsaturadas (saludables) que ayudan a reducir el colesterol malo (LDL). Además, su magnesio y potasio contribuyen a regular la presión arterial.<br><strong>• Poderoso Efecto Antioxidante y Antiinflamatorio: </strong> La piel de la avellana está cargada de antioxidantes (compuestos fenólicos) que combaten el daño celular y reducen la inflamación en el cuerpo, ayudando a prevenir enfermedades crónicas.<br><strong>• Apoyo a la Salud Cerebral y Nerviosa: </strong> Su alto contenido de Vitamina E, manganeso y folato (Vitamina B9) contribuye a mejorar la función cognitiva y a proteger las neuronas del envejecimiento.<br><strong>• Fuente de Energía y Fortalecimiento Óseo: </strong> Aportan grasas saludables y proteínas para una energía duradera, y su alto contenido de manganeso es esencial para la salud y densidad de los huesos.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/5hBnK7Dj/TNUTavellana.jpg" alt="TNUTavellana" border="0" width="295" height="291"/></div></div>` },
                        { name: 'Baya Tibetana de Goji', price: 129, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Deshidratados', imageUrl: 'https://i.ibb.co/Y5MZ0XP/rev1-baya-goji.jpg', origin: 'China', ingredients: '100% Baya de Goji', description: `<strong>• Origen Milenario del Himalaya:</strong> Proviene de las regiones de gran altitud de China (Meseta Tibetana), la cuna de la Medicina Tradicional China. Este origen extremo y puro es clave para su legendaria concentración de nutrientes.<br><strong>• Potencia Antioxidante Superior:</strong> Considerada un tesoro para la longevidad, es excepcionalmente rica en antioxidantes, especialmente en Zeaxantina, un compuesto vital para proteger la salud visual y la retina del daño solar.<br><strong>• Refuerzo Inmunitario y Vitalidad:</strong> Es una de las nueces con mayor contenido de antioxidantes, que protegen las células del cuerpo. Además, está cargada de grasas monoinsaturadas, beneficiosas para la salud del corazón.<br><strong>• Sabor Único y Energizante:</strong> Ofrece un sabor inconfundible, con un balance perfecto entre dulce y un toque ligeramente ácido. Su textura masticable la hace ideal para añadir a yogures, batidos, tés o ensaladas, aportando un impulso de sabor y nutrición que no encontrarás en bayas comunes.`, benefits: `<strong>• Potente Poder Antioxidante y Antienvejecimiento:</strong> Cargadas de antioxidantes únicos (como la zeaxantina) que combaten el daño celular, reducen la inflamación y ayudan a mantener una piel joven y saludable.<br><strong>• Mejora la calidad del descanso nocturno (Sueño):</strong> Es una de las pocas frutas en el mundo que contiene melatonina natural, la hormona del sueño. Además, su magnesio relaja tu sistema nervioso, sus potentes antioxidantes reducen el estrés físico en tu cuerpo, y su capacidad para mejorar el estado de ánimo durante el día te prepara para una noche de descanso profundo y tranquilo.<br><strong>• Fortalecimiento del Sistema Inmune:</strong> Su altísima concentración de Vitamina C y Vitamina A es clave para estimular las defensas del cuerpo, ayudando a prevenir resfriados y otras infecciones.<br><strong>• Protección de la Salud Visual:</strong> Son una de las fuentes más ricas en zeaxantina y luteína, antioxidantes que se acumulan en la retina, protegiendo los ojos de la luz azul y del deterioro asociado a la edad.<br><strong>• Fuente de Energía Natural y Estado de Ánimo:</strong> Aportan un complejo de vitaminas B, fibra y minerales que ayudan a convertir los alimentos en energía de manera eficiente, combatiendo la fatiga y mejorando el estado de ánimo.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/zWQ9LhCt/TNUTvaydegoji.jpg" alt="TNUTvaydegoji" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', price: 67, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Deshidratados', imageUrl: 'https://i.ibb.co/LdwbZYbX/rev1-datiles.jpg', origin: 'Irán', ingredients: '100% Dátil Sayer', description: `<strong>• Origen Persa de Prestigio:</strong> Proviene de Irán, una de las cunas históricas del cultivo de dátiles. Este origen milenario garantiza una calidad y un perfil de sabor auténtico y muy apreciado.<br><strong>• Dulzura Natural a Caramelo:</strong> La variedad Sayer es famosa por su intensa dulzura natural con claras notas a caramelo y toffee, convirtiéndolo en el endulzante saludable perfecto, sin ningún tipo de azúcar añadido.<br><strong>• Textura Suave y Masticable:</strong> Ofrece una textura semi-seca, firme pero tierna y muy agradable de masticar, que no es tan pegajosa como la de otras variedades (como el Medjool), haciéndola ideal para picar o añadir a recetas.<br><strong>• Máxima Conveniencia y Energía:</strong> Al venir sin semilla, está listo para consumir o usar en batidos, postres y barras energéticas. Es una fuente increíble de energía de liberación rápida y fibra, ideal para deportistas o para calmar un antojo de forma saludable.`, benefits: `<strong>• Fuente de Energía Natural e Inmediata:</strong> Gracias a sus azúcares naturales (glucosa y fructosa), son un snack perfecto para combatir la fatiga y obtener un impulso de energía rápido y saludable, ideal para antes de hacer ejercicio.<br><strong>• Excelente para la Salud Digestiva:</strong> Son muy ricos en fibra dietética, lo que ayuda a prevenir el estreñimiento, promueve la regularidad intestinal y alimenta a las bacterias buenas del intestino.<br><strong>• Rico en Minerales para Huesos y Corazón:</strong> Aportan minerales esenciales como el potasio, que ayuda a regular la presión arterial, y el magnesio y fósforo, que son vitales para mantener la salud y fortaleza de los huesos.<br><strong>• Alternativa Saludable al Azúcar Refinado:</strong> Su dulzor natural y su perfil nutricional los convierten en el sustituto perfecto del azúcar en recetas, postres y batidos, añadiendo nutrientes en lugar de calorías vacías.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/dw8N63wV/TNUTdatiles.jpg" alt="TNUTdatiles" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Higo Turco seco (Sin azúcar añadida)', price: 100, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Deshidratados', imageUrl: 'https://i.ibb.co/35C2wxTZ/rev1-higos-turcos.jpg', origin: 'Turquía', ingredients: '100% Higo Turco', description: `<strong>• Origen de Élite Mundial:</strong> Proviene de Turquía, la cuna de los higos secos de mayor calidad y prestigio. Este origen es sinónimo de un producto grande, tierno y de sabor superior.<br><strong>• Dulzura Natural a Miel:</strong> Famoso por su intenso dulzor natural con notas claras a miel y caramelo, todo sin una gota de azúcar añadido. Es el postre de la naturaleza.<br><strong>• Textura Excepcional:</strong> Su piel es delgada y su interior extremadamente carnoso y tierno, con el característico y agradable crujido de sus pequeñas semillas. Una experiencia de consumo lujosa y satisfactoria.<br><strong>• Potencia en Fibra y Calcio:</strong> Es una de las mejores fuentes vegetales de fibra, ideal para la salud digestiva, y aporta una cantidad significativa de Calcio, esencial para la salud de los huesos.`, benefits: `<strong>• Excelente para la Salud Digestiva:</strong> Son muy ricos en fibra, lo que los convierte en un laxante natural eficaz para combatir el estreñimiento y promover la regularidad intestinal.<br><strong>• Fortalecimiento de los Huesos:</strong> Aportan una buena cantidad de calcio, potasio y magnesio, minerales esenciales para mantener una buena densidad ósea y prevenir enfermedades como la osteoporosis.<br><strong>• Control del Azúcar en Sangre:</strong> A pesar de su dulzura, su alto contenido de fibra ayuda a ralentizar la absorción de azúcar, lo que puede contribuir a mejorar los niveles de glucosa en sangre.<br><strong>• Salud Cardiovascular:</strong> Su fibra ayuda a reducir los niveles de colesterol, mientras que el potasio contribuye a mantener una presión arterial saludable, protegiendo así el corazón.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/kTdp7LW/TNUThigoturco.jpg" alt="TNUThigoturco" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Macadamia Nicaragüense natural', price: 158, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/SXyGg7X2/rev1-macadamia.jpg', origin: 'Nicaragua', ingredients: '100% Macadamia', description: `<strong>• Origen Volcánico Exótico:</strong> Cultivada en las fértiles tierras volcánicas de Nicaragua, un origen único que le confiere un perfil de sabor distintivo y una calidad excepcional.<br><strong>• Cremosidad Inigualable: </strong> Reconocida por su textura excepcionalmente cremosa y mantecosa que se deshace en la boca, una característica muy apreciada y buscada por los conocedores.<br><strong>• Sabor Rico y Sutil: </strong> Ofrece un sabor delicado, ligeramente dulce y con notas a nuez, sin el perfil a veces demasiado tostado de otras procedencias, lo que la hace perfecta tanto para snacks de lujo como para repostería fina.<br><strong>• Joya Centroamericana:</strong> La macadamia de Nicaragua es una joya emergente y de producción más limitada, ofreciendo una experiencia gourmet, sostenible y diferenciadora.`, benefits: `<strong>• Salud Cardiovascular Superior: </strong> Son excepcionalmente ricas en grasas monoinsaturadas (las "buenas"), como el ácido palmitoleico, ayudando a reducir drásticamente el colesterol malo (LDL) y a mantener las arterias flexibles y saludables.<br><strong>• Soporte para el Cerebro y Sistema Nervioso: </strong> Su perfil único de grasas y antioxidantes (como los tocotrienoles, una forma de Vitamina E) nutre las células cerebrales, protege contra el estrés oxidativo y apoya la función nerviosa.<br><strong>• Control del Apetito y Energía Limpia: </strong> Su alta concentración de grasas saludables y fibra genera una gran sensación de saciedad, ayudando a controlar el apetito y los antojos. Aportan energía densa y limpia, ideal para dietas bajas en carbohidratos.<br><strong>• Propiedades Antiinflamatorias: </strong> Contienen flavonoides y otros antioxidantes que ayudan a reducir la inflamación crónica en el cuerpo, un factor de riesgo para muchas enfermedades.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/d4PmnpLq/TNUTmacadamia.jpg" alt="TNUTmacadamia" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Maní Brasileño tostado ligeramente salado bola entera y mitades (Bajo en sodio)', price: 30, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/k2jhsHNk/rev1-mani-con-sal.jpg', origin: 'Brasil, Tostado: Colombia', ingredients: 'Maní tostado y sal en bajas cantidades', description: `<strong>• Origen de Prestigio:</strong> Proviene de Brasil, uno de los productores líderes en el mundo, reconocido por sus condiciones de cultivo ideales que resultan en un maní de alta calidad y gran sabor.<br><strong>• Sabor Intenso y Auténtico: </strong> El maní brasileño es famoso por su perfil de sabor más profundo y un dulzor natural más pronunciado, que se intensifica a la perfección con el proceso de tostado.<br><strong>• Calibre Superior: </strong> Seleccionamos granos de "bola entera" de gran tamaño, garantizando una mordida más crujiente y una experiencia de snack mucho más satisfactoria que la de manís más pequeños o partidos.<br><strong>• Toque de Sabor Perfecto:</strong> Tostado a la perfección y ligeramente salado (bajo en sodio) para realzar su sabor natural sin excesos, convirtiéndolo en el snack saludable y delicioso por excelencia.`, benefits: `<strong>• Fuente de Energía y Proteína Vegetal:</strong> Es un snack ideal para recargar energías de forma sostenida gracias a su combinación de grasas saludables y proteínas, que también ayudan a la reparación muscular.<br><strong>• Corazón Protegido y Saludable: </strong> Rico en grasas monoinsaturadas y niacina (Vitamina B3), ayuda a reducir el colesterol malo (LDL). Al ser bajo en sodio, apoya la salud cardiovascular sin el riesgo de la presión alta asociada a los snacks muy salados.<br><strong>• Soporte para el Cerebro y el Ánimo: </strong> Es una buena fuente de folato y biotina, vitaminas del complejo B que son importantes para la función cerebral y pueden contribuir a un estado de ánimo estable.<br><strong>• Control de Azúcar y Saciedad: </strong> La mezcla de fibra, proteína y grasas ayuda a regular los niveles de azúcar en la sangre y a mantenerte satisfecho por más tiempo, controlando los antojos.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/x8qYrQcG/TNUTmaniconsal.jpg" alt="TNUTmaniconsal" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Maní Brasileño tostado sin sal bola entera y mitades', price: 30, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/yr8DQgh/rev1-mani-sin-sal.jpg', origin: 'Brasil, Tostado: Colombia', ingredients: 'Maní tostado', description: `<strong>• Origen de Calidad Superior:</strong> Cultivado en Brasil, un origen reconocido mundialmente por producir maní de excelente calidad gracias a sus condiciones climáticas óptimas.<br><strong>• Sabor 100% Puro y Natural:</strong> Al ser tostado sin sal, puedes apreciar el auténtico sabor del grano: un perfil profundo, con un dulzor natural característico de la variedad brasileña, ideal para puristas del sabor.<br><strong>• Textura "Crunch" Insuperable: </strong> Seleccionamos exclusivamente maní de "bola entera" de gran calibre, lo que garantiza una textura extra crujiente y una experiencia de snack mucho más robusta y placentera.<br><strong>• Máxima Versatilidad Saludable:</strong> Perfecto para quienes siguen dietas bajas en sodio o simplemente prefieren un sabor sin aditivos. Es el ingrediente ideal para crear tus propias mezclas, mantequillas de maní caseras o para añadir a recetas dulces y saladas.`, benefits: `<strong>• Fuente Pura de Energía y Proteína Vegetal:</strong> Aporta una excelente combinación de grasas saludables y proteína para una energía duradera y una óptima recuperación muscular, sin aditivos.<br><strong>• Máxima Protección Cardiovascular (Sin Sodio): </strong> Al no tener sal, es la opción ideal para la salud del corazón. Sus grasas monoinsaturadas ayudan a reducir el colesterol malo (LDL) y a mantener una presión arterial saludable.<br><strong>• Control de Azúcar y Saciedad Natural: </strong> El poderoso trío de fibra, proteína y grasas saludables promueve una gran sensación de saciedad y ayuda a mantener estables los niveles de azúcar en la sangre, siendo un aliado en el control de peso.<br><strong>• Soporte para el Cerebro y Estado de Ánimo: </strong> Es una buena fuente de vitaminas del complejo B como el folato y la biotina, que son esenciales para la función cognitiva y el mantenimiento de un sistema nervioso.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/60Yrb2Vs/TNUTmanisinsal.jpg" alt="TNUTmanisinsal" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Marañón Brasileño entero tostado W1 320 sin sal', price: 118, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos',imageUrl: 'https://i.ibb.co/3tFQZXC/rev1-mara-on.jpg', origin: 'Brasil', ingredients: '99% Marañon y 1% aceite de algodón', description: `<strong>• Origen de Élite:</strong> Proviene de Brasil, uno de los productores más importantes y prestigiosos del mundo, reconocido por sus marañones de calidad superior y sabor excepcional.<br><strong>• Calibre Premium (W1 320):</strong> Seleccionamos el calibre W1 320, un estándar internacional que garantiza un marañón entero, de color claro ("White") y de gran tamaño (imadamente 320 nueces por libra). Esto asegura una calidad visual y una textura consistente que no se encuentra en calibres inferiores o partidos.<br><strong>• Textura y Sabor Inigualables: </strong> Famoso por su textura cremosa y mantecosa que se deshace en la boca, y un sabor naturalmente dulce y delicado, perfecto al ser tostado sin sal para apreciar todas sus notas.<br><strong>• Pureza y Versatilidad:</strong> Al ser entero y sin sal, es el ingrediente gourmet ideal para snacks de lujo, cocina vegana (para hacer quesos o cremas), repostería fina o como el protagonista de cualquier mezcla prémium.`, benefits: `<strong>• Salud Cardiovascular Óptima:</strong> Rico en grasas monoinsaturadas (las "buenas"), ayuda a reducir el colesterol malo (LDL) y, al no tener sal, es ideal para mantener una presión arterial saludable.<br><strong>• Fortalecimiento de Huesos y Nervios: </strong> Es una excelente fuente de magnesio y cobre, minerales esenciales para la densidad ósea, la producción de energía y el funcionamiento saludable del sistema nervioso.<br><strong>• Soporte Cerebral y Cognitivo:</strong> El cobre y las grasas saludables que contiene son vitales para la producción de neurotransmisores y la protección de las células cerebrales, apoyando la memoria y la concentración.<br><strong>• Prevención y Control de la Diabetes: </strong> Gracias a su bajo índice glucémico y su contenido de fibra y grasas saludables, ayuda a regular los niveles de azúcar en la sangre, siendo un snack seguro y beneficioso.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/zpd61RM/TNUTmara-on.jpg" alt="TNUTmara-on" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Nuez del Brasil natural partida', price: 88, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos',imageUrl: 'https://i.ibb.co/6JcjSzSD/rev1-nuez-brasil.jpg', origin: 'Brasil', ingredients: '100% Nuez del Brasil', description: `<strong>• Origen Auténtico del Amazonas:</strong> Proviene de Brasil, su lugar de origen en el corazón de la selva amazónica. Este entorno salvaje y natural le confiere una riqueza nutricional inigualable.<br><strong>• La Mayor Fuente Natural de Selenio:</strong> Es el superalimento por excelencia. Con solo una o dos nueces al día puedes cubrir tus necesidades diarias de selenio, un mineral esencial con un potentísimo efecto antioxidante y clave para el sistema inmune.<br><strong>• Sabor Único y Textura Mantecosa: </strong> Ofrece un perfil de sabor suave, terroso y ligeramente dulce, con una textura crujiente pero mantecosa que la distingue de otras nueces.<br><strong>• Versatilidad Práctica:</strong> Al venir partida, es perfecta para añadir directamente a granolas, batidos, ensaladas o para crear tus propias mezclas energéticas, haciendo más fácil disfrutar de sus increíbles beneficios.`, benefits: `<strong>• Superdosis de Selenio para la Tiroides y Defensas:</strong> Es la fuente natural más potente de selenio, un mineral clave para la función de la tiroides, fortalecer el sistema inmune y proteger las células del daño oxidativo con solo una o dos nueces al día.<br><strong>• Salud Cardiovascular y Control del Colesterol: </strong> Gracias a su perfil de grasas saludables (monoinsaturadas y poliinsaturadas), ayuda a reducir el colesterol malo (LDL) y a mantener la salud del corazón y las arterias.<br><strong>• Potente Efecto Antiinflamatorio y Cerebral:</strong> Su alto contenido de antioxidantes como el selenio, la vitamina E y el ácido elágico ayuda a reducir la inflamación en el cuerpo y a proteger las neuronas del envejecimiento prematuro.<br><strong>• Fuente de Energía Completa: </strong> Aporta una mezcla densa de grasas saludables, proteínas y fibra, ofreciendo energía sostenida y una gran sensación de saciedad.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/nNmkVvth/TNUTnuezbrasil.jpg" alt="TNUTnuezbrasil" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Nuez del Nogal Americana natural', price: 115, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos',imageUrl: 'https://i.ibb.co/21171phD/rev1-nuez-nogal.jpg', origin: 'Estados Unidos', ingredients: '100% Nuez del Nogal', description: `<strong>• Origen de Calidad Superior:</strong> Proviene de Estados Unidos (California), líder mundial en producción, donde estrictos controles de calidad garantizan una nuez de calibre grande, color claro y frescura excepcional.<br><strong>• Potencia en Omega-3:</strong> Es reconocida como una de las mejores fuentes vegetales de Omega-3 (ALA), un ácido graso esencial fundamental para la salud del cerebro, el corazón y con potentes propiedades antiinflamatorias.<br><strong>• Sabor Robusto y Equilibrado:</strong> La variedad americana es apreciada por su sabor rico y robusto, con el característico toque amargo perfectamente equilibrado, ideal para repostería, ensaladas o como un snack que sacia.<br><strong>• Textura "Carnosa" y Crujiente:</strong> Ofrece una textura única, más "carnosa" y menos seca que otras variedades, lo que la hace especialmente placentera al morder y muy versátil en la cocina.`, benefits: `<strong>• Salud Cerebral Superior:</strong> Es el fruto seco rey en Omega-3 (ALA), un ácido graso esencial que nutre el cerebro, mejora la memoria, la concentración y protege contra el deterioro cognitivo.<br><strong>• Potente Acción Antioxidante y Antiinflamatoria:</strong> Contiene una combinación única y muy potente de antioxidantes (polifenoles y Vitamina E) que combatan el daño celular y reducen la inflamación crónica, ayudando a prevenir enfermedades.<br><strong>• Corazón Fuerte y Protegido:</strong> Su alto contenido de Omega-3, fibra y otros compuestos bioactivos ayuda a reducir el colesterol malo (LDL), disminuir la presión arterial y mejorar la salud de los vasos sanguíneos.<br><strong>• Mejora de la Salud Intestinal:</strong> Actúa como un prebiótico, alimentando a las bacterias beneficiosas del intestino. Un microbioma sano está vinculado a una mejor digestión, un sistema inmune más fuerte y un mejor estado de ánimo.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/ccqNNpvc/TNUTnueznogal.jpg" alt="TNUTnueznogal" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Nuez Pecan Americana natural', price: 175, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/yc0LGr5Z/rev1-nuez-pecan.jpg', origin: 'Estados Unidos', ingredients: '100% Nuez Pecan', description: `<strong>• Origen Auténtico y Superior:</strong> Proviene de Estados Unidos, la cuna de la Nuez Pecan. Este origen garantiza una calidad insuperable y el perfil de sabor clásico y más demandado a nivel mundial.<br><strong>• Dulzura Natural y Textura Mantecosa:</strong> Famosa por su sabor naturalmente dulce, con notas acarameladas y de mantequilla, mucho más suave y menos amarga que la nuez de nogal.<br><strong>• Rica en Antioxidantes y Grasas Saludables: </strong>  Es una de las nueces con mayor contenido de antioxidantes, que protegen las células del cuerpo. Además, está cargada de grasas monoinsaturadas, beneficiosas para la salud del corazón.<br><strong>• La Reina de la Repostería:</strong> Su sabor dulce y su textura tierna pero crujiente la convierten en la nuez preferida por chefs y pasteleros para tartas ("pecan pie"), brownies, galletas y postres gourmet.`, benefits: `<strong>• Salud del Corazón y Colesterol:</strong> Baja el colesterol malo (LDL) gracias a su alto contenido de grasas saludables, Evita que el colesterol se 'oxide' y se pegue a las arterias, gracias a que es una de las nueces más ricas en antioxidantes. Mejora la flexibilidad de los vasos sanguíneos, ayudando a una presión arterial saludable y Reduce la inflamación en el cuerpo, protegiendo todo tu sistema cardiovascular.<br><strong>• Soporte para la Salud Cerebral y Nerviosa:</strong> Las grasas saludables y minerales como el manganeso y el cobre son esenciales para una buena función cognitiva y la salud del sistema nervioso.<br><strong>• Rico en Antioxidantes y Antienvejecimiento:</strong> Es uno de los frutos secos con mayor capacidad antioxidante, gracias a su alto contenido de flavonoides y Vitamina E, que combatan el daño celular y el envejecimiento prematuro.<br><strong>• Ayuda en el Control del Azúcar y Metabolismo:</strong> Su combinación de fibra y grasas saludables ayuda a regular los niveles de azúcar en la sangre, proporcionando energía estable y una mayor sensación de saciedad.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/XfVKSn1B/TNUTnuezpecan.jpg" alt="TNUTnuezpecan" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Con cáscara)', price: 130, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/nN9Rsx8r/rev1-pistacho.jpg', origin: 'Estados Unidos', ingredients: 'Pistacho y sal en bajas cantidades', description: `<strong>• Origen de Prestigio Mundial:</strong> Cultivado en California, Estados Unidos, reconocido globalmente por producir pistachos de calibre grande, apertura natural y un color verde vibrante, superando a menudo en tamaño a variedades de otras regiones.<br><strong>• Sabor Dulce y Menos Terroso:</strong> El pistacho californiano es famoso por su perfil de sabor limpio, naturalmente dulce y mantecoso, en contraste con el sabor a veces más intenso y terroso de los pistachos de Oriente Medio.<br><strong>• Tostado Perfecto y Sabor Realzado:</strong> Tostado a la perfección para maximizar su "crunch" y ligeramente salado (bajo en sodio), un toque justo que realza su dulzura natural sin opacarla, ideal para un snack saludable.<br><strong>• El Ritual de la Cáscara:</strong> Al venir con cáscara, no solo se conserva mejor su frescura, sino que promueve un consumo más consciente y pausado, convirtiendo el acto de comerlos en un placentero ritual.`, benefits: `<strong>• Proteína Completa y Energía Sostenida:</strong> Es una de las pocas fuentes vegetales de proteína completa (con todos los aminoácidos esenciales), ideal para la recuperación muscular y para mantener la energía estable.<br><strong>• Salud Cardiovascular Inteligente:</strong> Rico en grasas saludables y potasio para reducir el colesterol y regular la presión. Al ser bajo en sodio, ofrece el sabor sin el riesgo para la presión arterial asociado a los snacks muy salados.<br><strong>• Control de Peso y Porciones Conscientes:</strong> El acto de abrir la cáscara ralentiza el consumo (comer "mindful"), lo que promovemos la saciedad y ayuda a controlar las porciones de forma natural, apoyando el manejo del peso.<br><strong>• Rico en Antioxidantes para Ojos y Células:</strong> Su color verde y morado proviene de la luteína y la zeaxantina, antioxidantes que protegen la salud ocular. Además, combate el daño celular en todo el cuerpo.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/jk5wJdgk/TNUTpistachoconcascara.jpg" alt="TNUTpistachoconcascara" border="0" width="295" height="291"/></div></div>` },
                        { name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', price: 270, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/pjgNrvgX/rev1-pistacho-sin-cascara.jpg', origin: 'Estados Unidos', ingredients: 'Pistacho y sal en bajas cantidades', description: `<strong>• Origen de Prestigio Mundial:</strong> Cultivado en California, Estados Unidos, reconocido globalmente por producir pistachos de calibre grande, apertura natural y un color verde vibrante, superando a menudo en tamaño a variedades de otras regiones.<br><strong>• Sabor Dulce y Menos Terroso:</strong> El pistacho californiano es famoso por su perfil de sabor limpio, naturalmente dulce y mantecoso, en contraste con el sabor a veces más intenso y terroso de los pistachos de Oriente Medio.<br><strong>• Máxima Comodidad, Listo para Usar:</strong> Al venir sin cáscara, está listo para disfrutar al instante como un snack de lujo o para añadir directamente a ensaladas, postres, pestos o cualquier receta gourmet, ahorrándote tiempo y esfuerzo.<br><strong>• Ideal para Mezclas Premium:</strong> Su conveniencia y calidad lo convierten en el ingrediente perfecto para elevar cualquier mezcla de frutos secos, aportando color, un sabor inconfundible y una textura crujiente.`, benefits: `<strong>• Proteína Completa y Energía Sostenida:</strong> Es una de las pocas fuentes vegetales de proteína completa (con todos los aminoácidos esenciales), ideal para la recuperación muscular y para mantener la energía estable.<br><strong>• Salud Cardiovascular Inteligente:</strong> Rico en grasas saludables y potasio para reducir el colesterol y regular la presión. Al ser bajo en sodio, ofrece el sabor sin el riesgo para la presión arterial asociado a los snacks muy salados.<br><strong>• Rico en Antioxidantes para la Salud Visual y Celular:</strong> Su característico color verde y morado proviene de la luteína y zeaxantina, antioxidantes que se consumen directamente para proteger la salud de tus ojos y combatir el daño celular general.<br><strong>• Versatilidad y Nutrición Instantánea:</strong> Son el formato ideal para enriquecer instantáneamente ensaladas, yogures, pastas o batidos, facilitando la incorporación de fibra, vitaminas y minerales a tu dieta diaria.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/jk5wJdgk/TNUTpistachoconcascara.jpg" alt="TNUTpistachoconcascara" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Uva pasa Mexicana flame mediana (Sin azúcar añadida)', price: 33, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Deshidratados', imageUrl: 'https://i.ibb.co/kV0PGxt3/rev1-uva-pasa.jpg', origin: 'México', ingredients: 'Uvas y aceite vegetal', description: `<strong>• Origen Soleado y de Calidad:</strong> Cultivada bajo el intenso sol de México, un origen reconocido por producir uvas de gran calidad que resultan en pasas dulces, carnosas y de color intenso.<br><strong>• Variedad Flame Superior:</strong> Proviene de la uva de mesa "Flame Seedless", una variedad premium famosa por su gran tamaño, su textura suave y su dulzura equilibrada, a diferencia de otras pasas más pequeñas o secas.<br><strong>• Dulzura 100% Natural:</strong> Todo su delicioso sabor es completamente natural, sin azúcares añadidos. Es el toque perfecto para endulzar de forma saludable tus cereales, yogures, ensaladas y postres.<br><strong>• Fuente de Energía Rápida y Hierro:</strong> Es un snack ideal para un impulso de energía natural e inmediata, además de ser una buena fuente vegetal de hierro y potasio, nutrientes importantes para el día a día.`, benefits: `<strong>• Fuente de Energía Rápida y Natural:</strong> Sus azúcares naturales (fructosa y glucosa) proporcionan un impulso de energía inmediato, siendo un snack ideal para antes de la actividad física o para combatir la fatiga.<br><strong>• Ayuda a la Salud Digestiva: </strong> Son ricas en fibra dietética, lo que favorece un buen tránsito intestinal, ayuda a prevenir el estreñimiento y contribuye a una sensación de saciedad.<br><strong>• Combate la Anemia:</strong> Aportan una buena cantidad de hierro, un mineral esencial para la formación de glóbulos rojos y el transporte de oxígeno en la sangre.<br><strong>• Fortalecimiento Óseo:</strong> Contienen boro, un mineral que es importante para la absorción del calcio y el magnesio, contribuyendo así a la salud y densidad de los huesos.<br><strong>• Ricas en Antioxidantes: </strong> A pesar de su tamaño, concentran antioxidantes como los fenoles y polifenoles, que ayudan a proteger las células del cuerpo del daño causado por los radicales libres.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/KCvjz1b/TNUTUVAS.jpg" alt="TNUTUVAS" border="0" width="295" height="291" /></div></div>` }
                    ];
                    this.predefinedMixes = [
    { id: 1, name: 'Mix Corazón Fuerte', subtitle: 'Salud Cardiovascular', description1: 'Es una potencia para la salud de tu corazón.',description2:'La Nuez del Nogal  aporta Omega-3, que ayuda a reducir el colesterol "malo" (LDL). La Almendra y Macadamia son ricas en grasas monoinsaturadas saludables, que protegen las arterias. Finalmente, el Marañón es una de las mejores fuentes naturales de Magnesio. El magnesio es un mineral crucial para la salud del corazón porque ayuda a relajar las paredes de los vasos sanguíneos y las arterias, lo que mejora el flujo sanguíneo y ayuda a reducir la presión arterial.', ingredients: ['40% Nuez del Nogal Americana natural', '30% Almendra Americana NPX natural', '15% Macadamia Nicaragüense natural', '15% Marañón Brasileño entero tostado W1 320 sin sal'], proportions: [{ name: 'Nuez del Nogal Americana natural', percentage: 40 }, { name: 'Almendra Americana NPX natural', percentage: 30 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 15 }, { name: 'Macadamia Nicaragüense natural', percentage: 15 }], gramsToAdd: 0 },
    { id: 2, name: 'Mix Escudo', subtitle: 'Antioxidante', description1: 'Combate el daño de los radicales libres que aceleran el envejecimiento.',description2: 'La Baya de Goji es de las fuentes mas ricas de antioxidantes del planeta, rica en Zeaxantina y polisacáridos (LBP) que combaten el estrés oxidativo. La Nuez del Nogal y la Nuez Pecan lideran el ranking de frutos secos con mayor capacidad antioxidante. La piel de la Avellana contiene una alta concentración de estos compuestos protectores.', ingredients: ['30% Nuez del Nogal Americana natural', '30% Baya Tibetana de Goji', '25% Nuez Pecan Americana natural', '15% Avellana Turca natural con piel'], proportions: [{ name: 'Nuez del Nogal Americana natural', percentage: 30 }, { name: 'Baya Tibetana de Goji', percentage: 30 }, { name: 'Nuez Pecan Americana natural', percentage: 25 }, { name: 'Avellana Turca natural con piel', percentage: 15 }], gramsToAdd: 0 },
    { id: 3, name: 'Mix Digestión Activa', subtitle: 'Alto en Fibra', description1: 'Un aliado natural para tu sistema digestivo.',description2: 'El Higo Turco y el Dátil son excepcionalmente ricos en fibra soluble e insoluble, que promueve la regularidad intestinal. El Albaricoque también aporta una dosis significativa de fibra, mientras que la Almendra añade un crujido satisfactorio y fibra adicional para una digestión óptima.', ingredients: ['30% Higo Turco seco (Sin azúcar añadida)', '30% Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', '25% Almendra Americana NPX natural', '15% Albaricoque Turco seco (Sin azúcar añadida)'], proportions: [{ name: 'Higo Turco seco (Sin azúcar añadida)', percentage: 30 }, { name: 'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', percentage: 30 }, { name: 'Almendra Americana NPX natural', percentage: 25 }, { name: 'Albaricoque Turco seco (Sin azúcar añadida)', percentage: 15 }], gramsToAdd: 0 },
    { id: 4, name: 'Mix Multinutrientes', subtitle: 'Vitaminas y Minerales', description1: 'Una verdadera bomba de micronutrientes esenciales.',description2: 'Con solo una o dos Nueces del Brasil se obtiene la dosis diaria de Selenio. La Baya de Goji aporta Vitamina A y C. El Pistacho ofrece Vitamina B6 y potasio. El Marañón es rico en cobre y zinc, y la Almendra en Vitamina E y magnesio.', ingredients: ['35% Almendra Americana NPX natural', '25% Marañón Brasileño entero tostado W1 320 sin sal', '20% Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', '15% Baya Tibetana de Goji', '5% Nuez del Brasil natural partida'], proportions: [{ name: 'Almendra Americana NPX natural', percentage: 35 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 25 }, { name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', percentage: 20 }, { name: 'Baya Tibetana de Goji', percentage: 15 }, { name: 'Nuez del Brasil natural partida', percentage: 5 }], gramsToAdd: 0 },
    { id: 5, name: 'Mix Poder Proteico', subtitle: 'Proteínas', description1: 'La opción ideal para deportistas, vegetarianos o cualquiera que busque un impulso de proteína vegetal.',description2: 'El maní y la Almendra son los frutos secos con mayor contenido proteico, esencial para la reparación y construcción de músculos. El Pistacho complementa la mezcla con un perfil completo de aminoácidos.', ingredients: ['40% Maní Brasileño tostado sin sal bola entera y mitades ', '40% Almendra Americana NPX natural', '20% Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)'], proportions: [{ name: 'Maní Brasileño tostado sin sal bola entera y mitades', percentage: 40 }, { name: 'Almendra Americana NPX natural', percentage: 40 }, { name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', percentage: 20 }], gramsToAdd: 0 },
    { id: 6, name: 'Mix Figura Ideal', subtitle: 'Ayuda con la Pérdida de Peso', description1: 'Un snack inteligente para controlar el apetito y mantenerte en tu peso ideal.',description2: 'La combinación de proteína, fibra y grasas saludables de la Almendra y el Marañón genera una gran sensación de saciedad, ayudándote a evitar antojos y ayudan al metabolismo energético. La Nuez del Nogal aporta Omega-3, que ayuda a regular el metabolismo.', ingredients: ['50% Almendra Americana NPX natural', '30% Nuez del Nogal Americana natural', '20% Marañón Brasileño entero tostado W1 320 sin sal'], proportions: [{ name: 'Almendra Americana NPX natural', percentage: 50 }, { name: 'Nuez del Nogal Americana natural', percentage: 30 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 20 }], gramsToAdd: 0 },
    { id: 7, name: 'Mix Mente Brillante', subtitle: 'Salud Cerebral', description1: 'Nutrición específica para tu cerebro.',description2: 'La Nuez del Nogal es la reina de la salud cerebral gracias a su altísimo contenido de Omega-3 (ALA), vital para las neuronas. La Uva pasa es rica en Boro, un mineral que ha demostrado mejorar la función cognitiva, la coordinación y la memoria a corto plazo. La Avellana es rica en Vitamina E la cual ayuda a prevenir el deterioro cognitivo.', ingredients: ['40% Nuez del Nogal Americana natural', '30% Uva pasa Mexicana flame mediana (Sin azúcar añadida)', '30% Avellana Turca natural con piel'], proportions: [{ name: 'Nuez del Nogal Americana natural', percentage: 40 }, { name: 'Uva pasa Mexicana flame mediana (Sin azúcar añadida)', percentage: 30 }, { name: 'Avellana Turca natural con piel', percentage: 30 }], gramsToAdd: 0 },
    { id: 8, name: 'Mix Huesos de Acero', subtitle: 'Salud Ósea', description1: 'Fortalece tu estructura ósea desde adentro.',description2: 'El Higo Turco y la Almendra son excelentes fuentes vegetales de Calcio. El Marañón y la Almendra aportan Magnesio, un mineral crucial para la absorción del calcio. La Uva pasa contiene Boro, un mineral traza que juega un papel importante en la prevención de la osteoporosis.', ingredients: ['40% Almendra Americana NPX natural', '30% Higo Turco seco (Sin azúcar añadida)', '20% Marañón Brasileño entero tostado W1 320 sin sal', '10% Uva pasa Mexicana flame mediana (Sin azúcar añadida)'], proportions: [{ name: 'Almendra Americana NPX natural', percentage: 40 }, { name: 'Higo Turco seco (Sin azúcar añadida)', percentage: 30 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 20 }, { name: 'Uva pasa Mexicana flame mediana (Sin azúcar añadida)', percentage: 10 }], gramsToAdd: 0 },
    { id: 9, name: 'Mix Zen', subtitle: 'Efecto Antiinflamatorio', description1: 'Ayuda a tu cuerpo a combatir la inflamación crónica de forma natural.',description2: 'La Nuez del Nogal es la fuente principal de ácidos grasos Omega-3 antiinflamatorios. La Nuez Pecan y la Almendra contienen antioxidantes y grasas saludables que ayudan a reducir los marcadores inflamatorios. La Baya de Goji añade su potente polisacárido antiinflamantorio para un efecto sinérgico.', ingredients: ['40% Nuez del Nogal Americana natural', '30% Almendra Americana NPX natural', '20% Nuez Pecan Americana natural', '10% Baya Tibetana de Goji'], proportions: [{ name: 'Nuez del Nogal Americana natural', percentage: 40 }, { name: 'Almendra Americana NPX natural', percentage: 30 }, { name: 'Nuez Pecan Americana natural', percentage: 20 }, { name: 'Baya Tibetana de Goji', percentage: 10 }], gramsToAdd: 0 },
    { id: 10, name: 'Mix Alma Feliz', subtitle: 'Mejora del Estado de Ánimo', description1: 'Un impulso para tu bienestar emocional.',description2: 'La Nuez del Nogal contiene triptófano, un precursor de la serotonina (la "hormona de la felicidad"). El Marañón es rico en magnesio, conocido como el "mineral antiestrés". El Dátil provee energía rápida para combatir la fatiga, y el Pistacho contienen Vitamina B6, necesaria para la producción de neurotransmisores del bienestar.', ingredients: ['35% Nuez del Nogal Americana natural', '35% Marañón Brasileño entero tostado W1 320 sin sal', '20% Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', '10% Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)'], proportions: [{ name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 35 }, { name: 'Nuez del Nogal Americana natural', percentage: 35 }, { name: 'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', percentage: 20 }, { name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', percentage: 10 }], gramsToAdd: 0 },
    { id: 11, name: 'Mix Inmunidad Total', subtitle: 'Aumento de Defensas', description1: 'Refuerza tu sistema inmune para protegerte de enfermedades.',description2: 'Una sola Nuez del Brasil aporta todo el selenio que necesitas, un mineral vital para la función inmunológica. La Nuez Pecan y el Marañón son ricos en zinc, esencial para el desarrollo y función de las células inmunitarias. La Almendra proveen Vitamina E, un antioxidante que protege las membranas de estas células. La Baya de Goji potencia la mezcla con vitamina C y polisacárido que estimulan la respuesta inmunitaria.', ingredients: ['30% Almendra Americana NPX natural','30% Marañón Brasileño entero tostado W1 320 sin sal', '20% Baya Tibetana de Goji', '10% Nuez Pecan Americana natural', '10% Nuez del Brasil natural partida'], proportions: [{ name: 'Almendra Americana NPX natural', percentage: 30 },{ name: 'Baya Tibetana de Goji', percentage: 20 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 30 }, { name: 'Nuez Pecan Americana natural', percentage: 10 }, { name: 'Nuez del Brasil natural partida', percentage: 10 }], gramsToAdd: 0 },
    { id: 12, name: 'Mix Flujo Ligero', subtitle: 'Combate el Estreñimiento', description1: 'La solución natural para la regularidad.',description2: 'Esta mezcla es una bomba de fibra. El Higo, el Dátil y el Albaricoque son famosos por su capacidad para ablandar las heces y estimular el tránsito intestinal. La Nuez Pecan añade un extra de fibra y grasas saludables, lubricando el sistema digestivo.', ingredients: ['35% Higo Turco seco (Sin azúcar añadida)', '30% Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', '20% Albaricoque Turco seco (Sin azúcar añadida)', '15% Nuez Pecan Americana natural'], proportions: [{ name: 'Higo Turco seco (Sin azúcar añadida)', percentage: 35 }, { name: 'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', percentage: 30 }, { name: 'Albaricoque Turco seco (Sin azúcar añadida)', percentage: 20 }, { name: 'Nuez Pecan Americana natural', percentage: 15 }], gramsToAdd: 0 },
    { id: 13, name: 'Mix Eterna Juventud', subtitle: 'Propiedades Anti-envejecimiento', description1: 'Protege tus células desde adentro hacia afuera.',description2: 'La Baya de Goji y sus antioxidantes unicos lideran la defensa contra el envejecimiento, la Nuez de Nogal y la Nuez Pecan combaten el estrés oxidativo, una de las principales causas del envejecimiento celular. La Vitamina E de la Avellana es clave para mantener una piel elástica y saludable.', ingredients: ['40% Nuez del Nogal Americana natural', '25% Baya Tibetana de Goji', '20% Nuez Pecan Americana natural', '15% Avellana Turca natural con piel'], proportions: [{ name: 'Nuez del Nogal Americana natural', percentage: 40 }, { name: 'Baya Tibetana de Goji', percentage: 25 }, { name: 'Nuez Pecan Americana natural', percentage: 20 }, { name: 'Avellana Turca natural con piel', percentage: 15 }], gramsToAdd: 0 },
    { id: 14, name: 'Mix Sangre de Hierro', subtitle: 'Combate la Anemia', description1: 'Un apoyo natural para aumentar tus niveles de hemoglobina.',description2: 'El Albaricoque y la Baya de Goji son excelentes fuentes vegetales de hierro. El Marañón es rico en cobre, un mineral indispensable para que el cuerpo pueda absorber y utilizar el hierro de manera eficiente. El Pistacho también complementa el aporte de hierro.', ingredients: ['35% Albaricoque Turco seco (Sin azúcar añadida)', '35% Marañón Brasileño entero tostado W1 320 sin sal', '20% Baya Tibetana de Goji', '10% Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)'], proportions: [{ name: 'Albaricoque Turco seco (Sin azúcar añadida)', percentage: 35 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 35 }, { name: 'Baya Tibetana de Goji', percentage: 20 }, { name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', percentage: 10 }], gramsToAdd: 0 },
    
    { 
        id: 15, 
        name: 'Mix Calma Profunda', 
        subtitle: 'Combate la Ansiedad', 
        description1: 'Un refugio de tranquilidad para tu sistema nervioso.',
        description2: 'El dúo dinámico de Almendra y Marañón ofrece una de las dosis más altas de Magnesio, conocido como el "mineral antiestrés" por su capacidad para relajar el sistema nervioso y reducir la tensión. La Nuez de Nogal complementa con Omega-3, que nutre el cerebro y apoya un estado de calma general.',
        ingredients: ['40% Almendra Americana NPX natural', '40% Marañón Brasileño entero tostado W1 320 sin sal', '20% Nuez del Nogal Americana natural'], 
        proportions: [
            { name: 'Almendra Americana NPX natural', percentage: 40 }, 
            { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 40 }, 
            { name: 'Nuez del Nogal Americana natural', percentage: 20 }
        ], 
        gramsToAdd: 0 
    },
    { 
        id: 16, 
        name: 'Mix Alma Radiante', 
        subtitle: 'Apoyo contra la Depresión', 
        description1: 'Un impulso natural para tu bienestar emocional.',
        description2: 'La Nuez de Nogal es la estrella de esta mezcla, siendo una fuente vegetal de triptófano, un aminoácido precursor de la serotonina (la "hormona de la felicidad"). Su alto contenido de Omega-3 también es crucial para la salud neuronal y la regulación del ánimo. El Dátil aporta energía natural para combatir la fatiga que a menudo acompaña a los estados de ánimo bajos.',
        ingredients: ['50% Nuez del Nogal Americana natural', '30% Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', '20% Marañón Brasileño entero tostado W1 320 sin sal'], 
        proportions: [
            { name: 'Nuez del Nogal Americana natural', percentage: 50 }, 
            { name: 'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', percentage: 30 }, 
            { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 20 }
        ], 
        gramsToAdd: 0 
    },
    { 
        id: 17, 
        name: 'Mix Mente Activa', 
        subtitle: 'Mejora la Memoria', 
        description1: 'El combustible perfecto para un cerebro enfocado y ágil.',
        description2: 'La Nuez de Nogal es el alimento cerebral por excelencia, cargada de Omega-3 (ALA) que protege las neuronas y mejora la comunicación entre ellas. Los Arándanos aportan potentes antioxidantes que combaten el estrés oxidativo en el cerebro, mejorando la memoria y la función cognitiva. La Almendra, con su Vitamina E, completa este escudo protector para tu mente.',
        ingredients: ['40% Nuez del Nogal Americana natural', '30% Arándano deshidratado Americano Ocean Spray (Con azúcar añadida)', '30% Almendra Americana NPX natural'], 
        proportions: [
            { name: 'Nuez del Nogal Americana natural', percentage: 40 }, 
            { name: 'Arándano deshidratado Americano Ocean Spray (Con azúcar añadida)', percentage: 30 },
            { name: 'Almendra Americana NPX natural', percentage: 30 }
        ], 
        gramsToAdd: 0 
    },
{ 
    id: 18, 
    name: 'Mix Dulces Sueños', 
    subtitle: 'Mejora la Calidad del Sueño', 
    description1: 'Una ayuda natural y potente para conciliar el sueño y mejorar su calidad.',
    description2: 'Esta mezcla es la "Trifecta del Descanso". La Almendra aporta Magnesio para relajar el sistema nervioso y también melatonina. El Pistacho es rico en Vitamina B6, que ayuda al cuerpo a producir su propia melatonina. Finalmente, las Bayas de Goji, son una de las pocas frutas que contienen melatonina de forma natural, añadiendo un impulso directo y una deliciosa textura a la mezcla.',
    ingredients: ['50% Almendra Americana NPX natural', '30% Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', '20% Baya Tibetana de Goji'], 
    proportions: [
        { name: 'Almendra Americana NPX natural', percentage: 50 },
        { name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', percentage: 30 },
        { name: 'Baya Tibetana de Goji', percentage: 20 }
    ], 
    gramsToAdd: 0 
},
    { 
        id: 19, 
        name: 'Mix Glucocontrol', 
        subtitle: 'Control de la Diabetes', 
        description1: 'Un snack inteligente para mantener tus niveles de energía estables.',
        description2: 'Diseñado con un bajo índice glucémico. La Almendra y el Maní son ricos en fibra, proteína y grasas saludables, que ralentizan la absorción de azúcar y evitan picos de glucosa. La Nuez de Nogal, con su Omega-3, ha demostrado mejorar la sensibilidad a la insulina. El Marañón aporta magnesio, un mineral esencial para el metabolismo de la glucosa.',
        ingredients: ['40% Almendra Americana NPX natural', '30% Nuez del Nogal Americana natural', '20% Maní Brasileño tostado sin sal bola entera y mitades', '10% Marañón Brasileño entero tostado W1 320 sin sal'], 
        proportions: [
            { name: 'Almendra Americana NPX natural', percentage: 40 }, 
            { name: 'Nuez del Nogal Americana natural', percentage: 30 }, 
            { name: 'Maní Brasileño tostado sin sal bola entera y mitades', percentage: 20 },
            { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 10 }
        ], 
        gramsToAdd: 0 
    },
    { 
        id: 20, 
        name: 'Mix Balance Arterial', 
        subtitle: 'Apoyo para una Tensión Saludable', 
        description1: 'Una potente combinación de frutos ricos en Potasio y Magnesio.',
        description2: 'Este mix es un aliado formidable para tu presión arterial. El Albaricoque seco es una de las mayores fuentes naturales de Potasio, mineral clave que ayuda al cuerpo a equilibrar el sodio. Se combina con la Almendra y el Marañón, que aportan Magnesio para relajar las paredes de los vasos sanguíneos, y la Nuez de Nogal, que añade Omega-3 para mejorar la salud arterial general.',
        ingredients: ['35% Almendra Americana NPX natural', '30% Marañón Brasileño entero tostado W1 320 sin sal', '20% Albaricoque Turco seco (Sin azúcar añadida)', '15% Nuez del Nogal Americana natural'], 
        proportions: [
            { name: 'Almendra Americana NPX natural', percentage: 35 }, 
            { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 30 },
            { name: 'Albaricoque Turco seco (Sin azúcar añadida)', percentage: 20 },
            { name: 'Nuez del Nogal Americana natural', percentage: 15 }
        ], 
        gramsToAdd: 0 
    },
    
    { id: 21, name: 'Mix Energía Sostenida', subtitle: 'Para el día a día', description1: 'Combate el cansancio de la tarde y proporciona un flujo de energía constante, sin los picos y caídas del azúcar refinado.',description2: 'La Almendra gracias a su combinación de proteína, fibra y grasas saludables asegura una liberación de energía lenta y sostenida. El Dátil aporta carbohidratos naturales de rápida absorción para un impulso de energía inmediato, pero sin ser procesados. La Macadamia es densa en calorías de grasas saludables, lo que las convierte en una fuente de energía de muy larga duración. El Marañón es rico en magnesio, que es crucial para convertir los alimentos en energía a nivel celular.', ingredients: ['40% Almendra Americana NPX natural', '30% Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', '20% Macadamia Nicaragüense natural', '10% Marañón Brasileño entero tostado W1 320 sin sal'], proportions: [{ name: 'Almendra Americana NPX natural', percentage: 40 }, { name: 'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', percentage: 30 }, { name: 'Macadamia Nicaragüense natural', percentage: 20 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 10 }], gramsToAdd: 0 },
    { id: 22, name: 'Mix Piel Radiante', subtitle: 'Belleza desde Adentro', description1: 'Nutre la piel para mejorar su elasticidad, hidratación y protegerla del daño ambiental.',description2: 'La Almendra es una de las mejores fuentes de Vitamina E, un poderoso antioxidante que protege las células de la piel del daño solar y el envejecimiento. La Avellana aporta más Vitamina E y antioxidantes concentrados en su piel, que combaten la inflamación cutánea. La Baya de Goji es rica en Vitamina A (betacaroteno), esencial para la reparación de los tejidos de la piel y para mantenerla suave. La Nuez de Nogal gracias a su Omega-3 fortalece las membranas celulares de la piel, ayudando a mantenerla hidratada y flexible.', ingredients: ['40% Almendra Americana NPX natural', '25% Avellana Turca natural con piel', '20% Baya Tibetana de Goji', '15% Nuez del Nogal Americana natural'], proportions: [{ name: 'Almendra Americana NPX natural', percentage: 40 }, { name: 'Avellana Turca natural con piel', percentage: 25 }, { name: 'Baya Tibetana de Goji', percentage: 20 }, { name: 'Nuez del Nogal Americana natural', percentage: 15 }], gramsToAdd: 0 },
    { id: 23, name: 'Mix Impulso Pre-Entreno', subtitle: 'Energía para el Ejercicio', description1: 'Ofrece el combustible rápido y eficiente que el cuerpo necesita antes de una sesión de ejercicio, mejorando el rendimiento y la resistencia.',description2: 'El Dátil es la fuente perfecta de carbohidratos de digestión rápida para tener energía disponible al instante. El Maní aporta proteína y un poco de grasa para dar sostenimiento al pico de energía inicial. La Uva pasa complementa a los Dátiles con más azúcares naturales para un combustible inmediato. La Almendra laminada añade una textura ligera y fácil de digerir antes del esfuerzo físico.', ingredients: ['40% Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', '30% Maní Brasileño tostado sin sal bola entera y mitades ', '20% Uva pasa Mexicana flame mediana (Sin azúcar añadida)', '10% Almendra Americana NPX laminada natural sin cutícula'], proportions: [{ name: 'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', percentage: 40 }, { name: 'Maní Brasileño tostado sin sal bola entera y mitades', percentage: 30 }, { name: 'Uva pasa Mexicana flame mediana (Sin azúcar añadida)', percentage: 20 }, { name: 'Almendra Americana NPX laminada natural sin cutícula', percentage: 10 }], gramsToAdd: 0 },
    { id: 24, name: 'Mix Recuperación Post-Entreno', subtitle: 'Reparación Muscular', description1: 'Repone las reservas de energía (glucógeno) y proporciona las proteínas necesarias para reparar las fibras musculares después del ejercicio, acelerando la recuperación.',description2: 'El Marañón tienen una proporción ideal de carbohidratos y proteínas, perfecta para la recuperación muscular. El Maní es el rey de la proteína vegetal para una reparación muscular efectiva. El Arándano aporta los carbohidratos necesarios para rellenar las reservas de glucógeno y sus antioxidantes ayudan a reducir el dolor muscular post-ejercicio.', ingredients: ['40% Marañón Brasileño entero tostado W1 320 sin sal', '30% Maní Brasileño tostado sin sal bola entera y mitades ', '30% Arándano deshidratado Americano Ocean Spray (Con azúcar añadida)'], proportions: [{ name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 40 }, { name: 'Maní Brasileño tostado sin sal bola entera y mitades', percentage: 30 }, { name: 'Arándano deshidratado Americano Ocean Spray (Con azúcar añadida)', percentage: 30 }], gramsToAdd: 0 },
    { id: 25, name: 'Mix Balance Femenino', subtitle: 'Salud Hormonal', description1: 'Apoya el equilibrio hormonal y alivia síntomas comunes del ciclo menstrual, gracias a su perfil de minerales específicos.',description2: 'La Almendra es rica en Magnesio y Calcio, que han demostrado ayudar a reducir los cólicos y los síntomas del síndrome premenstrual (SPM). El Marañón es otra fuente potentísima de Magnesio, conocido por su efecto relajante y por mejorar el estado de ánimo. El Albaricoque es una buena fuente de hierro, importante para reponer las pérdidas durante la menstruación. La Nuez de Nogal con su Omega-3 ayuda a regular la inflamación, que puede ser una causa de dolor menstrual.', ingredients: ['40% Almendra Americana NPX natural', '30% Marañón Brasileño entero tostado W1 320 sin sal', '20% Albaricoque Turco seco (Sin azúcar añadida)', '10% Nuez del Nogal Americana natural'], proportions: [{ name: 'Almendra Americana NPX natural', percentage: 40 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 30 }, { name: 'Albaricoque Turco seco (Sin azúcar añadida)', percentage: 20 }, { name: 'Nuez del Nogal Americana natural', percentage: 10 }], gramsToAdd: 0 },
    { id: 26, name: 'Mix Vigor Masculino', subtitle: 'Salud del Hombre', description1: 'Enfocado en nutrientes clave para la salud masculina, como la función prostática, la producción de testosterona y la salud cardiovascular.',description2: 'El Pistacho es rico en Zinc, un mineral esencial para la salud de la próstata y la producción de testosterona. También contienen arginina, que mejora el flujo sanguíneo. La Nuez Pecan aporta antioxidantes y también es una buena fuente de Zinc. La Nuez del Nogal con su Omega-3 es fundamental para la salud cardiovascular general. La Nuez del Brasil es rica en Selenio que aporta es un antioxidante muy potente, también ligado a la producción de testosterona y la salud prostática.', ingredients: ['40% Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', '30% Nuez Pecan Americana natural', '20% Nuez del Nogal Americana natural', '10% Nuez del Brasil natural partida'], proportions: [{ name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', percentage: 40 }, { name: 'Nuez Pecan Americana natural', percentage: 30 }, { name: 'Nuez del Nogal Americana natural', percentage: 20 }, { name: 'Nuez del Brasil natural partida', percentage: 10 }], gramsToAdd: 0 },
    { 
        id: 27, 
        name: 'Mix Equilibrio Tiroideo', 
        subtitle: 'Apoyo Nutricional para la Tiroides', 
        description1: 'Una combinación rica en Selenio y Zinc, minerales clave para la correcta función tiroidea.',
        description2: 'Esta mezcla es una fuente excepcional de Selenio gracias a la Nuez de Brasil; este mineral es indispensable para la conversión de la hormona tiroidea T4 a su forma activa, T3. La Almendra y el Marañón aportan Zinc y Magnesio, que también juegan un papel crucial en la producción de hormonas tiroideas. Las Bayas de Goji, con su alto poder antioxidante, ayudan a combatir el estrés oxidativo que a menudo afecta a la glándula tiroides, especialmente en condiciones autoinmunes.',
        ingredients: ['40% Almendra Americana NPX natural', '30% Marañón Brasileño entero tostado W1 320 sin sal', '20% Baya Tibetana de Goji', '10% Nuez del Brasil natural partida'], 
        proportions: [
            { name: 'Almendra Americana NPX natural', percentage: 40 }, 
            { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 30 }, 
            { name: 'Baya Tibetana de Goji', percentage: 20 },
            { name: 'Nuez del Brasil natural partida', percentage: 10 }
        ], 
        gramsToAdd: 0 
    },
    { 
        id: 28, 
        name: 'Mix Sinergía Total', 
        subtitle: 'El Mix Definitivo de Soporte Nutricional (Lupus y Fibromialgia)', 
        description1: 'La sinergia de siete superalimentos, diseñada para un apoyo integral contra la inflamación, la fatiga y el estrés oxidativo.',
        description2: 'Nuestra fórmula más completa y holística. La Nuez de Nogal establece la base antiinflamatoria con su Omega-3. La Almendra y el Marañón forman el dúo mineral, aportando Magnesio para combatir la fatiga y el dolor muscular, y Zinc para ayudar a regular el sistema inmune. La Nuez Pecan y las Bayas de Goji actúan como un potente escudo antioxidante, mientras que el Dátil y el Albaricoque aportan un complejo de fibra y energía natural para una vitalidad sostenida.',
        ingredients: ['25% Nuez del Nogal Americana natural', '20% Almendra Americana NPX natural', '15% Marañón Brasileño entero tostado W1 320 sin sal', '10% Nuez Pecan Americana natural', '10% Baya Tibetana de Goji', '10% Albaricoque Turco seco (Sin azúcar añadida)', '10% Dátil Sayer iraní sin semilla (Sin Azúcar añadida)'], 
        proportions: [
            { name: 'Nuez del Nogal Americana natural', percentage: 25 }, 
            { name: 'Almendra Americana NPX natural', percentage: 20 }, 
            { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 15 },
            { name: 'Nuez Pecan Americana natural', percentage: 10 },
            { name: 'Baya Tibetana de Goji', percentage: 10 },
            { name: 'Albaricoque Turco seco (Sin azúcar añadida)', percentage: 10 },
            { name: 'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', percentage: 10 }
        ], 
        gramsToAdd: 0 
    }
];
},
                viewProduct(nut) {
                    this.selectedNut = nut;
                    this.mode = 'productDetail';
                    this.searchQuery = ''; 
                },
                backToBuilder() {
                    this.selectedNut = null;
                    this.activeTab = 1; 
                },
                removeFromCart(index) { 
                    this.cart.splice(index, 1); 
                    this.saveCart(); // <<< NUEVO: Guardar cambios
                },

                get finalSummary() {
                    const subtotalMezclas = this.cart.reduce((acc, item) => acc + (item.cost * item.quantity), 0);
                    const costoEnvases = this.cart.reduce((acc, item) => acc + (item.packaging.price * item.quantity), 0);
                    const subtotal = subtotalMezclas + costoEnvases;

                    let deliveryCostRaw = (this.delivery.mode === 'Envío') ? this.delivery.cost : 0;
                    
                    let discount = 0;
                    if (this.delivery.department === 'Bogotá D.C.') {
                        if (subtotalMezclas >= 200000) {
                            discount = deliveryCostRaw;
                        } else if (subtotalMezclas >= 100000) {
                            discount = deliveryCostRaw * 0.5;
                        }
                    }
                    
                    const total = subtotal + deliveryCostRaw - discount;
                    return { subtotal, deliveryCostRaw, discount: Math.round(discount), total };
                },

                get isOrderButtonEnabled() {
                    if (this.cart.length === 0) return false;
                    if (!this.contactInfo.name || !this.contactInfo.phone || this.contactInfo.phone.length !== 10) return false;
                    
                    if (this.delivery.mode === 'Envío') {
                        if (!this.delivery.address || !this.delivery.department) return false;
                        if (this.delivery.department === 'Bogotá D.C.' && !this.delivery.locality) return false;
                        if (this.delivery.department !== 'Bogotá D.C.' && !this.delivery.municipality) return false;
                    }
                    
                    return true;
                },

                placeOrder() {
                     if (!this.isOrderButtonEnabled) {
                        if (this.cart.length === 0) {
                            this.triggerAlert('Tu carrito está vacío. Añade al menos un producto.');
                        } else if (!this.contactInfo.name || !this.contactInfo.phone) {
                            this.triggerAlert('Por favor, completa tu nombre y celular de contacto.');
                        } else if (this.contactInfo.phone.length !== 10) {
                            this.triggerAlert('El celular de contacto debe tener 10 dígitos.');
                        } else if (this.delivery.mode === 'Envío') {
                            if (!this.delivery.department || (this.delivery.department === 'Bogotá D.C.' && !this.delivery.locality) || (this.delivery.department !== 'Bogotá D.C.' && !this.delivery.municipality)) {
                                this.triggerAlert('Por favor, selecciona tu departamento y municipio/localidad.');
                            } else if (!this.delivery.address) {
                                this.triggerAlert('Por favor, completa tu dirección de envío.');
                            } else {
                                this.triggerAlert('Por favor, revisa que todos los campos del pedido estén completos.');
                            }
                        }
                        return; 
                    }
                    this.showPreConfirmationModal = true;
                },

                async executeOrder() {
                    this.showPreConfirmationModal = false;
                    this.formStatus = 'Enviando...';

                    let orderSummary = `Pedido #${this.orderCounter} Nut&Mix\n=================================\n\n`;
                    orderSummary += `**Información de Contacto:**\nNombre: ${this.contactInfo.name}\nCelular: ${this.contactInfo.phone}\n\n`;
                    orderSummary += `**Detalle del Pedido:**\n`;
                    this.cart.forEach((item, index) => {
                        orderSummary += `--- ${item.name} (x${item.quantity}) - ${this.formatCurrency((item.cost + item.packaging.price) * item.quantity)} ---\n`;
                        orderSummary += `  (Peso unitario: ${item.totalGrams.toFixed(0)}g)\n`;

                        if (item.packaging.type === 'glass_jar') {
                            const jar = this.getJarById(item.packaging.jarId);
                            orderSummary += `  + Envase: ${jar.name} (${jar.capacity}g) - ${this.formatCurrency(jar.price)}\n`;
                            orderSummary += `  + Etiqueta: ${item.packaging.labelId === 'custom' ? `Personalizada: '${item.packaging.customMessage}'` : this.getLabelNameById(item.packaging.labelId)}\n`;
                        } else {
                            orderSummary += `  + Empaque: Bolsa Kraft (Incluida)\n`;
                        }

                        if (item.discount > 0) {
                            orderSummary += `  (Descuento unitario por cantidad del ${item.discountPercentage}% aplicado)\n`;
                        }
                        item.nuts.filter(n => n.grams > 0).forEach(nut => { 
                            let nutLine = `  - ${nut.name}: ${nut.grams.toFixed(0)}g`;
                            if (nut.cutPreference) {
                                nutLine += ` (${nut.cutPreference})`;
                            }
                            orderSummary += nutLine + `\n`;
                        });
                        orderSummary += `\n`;
                    });
                    orderSummary += `**Resumen de Costos:**\nSubtotal: ${this.formatCurrency(this.finalSummary.subtotal)}\n`;

                    if (this.delivery.mode === 'Envío') {
                        let cityInfo = this.delivery.department === 'Bogotá D.C.' ? `${this.delivery.locality}, ${this.delivery.department}` : `${this.delivery.municipality}, ${this.delivery.department}`;
                        orderSummary += `Método: Envío\nDirección: ${this.delivery.address}, ${cityInfo}\nCosto Envío: ${this.formatCurrency(this.finalSummary.deliveryCostRaw)}\n`;
                        if (this.shippingWarningMessage) {
                            orderSummary += `**NOTA:** ${this.shippingWarningMessage}\n`;
                        }
                        if (this.finalSummary.discount > 0) orderSummary += `Descuento Envío: -${this.formatCurrency(this.finalSummary.discount)}\n`;
                    } else {
                        orderSummary += `Método: Recoger en Tienda\nDirección de Recogida: Carrera 19 # 183-30 (Usaquén, Bogotá)\nCosto Envío: ${this.formatCurrency(0)}\n`;
                    }

                    orderSummary += `-------------------\nTOTAL: ${this.formatCurrency(this.finalSummary.total)}\n`;
                    
                    const cleanSummaryForWhatsapp = orderSummary.replace(/\*\*/g, '');
                    
                    const formData = new FormData();
                    formData.append('Nombre', this.contactInfo.name);
                    formData.append('Celular', this.contactInfo.phone);
                    formData.append('Total_Pedido', this.formatCurrency(this.finalSummary.total));
                    formData.append('Resumen_Completo', orderSummary);

                    try {
                        const response = await fetch('https://formcarry.com/s/O3puiyHnvy5', {
                            method: 'POST', body: formData, headers: { 'Accept': 'application/json' }
                        });
                        if (response.ok) {
                            this.showConfirmation(orderSummary, cleanSummaryForWhatsapp);
                            this.orderCounter++;
                            sessionStorage.setItem('nutMixOrderCounter_v2', this.orderCounter);
                            this.clearCart(); // <<< NUEVO: Limpiar carrito y sessionStorage
                            this.resetBuilder();
                            this.delivery = { 
                                mode: 'Envío', 
                                address: '', addressPart1: '', addressPart2: '', addressPart3: '', interior: '', apartment: '',
                                department: 'Bogotá D.C.', municipality: '', locality: '', cost: 0
                            };
                            this.contactInfo = { name: '', phone: '', phoneError: '' };
                        } else { throw new Error('Error en el servidor.'); }
                    } catch (error) {
                        alert('Hubo un problema al enviar tu pedido. Por favor, intenta de nuevo.');
                    } finally {
                        this.formStatus = 'Confirmar Pedido';
                    }
                },

                showConfirmation(summaryForModal, summaryForWhatsapp) {
                    this.confirmationDetails.title = '¡Tu Pedido ha sido recibido con éxito!';
                    let messageBody = '';
                    const imageHtml = `<div class='flex justify-center mt-4'><img src='https://i.ibb.co/jkmzGCDZ/Airbrush-Image-Enhancer-1752901262222.jpg' alt='Logo de Agradecimiento' class='h-32 w-auto' /></div>`;
                    
                    const currentHour = new Date().getHours();
                    let contactMessagePart = '';
                    if (currentHour >= 8 && currentHour < 19) {
                        contactMessagePart = 'En breve, uno de nuestros expertos te contactará';
                    } else {
                        contactMessagePart = 'En nuestro horario hábil (8:00 a.m. a 7:00 p.m.), uno de nuestros expertos te contactará';
                    }

                    if (this.delivery.mode === 'recoger') {
                        messageBody = `<p>¡Tu creación está en marcha! Estamos seleccionando los ingredientes más frescos para tu mezcla. ${contactMessagePart} para confirmar los detalles del pago y avisarte en cuanto puedas pasar a recogerla. ¡Gracias por elegirnos!</p>`;
                    } else { 
                        messageBody = `<p>¡Gracias por elegirnos! Estamos seleccionando los frutos para tu mezcla. ${contactMessagePart} para coordinar el metodo de pago y programar la entrega en tu dirección.<br><br>Agradecemos tu confianza.</p>`;
                    }
                    
                    const customerName = this.contactInfo.name.split(' ')[0];
                    const fullPhoneNumber = '57' + this.contactInfo.phone;
                    const whatsappMessage = `¡Hola ${customerName}! Gracias por tu compra en Nut&Mix. Aquí tienes un resumen de tu pedido:\n\n${summaryForWhatsapp}`;
                    const whatsappUrl = `https://wa.me/${fullPhoneNumber}?text=${encodeURIComponent(whatsappMessage)}`;

                    const additionalContent = `
                        <div class='mt-6 text-center border-t pt-6'>
                            <p class='text-slate-700 font-semibold mb-3'>Haz clic en el botón para enviarte una copia de tu pedido a tu WhatsApp.</p>
                            <a href="${whatsappUrl}" target="_blank" rel="noopener noreferrer" 
                               class="inline-flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-transform transform hover:scale-105">
                                <svg xmlns="http://www.w.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                                </svg>
                                <span>Enviar a mi WhatsApp</span>
                            </a>
                        </div>
                    `;
                    
                    this.confirmationDetails.message = messageBody + imageHtml + additionalContent;
                    this.confirmationDetails.summary = summaryForModal;
                    this.showConfirmationModal = true;
                },
   
                closeConfirmationModal() {
                    this.showConfirmationModal = false;
                },

                formatCurrency(value) { return new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 0 }).format(value); },
                
                calculateMixCostForWeight(weight) {
                    if (!this.activeItemForModal || weight <= 0) return 0;
                    const originalMix = this.activeItemForModal;
                    const originalTotalGrams = originalMix.nuts.reduce((acc, nut) => acc + nut.originalGrams, 0);
                    if (originalTotalGrams <= 0) return 0;
                    let mixSubtotal = 0;
                    originalMix.nuts.forEach(nut => {
                        const proportion = nut.originalGrams / originalTotalGrams;
                        const newGrams = weight * proportion;
                        const nutData = this.getNutByName(nut.name);
                        if (nutData) {
                            mixSubtotal += newGrams * nutData.price;
                        }
                    });
                    const discount = weight >= 750 ? mixSubtotal * 0.05 : 0;
                    return mixSubtotal - discount;
                },

                calculateNutPercentage(grams) {
                    const totalGrams = this.nuts.reduce((acc, nut) => acc + (Number(nut.grams) || 0), 0);
                    if (totalGrams === 0) return '0.00'; return ((grams / totalGrams) * 100).toFixed(2);
                },
                calculateNutGrams(percentage) { return (this.totalGramsForPercentage * (percentage / 100)).toFixed(0); }
            }
        }
    </script>
</body>
</html>