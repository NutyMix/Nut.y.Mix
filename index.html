<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personalizada Tu propia Mezcla</title>

    <!-- Google Fonts for elegant style -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Alpine.js CDN -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.0/dist/cdn.min.js"></script>

    <style>
        [x-cloak] {
            display: none !important;
        }

        .font-elegant {
            font-family: 'Playfair Display', serif;
        }

        .font-body {
            font-family: 'Roboto', sans-serif;
        }

        .transition-height {
            transition: max-height 0.5s ease-in-out;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            /* Paleta: Color primario Gris Pizarra */
            border-top: 4px solid #2F4F4F;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        html {
            scroll-behavior: smooth;
        }

        /* For smooth scrolling */

        /* Estilos para el tooltip de ayuda en la sección de porcentajes */
        .group:hover .group-hover\:opacity-100,
        .group:focus-within .group-hover\:opacity-100 {
            opacity: 1;
        }
    </style>
</head>

<!-- Paleta: Fondo principal cambiado a Blanco Lino -->
<body class="bg-stone-100 text-slate-800 font-body">

    <!-- Banner Fijo de Métodos de Pago -->
    <div id="payment-banner" class="fixed bottom-0 left-0 w-full bg-slate-800 text-white p-3 z-50 text-center text-sm md:text-base">
        <div class="container mx-auto">
            <p>
                <strong class="font-bold text-orange-300">FORMA DE PAGO:</strong> Se acordará por WhatsApp una vez finalices tu pedido. Aceptamos TRANSFERENCIA, NEQUI, DAVIPLATA, DALE y EFECTIVO.
            </p>
        </div>
    </div>

    <div class="container mx-auto max-w-4xl p-4 sm:p-6 lg:p-8 pb-32 md:pb-24" x-data="mixBuilder()" @keydown.escape.window="handleEscape()" x-cloak>
        <!-- Título y Encabezado -->
        <header id="header" class="text-center mb-8">
            <div class="flex justify-center items-center space-x-4">
                <img src="https://i.ibb.co/svMK2wRn/Airbrush-Image-Enhancer-1752901262222.jpg" alt="Logo Izquierda" width="280" height="280">
            </div>
            <p class="mt-4 max-w-3xl mx-auto text-slate-700 leading-relaxed">
                Tú tienes el control. Crea tu mix ideal con nuestra selección premium y disfruta de un bocado saludable, hecho perfectamente para ti.
            </p>
        </header>

        <!-- Pestañas de Modo -->
        <div id="selection-tabs" class="mb-8">
            <!-- Main Tabs -->
<div class="mb-6 flex justify-center">
                <div class="inline-flex border border-slate-300 rounded-lg p-1 bg-slate-200">
                    <!-- Paleta: Texto activo ahora es Gris Pizarra -->
                    <button @click="activeTab = 0"
                            :class="{ 'bg-white text-slate-800 shadow-md': activeTab === 0, 'text-slate-600 hover:bg-slate-100': activeTab !== 0 }"
                            class="flex items-center gap-2 px-6 py-3 rounded-md font-semibold text-lg transition-colors duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M5 4a1 1 0 00-2 0v7.268a2 2 0 000 3.464V16a1 1 0 102 0v-1.268a2 2 0 000-3.464V4zM11 4a1 1 0 10-2 0v1.268a2 2 0 000 3.464V16a1 1 0 102 0V8.732a2 2 0 000-3.464V4zM16 3a1 1 0 011 1v7.268a2 2 0 010 3.464V16a1 1 0 11-2 0v-1.268a2 2 0 010-3.464V4a1 1 0 011-1z" /></svg>
                        Crea tu Mix
                    </button>
                    <button @click="activeTab = 1"
                            :class="{ 'bg-white text-slate-800 shadow-md': activeTab === 1, 'text-slate-600 hover:bg-slate-100': activeTab !== 1 }"
                            class="flex items-center gap-2 px-6 py-3 rounded-md font-semibold text-lg transition-colors duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 sm:h-6 w-5 sm:w-6" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
            </svg>
                        Productos
                    </button>
                    <button @click="activeTab = 2"
                            :class="{ 'bg-white text-slate-800 shadow-md': activeTab === 2, 'text-slate-600 hover:bg-slate-100': activeTab !== 2 }"
                            class="flex items-center gap-2 px-6 py-3 rounded-md font-semibold text-lg transition-colors duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" /></svg>
                        Mixes Vitales
                    </button>
                </div>
            </div>

            <hr class="border-t border-slate-200 my-6">

            <!-- Sub-tabs Content -->
            <div class="pt-4 pb-4">
                <!-- Crea tu Mezcla Tab -->
                <div :class="{ '!block': activeTab === 0 }" x-show.transition.in.opacity.duration.600="activeTab === 0" class="hidden">
                    <div class="mb-6 flex justify-center text-sm">
                        <!-- Paleta: Sub-pestaña usa fondo blanco y texto verde salvia -->
                        <div class="inline-flex border border-slate-300 rounded-lg p-1 bg-slate-200">
                            <button @click="changeSubTab(0)"
                                    :class="{ 'bg-white text-green-800 shadow-md': activeSubTab === 0, 'text-slate-600 hover:bg-slate-100': activeSubTab !== 0 }"
                                    class="flex items-center gap-2 px-4 py-2 rounded-md font-semibold transition-colors duration-300">
                                Mix por Cantidad
                            </button>
                            <button @click="changeSubTab(1)"
                                    :class="{ 'bg-white text-green-800 shadow-md': activeSubTab === 1, 'text-slate-600 hover:bg-slate-100': activeSubTab !== 1 }"
                                    class="flex items-center gap-2 px-4 py-2 rounded-md font-semibold transition-colors duration-300">
                                Mix por Porcentajes
                            </button>
                            <button @click="changeSubTab(2)"
                                    :class="{ 'bg-white text-green-800 shadow-md': activeSubTab === 2, 'text-slate-600 hover:bg-slate-100': activeSubTab !== 2 }"
                                    class="flex items-center gap-2 px-4 py-2 rounded-md font-semibold transition-colors duration-300">
                                A granel (Individual)
                            </button>
                        </div>
                    </div>
                    
                    <div x-show="activeSubTab === 0" x-transition>
                        <p class="mb-6 text-center font-elegant text-slate-700 text-lg">Indica la cantidad en gramos de cada fruto que deseas combinar</p>
                        <div class="text-center text-sm text-slate-700 mb-6 bg-green-50 p-3 rounded-md border border-green-200">
                            <p class="font-bold text-green-900">Aprovecha nuestro descuento por cantidad</p>
                            <p><strong>750 g o más</strong> → <span class="font-semibold">5 % de descuento</span></p>

                        </div>
                        <!-- Buscador para Mix por Cantidad -->
                        <div class="mb-6 px-2">
                            <input type="text" x-model.debounce.300ms="mixSearchQuery" placeholder="Buscar fruto por nombre..." class="w-full p-3 border-2 border-slate-300 rounded-lg shadow-sm focus:border-slate-700 focus:ring-slate-700 transition">
                        </div>
                        <div class="grid grid-cols-1 divide-y divide-slate-200">
                            <div class="grid grid-cols-[3fr,2fr] gap-4 font-semibold text-slate-500 pb-2 mb-2 px-2">
				                <span>FRUTO (COSTO X GRAMO)</span>
				                <span class="text-center">CANTIDAD</span>	
       			            </div>
                            <template x-for="nut in filteredNuts" :key="nut.name">
                                <div class="grid grid-cols-[3fr,2fr] gap-4 items-center py-3 group relative">
                                    <div class="flex items-center gap-3">
                                        <!-- CAMBIO: Contenedor de imagen con overlay de lupa -->
                                        <div @click="openImageModal(nut.imageUrl)" class="relative w-12 h-12 flex-shrink-0 cursor-pointer group/image">
                                            <img :src="nut.imageUrl" :alt="nut.name" class="w-12 h-12 rounded-md object-cover">
                                            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover/image:bg-opacity-50 flex items-center justify-center transition-all duration-300 rounded-md">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-white opacity-0 group-hover/image:opacity-100 transition-opacity">
                                                    <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Zm5-2.25a.75.75 0 0 1 .75.75v1.5h1.5a.75.75 0 0 1 0 1.5h-1.5v1.5a.75.75 0 0 1-1.5 0v-1.5h-1.5a.75.75 0 0 1 0-1.5h1.5v-1.5a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd" />
                                                </svg>
                                            </div>
                                        </div>
                                        <div>
                                            <span x-text="nut.name" class="font-medium text-slate-700 text-justify"></span>
                                            <p class="text-green-700 font-semibold" x-text="(formatCurrency(nut.price) + '/gr')"></p>
<p x-show="largeFruits.includes(nut.name)" class="text-xs italic text-indigo-600 mt-1">✨ Opción de corte en trozos disponible en el carrito</p>
                                        </div>
                                    </div>
                                    <div class="relative">
                                        <!-- CAMBIO: Tooltip condicional para pistacho -->
                                        <span class="absolute -top-7 left-1/2 -translate-x-1/2 text-xs bg-gray-700 text-white px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap" x-show="nut.name !== 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Con cáscara)'">Puedes seleccionar los frutos que desees</span>
                                        <span class="absolute -top-7 left-1/2 -translate-x-1/2 text-xs bg-gray-700 text-white px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap" x-show="nut.name === 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Con cáscara)'">No se puede mezclar. Pídelo sin cáscara.</span>
                                        <!-- CAMBIO: Input deshabilitado para pistacho -->
                                        <input type="number" min="0" x-model.number.debounce="nut.grams" 
                                               :disabled="nut.name === 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Con cáscara)'"
                                               class="w-full text-center border-2 border-slate-300 rounded-md shadow-sm p-2 focus:border-slate-700 focus:ring-slate-700 pr-8 disabled:bg-slate-200 disabled:cursor-not-allowed">
                                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 select-none">gr</span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <div x-show="activeSubTab === 1" x-transition>
                        <p class="mb-6 text-center font-elegant text-slate-700 text-lg">Define un peso total y luego distribuye el 100% entre tus frutos favoritos</p>
                        <div class="text-center text-sm text-slate-700 mb-6 bg-green-50 p-3 rounded-md border border-green-200">
                            <p class="font-bold text-green-900">Aprovecha nuestro descuento por cantidad</p>
                            <p><strong>750 g o más</strong> → <span class="font-semibold">5 % de descuento</span></p>
                        </div>
                        <div class="mb-6">
                            <label for="totalGrams" class="block text-sm font-medium text-slate-700 text-center mb-2">Ingresa la cantidad total de tu Mezcla (Gramos)</label>
                            <div class="relative max-w-xs mx-auto"><input id="totalGrams" type="number" min="0" x-model.number="totalGramsForPercentage" class="w-full text-center border-2 rounded-md shadow-sm p-2 focus:border-slate-700 focus:ring-slate-700 transition-colors"
                                :class="{'border-red-500 ring-2 ring-red-300': currentMix.totalPercentage !== 100 && totalGramsForPercentage > 0, 'border-slate-300': currentMix.totalPercentage === 100 || totalGramsForPercentage === 0}">
                            </div>
                        </div>
                        <!-- Buscador para Mix por Porcentajes -->
                        <div class="mb-6 px-2">
                            <input type="text" x-model.debounce.300ms="mixSearchQuery" placeholder="Buscar fruto por nombre..." class="w-full p-3 border-2 border-slate-300 rounded-lg shadow-sm focus:border-slate-700 focus:ring-slate-700 transition">
                        </div>
                        <div class="relative grid grid-cols-1 divide-y divide-slate-200">
                            <div class="grid grid-cols-[3fr,2fr] gap-4 font-semibold text-slate-500 pb-2 mb-2 px-2"><span>FRUTO (COSTO X GRAMO)</span><span class="text-center">PORCENTAJE</span></div>
                            <template x-for="nut in filteredNuts" :key="nut.name">
                                <div class="relative group grid grid-cols-[3fr,2fr] gap-4 items-center py-3">
                                    <div class="flex items-center gap-3">
                                        <!-- CAMBIO: Contenedor de imagen con overlay de lupa -->
                                        <div @click="openImageModal(nut.imageUrl)" class="relative w-12 h-12 flex-shrink-0 cursor-pointer group/image">
                                            <img :src="nut.imageUrl" :alt="nut.name" class="w-12 h-12 rounded-md object-cover">
                                            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover/image:bg-opacity-50 flex items-center justify-center transition-all duration-300 rounded-md">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-white opacity-0 group-hover/image:opacity-100 transition-opacity">
                                                    <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Zm5-2.25a.75.75 0 0 1 .75.75v1.5h1.5a.75.75 0 0 1 0 1.5h-1.5v1.5a.75.75 0 0 1-1.5 0v-1.5h-1.5a.75.75 0 0 1 0-1.5h1.5v-1.5a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd" />
                                                </svg>
                                            </div>
                                        </div>
                                        <div>
                                            <span x-text="nut.name" class="font-medium text-slate-700 text-justify"></span>
                                            <p class="text-green-700 font-semibold" x-text="(formatCurrency(nut.price) + '/gr')"></p>
<p x-show="largeFruits.includes(nut.name)" class="text-xs italic text-indigo-600 mt-1">✨ Opción de corte en trozos disponible en el carrito </p>
                                        </div>
                                    </div>
                                    <div class="relative">
                                        <!-- CAMBIO: Tooltip condicional para pistacho -->
                                        <span class="absolute -top-7 left-1/2 -translate-x-1/2 text-xs bg-gray-700 text-white px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap" x-show="nut.name !== 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Con cáscara)'">La sumatoria debe ser 100%</span>
                                        <span class="absolute -top-7 left-1/2 -translate-x-1/2 text-xs bg-gray-700 text-white px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap" x-show="nut.name === 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Con cáscara)'">No se puede mezclar. Pídelo sin cáscara.</span>
                                        <!-- CAMBIO: Input deshabilitado para pistacho -->
                                        <input type="number" min="0" max="100" x-model.number.debounce="nut.percentage"
                                               :disabled="nut.name === 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Con cáscara)'"
                                               class="w-full text-center border-2 border-slate-300 rounded-md shadow-sm p-2 focus:border-slate-700 focus:ring-slate-700 pr-8 disabled:bg-slate-200 disabled:cursor-not-allowed">
                                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 select-none">%</span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <div x-show="activeSubTab === 2" x-transition>
                        <p class="mb-6 text-center font-elegant text-slate-700 text-lg">Indica la cantidad exacta de tu fruto favorito</p>
                        <div class="text-center text-sm text-slate-700 mb-6 bg-green-50 p-3 rounded-md border border-green-200">
                            <p class="font-bold text-green-900">Aprovecha nuestro descuento por cantidad</p>
                            <p><strong>750g o más</strong> → <span class="font-semibold">5 % de descuento</span></p>
                        </div>
                        <!-- Buscador para A Granel -->
                        <div class="mb-6 px-2">
                            <input type="text" x-model.debounce.300ms="mixSearchQuery" placeholder="Buscar fruto por nombre..." class="w-full p-3 border-2 border-slate-300 rounded-lg shadow-sm focus:border-slate-700 focus:ring-slate-700 transition">
                        </div>
                        <div class="grid grid-cols-1 divide-y divide-slate-200">
                            <!-- Nueva cabecera de la tabla con espacio para el botón -->
                            <div class="grid grid-cols-[3fr,1.5fr,1.5fr] gap-4 font-semibold text-slate-500 pb-2 mb-2 px-2">
                                <span>FRUTO (COSTO X GRAMO)</span>
                                <span class="text-center">CANTIDAD</span>
                                <span></span> <!-- Columna vacía para el botón -->
                            </div>
                            <template x-for="nut in filteredNuts" :key="nut.name">
                                <!-- Nueva estructura de la fila con 3 columnas -->
                                <div class="grid grid-cols-[3fr,1.5fr,1.5fr] gap-4 items-center py-3">
                                    <!-- Columna 1: Imagen y Nombre (sin cambios) -->
                                    <div class="flex items-center gap-3">
                                        <div @click="openImageModal(nut.imageUrl)" class="relative w-12 h-12 flex-shrink-0 cursor-pointer group/image">
                                            <img :src="nut.imageUrl" :alt="nut.name" class="w-12 h-12 rounded-md object-cover">
                                            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover/image:bg-opacity-50 flex items-center justify-center transition-all duration-300 rounded-md">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-white opacity-0 group-hover/image:opacity-100 transition-opacity"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Zm5-2.25a.75.75 0 0 1 .75.75v1.5h1.5a.75.75 0 0 1 0 1.5h-1.5v1.5a.75.75 0 0 1-1.5 0v-1.5h-1.5a.75.75 0 0 1 0-1.5h1.5v-1.5a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd" /></svg>
                                            </div>
                                        </div>
                                        <div>
                                            <span x-text="nut.name" class="font-medium text-slate-700 text-justify"></span>
                                            <p class="text-green-700 font-semibold" x-text="(formatCurrency(nut.price) + '/gr')"></p>
<p x-show="largeFruits.includes(nut.name)" class="text-xs italic text-indigo-600 mt-1">✨ Opción de corte en trozos disponible en el carrito</p>
                                        </div>
                                    </div>
                                    <!-- Columna 2: Input de Cantidad -->
                                    <div class="relative">
                                        <input type="number" min="0" x-model.number="nut.grams"
                                               @input="handleIndividualSelection(nut)"
                                               :disabled="selectedIndividualNutName && selectedIndividualNutName !== nut.name"
                                               class="w-full text-center border-2 border-slate-300 rounded-md shadow-sm p-2 focus:border-slate-700 focus:ring-slate-700 pr-8 disabled:bg-slate-200 disabled:cursor-not-allowed">
                                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 select-none">gr</span>
                                    </div>
                                    <!-- Columna 3: Botón de Añadir -->
                                    <div class="text-center">
                                        <button @click="addIndividualToCart(nut)"
                                                :disabled="!nut.grams || nut.grams <= 0"
                                                class="w-full font-bold py-2 px-4 rounded-lg transition-all text-white"
                                                :class="{
                                                    'bg-slate-700 hover:bg-slate-800 shadow-md': !nut.justAddedIndividual,
                                                    'bg-green-600': nut.justAddedIndividual,
                                                    'bg-slate-300 cursor-not-allowed': !nut.grams || nut.grams <= 0
                                                }">
                                            <span x-show="!nut.justAddedIndividual" class="flex items-center justify-center gap-1">
                                                 <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l.892-.892L7.793 8H14a1 1 0 00.994-.883l1.928-6.432A1 1 0 0015.958 0H4.592a1 1 0 00-.986.816L3.43 2H3z" /><path d="M6 16a2 2 0 11-4 0 2 2 0 014 0zM15 16a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                                                Añadir
                                            </span>
                                            <span x-show="nut.justAddedIndividual" class="flex items-center justify-center gap-1">
                                                ¡Añadido!
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                                            </span>
                                        </button>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <div x-show="activeSubTab === 0 || activeSubTab === 1">
                        <div id="add-to-cart-section" class="mt-6">
                            <div class="pt-4 border-t border-slate-200 bg-white p-4 rounded-lg">
                                <h3 class="font-bold text-lg mb-2 text-slate-800">Resumen de Compra Actual</h3>
                                <div class="flex justify-between"><span class="text-slate-600">Total Gramos:</span><span class="font-semibold" x-text="currentMix.totalGrams.toFixed(0) + ' g'"></span></div>
                                <div x-show="activeSubTab === 1" class="flex justify-between items-center">
                                    <span class="text-slate-600">Total Porcentaje:</span>
                                    <span class="font-semibold px-2 py-0.5 rounded" :class="{'text-green-800 bg-green-200': currentMix.totalPercentage === 100, 'text-red-800 bg-red-200': currentMix.totalPercentage !== 100}" x-text="currentMix.totalPercentage + '%'"></span>
                                </div>
                                <p x-show="activeSubTab === 1 && currentMix.totalPercentage !== 100" class="text-red-600 text-sm text-right">El total debe ser 100% para añadir.</p>
                                <div class="flex justify-between"><span class="text-slate-600">Subtotal:</span><span class="font-semibold" x-text="formatCurrency(currentMix.subtotal)"></span></div>
                                <div x-show="currentMix.discount > 0" class="flex justify-between text-green-700">
                                    <span class="text-green-700" x-text="`Descuento por cantidad (${currentMix.discountPercentage}%):`"></span>
                                    <span class="font-semibold" x-text="'-' + formatCurrency(currentMix.discount)"></span>
                                </div>
                                <div class="flex justify-between text-xl"><span class="font-bold">Costo Mezcla:</span><span class="font-bold text-slate-800" x-text="formatCurrency(currentMix.cost)"></span></div>
                            </div>
                            <div class="mt-6">
                                <button @click="addToCart()" :disabled="!isActionEnabled || justAdded" class="w-full font-bold py-3 px-4 rounded-lg transition-all"
                                        :class="{'bg-slate-700 hover:bg-slate-800 text-white shadow-lg': isActionEnabled && !justAdded, 'bg-slate-500 text-white': justAdded, 'bg-slate-300 cursor-not-allowed text-slate-500': !isActionEnabled}">
                                    <span x-show="!justAdded">Añadir Compra</span>
                                    <span x-show="justAdded" class="flex items-center justify-center gap-2">
                                        ¡Añadido!
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                                    </span>
                                </button>
                                <p class="text-center text-sm text-slate-500 mt-2">Puedes añadir las mezclas que desees.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Productos Tab -->
                <div :class="{ '!block': activeTab === 1 }" x-show.transition.in.opacity.duration.600="activeTab === 1" class="hidden">
                    <div class="mb-6">
                        <h2 class="text-3xl font-elegant font-bold text-slate-900 text-center mb-4">Nuestros Productos</h2>
                        <p class="text-center text-slate-600 mb-8">Explora nuestra selección premium de frutos secos y frutas deshidratadas</p>
                    </div>

                    <div class="mb-8 px-4 sm:px-0">
                        <input type="text" x-model.debounce.300ms="searchQuery" placeholder="Buscar fruto por nombre..." class="w-full p-3 border-2 border-slate-300 rounded-lg shadow-sm focus:border-slate-700 focus:ring-slate-700 transition">
                    </div>

                    <div class="flex justify-center flex-wrap gap-2 mb-8">
                        <button @click="productFilter = 'Todos'; searchQuery = ''" class="px-4 py-2 text-sm font-medium rounded-full transition-colors" :class="{'bg-slate-700 text-white': productFilter === 'Todos', 'bg-slate-200 text-slate-700 hover:bg-slate-300': productFilter !== 'Todos'}">Todos</button>
                        <button @click="productFilter = 'Frutos Secos'; searchQuery = ''" class="px-4 py-2 text-sm font-medium rounded-full transition-colors" :class="{'bg-slate-700 text-white': productFilter === 'Frutos Secos', 'bg-slate-200 text-slate-700 hover:bg-slate-300': productFilter !== 'Frutos Secos'}">Frutos Secos</button>
                        <button @click="productFilter = 'Frutos Deshidratados'; searchQuery = ''" class="px-4 py-2 text-sm font-medium rounded-full transition-colors" :class="{'bg-slate-700 text-white': productFilter === 'Frutos Deshidratados', 'bg-slate-200 text-slate-700 hover:bg-slate-300': productFilter !== 'Frutos Deshidratados'}">Frutos Deshidratados</button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <template x-for="nut in nuts.filter(n => (productFilter === 'Todos' || n.category === productFilter) && (normalizeText(n.name).includes(normalizeText(searchQuery))))" :key="nut.name">
                            <div class="bg-white border border-slate-200 rounded-lg overflow-hidden shadow-md hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
                                <img :src="nut.imageUrl" :alt="nut.name" class="w-full h-48 object-cover object-top">
                                <div class="p-4 flex flex-col justify-between min-h-0 md:min-h-[188px]">
                                    <div>
                                        <h3 class="font-bold text-slate-800 mb-2" x-text="nut.name"></h3>
                                        <p class="text-green-700 font-semibold mb-3" x-text="formatCurrency(nut.price) + '/gr'"></p>
                                    </div>
                                    <button @click="viewProduct(nut)"
                                            class="w-full bg-slate-700 hover:bg-slate-800 text-white font-bold py-2 px-4 rounded transition-colors">
                                        Ver Detalle
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Mixes Vitales Tab -->
                <div :class="{ '!block': activeTab === 2 }" x-show.transition.in.opacity.duration.600="activeTab === 2" class="hidden">
                    <h2 class="text-3xl font-elegant font-bold text-slate-900 text-center mb-4">
                        Una Guía para tu Bienestar
                    </h2>
                    <p class="max-w-2xl mx-auto text-slate-600 text-center mb-6">
                        Explora nuestras mezclas diseñadas para potenciar tu vitalidad.
                    </p>
     	            <ol class="flex flex-col sm:flex-row justify-center items-center gap-4 sm:gap-8 my-8 text-slate-700">
                        <li class="flex items-center gap-2">
                            <span class="flex items-center justify-center w-8 h-8 bg-emerald-700 text-white font-bold rounded-full">1</span>
                            <span class="font-semibold">Elige tu mix vital</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="flex items-center justify-center w-8 h-8 bg-emerald-700 text-white font-bold rounded-full">2</span>
                            <span class="font-semibold">Define la cantidad en gramos.</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="flex items-center justify-center w-8 h-8 bg-emerald-700 text-white font-bold rounded-full">3</span>
                            <span class="font-semibold">Añade al carrito o personalízalo.</span>
                        </li>
                    </ol>
                    <p class="text-xs text-slate-500 max-w-xl text-center mx-auto italic">
                        Nota: Estas sugerencias no reemplazan el consejo de un profesional de la salud.
                    </p><br>
                    <div class="flex justify-center"><img src="https://i.ibb.co/39vRJBFp/Whats-App-Image-2025-08-03-at-7-38-20-AM.jpg" alt="Empaque" class="rounded-lg shadow-md mb-8" width="412" height="286" >
                    </div>
                    <!-- Buscador para Mixes Vitales -->
                    <div class="mb-8 px-4 sm:px-0">
                        <input type="text" x-model.debounce.300ms="vitalMixSearchQuery" placeholder="Buscar mix vital por nombre o beneficio..." class="w-full p-3 border-2 border-slate-300 rounded-lg shadow-sm focus:border-slate-700 focus:ring-slate-700 transition">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <template x-for="(mix, index) in filteredPredefinedMixes" :key="mix.id">
                            <div class="bg-white border border-slate-300 rounded-xl overflow-hidden flex flex-col relative hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
                                <div class="absolute top-2 right-3 font-elegant text-4xl text-slate-800/10 font-bold select-none" x-text="mix.id.toString().padStart(2, '0')"></div>
                                <div class="p-4 flex flex-col flex-grow">
                                    <div class="flex-grow">
                                        <h3 class="text-xl font-bold font-elegant text-slate-800" x-text="mix.name"></h3>
                                        <p class="text-sm text-slate-500 mb-4" x-text="mix.subtitle"></p>
					                    <p class="text-sm text-slate-800 text-justify mb-4" x-text="mix.description1"></p>   
                                        <button @click="viewMix(mix)" 
                                            class="text-sm font-semibold text-green-700 text-justify bg-green-50 hover:bg-green-100 px-4 py-2 rounded-full transition-colors duration-200">
                                            Ver Detalle
                                        </button>
                                    </div>
                                    <div class="mt-4 pt-4 border-t border-slate-200 text-center">
                                        <div class="relative w-full max-w-xs mx-auto">
                                            <input type="number" step="50" x-model.number="mix.gramsToAdd" placeholder="Gramos (mín. 100)"
                                                class="w-full text-center border-2 border-slate-300 rounded-md shadow-sm p-2 focus:border-slate-700 focus:ring-slate-700 pr-8">
                                            <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 select-none">gr</span>
                                        </div>
                                        
                                        <!-- Novedad: Lógica de botones y texto instructivo mejorados -->
                                        <div class="flex flex-col items-center gap-2 max-w-xs mx-auto mt-2">
                                            <p x-show="!mix.gramsToAdd || mix.gramsToAdd < 100"
                                               class="text-xs text-slate-500 text-center mb-2 italic"
                                               x-transition:enter="transition ease-out duration-200"
                                               x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
                                               x-transition:leave="transition ease-in duration-200"
                                               x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
                                                Ingresa 100g o más para continuar
                                            </p>
                                            <div class="flex gap-2 w-full">
                                                <button @click="addPredefinedMixToCart(mix)"
                                                        :disabled="!mix.gramsToAdd || mix.gramsToAdd < 100"
                                                        :class="{
                                                            'bg-slate-700 hover:bg-slate-800': mix.gramsToAdd && mix.gramsToAdd >= 100,
                                                            'bg-slate-300 cursor-not-allowed': !mix.gramsToAdd || mix.gramsToAdd < 100
                                                        }"
                                                        class="text-white font-bold text-base py-2 px-4 rounded-lg shadow-lg whitespace-nowrap w-full transition-colors duration-300">
                                                    Añadir
                                                </button>
                                                <button @click="openCustomizationModal(mix)"
                                                        :disabled="!mix.gramsToAdd || mix.gramsToAdd < 100"
                                                        :class="{
                                                            'bg-green-700 hover:bg-green-800': mix.gramsToAdd && mix.gramsToAdd >= 100,
                                                            'bg-slate-300 cursor-not-allowed': !mix.gramsToAdd || mix.gramsToAdd < 100
                                                        }"
                                                        class="text-white font-bold text-base py-2 px-4 rounded-lg shadow-lg whitespace-nowrap w-full transition-colors duration-300">
                                                    Personalizar Mix
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <div class="mt-8 flex justify-end">
                        <button @click="scrollToElement('#header')"
                            class="font-bold py-2 px-6 rounded-lg bg-slate-700 hover:bg-slate-800 text-white shadow-lg transition-transform hover:scale-105 flex items-center gap-2">
                            Menú principal
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                <path fill-rule="evenodd"
                                    d="M10 17a.75.75 0 0 1-.75-.75V5.612L7.03 7.83a.75.75 0 1 1-1.06-1.06l3.25-3.25a.75.75 0 0 1 1.06 0l3.25 3.25a.75.75 0 1 1-1.06 1.06L10.75 5.612V16.25A.75.75 0 0 1 10 17Z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

         <!-- Product Detail Modal -->
         <div x-show="mode === 'productDetail' && selectedNut"
              @keydown.escape.window="backToBuilder()"
              x-data="{ detailTab: 'description' }"
              class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4 overflow-hidden">
             <div @click.away="backToBuilder()"
                  class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col">
                 <div class="flex-shrink-0 flex justify-between items-center p-4 border-b border-gray-200">
                     <div class="w-6 h-6"></div> <!-- Espaciador para centrar el botón de cierre -->
                     <button @click="backToBuilder()"
                             class="text-gray-400 hover:text-gray-600 transition-colors">
                         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                         </svg>
                     </button>
                 </div>
                 <div class="flex-1 overflow-y-auto p-6 min-h-0">
                     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                         <!-- Columna Izquierda: Imagen Principal -->
                         <div>
                             <img :src="selectedNut?.imageUrl" :alt="selectedNut?.name"
                                  class="w-full h-auto rounded-lg shadow-md mb-4">
                         </div>
                         <!-- Columna Derecha: Información Clave -->
                         <div>
                             <h3 class="text-3xl font-elegant font-bold text-slate-900 mb-2"
                                 x-text="selectedNut?.name || ''"></h3>
                             <p class="text-2xl font-semibold text-green-700 mb-4" x-text="formatCurrency(selectedNut?.price || 0) + '/gr'"></p>
                             <div class="text-sm space-y-2">
                                 <p><strong class="font-semibold text-slate-800">ORIGEN:</strong> <span class="text-slate-600" x-text="selectedNut?.origin"></span></p>
                                 <p><strong class="font-semibold text-slate-800">INGREDIENTES:</strong> <span class="text-slate-600" x-text="selectedNut?.ingredients"></span></p>
                             </div>
                         </div>
                     </div>

                     <!-- Sección de Pestañas -->
                     <div class="mt-6 border-t pt-6">
                         <!-- Botones de Pestañas (Nuevo estilo) -->
                         <div class="mb-4 flex justify-center">
                             <div class="inline-flex border border-slate-300 rounded-lg p-1 bg-slate-200">
                                 <button @click="detailTab = 'description'" :class="{'bg-white text-green-800 shadow-md': detailTab === 'description', 'text-slate-600 hover:bg-slate-100': detailTab !== 'description'}"
                                         class="px-4 py-2 rounded-md font-semibold transition-colors duration-300">
                                     Descripción
                                 </button>
                                 <button @click="detailTab = 'benefits'" :class="{'bg-white text-green-800 shadow-md': detailTab === 'benefits', 'text-slate-600 hover:bg-slate-100': detailTab !== 'benefits'}"
                                         class="px-4 py-2 rounded-md font-semibold transition-colors duration-300">
                                     Beneficios
                                 </button>
                                 <button @click="detailTab = 'nutrition'" :class="{'bg-white text-green-800 shadow-md': detailTab === 'nutrition', 'text-slate-600 hover:bg-slate-100': detailTab !== 'nutrition'}"
                                         class="px-4 py-2 rounded-md font-semibold transition-colors duration-300">
                                     Info. Nutricional
                                 </button>
                             </div>
                         </div>

                         <!-- Contenido de Pestañas -->
                         <div class="mt-4 text-slate-700 leading-relaxed space-y-3 text-justify bg-white p-4 rounded-lg border">
                             <div x-show="detailTab === 'description'" x-html="selectedNut?.description || ''"></div>
                             <div x-show="detailTab === 'benefits'" x-html="selectedNut?.benefits || ''"></div>
                             <div x-show="detailTab === 'nutrition'" class="flex justify-center" x-html="selectedNut?.nutritionInfo || ''"></div>
                         </div>
                     </div>
                 </div>
                 <div class="flex-shrink-0 p-4 border-t border-gray-200 bg-slate-50 flex justify-end">
                     <button @click="backToBuilder()"
                         class="font-bold py-2 px-6 rounded-lg bg-slate-700 hover:bg-slate-800 text-white shadow-lg transition-colors">
                         Cerrar
                     </button>
                 </div>
             </div>
         </div>
         
         <!-- Mix Detail Modal -->
         <div x-show="selectedMix"
              class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4 overflow-hidden">
             <div @click.away="closeMixDetail()"
                  class="bg-white rounded-lg shadow-xl w-full max-w-2xl h-[80vh] flex flex-col">
                 <div class="flex flex-col h-full">
                     <div class="flex-shrink-0 flex justify-between items-center p-4 border-b border-gray-200">
                         <h2 class="text-xl font-bold text-slate-900" x-text="selectedMix?.name || ''"></h2>
                         <button @click="closeMixDetail()"
                                 class="text-gray-400 hover:text-gray-600 transition-colors">
                             <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                             </svg>
                         </button>
                     </div>
                     <div class="flex-1 overflow-y-auto p-6 min-h-0">
                         <h3 class="text-2xl font-elegant font-bold text-slate-800" x-text="selectedMix?.name || ''"></h3>
                         <p class="text-md text-slate-500 mb-4" x-text="selectedMix?.subtitle || ''"></p>
                         <p class="text-slate-700 leading-relaxed text-justify mb-6" x-text="selectedMix?.description2 || ''"></p>

                         <div>
                             <p class="text-lg font-bold text-slate-700">Ingredientes:</p>
                             <ul class="text-slate-700 list-none mt-2 space-y-1">
                                 <template x-for="ingredient in selectedMix?.ingredients" :key="ingredient">
                                     <li class="font-semibold" x-text="ingredient"></li>
                                 </template>
                             </ul>
                         </div>
                     </div>
                     <div class="flex-shrink-0 p-4 border-t border-gray-200 flex justify-center">
                         <button @click="closeMixDetail()"
                             class="font-bold py-2 px-6 rounded-lg bg-slate-700 hover:bg-slate-800 text-white shadow-lg transition-colors">
                             Entendido
                         </button>
                     </div>
                 </div>
             </div>
         </div>

         <!-- Image Preview Modal -->
         <div x-show="showImageModal"
              x-transition:enter="ease-out duration-300"
              x-transition:enter-start="opacity-0"
              x-transition:enter-end="opacity-100"
              x-transition:leave="ease-in duration-200"
              x-transition:leave-start="opacity-100"
              x-transition:leave-end="opacity-0"
              @click="closeImageModal()"
              class="fixed inset-0 z-[200] flex items-center justify-center bg-black bg-opacity-75 p-4">
            <div @click.stop class="relative max-w-3xl max-h-full">
                <img :src="modalImageUrl" alt="Vista previa del producto" class="rounded-lg shadow-lg">
                <button @click="closeImageModal()" class="absolute -top-2 -right-2 bg-white rounded-full p-1 text-slate-700 hover:text-red-500 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
         </div>

        <!-- Custom Alert Notification -->
        <div x-show="showAlert"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform -translate-y-4"
             x-transition:enter-end="opacity-100 transform translate-y-0"
             x-transition:leave="transition ease-in duration-300"
             x-transition:leave-start="opacity-100 transform translate-y-0"
             x-transition:leave-end="opacity-0 transform -translate-y-4"
             class="fixed top-5 left-1/2 -translate-x-1/2 z-[100] bg-red-500 text-white font-semibold py-3 px-6 rounded-lg shadow-lg flex items-center gap-4"
             x-cloak>
            <span x-text="alertMessage"></span>
            <button @click="showAlert = false" class="text-xl font-bold">×</button>
        </div>
        
        <!-- START: Mix Customization Modal -->
        <div x-show="customization.showModal"
             class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4 overflow-hidden"
             x-cloak>
            <div @click.away="closeCustomizationModal()"
                 class="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col">
                
                <!-- Modal Header -->
                <div class="flex-shrink-0 flex justify-between items-center p-4 border-b border-gray-200">
                    <h2 class="text-xl font-bold text-slate-900">Personalizando: <span x-text="customization.mix.name"></span></h2>
                    <button @click="closeCustomizationModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="flex-1  bg-stone-100  overflow-y-auto p-6 min-h-0 space-y-6">
                    <div>
                        <label for="customMixGrams" class="block text-sm font-medium text-slate-700 text-center mb-2">1. Ajusta la cantidad total de tu Mezcla (Gramos)</label>
                        <div class="relative max-w-xs mx-auto">
                            <input id="customMixGrams" type="number" min="100" x-model.number="customization.totalGrams" class="w-full text-center border-2 rounded-md shadow-sm p-2 focus:border-slate-700 focus:ring-slate-700 transition-colors"
                                   :class="{'border-red-500 ring-2 ring-red-300': customization.totalPercentage !== 100 && customization.totalGrams > 0, 'border-slate-300': customization.totalPercentage === 100 || customization.totalGrams === 0}">
                        </div>
                    </div>

                    <div class="border-t pt-4">
                        <p class="text-center font-medium text-slate-700 mb-4">2. Añade o elimina ingredientes / Ajusta porcentajes (La suma debe ser 100%).</p>
                        
                        <!-- Ingredient List -->
                        <div class="space-y-3">
                            <!-- Novedad: Imágenes de producto añadidas al modal de personalización -->
                            <template x-for="(ingredient, index) in customization.mix.ingredients" :key="index">
                                <div class="grid grid-cols-[auto,1fr,auto,auto] gap-3 items-center">
                                    <div @click="openImageModal(getNutByName(ingredient.name)?.imageUrl)" class="relative w-10 h-10 flex-shrink-0 cursor-pointer group/image">
                                        <img :src="getNutByName(ingredient.name)?.imageUrl" :alt="ingredient.name" class="w-10 h-10 rounded-md object-cover">
                                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover/image:bg-opacity-50 flex items-center justify-center transition-all duration-300 rounded-md">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-white opacity-0 group-hover/image:opacity-100 transition-opacity">
                                                <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Zm5-2.25a.75.75 0 0 1 .75.75v1.5h1.5a.75.75 0 0 1 0 1.5h-1.5v1.5a.75.75 0 0 1-1.5 0v-1.5h-1.5a.75.75 0 0 1 0-1.5h1.5v-1.5a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="font-medium text-slate-800" x-text="ingredient.name"></div>
                                    <div class="relative">
                                        <input type="number" min="0" max="100" x-model.number="ingredient.percentage" class="w-24 text-center border-2 border-slate-300 rounded-md p-1 pr-6">
                                        <span class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 select-none text-sm">%</span>
                                    </div>
                                    <button @click="removeCustomIngredient(index)" class="text-red-500 hover:text-red-700 p-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>
                                    </button>
                                </div>
                            </template>
                        </div>
                        
                        <!-- Add New Ingredient -->
                        <div class="mt-4 pt-4 border-t border-dashed">
                            <div class="grid grid-cols-[1fr,auto] gap-3 items-center">
                                <select x-model="customization.nutToAdd" class="w-full border-slate-300 rounded-md shadow-sm">
                                    <option value="">Añadir otro fruto...</option>
                                    <template x-for="nut in availableNutsForCustomization" :key="nut.name">
                                        <option :value="nut.name" x-text="nut.name"></option>
                                    </template>
                                </select>
                                <button @click="addCustomIngredient()" :disabled="!customization.nutToAdd" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold px-4 py-2 rounded-md transition-colors disabled:bg-slate-100 disabled:text-slate-400 disabled:cursor-not-allowed">Añadir</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex-shrink-0 p-4 border-t border-gray-200 bg-slate-50">
                    <div class="flex justify-between items-center">
                        <div class="text-lg">
                            <span class="font-bold">Total:</span>
                            <span class="font-semibold px-2 py-1 rounded" :class="{'text-green-800 bg-green-200': customization.totalPercentage === 100, 'text-red-800 bg-red-200': customization.totalPercentage !== 100}" x-text="customization.totalPercentage + '%'"></span>
                            <span class="font-bold ml-4" x-text="formatCurrency(customization.cost)"></span>
                        </div>
                        <div class="flex gap-4">
                            <button @click="closeCustomizationModal()" class="font-bold py-2 px-6 rounded-lg bg-slate-200 hover:bg-slate-300 text-slate-700">Cancelar</button>
                            <button @click="addCustomMixToCart()" :disabled="!isCustomizationValid" class="font-bold py-2 px-6 rounded-lg bg-slate-700 hover:bg-slate-800 text-white shadow-lg disabled:bg-slate-300 disabled:cursor-not-allowed">
                                Añadir Mix
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END: Mix Customization Modal -->


        <!-- Carrito de Compras -->
        <section id="cart" class="mt-8 bg-white p-6 rounded-xl shadow-lg border border-slate-200"
            x-show="!selectedNut && !selectedMix">
            <h2 class="text-2xl font-bold text-slate-800 mb-4">Revisa tu Carrito</h2>

            <div x-show="cart.length === 0"
                class="text-center text-slate-500 py-8 border-2 border-dashed border-slate-300 rounded-lg">
                <p class="font-medium">Tu carrito está vacío.</p>
                <p class="text-sm">Añade tus mezclas perfectas para verlas aquí.</p>
            </div>

            <div x-show="cart.length > 0" class="space-y-4" x-transition>
                <template x-for="(item, index) in cart" :key="index">
                    <div class="bg-stone-100 p-3 rounded-md">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <p class="font-bold" x-text="item.name"></p>
                                <ul class="text-sm text-slate-600 list-disc list-inside">
                                    <template x-for="nut in item.nuts.filter(n => n.grams > 0)" :key="nut.name">
                                        <li><span x-text="`${nut.name}: ${nut.grams.toFixed(0)}g`"></span></li>
                                    </template>
                                </ul>
                                <p x-show="item.discount > 0" class="text-xs text-green-700 font-bold mt-1"
                                    x-text="`(Incluye ${item.discountPercentage}% de descuento por cantidad)`"></p>
                            </div>
                            <div class="text-right mx-4 flex-shrink-0">
                                <p class="font-semibold" x-text="formatCurrency(item.cost)"></p>
                                <p class="text-sm text-slate-500" x-text="`${item.totalGrams.toFixed(0)} g`"></p>
                            </div>
                            <button @click="removeFromCart(index)"
                                class="text-red-500 hover:text-red-700 font-bold text-2xl p-1 -mt-1">×</button>
                        </div>
                        
                        <!-- Opciones de Corte para Frutos Grandes -->
                        <div x-show="item.nuts.some(n => n.cutPreference)" class="mt-2 pt-2 border-t border-slate-300/60 flex justify-end">
    <button @click="openCutOptionsModal(index)" type="button" 
            class="border-2 border-indigo-600 hover:bg-indigo-600 text-indigo-700 hover:text-white text-xs font-bold px-4 py-2 rounded-lg inline-flex items-center gap-2 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
        </svg>
                <span>Opción de corte</span>
    </button>
</div>
                    </div>
                </template>
                <div x-show="cart.length > 0" class="flex justify-end items-center gap-4 mt-4">
                    <button @click="scrollToElement('#selection-tabs')" type="button"
                        class="font-bold py-2 px-4 rounded-lg bg-slate-200 hover:bg-slate-300 text-slate-700">Continuar
                        Seleccionando</button>
                    <button @click="scrollToElement('#order-section')" type="button"
                        class="font-bold py-2 px-4 rounded-lg bg-slate-700 hover:bg-slate-800 text-white shadow-lg">Proceder
                        a la Compra</button>
                </div>
            </div>
        </section>

        <!-- Sección de Pedido Final -->
        <div id="order-section" class="overflow-hidden transition-height"
            :style="cart.length > 0 ? 'max-height: 2000px' : 'max-height: 0'" x-show="!selectedNut && !selectedMix">
            <section class="mt-8 bg-white p-6 rounded-xl shadow-lg border border-slate-200">
                <form id="order-form" @submit.prevent="placeOrder">
                    <h2 class="text-2xl font-bold text-slate-800 mb-4">Completa tu Pedido</h2>
                    
                    <div class="mb-6">
                        <div class="bg-stone-100 p-4 rounded-lg space-y-4 border border-slate-200">
                            <h3 class="text-lg font-semibold text-slate-700">Información de Contacto</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label for="contact-name" class="block font-medium">Nombre de Contacto <span class="text-red-500">*</span></label>
                                    <input id="contact-name" type="text" x-model="contactInfo.name" required class="w-full border-slate-300 rounded-md shadow-sm">
                                </div>
                                <div>
                                    <label for="contact-phone" class="block font-medium">Celular de Contacto <span class="text-red-500">*</span></label>
                                    <input id="contact-phone" type="text" x-model="contactInfo.phone" @input="validatePhone()" maxlength="10" pattern="[0-9]*" inputmode="numeric" required class="w-full border-slate-300 rounded-md shadow-sm">
                                    <p x-show="contactInfo.phoneError" x-text="contactInfo.phoneError" class="text-red-500 text-sm mt-1" x-transition></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-slate-700 mb-3 text-center sm:text-left">Método de Entrega
                            <span class="text-red-500">*</span></h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <button type="button" @click="delivery.mode = 'domicilio'"
                                :class="{ 'bg-slate-700 text-white border-slate-700 shadow-lg': delivery.mode === 'domicilio', 'bg-white hover:bg-slate-50 text-slate-800 border-slate-300': delivery.mode !== 'domicilio' }"
                                class="w-full py-3 rounded-lg font-bold border-2 transition-all">Domicilio</button>
                            <button type="button" @click="delivery.mode = 'recoger'"
                                :class="{ 'bg-slate-700 text-white border-slate-700 shadow-lg': delivery.mode === 'recoger', 'bg-white hover:bg-slate-50 text-slate-800 border-slate-300': delivery.mode !== 'recoger' }"
                                class="w-full py-3 rounded-lg font-bold border-2 transition-all">Recoger</button>
                        </div>
                    </div>

                    <div x-show="delivery.mode === 'domicilio'" class="mb-6" x-transition>
                        <div class="bg-stone-100 rounded-lg space-y-4 border border-slate-200">
                            <h3 class="text-lg font-semibold text-slate-700">Información de Domicilio</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label for="address-part1" class="block font-medium">Dirección <span class="text-red-500">*</span></label>
                                    <div class="mt-1 flex items-center gap-2">
                                        <input id="address-part1" type="text" placeholder="Carrera 7" x-model="delivery.addressPart1" @input="updateFullAddress()" class="w-full border-slate-300 rounded-md shadow-sm">
                                        <span class="font-bold text-slate-500">#</span>
                                        <input type="text" placeholder="72" x-model="delivery.addressPart2" @input="updateFullAddress()" class="w-1/4 border-slate-300 rounded-md shadow-sm text-center">
                                        <span class="font-bold text-slate-500">-</span>
                                        <input type="text" placeholder="50" x-model="delivery.addressPart3" @input="updateFullAddress()" class="w-1/4 border-slate-300 rounded-md shadow-sm text-center">
                                    </div>
                                    <div class="mt-2 grid grid-cols-2 gap-4">
                                        <div>
                                            <label for="address-interior" class="block text-sm font-medium">Interior (Opcional)</label>
                                            <input id="address-interior" type="text" placeholder="Ej: 3" x-model="delivery.interior" @input="updateFullAddress()" class="w-full border-slate-300 rounded-md shadow-sm">
                                        </div>
                                        <div>
                                            <label for="address-apartment" class="block text-sm font-medium">Apartamento (Opcional)</label>
                                            <input id="address-apartment" type="text" placeholder="Ej: 101" x-model="delivery.apartment" @input="updateFullAddress()" class="w-full border-slate-300 rounded-md shadow-sm">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label for="locality-input" class="block font-medium">Localidad <span
                                            class="text-red-500">*</span></label>
                                    <select id="locality-input" x-model="delivery.locality" @change="updateDeliveryCost()"
                                        class="w-full border-slate-300 rounded-md shadow-sm">
                                        <option value="">Selecciona una localidad</option>
                                        <template x-for="locality in localities" :key="locality">
                                            <option :value="locality" x-text="locality"></option>
                                        </template>
                                    </select>
                                </div>
                            </div>
                            <div class="mt-4 pt-4 border-t border-slate-200 text-center text-sm text-slate-500 space-y-1">
                                <p>✨ <span class="font-bold">ENVIO GRATIS LOCALIDAD USAQUEN</span>.</p>
                                <p>✨ Domicilio <span class="font-bold">GRATIS</span> por compras superiores a <span
                                        class="font-bold">$200.000</span>.</p>
                                <p>✨ <span class="font-bold">50% de descuento</span> en domicilio para compras entre <span
                                        class="font-bold">$100.000</span> y <span class="font-bold">$199.999</span>.</p>
                            </div>
                        </div>
                    </div>

                    <div x-show="delivery.mode === 'recoger'"
                        class="space-y-4 mb-6 bg-stone-100 p-4 rounded-lg text-center border border-slate-200" x-transition>
                        <h3 class="text-lg font-semibold text-slate-700">Información de Recogida</h3>
                        <p class="text-slate-800">Puedes recoger tu pedido en la siguiente dirección:</p>
                        <p class="font-bold text-green-700 text-lg">Carrera 19 # 183-30 (Usaquén, Bogotá)</p>
                    </div>

                    <footer class="mt-8 pt-6 border-t">
                        <h3 class="text-xl font-bold text-slate-800 mb-4">Resumen Final</h3>
                        <div class="bg-stone-100 p-4 rounded-lg space-y-2 border border-slate-200">
                            <div class="flex justify-between"><span class="text-slate-600">Subtotal Compra</span><span
                                    class="font-semibold" x-text="formatCurrency(finalSummary.subtotal)"></span></div>
                            <div class="flex justify-between"><span class="text-slate-600">Costo Domicilio</span><span
                                    class="font-semibold" x-text="formatCurrency(finalSummary.deliveryCostRaw)"></span>
                            </div>
                            <div x-show="finalSummary.discount > 0" class="flex justify-between text-green-700"><span
                                    class="text-green-700">Descuento Domicilio</span><span class="font-semibold"
                                    x-text="'- ' + formatCurrency(finalSummary.discount)"></span></div>
                            <hr class="my-1 border-slate-300">
                            <div class="flex justify-between text-xl font-bold"><span class="">Total a Pagar</span><span
                                    x-text="formatCurrency(finalSummary.total)"></span></div>
                        </div>
                        <div class="mt-6"><button type="submit" :disabled="!isOrderButtonEnabled"
                                class="w-full text-white font-bold py-3 px-4 rounded-lg transition-all"
                                :class="{'bg-slate-700 hover:bg-slate-800 shadow-lg': isOrderButtonEnabled, 'bg-slate-300 cursor-not-allowed': !isOrderButtonEnabled}"><span
                                    x-text="formStatus"></span></button></div>
                    </footer>
                </form>
            </section>
        </div>

        
        <!-- Pre-Confirmation Modal -->
        <div x-show="showPreConfirmationModal" @keydown.escape.window="showPreConfirmationModal = false"
            class="fixed inset-0 z-[100] flex items-center justify-center bg-black bg-opacity-60 p-4">
            <div @click.away="showPreConfirmationModal = false"
                class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md text-center">
                <p class="text-slate-700 mb-6 text-lg">Estás a un paso de finalizar. Una vez confirmado, tu pedido será
                    enviado para ser procesado. ¿Deseas continuar?</p>
                <div class="flex justify-center gap-4">
                    <button @click="showPreConfirmationModal = false" type="button"
                        class="font-bold py-2 px-6 rounded-lg bg-slate-200 hover:bg-slate-300 text-slate-700">Volver y
                        revisar</button>
                    <button @click="executeOrder()" type="button"
                        class="font-bold py-2 px-6 rounded-lg bg-slate-700 hover:bg-slate-800 text-white shadow-lg">Confirmar
                        Pedido</button>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div x-show="showConfirmationModal" @keydown.escape.window="closeConfirmationModal()"
            class="fixed inset-0 z-[100] flex items-center justify-center bg-black bg-opacity-60 p-4">
            <div @click.away="closeConfirmationModal()"
                class="bg-white rounded-lg shadow-xl p-8 w-full max-w-2xl max-h-screen overflow-y-auto text-center">
                <h2 class="text-3xl font-elegant font-bold text-green-700 mb-4" x-text="confirmationDetails.title"></h2>
                <p class="text-slate-700 mb-6" x-html="confirmationDetails.message"></p>
                <div class="bg-stone-100 border border-slate-200 rounded-lg p-4 text-left text-sm whitespace-pre-wrap font-mono"
                    x-text="confirmationDetails.summary"></div>
                <button @click="closeConfirmationModal()"
                    class="mt-8 w-full sm:w-auto px-8 py-2 bg-slate-700 text-white font-bold rounded-lg shadow-md hover:bg-slate-800">Hacer otra Compra</button>
            </div>
        </div>

    <!-- MODAL DE OPCIONES DE CORTE (NUEVO) -->
    <div x-show="showCutOptionsModal"
     @keydown.escape.window="closeCutOptionsModal()"
     class="fixed inset-0 z-[150] flex items-center justify-center bg-black bg-opacity-60 p-4" x-cloak>
    <div @click.away="closeCutOptionsModal()" class="bg-white rounded-lg shadow-xl w-full max-w-md">
        <div class="p-6">
            <h3 class="text-lg font-bold text-slate-800 mb-4" x-text="`Ajuste ${editingCartItem?.name || ''}`"></h3>
            <div class="space-y-4">
                <template x-for="nut in editingCartItem?.nuts" :key="nut.name">
                    <div x-show="nut.cutPreference" class="flex items-center justify-between text-sm">
                        <span class="text-slate-600 font-medium" x-text="`${nut.name.split(' ')[0]}:`"></span>
                        <div class="inline-flex rounded-md shadow-sm" role="group">
                            <button type="button" @click="nut.cutPreference = 'Entero'"
                                    :class="{'bg-indigo-700 text-white': nut.cutPreference === 'Entero', 'bg-white text-slate-700 hover:bg-slate-50': nut.cutPreference !== 'Entero'}"
                                    class="px-3 py-1 text-xs font-semibold border border-slate-300 rounded-l-lg transition-colors">
                                Entero
                            </button>
                            <button type="button" @click="nut.cutPreference = 'Corte en Trozos'"
                                    :class="{'bg-indigo-700 text-white': nut.cutPreference === 'Corte en Trozos', 'bg-white text-slate-700 hover:bg-slate-50': nut.cutPreference !== 'Corte en Trozos'}"
                                    class="px-3 py-1 text-xs font-semibold border-t border-b border-r border-slate-300 rounded-r-lg transition-colors">
                                Corte en Trozos
                            </button>
                        </div>
                    </div>
                </template>
            </div>
        </div>
        <div class="bg-slate-50 px-6 py-3 flex justify-end">
            <button @click="closeCutOptionsModal()" class="font-bold py-2 px-6 rounded-lg bg-slate-700 hover:bg-slate-800 text-white shadow-lg">
                Aceptar
            </button>
        </div>
    </div>
</div>

    <!-- WhatsApp Floating Button with Visible Text -->
    <a href="https://wa.me/573123526839?text=Hola%2C%20necesito%20ayuda%20con%20mi%20mezcla%20de%20frutos%20secos."
        target="_blank" rel="noopener noreferrer"
        class="fixed bottom-20 right-4 sm:right-6 flex items-center gap-3 bg-white p-3 rounded-full shadow-lg z-40 transition-transform transform hover:scale-105 border border-slate-200">

        <span class="hidden sm:inline font-semibold text-slate-800">¿Ayuda?</span>

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="w-8 h-8 text-green-600">
            <path fill="currentColor"
                d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zM223.9 439.6c-38.2 0-73.7-11.8-103.6-32.5L100 419.5l-2.3-1.4-86.8 22.7L32.6 351.6c-19.8-31.5-31.5-68.4-31.5-107.6 0-110.3 89.7-200 200-200 55.1 0 105.9 21.6 143.4 59.1 37.5 37.5 59.1 88.3 59.1 143.4-.1 110.4-89.8 200-200.1 200zM324.9 288c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z" />
        </svg>
    </a>

    <script>
        function mixBuilder() {
            return {
                activeTab: 0,
                activeSubTab: 0,
                selectedIndividualNutName: null,
                totalGramsForPercentage: 0,
                nuts: [],
                largeFruits: [ // Array para identificar frutos grandes
                    'Albaricoque Turco seco (Sin azúcar añadida)',
                    'Higo Turco seco (Sin azúcar añadida)',
                    'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)'
                ],
                productFilter: 'Todos',
                searchQuery: '',
                mixSearchQuery: '',
                vitalMixSearchQuery: '',
                justAdded: false,
                predefinedMixes: [],
                localities: [
                    'Usaquén', 'Chapinero', 'Santa Fe', 'San Cristóbal', 'Usme', 'Tunjuelito', 'Bosa', 'Kennedy',
                    'Fontibón', 'Engativá', 'Suba', 'Barrios Unidos', 'Teusaquillo', 'Los Mártires', 'Antonio Nariño',
                    'Puente Aranda', 'La Candelaria', 'Rafael Uribe Uribe', 'Ciudad Bolívar', 'Sumapaz'
                ],
                cart: [],
                showOrderSection: false,
                contactInfo: { name: '', phone: '', phoneError: '' },
                delivery: { 
                    mode: 'domicilio', 
                    address: '',        
                    addressPart1: '',   
                    addressPart2: '',   
                    addressPart3: '',   
                    interior: '',       
                    apartment: '',      
                    locality: '', 
                    distance: null, 
                    cost: 0, 
                    status: '', 
                    error: false, 
                    isLoading: false 
                },
                formStatus: 'Confirmar Pedido',
                showConfirmationModal: false,
                showPreConfirmationModal: false,
                selectedNut: null,
                selectedMix: null,
                showImageModal: false,
                modalImageUrl: '',
                showAlert: false,
                alertMessage: '',
                confirmationDetails: { title: '', message: '', summary: '' },
                orderCounter: 1,
                mode: 'builder',
                showCutOptionsModal: false,
                editingCartItemIndex: null,

                get editingCartItem() {
                    if (this.editingCartItemIndex === null) return null;
                    return this.cart[this.editingCartItemIndex];
                },

                openCutOptionsModal(index) {
                    this.editingCartItemIndex = index;
                    this.showCutOptionsModal = true;
                },

                closeCutOptionsModal() {
                    this.editingCartItemIndex = null;
                    this.showCutOptionsModal = false;
                },

                handleEscape() { // <-- Esta función ya existe, solo añade la nueva condición
                    if (this.showImageModal) {
                        this.closeImageModal();
                    } else if (this.customization.showModal) {
                        this.closeCustomizationModal();
                    } else if (this.selectedMix) {
                        this.closeMixDetail();
                    } else if (this.selectedNut) {
                        this.backToBuilder();
                    } else if (this.showCutOptionsModal) { // <-- AÑADE ESTA LÍNEA
                        this.closeCutOptionsModal();      // <-- AÑADE ESTA LÍNEA
                    }
                },
                
                // START: Customization Modal State
                customization: {
                    showModal: false,
                    mix: null,
                    totalGrams: 0,
                    nutToAdd: '',
                    get totalPercentage() {
                        if (!this.mix || !this.mix.ingredients) return 0;
                        return this.mix.ingredients.reduce((acc, ing) => acc + (Number(ing.percentage) || 0), 0);
                    },
                    get cost() {
                        if (!this.mix || !this.mix.ingredients || this.totalGrams === 0) return 0;
                        let subtotal = 0;
                        this.mix.ingredients.forEach(ingredient => {
                            const nutData = this.getNutByName(ingredient.name);
                            if(nutData) {
                                const grams = this.totalGrams * ((Number(ingredient.percentage) || 0) / 100);
                                subtotal += grams * nutData.price;
                            }
                        });
                        return Math.round(subtotal);
                    }
                },
                // END: Customization Modal State

                get filteredNuts() {
                    if (!this.mixSearchQuery.trim()) {
                        return this.nuts;
                    }
                    const normalizedQuery = this.normalizeText(this.mixSearchQuery);
                    return this.nuts.filter(nut => 
                        this.normalizeText(nut.name).includes(normalizedQuery)
                    );
                },

                get filteredPredefinedMixes() {
                    if (!this.vitalMixSearchQuery.trim()) {
                        return this.predefinedMixes;
                    }
                    const normalizedQuery = this.normalizeText(this.vitalMixSearchQuery);
                    return this.predefinedMixes.filter(mix => {
                        const inName = this.normalizeText(mix.name).includes(normalizedQuery);
                        const inSubtitle = this.normalizeText(mix.subtitle).includes(normalizedQuery);
                        return inName || inSubtitle;
                    });
                },

                getNutByName(name) {
                    return this.nuts.find(n => n.name === name);
                },

                get availableNutsForCustomization() {
                    if (!this.customization.mix) return this.nuts;
                    const currentIngredients = this.customization.mix.ingredients.map(ing => ing.name);
                    return this.nuts.filter(nut => !currentIngredients.includes(nut.name) && nut.name !== 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Con cáscara)');
                },

                get isCustomizationValid() {
                    return this.customization.totalGrams >= 100 && this.customization.totalPercentage === 100;
                },

                openCustomizationModal(mix) {
                    if (!mix.gramsToAdd || mix.gramsToAdd < 100) return;
                    this.customization.mix = JSON.parse(JSON.stringify({
                        id: mix.id,
                        name: mix.name,
                        ingredients: mix.proportions.map(p => ({name: p.name, percentage: p.percentage}))
                    }));
                    this.customization.totalGrams = mix.gramsToAdd;
                    this.customization.nutToAdd = '';
                    this.customization.showModal = true;
                },

                closeCustomizationModal() {
                    this.customization.showModal = false;
                    this.customization.mix = null;
                },

                addCustomIngredient() {
                    if (this.customization.nutToAdd && !this.customization.mix.ingredients.some(ing => ing.name === this.customization.nutToAdd)) {
                        this.customization.mix.ingredients.push({
                            name: this.customization.nutToAdd,
                            percentage: 0
                        });
                        this.customization.nutToAdd = '';
                    }
                },

                removeCustomIngredient(index) {
                    this.customization.mix.ingredients.splice(index, 1);
                },

                addCustomMixToCart() {
                    if (!this.isCustomizationValid) return;
                    
                    const totalGrams = this.customization.totalGrams;
                    let subtotal = 0;
                    const nutsInMix = this.customization.mix.ingredients.map(p => {
                        const nutData = this.nuts.find(n => n.name === p.name);
                        const grams = totalGrams * (p.percentage / 100);
                        subtotal += grams * nutData.price;
                        
                        let nutObject = { name: p.name, grams: grams };
                        if(this.largeFruits.includes(p.name)) {
                            nutObject.cutPreference = 'Entero'; // Añade la opción de corte
                        }
                        return nutObject;
                    });

                    let discountPercentage = 0;
                    if (totalGrams >= 750) discountPercentage = 5;

                    const discount = subtotal * (discountPercentage / 100);
                    const cost = subtotal - discount;

                    this.cart.push({
                        name: `${this.customization.mix.name} (Personalizado)`,
                        nuts: nutsInMix,
                        totalGrams: totalGrams,
                        cost: Math.round(cost),
                        discount: Math.round(discount),
                        discountPercentage: discountPercentage
                    });
                    
                    const originalMix = this.predefinedMixes.find(pm => pm.id === this.customization.mix.id);
                    if(originalMix) originalMix.gramsToAdd = 0;
                    
                    this.closeCustomizationModal();
                    this.$nextTick(() => this.scrollToElement('#cart'));
                },


                normalizeText(text) {
                    if (!text) return '';
                    return text
                        .toLowerCase()
                        .normalize('NFD') 
                        .replace(/[\u0300-\u036f]/g, '');
                },

                init() {
                    this.resetBuilder();
                    this.orderCounter = parseInt(localStorage.getItem('nutMixOrderCounter_v2')) || 1;
                },
                triggerAlert(message) {
                    this.alertMessage = message;
                    this.showAlert = true;
                    setTimeout(() => {
                        this.showAlert = false;
                    }, 4000);
                },

                openImageModal(imageUrl) {
                    this.modalImageUrl = imageUrl;
                    this.showImageModal = true;
                },
                closeImageModal() {
                    this.showImageModal = false;
                },

                updateFullAddress() {
                    let fullAddress = '';
                    if (this.delivery.addressPart1 && this.delivery.addressPart2 && this.delivery.addressPart3) {
                        fullAddress += `${this.delivery.addressPart1} # ${this.delivery.addressPart2} - ${this.delivery.addressPart3}`;
                    }
                    if (this.delivery.interior) {
                        fullAddress += ` Int. ${this.delivery.interior}`;
                    }
                    if (this.delivery.apartment) {
                        fullAddress += ` Apto. ${this.delivery.apartment}`;
                    }
                    this.delivery.address = fullAddress.trim();
                    this.updateDeliveryCost();
                },

                updateDeliveryCost() {
                    if (!this.delivery.locality) {
                        this.delivery.cost = 0;
                        return;
                    }
                    const locality = this.delivery.locality;
                    if (['Usaquén'].includes(locality)) {
                        this.delivery.cost = 0;
                    } else if (['Suba'].includes(locality)) {
                        this.delivery.cost = 2500;
                    } else if (['Barrios Unidos', 'Chapinero', 'Teusaquillo'].includes(locality)) {
                        this.delivery.cost = 4000;
                    } else {
                        this.delivery.cost = 7000;
                    }
                },
                viewMix(mix) {
                    this.selectedMix = mix;
                },
                closeMixDetail() {
                    this.selectedMix = null;
                },

                validatePhone() {
                    this.contactInfo.phone = this.contactInfo.phone.replace(/[^0-9]/g, '');
                    if (this.contactInfo.phone.length > 0 && this.contactInfo.phone.length !== 10) {
                        this.contactInfo.phoneError = 'El celular debe tener exactamente 10 dígitos.';
                    } else {
                        this.contactInfo.phoneError = '';
                    }
                },

                handleIndividualSelection(changedNut) {
                    if (changedNut.grams > 0) {
                        this.selectedIndividualNutName = changedNut.name;
                    } else {
                        this.selectedIndividualNutName = null;
                    }
                },

                changeSubTab(tabIndex) {
                    this.activeSubTab = tabIndex;
                    this.selectedIndividualNutName = null;
                    this.nuts.forEach(nut => {
                        nut.grams = 0;
                        nut.percentage = 0;
                    });
                    this.totalGramsForPercentage = 0;
                },
                
                getPriceDisplay(nut) {
                    return `${this.formatCurrency(nut.price)}/gr`;
                },

                get currentMix() {
                    let totalGrams = 0, subtotal = 0, cost = 0, discount = 0, discountPercentage = 0, totalPercentage = 0;
                    let nutsInMix = [];

                    if (this.activeSubTab === 0 || this.activeSubTab === 2) {
                        this.nuts.forEach(nut => {
                            const grams = Number(nut.grams) || 0;
                            if (grams > 0) {
                                totalGrams += grams;
                                subtotal += grams * nut.price;
                                let nutObject = { name: nut.name, grams: grams };
                                if(this.largeFruits.includes(nut.name)) {
                                    nutObject.cutPreference = 'Entero';
                                }
                                nutsInMix.push(nutObject);
                            }
                        });
                    } else {
                        totalGrams = Number(this.totalGramsForPercentage) || 0;
                        totalPercentage = this.nuts.reduce((acc, nut) => acc + (Number(nut.percentage) || 0), 0);
                        this.nuts.forEach(nut => {
                            const grams = totalGrams * ((Number(nut.percentage) || 0) / 100);
                            if (grams > 0) {
                                subtotal += grams * nut.price;
                                let nutObject = { name: nut.name, grams: grams };
                                if(this.largeFruits.includes(nut.name)) {
                                    nutObject.cutPreference = 'Entero';
                                }
                                nutsInMix.push(nutObject);
                            }
                        });
                    }

                    if (totalGrams >= 750) { discountPercentage = 5; discount = subtotal * 0.05; }
                    
                    cost = subtotal - discount;
                    return { totalGrams, subtotal: Math.round(subtotal), discount: Math.round(discount), discountPercentage, cost: Math.round(cost), totalPercentage, nuts: nutsInMix };
                },

                get isActionEnabled() {
                    if (this.activeSubTab === 0) {
                        return this.currentMix.totalGrams > 0;
                    }
                    if (this.activeSubTab === 1) {
                        return this.currentMix.totalPercentage === 100 && this.currentMix.totalGrams > 0;
                    }
                    if (this.activeSubTab === 2) {
                        return this.currentMix.totalGrams > 0 && this.selectedIndividualNutName !== null;
                    }
                    return false;
                },

                scrollToElement(selector) {
                    document.querySelector(selector).scrollIntoView({ behavior: 'smooth' });
                },

                addToCart() {
                    if (!this.isActionEnabled) return;
                    
                    let newPurchase;
                    const current = this.currentMix;

                    const mixType = this.activeSubTab === 0 ? 'Mezcla por Cantidad' : 'Mezcla por Porcentaje';
                    const mixCount = this.cart.filter(item => item.name.startsWith(mixType)).length + 1;
                    newPurchase = {
                        ...current,
                        name: `${mixType} #${mixCount}`
                    };
                    
                    this.cart.push(newPurchase);

                    this.justAdded = true;
                    setTimeout(() => { this.justAdded = false; }, 2000);

                    this.changeSubTab(this.activeSubTab);
                    this.$nextTick(() => this.scrollToElement('#cart'));
                },
                
                addIndividualToCart(nut) {
                    if (!nut || !nut.grams || nut.grams <= 0) return;

                    const totalGrams = nut.grams;
                    const subtotal = totalGrams * nut.price;
                    
                    let discountPercentage = 0;
                    if (totalGrams >= 750) {
                        discountPercentage = 5;
                    }
                    
                    const discount = subtotal * (discountPercentage / 100);
                    const cost = subtotal - discount;

                    let nutObject = { name: nut.name, grams: totalGrams };
                    if(this.largeFruits.includes(nut.name)) {
                        nutObject.cutPreference = 'Entero';
                    }
                    
                    const mixType = 'A granel';
                    const mixCount = this.cart.filter(item => item.name.startsWith(mixType)).length + 1;

                    const newPurchase = {
                        name: `${mixType} #${mixCount}`,
                        nuts: [nutObject],
                        totalGrams: totalGrams,
                        cost: Math.round(cost),
                        discount: Math.round(discount),
                        discountPercentage: discountPercentage
                    };

                    this.cart.push(newPurchase);

                    nut.justAddedIndividual = true;
                    setTimeout(() => {
                        nut.justAddedIndividual = false;
                    }, 2500);

                    nut.grams = 0;
                    this.selectedIndividualNutName = null;

                    this.$nextTick(() => this.scrollToElement('#cart'));
                },

                addPredefinedMixToCart(mix) {
                    const totalGrams = mix.gramsToAdd;
                    if (!totalGrams || totalGrams < 100) {
                        this.triggerAlert('Por favor, ingresa una cantidad de al menos 100 gramos.');
                        return;
                    }
                    let subtotal = 0;
                    const nutsInMix = mix.proportions.map(p => {
                        const nutData = this.nuts.find(n => n.name === p.name);
                        const grams = totalGrams * (p.percentage / 100);
                        subtotal += grams * nutData.price;
                        
                        let nutObject = { name: p.name, grams: grams };
                        if(this.largeFruits.includes(p.name)) {
                            nutObject.cutPreference = 'Entero';
                        }
                        return nutObject;
                    });

                    let discountPercentage = 0;
                    if (totalGrams >= 750) discountPercentage = 5;

                    const discount = subtotal * (discountPercentage / 100);
                    const cost = subtotal - discount;

                    this.cart.push({
                        name: mix.name,
                        nuts: nutsInMix,
                        totalGrams: totalGrams,
                        cost: Math.round(cost),
                        discount: Math.round(discount),
                        discountPercentage: discountPercentage
                    });

                    mix.gramsToAdd = 0;
                    this.$nextTick(() => this.scrollToElement('#cart'));
                },
                
                resetBuilder() {
                    this.nuts = [
                        { name: 'Albaricoque Turco seco (Sin azúcar añadida)', price: 130, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Deshidratados', imageUrl: 'https://i.ibb.co/LD7JnWBT/rev1-albaricoque.jpg', origin: 'Turquía', ingredients: '100% Albaricoque', description: `<strong>• Origen Insuperable:</strong> Proviene de Turquía, el productor número uno y de mayor prestigio del mundo. Este origen es garantía de un albaricoque de calidad superior, carnoso y lleno de sabor.<br><strong>• Dulzura Natural y Toque Ácido:</strong> Famoso por su sabor dulce y meloso, perfectamente equilibrado con un ligero toque ácido que lo hace refrescante y delicioso. Todo su dulzor es 100% natural, sin azúcares añadidos.<br><strong>• Rico en Vitamina A y Hierro:</strong> Es una potencia nutricional, especialmente conocido por su alto contenido de Betacaroteno (que el cuerpo convierte en Vitamina A), esencial para la salud de la piel y la vista, además de ser una buena fuente de hierro.<br><strong>• Textura Tierna y Carnosa:</strong> A diferencia de albaricoques de otros orígenes que pueden ser más secos, el turco se caracteriza por su textura suave, carnosa y muy agradable de morder, ideal como snack o para rehidratar en recetas.`, benefits: `<strong>• Excelente para la Salud Digestiva:</strong> Son muy ricos en fibra, lo que los convierte en un remedio natural y eficaz para aliviar el estreñimiento y promover un tránsito intestinal regular.<br><strong>• Combate la Anemia y da Energía:</strong> Aportan una buena cantidad de hierro y cobre, minerales esenciales para la formación de glóbulos rojos. Además, sus carbohidratos naturales proporcionan una fuente de energía saludable y sostenida.<br><strong>• Protector de la Visión y la Piel:</strong> Son una fuente destacada de Vitamina A (en forma de betacaroteno), un antioxidante clave para mantener una buena salud ocular y proteger la piel del daño celular.<br><strong>• Regulador de la Presión Arterial:</strong> Su alto contenido de potasio ayuda a equilibrar los fluidos en el cuerpo y a relajar los vasos sanguíneos, lo que contribuye a mantener la presión arterial bajo control.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/BHgJdR61/TNUTalbaricoque.jpg" alt="TNUTalbaricoque" border="0" width="295" height="291" /></div></div>` },
			            { name: 'Almendra Americana NPX laminada natural sin cutícula', price: 98, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/LDT0KCNd/rev1-almendra-laminada.jpg', origin: 'Estados Unidos', ingredients: '100% Almendra NPX Laminada sin cutícula', description: `<strong>• Origen Premium:</strong> De los fértiles valles de California, el líder mundial en producción de almendras de alta calidad.<br><strong>• La Mejor Variedad:</strong> Seleccionamos la almendra Nonpareil (NPX), famosa por su sabor dulce superior y textura mantecosa.<br><strong>• Sabor Puro:</strong> Al ser laminada sin piel (cutícula), garantizamos una experiencia de sabor limpia, delicada y sin amargor.<br><strong>• Versatilidad Gourmet:</strong> Su laminado fino es perfecto para repostería, ensaladas o para añadir un toque crujiente y elegante a cualquier creación.`, benefits: `<strong>• Salud Cardiovascular:</strong> Son ricas en grasas monoinsaturadas (grasas "buenas") que ayudan a reducir el colesterol malo (LDL) y a mantener el bueno (HDL). Su contenido de magnesio y vitamina E también favorece la salud del corazón y la presión arterial.<br><strong>• Control del Azúcar en Sangre:</strong> Tienen un bajo índice glucémico y son una excelente fuente de magnesio, un mineral crucial para regular el azúcar en la sangre. Son un snack ideal para personas con diabetes o resistencia a la insulina.<br><strong>• Energía Sostenida y Salud Cerebral:</strong> Aportan proteínas y grasas saludables que proporcionan energía duradera sin causar picos de azúcar. La vitamina E que contienen es un potente antioxidante que protege las células del cerebro del estrés oxidativo.<br><strong>• Fortalecimiento de los Huesos:</strong> Son una buena fuente de calcio, magnesio y fósforo, minerales esenciales para construir y mantener unos huesos fuertes y sanos.<br><strong>• Facilita la Digestión:</strong> Al no tener cutícula (la piel marrón), son más fáciles de digerir para personas con estómagos sensibles, permitiendo absorber sus nutrientes de manera más suave.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><href="https://ibb.co/twKyPZZ8"><img src="https://i.ibb.co/Cp8xsJJh/TNUTalmedralamina.jpg" alt="TNUTalmedralamina" border="0" width="295" height="291"/></div></div>` },
                        { name: 'Almendra Americana NPX natural', price: 87, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/mVj6RVpY/rev1-almendra-natural.jpg', origin: 'Estados Unidos', ingredients: '100% Almendra NPX', description: `<strong>• Origen de Élite:</strong> Cultivada en California, EE. UU., el estándar de oro mundial que garantiza la máxima calidad y consistencia.<br><strong>• La Variedad "Reina":</strong> Seleccionamos la variedad Nonpareil (NPX), famosa por su sabor dulce superior y cero amargor.<br><strong>• Textura Perfecta: </strong> Ofrece una mordida crujiente pero suave, ideal tanto para comer como snack directo como para ingrediente en recetas.<br><strong>• Máximo Nutriente: </strong> Al conservar su piel natural, te beneficias de toda su fibra, antioxidantes y Vitamina E.<br><strong>• Calidad Confiable: </strong> Respaldada por la industria más avanzada del mundo, asegurando un producto seguro y de calibre premium en cada almendra.`, benefits: `<strong>• Potente Protector Cardiovascular: </strong> Ricas en grasas saludables y antioxidantes (concentrados en su piel), que ayudan a reducir el colesterol malo (LDL) y a proteger las arterias.<br><strong>• Salud Digestiva y Efecto Prebiótico: </strong> La piel de la almendra es una excelente fuente de fibra prebiótica, que alimenta a las bacterias buenas del intestino, mejorando la digestión y la salud general del microbioma.<br><strong>• Excelente Regulador del Azúcar: </strong> Su alto contenido de fibra, grasas saludables y magnesio ayuda a ralentizar la absorción de azúcar, evitando picos glucémicos y siendo un snack ideal para el control de peso y la diabetes.<br><strong>• Fortaleza para Huesos y Cerebro: </strong> Son una gran fuente de calcio y magnesio para mantener unos huesos fuertes, y su alta dosis de vitamina E funciona como un potente antioxidante que protege las células cerebrales.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/5WPBZdtf/TNUTalmendranatural.jpg" alt="TNUTalmendranatural" border="0" width="295" height="291"/></div></div>` },
                        { name: 'Arándano deshidratado Americano Ocean Spray (Con azúcar añadida)', price: 59, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Deshidratados', imageUrl: 'https://i.ibb.co/8gqXK5g9/rev1-arandano.jpg', origin: 'Estados Unidos', ingredients: 'Arándano, Azúcar y aceite de girasol', description: `<strong>• Calidad de Marca Líder Mundial:</strong> Respaldado por Ocean Spray, los maestros del arándano. Este nombre es sinónimo de confianza y calidad superior, utilizando los mejores frutos cultivados en Estados Unidos, su tierra natal.<br><strong>• Sabor Icónico y Perfectamente Equilibrado:</strong> El arándano es naturalmente muy ácido; el ligero toque de azúcar añadido es la firma de Ocean Spray para equilibrar esa acidez, creando el delicioso y adictivo sabor agridulce que los ha hecho famosos en todo el mundo.<br><strong>• Concentrado en Bienestar:</strong> A pesar de ser un snack delicioso, sigue siendo una fuente concentrada de proantocianidinas (PACs), los antioxidantes únicos del arándano conocidos por ayudar a mantener la salud del tracto urinario.<br><strong>• Textura Tierna y Color Vibrante:</strong> Posee una textura masticable y jugosa inconfundible y un intenso color rojo que lo convierten en el ingrediente ideal para dar vida, sabor y un toque gourmet a ensaladas, granolas, productos horneados y tus propias mezclas.`, benefits: `<strong>• Salud del Tracto Urinario:</strong> Su beneficio más conocido. Contienen proantocianidinas (PACs), compuestos que ayudan a prevenir que bacterias como la E. coli se adhieran a las paredes del tracto urinario, reduciendo el riesgo de infecciones.<br><strong>• Ricos en Antioxidantes:</strong> Aportan polifenoles y flavonoides que combaten el daño de los radicales libres en el cuerpo, contribuyendo a la salud celular y cardiovascular.<br><strong>• Fuente de Fibra Dietética:</strong> A pesar del proceso, conservan fibra que favorece la digestión y la salud intestinal.<br><strong>• Fuente Rápida de Energía:</strong> El azúcar (tanto natural como añadido) los convierte en una fuente de energía rápida, útil antes de una actividad física, por ejemplo.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/hRLRTwxd/TNUTarandano.jpg" alt="TNUTarandano" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Avellana Turca natural con piel', price: 130, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/Hpd55yQ7/rev1-avellana.jpg', origin: 'Turquía', ingredients: '100% Avellana con piel', description: `<strong>• Origen Insuperable:</strong> Proviene de Turquía, la "Capital Mundial de la Avellana". Este origen  garantiza una calidad y tradición inigualables, ya que son los mayores y más expertos productores del mundo.<br><strong>• Sabor Intenso y Aromático: </strong> Famosa por su perfil de sabor rico, mantecoso y profundo, es la avellana preferida por los chocolateros y pasteleros más prestigiosos de Europa.<br><strong>• Nutrición Completa: </strong> Al conservar su piel natural, obtienes un extra de fibra y antioxidantes, además de un sabor más rústico y completo que el de las avellanas peladas.<br><strong>• El Estándar de Oro: </strong> Mientras otras regiones producen avellanas de gran calidad, la turca es el estándar global por su equilibrio perfecto entre sabor, aceite y textura, convirtiéndola en la más versátil y demanda.`, benefits: `<strong>• Potente Protector del Corazón: </strong> Son muy ricas en grasas monoinsaturadas (saludables) que ayudan a reducir el colesterol malo (LDL). Además, su magnesio y potasio contribuyen a regular la presión arterial.<br><strong>• Poderoso Efecto Antioxidante y Antiinflamatorio: </strong> La piel de la avellana está cargada de antioxidantes (compuestos fenólicos) que combaten el daño celular y reducen la inflamación en el cuerpo, ayudando a prevenir enfermedades crónicas.<br><strong>• Apoyo a la Salud Cerebral y Nerviosa: </strong> Su alto contenido de Vitamina E, manganeso y folato (Vitamina B9) contribuye a mejorar la función cognitiva y a proteger las neuronas del envejecimiento.<br><strong>• Fuente de Energía y Fortalecimiento Óseo: </strong> Aportan grasas saludables y proteínas para una energía duradera, y su alto contenido de manganeso es esencial para la salud y densidad de los huesos.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/5hBnK7Dj/TNUTavellana.jpg" alt="TNUTavellana" border="0" width="295" height="291"/></div></div>` },
                        { name: 'Baya Tibetana de Goji', price: 129, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Deshidratados', imageUrl: 'https://i.ibb.co/Y5MZ0XP/rev1-baya-goji.jpg', origin: 'China', ingredients: '100% Baya de Goji', description: `<strong>• Origen Milenario del Himalaya:</strong> Proviene de las regiones de gran altitud de China (Meseta Tibetana), la cuna de la Medicina Tradicional China. Este origen extremo y puro es clave para su legendaria concentración de nutrientes.<br><strong>• Potencia Antioxidante Superior:</strong> Considerada un tesoro para la longevidad, es excepcionalmente rica en antioxidantes, especialmente en Zeaxantina, un compuesto vital para proteger la salud visual y la retina del daño solar.<br><strong>• Refuerzo Inmunitario y Vitalidad:</strong> Es una de las nueces con mayor contenido de antioxidantes, que protegen las células del cuerpo. Además, está cargada de grasas monoinsaturadas, beneficiosas para la salud del corazón.<br><strong>• Sabor Único y Energizante:</strong> Ofrece un sabor inconfundible, con un balance perfecto entre dulce y un toque ligeramente ácido. Su textura masticable la hace ideal para añadir a yogures, batidos, tés o ensaladas, aportando un impulso de sabor y nutrición que no encontrarás en bayas comunes.`, benefits: `<strong>• Potente Poder Antioxidante y Antienvejecimiento:</strong> Cargadas de antioxidantes únicos (como la zeaxantina) que combaten el daño celular, reducen la inflamación y ayudan a mantener una piel joven y saludable.<br><strong>• Fortalecimiento del Sistema Inmune:</strong> Su altísima concentración de Vitamina C y Vitamina A es clave para estimular las defensas del cuerpo, ayudando a prevenir resfriados y otras infecciones.<br><strong>• Protección de la Salud Visual:</strong> Son una de las fuentes más ricas en zeaxantina y luteína, antioxidantes que se acumulan en la retina, protegiendo los ojos de la luz azul y del deterioro asociado a la edad.<br><strong>• Fuente de Energía Natural y Estado de Ánimo:</strong> Aportan un complejo de vitaminas B, fibra y minerales que ayudan a convertir los alimentos en energía de manera eficiente, combatiendo la fatiga y mejorando el estado de ánimo.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/zWQ9LhCt/TNUTvaydegoji.jpg" alt="TNUTvaydegoji" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', price: 67, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Deshidratados', imageUrl: 'https://i.ibb.co/LdwbZYbX/rev1-datiles.jpg', origin: 'Irán', ingredients: '100% Dátil Sayer', description: `<strong>• Origen Persa de Prestigio:</strong> Proviene de Irán, una de las cunas históricas del cultivo de dátiles. Este origen milenario garantiza una calidad y un perfil de sabor auténtico y muy apreciado.<br><strong>• Dulzura Natural a Caramelo:</strong> La variedad Sayer es famosa por su intensa dulzura natural con claras notas a caramelo y toffee, convirtiéndolo en el endulzante saludable perfecto, sin ningún tipo de azúcar añadido.<br><strong>• Textura Suave y Masticable:</strong> Ofrece una textura semi-seca, firme pero tierna y muy agradable de masticar, que no es tan pegajosa como la de otras variedades (como el Medjool), haciéndola ideal para picar o añadir a recetas.<br><strong>• Máxima Conveniencia y Energía:</strong> Al venir sin semilla, está listo para consumir o usar en batidos, postres y barras energéticas. Es una fuente increíble de energía de liberación rápida y fibra, ideal para deportistas o para calmar un antojo de forma saludable.`, benefits: `<strong>• Fuente de Energía Natural e Inmediata:</strong> Gracias a sus azúcares naturales (glucosa y fructosa), son un snack perfecto para combatir la fatiga y obtener un impulso de energía rápido y saludable, ideal para antes de hacer ejercicio.<br><strong>• Excelente para la Salud Digestiva:</strong> Son muy ricos en fibra dietética, lo que ayuda a prevenir el estreñimiento, promueve la regularidad intestinal y alimenta a las bacterias buenas del intestino.<br><strong>• Rico en Minerales para Huesos y Corazón:</strong> Aportan minerales esenciales como el potasio, que ayuda a regular la presión arterial, y el magnesio y fósforo, que son vitales para mantener la salud y fortaleza de los huesos.<br><strong>• Alternativa Saludable al Azúcar Refinado:</strong> Su dulzor natural y su perfil nutricional los convierten en el sustituto perfecto del azúcar en recetas, postres y batidos, añadiendo nutrientes en lugar de calorías vacías.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/dw8N63wV/TNUTdatiles.jpg" alt="TNUTdatiles" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Higo Turco seco (Sin azúcar añadida)', price: 100, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Deshidratados', imageUrl: 'https://i.ibb.co/35C2wxTZ/rev1-higos-turcos.jpg', origin: 'Turquía', ingredients: '100% Higo Turco', description: `<strong>• Origen de Élite Mundial:</strong> Proviene de Turquía, la cuna de los higos secos de mayor calidad y prestigio. Este origen es sinónimo de un producto grande, tierno y de sabor superior.<br><strong>• Dulzura Natural a Miel:</strong> Famoso por su intenso dulzor natural con notas claras a miel y caramelo, todo sin una gota de azúcar añadido. Es el postre de la naturaleza.<br><strong>• Textura Excepcional:</strong> Su piel es delgada y su interior extremadamente carnoso y tierno, con el característico y agradable crujido de sus pequeñas semillas. Una experiencia de consumo lujosa y satisfactoria.<br><strong>• Potencia en Fibra y Calcio:</strong> Es una de las mejores fuentes vegetales de fibra, ideal para la salud digestiva, y aporta una cantidad significativa de Calcio, esencial para la salud de los huesos.`, benefits: `<strong>• Excelente para la Salud Digestiva:</strong> Son muy ricos en fibra, lo que los convierte en un laxante natural eficaz para combatir el estreñimiento y promover la regularidad intestinal.<br><strong>• Fortalecimiento de los Huesos:</strong> Aportan una buena cantidad de calcio, potasio y magnesio, minerales esenciales para mantener una buena densidad ósea y prevenir enfermedades como la osteoporosis.<br><strong>• Control del Azúcar en Sangre:</strong> A pesar de su dulzura, su alto contenido de fibra ayuda a ralentizar la absorción de azúcar, lo que puede contribuir a mejorar los niveles de glucosa en sangre.<br><strong>• Salud Cardiovascular:</strong> Su fibra ayuda a reducir los niveles de colesterol, mientras que el potasio contribuye a mantener una presión arterial saludable, protegiendo así el corazón.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/kTdp7LW/TNUThigoturco.jpg" alt="TNUThigoturco" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Macadamia Nicaragüense natural', price: 158, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/SXyGg7X2/rev1-macadamia.jpg', origin: 'Nicaragua', ingredients: '100% Macadamia', description: `<strong>• Origen Volcánico Exótico:</strong> Cultivada en las fértiles tierras volcánicas de Nicaragua, un origen único que le confiere un perfil de sabor distintivo y una calidad excepcional.<br><strong>• Cremosidad Inigualable: </strong> Reconocida por su textura excepcionalmente cremosa y mantecosa que se deshace en la boca, una característica muy apreciada y buscada por los conocedores.<br><strong>• Sabor Rico y Sutil: </strong> Ofrece un sabor delicado, ligeramente dulce y con notas a nuez, sin el perfil a veces demasiado tostado de otras procedencias, lo que la hace perfecta tanto para snacks de lujo como para repostería fina.<br><strong>• Joya Centroamericana:</strong> La macadamia de Nicaragua es una joya emergente y de producción más limitada, ofreciendo una experiencia gourmet, sostenible y diferenciadora.`, benefits: `<strong>• Salud Cardiovascular Superior: </strong> Son excepcionalmente ricas en grasas monoinsaturadas (las "buenas"), como el ácido palmitoleico, ayudando a reducir drásticamente el colesterol malo (LDL) y a mantener las arterias flexibles y saludables.<br><strong>• Soporte para el Cerebro y Sistema Nervioso: </strong> Su perfil único de grasas y antioxidantes (como los tocotrienoles, una forma de Vitamina E) nutre las células cerebrales, protege contra el estrés oxidativo y apoya la función nerviosa.<br><strong>• Control del Apetito y Energía Limpia: </strong> Su alta concentración de grasas saludables y fibra genera una gran sensación de saciedad, ayudando a controlar el apetito y los antojos. Aportan energía densa y limpia, ideal para dietas bajas en carbohidratos.<br><strong>• Propiedades Antiinflamatorias: </strong> Contienen flavonoides y otros antioxidantes que ayudan a reducir la inflamación crónica en el cuerpo, un factor de riesgo para muchas enfermedades.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/d4PmnpLq/TNUTmacadamia.jpg" alt="TNUTmacadamia" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Maní Brasileño tostado ligeramente salado bola entera y mitades (Bajo en sodio)', price: 30, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/k2jhsHNk/rev1-mani-con-sal.jpg', origin: 'Brasil, Tostado: Colombia', ingredients: 'Maní tostado y sal en bajas cantidades', description: `<strong>• Origen de Prestigio:</strong> Proviene de Brasil, uno de los productores líderes en el mundo, reconocido por sus condiciones de cultivo ideales que resultan en un maní de alta calidad y gran sabor.<br><strong>• Sabor Intenso y Auténtico: </strong> El maní brasileño es famoso por su perfil de sabor más profundo y un dulzor natural más pronunciado, que se intensifica a la perfección con el proceso de tostado.<br><strong>• Calibre Superior: </strong> Seleccionamos granos de "bola entera" de gran tamaño, garantizando una mordida más crujiente y una experiencia de snack mucho más satisfactoria que la de manís más pequeños o partidos.<br><strong>• Toque de Sabor Perfecto:</strong> Tostado a la perfección y ligeramente salado (bajo en sodio) para realzar su sabor natural sin excesos, convirtiéndolo en el snack saludable y delicioso por excelencia.`, benefits: `<strong>• Fuente de Energía y Proteína Vegetal:</strong> Es un snack ideal para recargar energías de forma sostenida gracias a su combinación de grasas saludables y proteínas, que también ayudan a la reparación muscular.<br><strong>• Corazón Protegido y Saludable: </strong> Rico en grasas monoinsaturadas y niacina (Vitamina B3), ayuda a reducir el colesterol malo (LDL). Al ser bajo en sodio, apoya la salud cardiovascular sin el riesgo de la presión alta asociada a los snacks muy salados.<br><strong>• Soporte para el Cerebro y el Ánimo: </strong> Es una buena fuente de folato y biotina, vitaminas del complejo B que son importantes para la función cerebral y pueden contribuir a un estado de ánimo estable.<br><strong>• Control de Azúcar y Saciedad: </strong> La mezcla de fibra, proteína y grasas ayuda a regular los niveles de azúcar en la sangre y a mantenerte satisfecho por más tiempo, controlando los antojos.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/x8qYrQcG/TNUTmaniconsal.jpg" alt="TNUTmaniconsal" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Maní Brasileño tostado sin sal bola entera y mitades', price: 30, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/yr8DQgh/rev1-mani-sin-sal.jpg', origin: 'Brasil, Tostado: Colombia', ingredients: 'Maní tostado', description: `<strong>• Origen de Calidad Superior:</strong> Cultivado en Brasil, un origen reconocido mundialmente por producir maní de excelente calidad gracias a sus condiciones climáticas óptimas.<br><strong>• Sabor 100% Puro y Natural:</strong> Al ser tostado sin sal, puedes apreciar el auténtico sabor del grano: un perfil profundo, con un dulzor natural característico de la variedad brasileña, ideal para puristas del sabor.<br><strong>• Textura "Crunch" Insuperable: </strong> Seleccionamos exclusivamente maní de "bola entera" de gran calibre, lo que garantiza una textura extra crujiente y una experiencia de snack mucho más robusta y placentera.<br><strong>• Máxima Versatilidad Saludable:</strong> Perfecto para quienes siguen dietas bajas en sodio o simplemente prefieren un sabor sin aditivos. Es el ingrediente ideal para crear tus propias mezclas, mantequillas de maní caseras o para añadir a recetas dulces y saladas.`, benefits: `<strong>• Fuente Pura de Energía y Proteína Vegetal:</strong> Aporta una excelente combinación de grasas saludables y proteína para una energía duradera y una óptima recuperación muscular, sin aditivos.<br><strong>• Máxima Protección Cardiovascular (Sin Sodio): </strong> Al no tener sal, es la opción ideal para la salud del corazón. Sus grasas monoinsaturadas ayudan a reducir el colesterol malo (LDL) y a mantener una presión arterial saludable.<br><strong>• Control de Azúcar y Saciedad Natural: </strong> El poderoso trío de fibra, proteína y grasas saludables promueve una gran sensación de saciedad y ayuda a mantener estables los niveles de azúcar en la sangre, siendo un aliado en el control de peso.<br><strong>• Soporte para el Cerebro y Estado de Ánimo: </strong> Es una buena fuente de vitaminas del complejo B como el folato y la biotina, que son esenciales para la función cognitiva y el mantenimiento de un sistema nervioso.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/60Yrb2Vs/TNUTmanisinsal.jpg" alt="TNUTmanisinsal" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Marañón Brasileño entero tostado W1 320 sin sal', price: 118, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos',imageUrl: 'https://i.ibb.co/3tFQZXC/rev1-mara-on.jpg', origin: 'Brasil', ingredients: '99% Marañon y 1% aceite de algodón', description: `<strong>• Origen de Élite:</strong> Proviene de Brasil, uno de los productores más importantes y prestigiosos del mundo, reconocido por sus marañones de calidad superior y sabor excepcional.<br><strong>• Calibre Premium (W1 320):</strong> Seleccionamos el calibre W1 320, un estándar internacional que garantiza un marañón entero, de color claro ("White") y de gran tamaño (aproximadamente 320 nueces por libra). Esto asegura una calidad visual y una textura consistente que no se encuentra en calibres inferiores o partidos.<br><strong>• Textura y Sabor Inigualables: </strong> Famoso por su textura cremosa y mantecosa que se deshace en la boca, y un sabor naturalmente dulce y delicado, perfecto al ser tostado sin sal para apreciar todas sus notas.<br><strong>• Pureza y Versatilidad:</strong> Al ser entero y sin sal, es el ingrediente gourmet ideal para snacks de lujo, cocina vegana (para hacer quesos o cremas), repostería fina o como el protagonista de cualquier mezcla prémium.`, benefits: `<strong>• Salud Cardiovascular Óptima:</strong> Rico en grasas monoinsaturadas (las "buenas"), ayuda a reducir el colesterol malo (LDL) y, al no tener sal, es ideal para mantener una presión arterial saludable.<br><strong>• Fortalecimiento de Huesos y Nervios: </strong> Es una excelente fuente de magnesio y cobre, minerales esenciales para la densidad ósea, la producción de energía y el funcionamiento saludable del sistema nervioso.<br><strong>• Soporte Cerebral y Cognitivo:</strong> El cobre y las grasas saludables que contiene son vitales para la producción de neurotransmisores y la protección de las células cerebrales, apoyando la memoria y la concentración.<br><strong>• Prevención y Control de la Diabetes: </strong> Gracias a su bajo índice glucémico y su contenido de fibra y grasas saludables, ayuda a regular los niveles de azúcar en la sangre, siendo un snack seguro y beneficioso.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/zpd61RM/TNUTmara-on.jpg" alt="TNUTmara-on" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Nuez del Brasil natural partida', price: 88, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos',imageUrl: 'https://i.ibb.co/6JcjSzSD/rev1-nuez-brasil.jpg', origin: 'Brasil', ingredients: '100% Nuez del Brasil', description: `<strong>• Origen Auténtico del Amazonas:</strong> Proviene de Brasil, su lugar de origen en el corazón de la selva amazónica. Este entorno salvaje y natural le confiere una riqueza nutricional inigualable.<br><strong>• La Mayor Fuente Natural de Selenio:</strong> Es el superalimento por excelencia. Con solo una o dos nueces al día puedes cubrir tus necesidades diarias de selenio, un mineral esencial con un potentísimo efecto antioxidante y clave para el sistema inmune.<br><strong>• Sabor Único y Textura Mantecosa: </strong> Ofrece un perfil de sabor suave, terroso y ligeramente dulce, con una textura crujiente pero mantecosa que la distingue de otras nueces.<br><strong>• Versatilidad Práctica:</strong> Al venir partida, es perfecta para añadir directamente a granolas, batidos, ensaladas o para crear tus propias mezclas energéticas, haciendo más fácil disfrutar de sus increíbles beneficios.`, benefits: `<strong>• Superdosis de Selenio para la Tiroides y Defensas:</strong> Es la fuente natural más potente de selenio, un mineral clave para la función de la tiroides, fortalecer el sistema inmune y proteger las células del daño oxidativo con solo una o dos nueces al día.<br><strong>• Salud Cardiovascular y Control del Colesterol: </strong> Gracias a su perfil de grasas saludables (monoinsaturadas y poliinsaturadas), ayuda a reducir el colesterol malo (LDL) y a mantener la salud del corazón y las arterias.<br><strong>• Potente Efecto Antiinflamatorio y Cerebral:</strong> Su alto contenido de antioxidantes como el selenio, la vitamina E y el ácido elágico ayuda a reducir la inflamación en el cuerpo y a proteger las neuronas del envejecimiento prematuro.<br><strong>• Fuente de Energía Completa: </strong> Aporta una mezcla densa de grasas saludables, proteínas y fibra, ofreciendo energía sostenida y una gran sensación de saciedad.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/nNmkVvth/TNUTnuezbrasil.jpg" alt="TNUTnuezbrasil" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Nuez del Nogal Americana natural', price: 115, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos',imageUrl: 'https://i.ibb.co/21171phD/rev1-nuez-nogal.jpg', origin: 'Estados Unidos', ingredients: '100% Nuez del Nogal', description: `<strong>• Origen de Calidad Superior:</strong> Proviene de Estados Unidos (California), líder mundial en producción, donde estrictos controles de calidad garantizan una nuez de calibre grande, color claro y frescura excepcional.<br><strong>• Potencia en Omega-3:</strong> Es reconocida como una de las mejores fuentes vegetales de Omega-3 (ALA), un ácido graso esencial fundamental para la salud del cerebro, el corazón y con potentes propiedades antiinflamatorias.<br><strong>• Sabor Robusto y Equilibrado:</strong> La variedad americana es apreciada por su sabor rico y robusto, con el característico toque amargo perfectamente equilibrado, ideal para repostería, ensaladas o como un snack que sacia.<br><strong>• Textura "Carnosa" y Crujiente:</strong> Ofrece una textura única, más "carnosa" y menos seca que otras variedades, lo que la hace especialmente placentera al morder y muy versátil en la cocina.`, benefits: `<strong>• Salud Cerebral Superior:</strong> Es el fruto seco rey en Omega-3 (ALA), un ácido graso esencial que nutre el cerebro, mejora la memoria, la concentración y protege contra el deterioro cognitivo.<br><strong>• Potente Acción Antioxidante y Antiinflamatoria:</strong> Contiene una combinación única y muy potente de antioxidantes (polifenoles y Vitamina E) que combaten el daño celular y reducen la inflamación crónica, ayudando a prevenir enfermedades.<br><strong>• Corazón Fuerte y Protegido:</strong> Su alto contenido de Omega-3, fibra y otros compuestos bioactivos ayuda a reducir el colesterol malo (LDL), disminuir la presión arterial y mejorar la salud de los vasos sanguíneos.<br><strong>• Mejora de la Salud Intestinal:</strong> Actúa como un prebiótico, alimentando a las bacterias beneficiosas del intestino. Un microbioma sano está vinculado a una mejor digestión, un sistema inmune más fuerte y un mejor estado de ánimo.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/ccqNNpvc/TNUTnueznogal.jpg" alt="TNUTnueznogal" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Nuez Pecan Americana natural', price: 175, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/yc0LGr5Z/rev1-nuez-pecan.jpg', origin: 'Estados Unidos', ingredients: '100% Nuez Pecan', description: `<strong>• Origen Auténtico y Superior:</strong> Proviene de Estados Unidos, la cuna de la Nuez Pecan. Este origen garantiza una calidad insuperable y el perfil de sabor clásico y más demandado a nivel mundial.<br><strong>• Dulzura Natural y Textura Mantecosa:</strong> Famosa por su sabor naturalmente dulce, con notas acarameladas y de mantequilla, mucho más suave y menos amarga que la nuez de nogal.<br><strong>• Rica en Antioxidantes y Grasas Saludables: </strong>  Es una de las nueces con mayor contenido de antioxidantes, que protegen las células del cuerpo. Además, está cargada de grasas monoinsaturadas, beneficiosas para la salud del corazón.<br><strong>• La Reina de la Repostería:</strong> Su sabor dulce y su textura tierna pero crujiente la convierten en la nuez preferida por chefs y pasteleros para tartas ("pecan pie"), brownies, galletas y postres gourmet.`, benefits: `<strong>• Salud del Corazón y Colesterol:</strong> Es una de las pocas fuentes vegetales de proteína completa (con todos los aminoácidos esenciales), ideal para la recuperación muscular y para mantener la energía estable.<br><strong>• Soporte para la Salud Cerebral y Nerviosa:</strong> Las grasas saludables y minerales como el manganeso y el cobre son esenciales para una buena función cognitiva y la salud del sistema nervioso.<br><strong>• Rico en Antioxidantes y Antienvejecimiento:</strong> Es uno de los frutos secos con mayor capacidad antioxidante, gracias a su alto contenido de flavonoides y Vitamina E, que combatan el daño celular y el envejecimiento prematuro.<br><strong>• Ayuda en el Control del Azúcar y Metabolismo:</strong> Su combinación de fibra y grasas saludables ayuda a regular los niveles de azúcar en la sangre, proporcionando energía estable y una mayor sensación de saciedad.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/XfVKSn1B/TNUTnuezpecan.jpg" alt="TNUTnuezpecan" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Con cáscara)', price: 130, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/nN9Rsx8r/rev1-pistacho.jpg', origin: 'Estados Unidos', ingredients: 'Pistacho y sal en bajas cantidades', description: `<strong>• Origen de Prestigio Mundial:</strong> Cultivado en California, Estados Unidos, reconocido globalmente por producir pistachos de calibre grande, apertura natural y un color verde vibrante, superando a menudo en tamaño a variedades de otras regiones.<br><strong>• Sabor Dulce y Menos Terroso:</strong> El pistacho californiano es famoso por su perfil de sabor limpio, naturalmente dulce y mantecoso, en contraste con el sabor a veces más intenso y terroso de los pistachos de Oriente Medio.<br><strong>• Tostado Perfecto y Sabor Realzado:</strong> Tostado a la perfección para maximizar su "crunch" y ligeramente salado (bajo en sodio), un toque justo que realza su dulzura natural sin opacarla, ideal para un snack saludable.<br><strong>• El Ritual de la Cáscara:</strong> Al venir con cáscara, no solo se conserva mejor su frescura, sino que promueve un consumo más consciente y pausado, convirtiendo el acto de comerlos en un placentero ritual.`, benefits: `<strong>• Proteína Completa y Energía Sostenida:</strong> Es una de las pocas fuentes vegetales de proteína completa (con todos los aminoácidos esenciales), ideal para la recuperación muscular y para mantener la energía estable.<br><strong>• Salud Cardiovascular Inteligente:</strong> Rico en grasas saludables y potasio para reducir el colesterol y regular la presión. Al ser bajo en sodio, ofrece el sabor sin el riesgo para la presión arterial asociado a los snacks muy salados.<br><strong>• Control de Peso y Porciones Conscientes:</strong> El acto de abrir la cáscara ralentiza el consumo (comer "mindful"), lo que promueve la saciedad y ayuda a controlar las porciones de forma natural, apoyando el manejo del peso.<br><strong>• Rico en Antioxidantes para Ojos y Células:</strong> Su color verde y morado proviene de la luteína y la zeaxantina, antioxidantes que protegen la salud ocular. Además, combate el daño celular en todo el cuerpo.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/jk5wJdgk/TNUTpistachoconcascara.jpg" alt="TNUTpistachoconcascara" border="0" width="295" height="291"/></div></div>` },
                        { name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', price: 270, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Secos', imageUrl: 'https://i.ibb.co/pjgNrvgX/rev1-pistacho-sin-cascara.jpg', origin: 'Estados Unidos', ingredients: 'Pistacho y sal en bajas cantidades', description: `<strong>• Origen de Prestigio Mundial:</strong> Cultivado en California, Estados Unidos, reconocido globalmente por producir pistachos de calibre grande, apertura natural y un color verde vibrante, superando a menudo en tamaño a variedades de otras regiones.<br><strong>• Sabor Dulce y Menos Terroso:</strong> El pistacho californiano es famoso por su perfil de sabor limpio, naturalmente dulce y mantecoso, en contraste con el sabor a veces más intenso y terroso de los pistachos de Oriente Medio.<br><strong>• Máxima Comodidad, Listo para Usar:</strong> Al venir sin cáscara, está listo para disfrutar al instante como un snack de lujo o para añadir directamente a ensaladas, postres, pestos o cualquier receta gourmet, ahorrándote tiempo y esfuerzo.<br><strong>• Ideal para Mezclas Premium:</strong> Su conveniencia y calidad lo convierten en el ingrediente perfecto para elevar cualquier mezcla de frutos secos, aportando color, un sabor inconfundible y una textura crujiente.`, benefits: `<strong>• Proteína Completa y Energía Sostenida:</strong> Es una de las pocas fuentes vegetales de proteína completa (con todos los aminoácidos esenciales), ideal para la recuperación muscular y para mantener la energía estable.<br><strong>• Salud Cardiovascular Inteligente:</strong> Rico en grasas saludables y potasio para reducir el colesterol y regular la presión. Al ser bajo en sodio, ofrece el sabor sin el riesgo para la presión arterial asociado a los snacks muy salados.<br><strong>• Rico en Antioxidantes para la Salud Visual y Celular:</strong> Su característico color verde y morado proviene de la luteína y zeaxantina, antioxidantes que se consumen directamente para proteger la salud de tus ojos y combatir el daño celular general.<br><strong>• Versatilidad y Nutrición Instantánea:</strong> Son el formato ideal para enriquecer instantáneamente ensaladas, yogures, pastas o batidos, facilitando la incorporación de fibra, vitaminas y minerales a tu dieta diaria.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/jk5wJdgk/TNUTpistachoconcascara.jpg" alt="TNUTpistachoconcascara" border="0" width="295" height="291" /></div></div>` },
                        { name: 'Uva pasa Mexicana flame mediana (Sin azúcar añadida)', price: 33, grams: 0, percentage: 0, justAddedIndividual: false, category: 'Frutos Deshidratados', imageUrl: 'https://i.ibb.co/kV0PGxt3/rev1-uva-pasa.jpg', origin: 'México', ingredients: 'Uvas y aceite vegetal', description: `<strong>• Origen Soleado y de Calidad:</strong> Cultivada bajo el intenso sol de México, un origen reconocido por producir uvas de gran calidad que resultan en pasas dulces, carnosas y de color intenso.<br><strong>• Variedad Flame Superior:</strong> Proviene de la uva de mesa "Flame Seedless", una variedad premium famosa por su gran tamaño, su textura suave y su dulzura equilibrada, a diferencia de otras pasas más pequeñas o secas.<br><strong>• Dulzura 100% Natural:</strong> Todo su delicioso sabor es completamente natural, sin azúcares añadidos. Es el toque perfecto para endulzar de forma saludable tus cereales, yogures, ensaladas y postres.<br><strong>• Fuente de Energía Rápida y Hierro:</strong> Es un snack ideal para un impulso de energía natural e inmediata, además de ser una buena fuente vegetal de hierro y potasio, nutrientes importantes para el día a día.`, benefits: `<strong>• Fuente de Energía Rápida y Natural:</strong> Sus azúcares naturales (fructosa y glucosa) proporcionan un impulso de energía inmediato, siendo un snack ideal para antes de la actividad física o para combatir la fatiga.<br><strong>• Ayuda a la Salud Digestiva: </strong> Son ricas en fibra dietética, lo que favorece un buen tránsito intestinal, ayuda a prevenir el estreñimiento y contribuye a una sensación de saciedad.<br><strong>• Combate la Anemia:</strong> Aportan una buena cantidad de hierro, un mineral esencial para la formación de glóbulos rojos y el transporte de oxígeno en la sangre.<br><strong>• Fortalecimiento Óseo:</strong> Contienen boro, un mineral que es importante para la absorción del calcio y el magnesio, contribuyendo así a la salud y densidad de los huesos.<br><strong>• Ricas en Antioxidantes: </strong> A pesar de su tamaño, concentran antioxidantes como los fenoles y polifenoles, que ayudan a proteger las células del cuerpo del daño causado por los radicales libres.`, nutritionInfo: `<div class="text-center"><strong>INFORMACION NUTRICIONAL:</strong><br><div class="flex justify-center"><img src="https://i.ibb.co/KCvjz1b/TNUTUVAS.jpg" alt="TNUTUVAS" border="0" width="295" height="291" /></div></div>` }
                    ];
                    this.predefinedMixes = [
                         { id: 1, name: 'Mix Corazón Fuerte', subtitle: 'Salud Cardiovascular', description1: 'Es una potencia para la salud de tu corazón.',description2:'La Nuez del Nogal  aporta Omega-3, que ayuda a reducir el colesterol "malo" (LDL). La Almendra y Macadamia son ricas en grasas monoinsaturadas saludables, que protegen las arterias. Finalmente, el Marañón es una de las mejores fuentes naturales de Magnesio. El magnesio es un mineral crucial para la salud del corazón porque ayuda a relajar las paredes de los vasos sanguíneos y las arterias, lo que mejora el flujo sanguíneo y ayuda a reducir la presión arterial.', ingredients: ['40% Nuez del Nogal Americana natural', '30% Almendra Americana NPX natural', '15% Macadamia Nicaragüense natural', '15% Marañón Brasileño entero tostado W1 320 sin sal'], proportions: [{ name: 'Nuez del Nogal Americana natural', percentage: 40 }, { name: 'Almendra Americana NPX natural', percentage: 30 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 15 }, { name: 'Macadamia Nicaragüense natural', percentage: 15 }], gramsToAdd: 0 },
                       { id: 2, name: 'Mix Escudo', subtitle: 'Antioxidante', description1: 'Combate el daño de los radicales libres que aceleran el envejecimiento.',description2: 'La Baya de Goji es de las fuentes mas ricas de antioxidantes del planeta, rica en Zeaxantina y polisacáridos (LBP) que combaten el estrés oxidativo. La Nuez del Nogal y la Nuez Pecan lideran el ranking de frutos secos con mayor capacidad antioxidante. La piel de la Avellana contiene una alta concentración de estos compuestos protectores.', ingredients: ['30% Nuez del Nogal Americana natural', '30% Baya Tibetana de Goji', '25% Nuez Pecan Americana natural', '15% Avellana Turca natural con piel'], proportions: [{ name: 'Nuez del Nogal Americana natural', percentage: 30 }, { name: 'Baya Tibetana de Goji', percentage: 30 }, { name: 'Nuez Pecan Americana natural', percentage: 25 }, { name: 'Avellana Turca natural con piel', percentage: 15 }], gramsToAdd: 0 },
                        { id: 3, name: 'Mix Digestión Activa', subtitle: 'Alto en Fibra', description1: 'Un aliado natural para tu sistema digestivo.',description2: 'El Higo Turco y el Dátil son excepcionalmente ricos en fibra soluble e insoluble, que promueve la regularidad intestinal. El Albaricoque también aporta una dosis significativa de fibra, mientras que la Almendra añade un crujido satisfactorio y fibra adicional para una digestión óptima.', ingredients: ['30% Higo Turco seco (Sin azúcar añadida)', '30% Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', '25% Almendra Americana NPX natural', '15% Albaricoque Turco seco (Sin azúcar añadida)'], proportions: [{ name: 'Higo Turco seco (Sin azúcar añadida)', percentage: 30 }, { name: 'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', percentage: 30 }, { name: 'Almendra Americana NPX natural', percentage: 25 }, { name: 'Albaricoque Turco seco (Sin azúcar añadida)', percentage: 15 }], gramsToAdd: 0 },
                        { id: 4, name: 'Mix Multinutrientes', subtitle: 'Vitaminas y Minerales', description1: 'Una verdadera bomba de micronutrientes esenciales.',description2: 'Con solo una o dos Nueces del Brasil se obtiene la dosis diaria de Selenio. La Baya de Goji aporta Vitamina A y C. El Pistacho ofrece Vitamina B6 y potasio. El Marañón es rico en cobre y zinc, y la Almendra en Vitamina E y magnesio.', ingredients: ['35% Almendra Americana NPX natural', '25% Marañón Brasileño entero tostado W1 320 sin sal', '20% Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', '15% Baya Tibetana de Goji', '5% Nuez del Brasil natural partida'], proportions: [{ name: 'Almendra Americana NPX natural', percentage: 35 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 25 }, { name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', percentage: 20 }, { name: 'Baya Tibetana de Goji', percentage: 15 }, { name: 'Nuez del Brasil natural partida', percentage: 5 }], gramsToAdd: 0 },
                        { id: 5, name: 'Mix Poder Proteico', subtitle: 'Proteínas', description1: 'La opción ideal para deportistas, vegetarianos o cualquiera que busque un impulso de proteína vegetal.',description2: 'El maní y la Almendra son los frutos secos con mayor contenido proteico, esencial para la reparación y construcción de músculos. El Pistacho complementa la mezcla con un perfil completo de aminoácidos.', ingredients: ['40% Maní Brasileño tostado sin sal bola entera y mitades ', '40% Almendra Americana NPX natural', '20% Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)'], proportions: [{ name: 'Maní Brasileño tostado sin sal bola entera y mitades', percentage: 40 }, { name: 'Almendra Americana NPX natural', percentage: 40 }, { name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', percentage: 20 }], gramsToAdd: 0 },
                        { id: 6, name: 'Mix Figura Ideal', subtitle: 'Ayuda con la Pérdida de Peso', description1: 'Un snack inteligente para controlar el apetito y mantenerte en tu peso ideal.',description2: 'La combinación de proteína, fibra y grasas saludables de la Almendra y el Marañón genera una gran sensación de saciedad, ayudándote a evitar antojos y ayudan al metabolismo energético. La Nuez del Nogal aporta Omega-3, que ayuda a regular el metabolismo.', ingredients: ['50% Almendra Americana NPX natural', '30% Nuez del Nogal Americana natural', '20% Marañón Brasileño entero tostado W1 320 sin sal'], proportions: [{ name: 'Almendra Americana NPX natural', percentage: 50 }, { name: 'Nuez del Nogal Americana natural', percentage: 30 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 20 }], gramsToAdd: 0 },
                        { id: 7, name: 'Mix Mente Brillante', subtitle: 'Salud Cerebral', description1: 'Nutrición específica para tu cerebro.',description2: 'La Nuez del Nogal es la reina de la salud cerebral gracias a su altísimo contenido de Omega-3 (ALA), vital para las neuronas. La Uva pasa es rica en Boro, un mineral que ha demostrado mejorar la función cognitiva, la coordinación y la memoria a corto plazo. La Avellana es rica en Vitamina E la cual ayuda a prevenir el deterioro cognitivo.', ingredients: ['40% Nuez del Nogal Americana natural', '30% Uva pasa Mexicana flame mediana (Sin azúcar añadida)', '30% Avellana Turca natural con piel'], proportions: [{ name: 'Nuez del Nogal Americana natural', percentage: 40 }, { name: 'Uva pasa Mexicana flame mediana (Sin azúcar añadida)', percentage: 30 }, { name: 'Avellana Turca natural con piel', percentage: 30 }], gramsToAdd: 0 },
                        { id: 8, name: 'Mix Huesos de Acero', subtitle: 'Salud Ósea', description1: 'Fortalece tu estructura ósea desde adentro.',description2: 'El Higo Turco y la Almendra son excelentes fuentes vegetales de Calcio. El Marañón y la Almendra aportan Magnesio, un mineral crucial para la absorción del calcio. La Uva pasa contiene Boro, un mineral traza que juega un papel importante en la prevención de la osteoporosis.', ingredients: ['40% Almendra Americana NPX natural', '30% Higo Turco seco (Sin azúcar añadida)', '20% Marañón Brasileño entero tostado W1 320 sin sal', '10% Uva pasa Mexicana flame mediana (Sin azúcar añadida)'], proportions: [{ name: 'Almendra Americana NPX natural', percentage: 40 }, { name: 'Higo Turco seco (Sin azúcar añadida)', percentage: 30 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 20 }, { name: 'Uva pasa Mexicana flame mediana (Sin azúcar añadida)', percentage: 10 }], gramsToAdd: 0 },
                        { id: 9, name: 'Mix Zen', subtitle: 'Efecto Antiinflamatorio', description1: 'Ayuda a tu cuerpo a combatir la inflamación crónica de forma natural.',description2: 'La Nuez del Nogal es la fuente principal de ácidos grasos Omega-3 antiinflamatorios. La Nuez Pecan y la Almendra contienen antioxidantes y grasas saludables que ayudan a reducir los marcadores inflamatorios. La Baya de Goji añade su potente polisacárido antiinflamantorio para un efecto sinérgico.', ingredients: ['40% Nuez del Nogal Americana natural', '30% Almendra Americana NPX natural', '20% Nuez Pecan Americana natural', '10% Baya Tibetana de Goji'], proportions: [{ name: 'Nuez del Nogal Americana natural', percentage: 40 }, { name: 'Almendra Americana NPX natural', percentage: 30 }, { name: 'Nuez Pecan Americana natural', percentage: 20 }, { name: 'Baya Tibetana de Goji', percentage: 10 }], gramsToAdd: 0 },
                        { id: 10, name: 'Mix Alma Feliz', subtitle: 'Mejora del Estado de Ánimo', description1: 'Un impulso para tu bienestar emocional.',description2: 'La Nuez del Nogal contiene triptófano, un precursor de la serotonina (la "hormona de la felicidad"). El Marañón es rico en magnesio, conocido como el "mineral antiestrés". El Dátil provee energía rápida para combatir la fatiga, y el Pistacho contienen Vitamina B6, necesaria para la producción de neurotransmisores del bienestar.', ingredients: ['35% Nuez del Nogal Americana natural', '35% Marañón Brasileño entero tostado W1 320 sin sal', '20% Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', '10% Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)'], proportions: [{ name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 35 }, { name: 'Nuez del Nogal Americana natural', percentage: 35 }, { name: 'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', percentage: 20 }, { name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', percentage: 10 }], gramsToAdd: 0 },
                        { id: 11, name: 'Mix Inmunidad Total', subtitle: 'Aumento de Defensas', description1: 'Refuerza tu sistema inmune para protegerte de enfermedades.',description2: 'Una sola Nuez del Brasil aporta todo el selenio que necesitas, un mineral vital para la función inmunológica. La Nuez Pecan y el Marañón son ricos en zinc, esencial para el desarrollo y función de las células inmunitarias. La Almendra proveen Vitamina E, un antioxidante que protege las membranas de estas células. La Baya de Goji potencia la mezcla con vitamina C y polisacárido que estimulan la respuesta inmunitaria.', ingredients: ['30% Almendra Americana NPX natural','30% Marañón Brasileño entero tostado W1 320 sin sal', '20% Baya Tibetana de Goji', '10% Nuez Pecan Americana natural', '10% Nuez del Brasil natural partida'], proportions: [{ name: 'Almendra Americana NPX natural', percentage: 30 },{ name: 'Baya Tibetana de Goji', percentage: 20 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 30 }, { name: 'Nuez Pecan Americana natural', percentage: 10 }, { name: 'Nuez del Brasil natural partida', percentage: 10 }], gramsToAdd: 0 },
                        { id: 12, name: 'Mix Flujo Ligero', subtitle: 'Combate el Estreñimiento', description1: 'La solución natural para la regularidad.',description2: 'Esta mezcla es una bomba de fibra. El Higo, el Dátil y el Albaricoque son famosos por su capacidad para ablandar las heces y estimular el tránsito intestinal. La Nuez Pecan añade un extra de fibra y grasas saludables, lubricando el sistema digestivo.', ingredients: ['35% Higo Turco seco (Sin azúcar añadida)', '30% Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', '20% Albaricoque Turco seco (Sin azúcar añadida)', '15% Nuez Pecan Americana natural'], proportions: [{ name: 'Higo Turco seco (Sin azúcar añadida)', percentage: 35 }, { name: 'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', percentage: 30 }, { name: 'Albaricoque Turco seco (Sin azúcar añadida)', percentage: 20 }, { name: 'Nuez Pecan Americana natural', percentage: 15 }], gramsToAdd: 0 },
                        { id: 13, name: 'Mix Eterna Juventud', subtitle: 'Propiedades Anti-envejecimiento', description1: 'Protege tus células desde adentro hacia afuera.',description2: 'La Baya de Goji y sus antioxidantes unicos lideran la defensa contra el envejecimiento, la Nuez de Nogal y la Nuez Pecan combaten el estrés oxidativo, una de las principales causas del envejecimiento celular. La Vitamina E de la Avellana es clave para mantener una piel elástica y saludable.', ingredients: ['40% Nuez del Nogal Americana natural', '25% Baya Tibetana de Goji', '20% Nuez Pecan Americana natural', '15% Avellana Turca natural con piel'], proportions: [{ name: 'Nuez del Nogal Americana natural', percentage: 40 }, { name: 'Baya Tibetana de Goji', percentage: 25 }, { name: 'Nuez Pecan Americana natural', percentage: 20 }, { name: 'Avellana Turca natural con piel', percentage: 15 }], gramsToAdd: 0 },
                        { id: 14, name: 'Mix Sangre de Hierro', subtitle: 'Combate la Anemia', description1: 'Un apoyo natural para aumentar tus niveles de hemoglobina.',description2: 'El Albaricoque y la Baya de Goji son excelentes fuentes vegetales de hierro. El Marañón es rico en cobre, un mineral indispensable para que el cuerpo pueda absorber y utilizar el hierro de manera eficiente. El Pistacho también complementa el aporte de hierro.', ingredients: ['35% Albaricoque Turco seco (Sin azúcar añadida)', '35% Marañón Brasileño entero tostado W1 320 sin sal', '20% Baya Tibetana de Goji', '10% Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)'], proportions: [{ name: 'Albaricoque Turco seco (Sin azúcar añadida)', percentage: 35 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 35 }, { name: 'Baya Tibetana de Goji', percentage: 20 }, { name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', percentage: 10 }], gramsToAdd: 0 },
                        { id: 15, name: 'Mix Calma Natural', subtitle: 'Combate Ansiedad y Depresión', description1: 'Un refugio de tranquilidad en cada bocado.',description2: 'La Nuez del Nogal es rica en Omega-3, ha demostrado mejorar los síntomas de la depresión. El Marañón y la Almendra son dos de las mejores fuentes de magnesio, un mineral que relaja el sistema nervioso y ayuda a reducir la ansiedad y el estrés.', ingredients: ['40% Nuez del Nogal Americana natural', '35% Almendra Americana NPX natural', '25% Marañón Brasileño entero tostado W1 320 sin sal'], proportions: [{ name: 'Nuez del Nogal Americana natural', percentage: 40 }, { name: 'Almendra Americana NPX natural', percentage: 35 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 25 }], gramsToAdd: 0 },
                        { id: 16, name: 'Mix Descanso y Claridad', subtitle: 'Mejora Memoria y Sueño', description1: 'Para un cerebro enfocado de día y un descanso reparador de noche.',description2: 'La Nuez del Nogal y el Arándano mejoran la función cognitiva y la memoria. Por otro lado, la Almendra y el Pistacho son fuentes naturales de melatonina, la hormona que regula el ciclo del sueño, ayudándote a conciliarlo y mejorar su calidad.', ingredients: ['35% Nuez del Nogal Americana natural', '35% Almendra Americana NPX natural', '15% Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', '15% Arándano deshidratado Americano Ocean Spray (Con azúcar añadida)'], proportions: [{ name: 'Nuez del Nogal Americana natural', percentage: 35 }, { name: 'Almendra Americana NPX natural', percentage: 35 }, { name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', percentage: 15 }, { name: 'Arándano deshidratado Americano Ocean Spray (Con azúcar añadida)', percentage: 15 }], gramsToAdd: 0 },
                        { id: 17, name: 'Mix Equilibrio Vital', subtitle: 'Control Diabetes y Tensión Arterial', description1: 'Ideal para mantener a raya los niveles de azúcar y presión arterial.',description2: 'Esta mezcla tiene un bajo índice glucémico. La Almendra ayuda a regular el azúcar en sangre después de las comidas. La Nuez del Nogal mejora la sensibilidad a la insulina. El Marañón con su magnesio, potencia el control de la glucosa y la relajación de las arterias. El Maní aporta proteína y fibra con un bajo índice glucémico.', ingredients: ['40% Almendra Americana NPX natural', '30% Nuez del Nogal Americana natural', '20% Maní Brasileño tostado sin sal bola entera y mitades ', '10% Marañón Brasileño entero tostado W1 320 sin sal'], proportions: [{ name: 'Almendra Americana NPX natural', percentage: 40 }, { name: 'Nuez del Nogal Americana natural', percentage: 30 }, { name: 'Maní Brasileño tostado sin sal bola entera y mitades', percentage: 20 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 10 }], gramsToAdd: 0 },
                        { id: 18, name: 'Mix Energía Sostenida', subtitle: 'Para el día a día', description1: 'Combate el cansancio de la tarde y proporciona un flujo de energía constante, sin los picos y caídas del azúcar refinado.',description2: 'La Almendra gracias a su combinación de proteína, fibra y grasas saludables asegura una liberación de energía lenta y sostenida. El Dátil aporta carbohidratos naturales de rápida absorción para un impulso de energía inmediato, pero sin ser procesados. La Macadamia es densa en calorías de grasas saludables, lo que las convierte en una fuente de energía de muy larga duración. El Marañón es rico en magnesio, que es crucial para convertir los alimentos en energía a nivel celular.', ingredients: ['40% Almendra Americana NPX natural', '30% Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', '20% Macadamia Nicaragüense natural', '10% Marañón Brasileño entero tostado W1 320 sin sal'], proportions: [{ name: 'Almendra Americana NPX natural', percentage: 40 }, { name: 'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', percentage: 30 }, { name: 'Macadamia Nicaragüense natural', percentage: 20 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 10 }], gramsToAdd: 0 },
                        { id: 19, name: 'Mix Piel Radiante', subtitle: 'Belleza desde Adentro', description1: 'Nutre la piel para mejorar su elasticidad, hidratación y protegerla del daño ambiental.',description2: 'La Almendra es una de las mejores fuentes de Vitamina E, un poderoso antioxidante que protege las células de la piel del daño solar y el envejecimiento. La Avellana aporta más Vitamina E y antioxidantes concentrados en su piel, que combaten la inflamación cutánea. La Baya de Goji es rica en Vitamina A (betacaroteno), esencial para la reparación de los tejidos de la piel y para mantenerla suave. La Nuez de Nogal gracias a su Omega-3 fortalece las membranas celulares de la piel, ayudando a mantenerla hidratada y flexible.', ingredients: ['40% Almendra Americana NPX natural', '25% Avellana Turca natural con piel', '20% Baya Tibetana de Goji', '15% Nuez del Nogal Americana natural'], proportions: [{ name: 'Almendra Americana NPX natural', percentage: 40 }, { name: 'Avellana Turca natural con piel', percentage: 25 }, { name: 'Baya Tibetana de Goji', percentage: 20 }, { name: 'Nuez del Nogal Americana natural', percentage: 15 }], gramsToAdd: 0 },
                        { id: 20, name: 'Mix Impulso Pre-Entreno', subtitle: 'Energía para el Ejercicio', description1: 'Ofrece el combustible rápido y eficiente que el cuerpo necesita antes de una sesión de ejercicio, mejorando el rendimiento y la resistencia.',description2: 'El Dátil es la fuente perfecta de carbohidratos de digestión rápida para tener energía disponible al instante. El Maní aporta proteína y un poco de grasa para dar sostenimiento al pico de energía inicial. La Uva pasa complementa a los Dátiles con más azúcares naturales para un combustible inmediato. La Almendra laminada añade una textura ligera y fácil de digerir antes del esfuerzo físico.', ingredients: ['40% Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', '30% Maní Brasileño tostado sin sal bola entera y mitades ', '20% Uva pasa Mexicana flame mediana (Sin azúcar añadida)', '10% Almendra Americana NPX laminada natural sin cutícula'], proportions: [{ name: 'Dátil Sayer iraní sin semilla (Sin Azúcar añadida)', percentage: 40 }, { name: 'Maní Brasileño tostado sin sal bola entera y mitades', percentage: 30 }, { name: 'Uva pasa Mexicana flame mediana (Sin azúcar añadida)', percentage: 20 }, { name: 'Almendra Americana NPX laminada natural sin cutícula', percentage: 10 }], gramsToAdd: 0 },
                        { id: 21, name: 'Mix Recuperación Post-Entreno', subtitle: 'Reparación Muscular', description1: 'Repone las reservas de energía (glucógeno) y proporciona las proteínas necesarias para reparar las fibras musculares después del ejercicio, acelerando la recuperación.',description2: 'El Marañón tienen una proporción ideal de carbohidratos y proteínas, perfecta para la recuperación muscular. El Maní es el rey de la proteína vegetal para una reparación muscular efectiva. El Arándano aporta los carbohidratos necesarios para rellenar las reservas de glucógeno y sus antioxidantes ayudan a reducir el dolor muscular post-ejercicio.', ingredients: ['40% Marañón Brasileño entero tostado W1 320 sin sal', '30% Maní Brasileño tostado sin sal bola entera y mitades ', '30% Arándano deshidratado Americano Ocean Spray (Con azúcar añadida)'], proportions: [{ name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 40 }, { name: 'Maní Brasileño tostado sin sal bola entera y mitades', percentage: 30 }, { name: 'Arándano deshidratado Americano Ocean Spray (Con azúcar añadida)', percentage: 30 }], gramsToAdd: 0 },
                        { id: 22, name: 'Mix Balance Femenino', subtitle: 'Salud Hormonal', description1: 'Apoya el equilibrio hormonal y alivia síntomas comunes del ciclo menstrual, gracias a su perfil de minerales específicos.',description2: 'La Almendra es rica en Magnesio y Calcio, que han demostrado ayudar a reducir los cólicos y los síntomas del síndrome premenstrual (SPM). El Marañón es otra fuente potentísima de Magnesio, conocido por su efecto relajante y por mejorar el estado de ánimo. El Albaricoque es una buena fuente de hierro, importante para reponer las pérdidas durante la menstruación. La Nuez de Nogal con su Omega-3 ayuda a regular la inflamación, que puede ser una causa de dolor menstrual.', ingredients: ['40% Almendra Americana NPX natural', '30% Marañón Brasileño entero tostado W1 320 sin sal', '20% Albaricoque Turco seco (Sin azúcar añadida)', '10% Nuez del Nogal Americana natural'], proportions: [{ name: 'Almendra Americana NPX natural', percentage: 40 }, { name: 'Marañón Brasileño entero tostado W1 320 sin sal', percentage: 30 }, { name: 'Albaricoque Turco seco (Sin azúcar añadida)', percentage: 20 }, { name: 'Nuez del Nogal Americana natural', percentage: 10 }], gramsToAdd: 0 },
                        { id: 23, name: 'Mix Vigor Masculino', subtitle: 'Salud del Hombre', description1: 'Enfocado en nutrientes clave para la salud masculina, como la función prostática, la producción de testosterona y la salud cardiovascular.',description2: 'El Pistacho es rico en Zinc, un mineral esencial para la salud de la próstata y la producción de testosterona. También contienen arginina, que mejora el flujo sanguíneo. La Nuez Pecan aporta antioxidantes y también es una buena fuente de Zinc. La Nuez del Nogal con su Omega-3 es fundamental para la salud cardiovascular general. La Nuez del Brasil es rica en Selenio que aporta es un antioxidante muy potente, también ligado a la producción de testosterona y la salud prostática.', ingredients: ['40% Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', '30% Nuez Pecan Americana natural', '20% Nuez del Nogal Americana natural', '10% Nuez del Brasil natural partida'], proportions: [{ name: 'Pistacho Californiano tostado ligeramente salado (Bajo en sodio - Sin cáscara)', percentage: 40 }, { name: 'Nuez Pecan Americana natural', percentage: 30 }, { name: 'Nuez del Nogal Americana natural', percentage: 20 }, { name: 'Nuez del Brasil natural partida', percentage: 10 }], gramsToAdd: 0 }
                    ];
                },
                viewProduct(nut) {
                    this.selectedNut = nut;
                    this.mode = 'productDetail';
                },
                backToBuilder() {
                    this.selectedNut = null;
                    this.activeTab = 1; 
                },
                removeFromCart(index) { this.cart.splice(index, 1); },

                get finalSummary() {
                    const subtotal = this.cart.reduce((acc, item) => acc + item.cost, 0);
                    const deliveryCostRaw = (this.delivery.mode === 'domicilio') ? this.delivery.cost : 0;
                    let discount = 0;
                    if (subtotal >= 200000) {
                        discount = deliveryCostRaw;
                    } else if (subtotal >= 100000) {
                        discount = deliveryCostRaw * 0.5;
                    }
                    const total = subtotal + deliveryCostRaw - discount;
                    return { subtotal, deliveryCostRaw, discount: Math.round(discount), total };
                },

                get isOrderButtonEnabled() {
                    if (this.cart.length === 0) return false;
                    if (!this.contactInfo.name || !this.contactInfo.phone || this.contactInfo.phone.length !== 10) return false;
                    if (this.delivery.mode === 'domicilio' && (!this.delivery.address || !this.delivery.locality)) return false;
                    return true;
                },

                placeOrder() {
                    if (!this.isOrderButtonEnabled) return;
                    this.showPreConfirmationModal = true;
                },

                async executeOrder() {
                    this.showPreConfirmationModal = false;
                    this.formStatus = 'Enviando...';

                    let orderSummary = `Pedido #${this.orderCounter} Nut&Mix\n=================================\n\n`;
                    orderSummary += `**Información de Contacto:**\nNombre: ${this.contactInfo.name}\nCelular: ${this.contactInfo.phone}\n\n`;
                    orderSummary += `**Detalle del Pedido:**\n`;
                    this.cart.forEach((item, index) => {
                        orderSummary += `--- ${item.name} (${item.totalGrams.toFixed(0)}g) - ${this.formatCurrency(item.cost)} ---\n`;
                        if (item.discount > 0) {
                            orderSummary += `  (Descuento por cantidad del ${item.discountPercentage}% aplicado)\n`;
                        }
                        item.nuts.filter(n => n.grams > 0).forEach(nut => { 
                            let nutLine = `  - ${nut.name}: ${nut.grams.toFixed(0)}g`;
                            if (nut.cutPreference) { // Añade la preferencia de corte al resumen
                                nutLine += ` (Presentación: ${nut.cutPreference})`;
                            }
                            orderSummary += nutLine + `\n`;
                        });
                        orderSummary += `\n`;
                    });
                    orderSummary += `**Resumen de Costos:**\nSubtotal: ${this.formatCurrency(this.finalSummary.subtotal)}\n`;

                    if (this.delivery.mode === 'domicilio') {
                        orderSummary += `Método: Domicilio\nDirección: ${this.delivery.address}, ${this.delivery.locality}, Bogotá\nCosto Domicilio: ${this.formatCurrency(this.finalSummary.deliveryCostRaw)}\n`;
                        if (this.finalSummary.discount > 0) orderSummary += `Descuento Domicilio: -${this.formatCurrency(this.finalSummary.discount)}\n`;
                    } else {
                        orderSummary += `Método: Recoger en Tienda\nDirección de Recogida: Carrera 19 # 183-30 (Usaquén, Bogotá)\nCosto Domicilio: ${this.formatCurrency(0)}\n`;
                    }

                    orderSummary += `-------------------\nTOTAL: ${this.formatCurrency(this.finalSummary.total)}\n`;
                    
                    const cleanSummaryForWhatsapp = orderSummary.replace(/\*\*/g, '');
                    
                    const formData = new FormData();
                    formData.append('Nombre', this.contactInfo.name);
                    formData.append('Celular', this.contactInfo.phone);
                    formData.append('Total_Pedido', this.formatCurrency(this.finalSummary.total));
                    formData.append('Resumen_Completo', orderSummary);

                    try {
                        const response = await fetch('https://formcarry.com/s/O3puiyHnvy5', {
                            method: 'POST', body: formData, headers: { 'Accept': 'application/json' }
                        });
                        if (response.ok) {
                            this.showConfirmation(orderSummary, cleanSummaryForWhatsapp);
                            this.orderCounter++;
                            localStorage.setItem('nutMixOrderCounter_v2', this.orderCounter);
                            this.cart = [];
                            this.resetBuilder();
                            this.delivery = { mode: 'domicilio', address: '', locality: '', distance: null, cost: 0, status: '', error: false, isLoading: false, addressPart1: '', addressPart2: '', addressPart3: '', interior: '', apartment: ''};
                            this.contactInfo = { name: '', phone: '', phoneError: '' };
                        } else { throw new Error('Error en el servidor.'); }
                    } catch (error) {
                        alert('Hubo un problema al enviar tu pedido. Por favor, intenta de nuevo.');
                    } finally {
                        this.formStatus = 'Confirmar Pedido';
                    }
                },
showConfirmation(summaryForModal, summaryForWhatsapp) {
    this.confirmationDetails.title = '¡Tu solicitud ha sido recibida con éxito!';
    let messageBody = '';
    const imageHtml = `<div class='flex justify-center mt-4'><img src='https://i.ibb.co/jkmzGCDZ/Airbrush-Image-Enhancer-1752901262222.jpg' alt='Logo de Agradecimiento' class='h-32 w-auto' /></div>`;

    if (this.delivery.mode === 'recoger') {
        messageBody = `<p>¡Tu creación está en marcha! Ya estamos seleccionando los ingredientes más frescos para tu mezcla. En breve, uno de nuestros expertos te contactará para confirmar los detalles del pago y avisarte en cuanto puedas pasar a recogerla. ¡Gracias por elegirnos!</p>`;
    } else { 
        messageBody = `<p>¡Gracias por elegirnos! Estamos seleccionando los frutos para tu mezcla. En breve, uno de nuestros expertos te contactará para coordinar el metodo de pago y programar la entrega en tu dirección.<br><br>Agradecemos tu confianza.</p>`;
    }
    
    // 1. Detecta si el usuario está en un dispositivo móvil
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    // 2. Prepara los datos del mensaje
    const customerName = this.contactInfo.name.split(' ')[0];
    const fullPhoneNumber = '57' + this.contactInfo.phone;
    const whatsappMessage = `¡Hola ${customerName}! Gracias por tu compra en Nut&Mix. Aquí tienes un resumen de tu pedido:\n\n${summaryForWhatsapp}`;

    // 3. Elige el enlace correcto según el dispositivo
    let whatsappUrl = '';
    if (isMobile) {
        // Enlace directo a la APP para móviles
        whatsappUrl = `whatsapp://send?phone=${fullPhoneNumber}&text=${encodeURIComponent(whatsappMessage)}`;
    } else {
        // Enlace a WhatsApp Web para computadores
        whatsappUrl = `https://wa.me/${fullPhoneNumber}?text=${encodeURIComponent(whatsappMessage)}`;
    }

    // 4. Abre WhatsApp automáticamente
    window.open(whatsappUrl, '_blank');
    
    // Muestra el modal de confirmación
    this.confirmationDetails.message = messageBody + imageHtml;
    this.confirmationDetails.summary = summaryForModal;
    this.showConfirmationModal = true;
},

                closeConfirmationModal() {
                    this.showConfirmationModal = false;
                },

                formatCurrency(value) { return new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 0 }).format(value); },
                calculateNutPercentage(grams) {
                    const totalGrams = this.nuts.reduce((acc, nut) => acc + (Number(nut.grams) || 0), 0);
                    if (totalGrams === 0) return '0.00'; return ((grams / totalGrams) * 100).toFixed(2);
                },
                calculateNutGrams(percentage) { return (this.totalGramsForPercentage * (percentage / 100)).toFixed(0); }
            }
        }
    </script>
</body>
